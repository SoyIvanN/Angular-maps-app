var Rk=Object.create;var Xx=Object.defineProperty,Ok=Object.defineProperties,Lk=Object.getOwnPropertyDescriptor,kk=Object.getOwnPropertyDescriptors,Fk=Object.getOwnPropertyNames,U_=Object.getOwnPropertySymbols,Nk=Object.getPrototypeOf,Kx=Object.prototype.hasOwnProperty,iM=Object.prototype.propertyIsEnumerable;var rM=(s,a,m)=>a in s?Xx(s,a,{enumerable:!0,configurable:!0,writable:!0,value:m}):s[a]=m,Ct=(s,a)=>{for(var m in a||={})Kx.call(a,m)&&rM(s,m,a[m]);if(U_)for(var m of U_(a))iM.call(a,m)&&rM(s,m,a[m]);return s},Fr=(s,a)=>Ok(s,kk(a));var $_=(s,a)=>{var m={};for(var d in s)Kx.call(s,d)&&a.indexOf(d)<0&&(m[d]=s[d]);if(s!=null&&U_)for(var d of U_(s))a.indexOf(d)<0&&iM.call(s,d)&&(m[d]=s[d]);return m};var zk=(s,a)=>()=>(a||s((a={exports:{}}).exports,a),a.exports);var Bk=(s,a,m,d)=>{if(a&&typeof a=="object"||typeof a=="function")for(let y of Fk(a))!Kx.call(s,y)&&y!==m&&Xx(s,y,{get:()=>a[y],enumerable:!(d=Lk(a,y))||d.enumerable});return s};var Jx=(s,a,m)=>(m=s!=null?Rk(Nk(s)):{},Bk(a||!s||!s.__esModule?Xx(m,"default",{value:s,enumerable:!0}):m,s));var Wh=(s,a,m)=>new Promise((d,y)=>{var i=B=>{try{L(m.next(B))}catch(q){y(q)}},M=B=>{try{L(m.throw(B))}catch(q){y(q)}},L=B=>B.done?d(B.value):Promise.resolve(B.value).then(i,M);L((m=m.apply(s,a)).next())});var K0=zk((LT,kT)=>{"use strict";(function(s,a){typeof LT=="object"&&typeof kT<"u"?kT.exports=a():typeof define=="function"&&define.amd?define(a):(s=typeof globalThis<"u"?globalThis:s||self,s.mapboxgl=a())})(LT,function(){"use strict";var s,a,m;function d(i,M){if(!s)s=M;else if(!a)a=M;else{var L="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",B={};s(B),m=M(B),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([L],{type:"text/javascript"})))}}d(["exports"],function(i){"use strict";var M="3.4.0";let L,B={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(L==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{L=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{L=t}}return L},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!B.API_URL)return null;try{let t=new URL(B.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function q(t){return B.API_URL_REGEX.test(t)}function se(t){return t.indexOf("mapbox:")===0}function ge(t){return B.API_CDN_URL_REGEX.test(t)}function Pe(t){return B.API_SPRITE_REGEX.test(t)}function Ke(t){return B.API_STYLE_REGEX.test(t)&&!Pe(t)}let Nt={create:"create",load:"load",fullLoad:"fullLoad"};function sn(t){let e=t.name.split("?")[0];return ge(e)&&e.includes("mapbox-gl.js")?"javascript":ge(e)&&e.includes("mapbox-gl.css")?"css":function(n){return B.API_FONTS_REGEX.test(n)}(e)?"fontRange":Pe(e)?"sprite":Ke(e)?"style":function(n){return B.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function Rt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var bt={},an={};Object.defineProperty(an,"__esModule",{value:!0}),an.setMatrixArrayType=function(t){an.ARRAY_TYPE=kn=t},an.toRadian=function(t){return t*jr},an.equals=function(t,e){return Math.abs(t-e)<=or*Math.max(1,Math.abs(t),Math.abs(e))},an.RANDOM=an.ARRAY_TYPE=an.EPSILON=void 0;var or=1e-6;an.EPSILON=or;var kn=typeof Float32Array<"u"?Float32Array:Array;an.ARRAY_TYPE=kn;var fi=Math.random;an.RANDOM=fi;var jr=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var wn={};function Ao(t){return Ao=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ao(t)}Object.defineProperty(wn,"__esModule",{value:!0}),wn.create=function(){var t=new pi.ARRAY_TYPE(4);return pi.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},wn.clone=function(t){var e=new pi.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},wn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},wn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},wn.fromValues=function(t,e,n,o){var c=new pi.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=o,c},wn.set=function(t,e,n,o,c){return t[0]=e,t[1]=n,t[2]=o,t[3]=c,t},wn.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},wn.invert=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],p=n*u-c*o;return p?(t[0]=u*(p=1/p),t[1]=-o*p,t[2]=-c*p,t[3]=n*p,t):null},wn.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},wn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},wn.multiply=Xl,wn.rotate=function(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=Math.sin(n),x=Math.cos(n);return t[0]=o*x+u*_,t[1]=c*x+p*_,t[2]=o*-_+u*x,t[3]=c*-_+p*x,t},wn.scale=function(t,e,n){var o=e[1],c=e[2],u=e[3],p=n[0],_=n[1];return t[0]=e[0]*p,t[1]=o*p,t[2]=c*_,t[3]=u*_,t},wn.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=-n,t[3]=o,t},wn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},wn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},wn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},wn.LDU=function(t,e,n,o){return t[2]=o[2]/o[0],n[0]=o[0],n[1]=o[1],n[3]=o[3]-t[2]*n[1],[t,e,n]},wn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},wn.subtract=Wr,wn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},wn.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=t[3],p=e[0],_=e[1],x=e[2],w=e[3];return Math.abs(n-p)<=pi.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-_)<=pi.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(c-x)<=pi.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-w)<=pi.EPSILON*Math.max(1,Math.abs(u),Math.abs(w))},wn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},wn.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t},wn.sub=wn.mul=void 0;var pi=function(t,e){if(t&&t.__esModule)return t;if(t===null||Ao(t)!=="object"&&typeof t!="function")return{default:t};var n=Na(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(o,u,p):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(an);function Na(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Na=function(o){return o?n:e})(t)}function Xl(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=n[0],x=n[1],w=n[2],E=n[3];return t[0]=o*_+u*x,t[1]=c*_+p*x,t[2]=o*w+u*E,t[3]=c*w+p*E,t}function Wr(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}wn.mul=Xl,wn.sub=Wr;var Wn={};function za(t){return za=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},za(t)}Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.create=function(){var t=new Ni.ARRAY_TYPE(6);return Ni.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},Wn.clone=function(t){var e=new Ni.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},Wn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},Wn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},Wn.fromValues=function(t,e,n,o,c,u){var p=new Ni.ARRAY_TYPE(6);return p[0]=t,p[1]=e,p[2]=n,p[3]=o,p[4]=c,p[5]=u,p},Wn.set=function(t,e,n,o,c,u,p){return t[0]=e,t[1]=n,t[2]=o,t[3]=c,t[4]=u,t[5]=p,t},Wn.invert=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],p=e[4],_=e[5],x=n*u-o*c;return x?(t[0]=u*(x=1/x),t[1]=-o*x,t[2]=-c*x,t[3]=n*x,t[4]=(c*_-u*p)*x,t[5]=(o*p-n*_)*x,t):null},Wn.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},Wn.multiply=Ba,Wn.rotate=function(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=e[4],x=e[5],w=Math.sin(n),E=Math.cos(n);return t[0]=o*E+u*w,t[1]=c*E+p*w,t[2]=o*-w+u*E,t[3]=c*-w+p*E,t[4]=_,t[5]=x,t},Wn.scale=function(t,e,n){var o=e[1],c=e[2],u=e[3],p=e[4],_=e[5],x=n[0],w=n[1];return t[0]=e[0]*x,t[1]=o*x,t[2]=c*w,t[3]=u*w,t[4]=p,t[5]=_,t},Wn.translate=function(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=e[4],x=e[5],w=n[0],E=n[1];return t[0]=o,t[1]=c,t[2]=u,t[3]=p,t[4]=o*w+u*E+_,t[5]=c*w+p*E+x,t},Wn.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=-n,t[3]=o,t[4]=0,t[5]=0,t},Wn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},Wn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},Wn.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},Wn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},Wn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},Wn.subtract=Qs,Wn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},Wn.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t},Wn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},Wn.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=t[3],p=t[4],_=t[5],x=e[0],w=e[1],E=e[2],I=e[3],S=e[4],A=e[5];return Math.abs(n-x)<=Ni.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(o-w)<=Ni.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(c-E)<=Ni.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(u-I)<=Ni.EPSILON*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(p-S)<=Ni.EPSILON*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(_-A)<=Ni.EPSILON*Math.max(1,Math.abs(_),Math.abs(A))},Wn.sub=Wn.mul=void 0;var Ni=function(t,e){if(t&&t.__esModule)return t;if(t===null||za(t)!=="object"&&typeof t!="function")return{default:t};var n=Zi(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(o,u,p):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(an);function Zi(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Zi=function(o){return o?n:e})(t)}function Ba(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=e[4],x=e[5],w=n[0],E=n[1],I=n[2],S=n[3],A=n[4],R=n[5];return t[0]=o*w+u*E,t[1]=c*w+p*E,t[2]=o*I+u*S,t[3]=c*I+p*S,t[4]=o*A+u*R+_,t[5]=c*A+p*R+x,t}function Qs(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}Wn.mul=Ba,Wn.sub=Qs;var Tn={};function ja(t){return ja=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ja(t)}Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.create=function(){var t=new ri.ARRAY_TYPE(9);return ri.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Tn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Tn.clone=function(t){var e=new ri.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Tn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Tn.fromValues=function(t,e,n,o,c,u,p,_,x){var w=new ri.ARRAY_TYPE(9);return w[0]=t,w[1]=e,w[2]=n,w[3]=o,w[4]=c,w[5]=u,w[6]=p,w[7]=_,w[8]=x,w},Tn.set=function(t,e,n,o,c,u,p,_,x,w){return t[0]=e,t[1]=n,t[2]=o,t[3]=c,t[4]=u,t[5]=p,t[6]=_,t[7]=x,t[8]=w,t},Tn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Tn.transpose=function(t,e){if(t===e){var n=e[1],o=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=o,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Tn.invert=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],p=e[4],_=e[5],x=e[6],w=e[7],E=e[8],I=E*p-_*w,S=-E*u+_*x,A=w*u-p*x,R=n*I+o*S+c*A;return R?(t[0]=I*(R=1/R),t[1]=(-E*o+c*w)*R,t[2]=(_*o-c*p)*R,t[3]=S*R,t[4]=(E*n-c*x)*R,t[5]=(-_*n+c*u)*R,t[6]=A*R,t[7]=(-w*n+o*x)*R,t[8]=(p*n-o*u)*R,t):null},Tn.adjoint=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],p=e[4],_=e[5],x=e[6],w=e[7],E=e[8];return t[0]=p*E-_*w,t[1]=c*w-o*E,t[2]=o*_-c*p,t[3]=_*x-u*E,t[4]=n*E-c*x,t[5]=c*u-n*_,t[6]=u*w-p*x,t[7]=o*x-n*w,t[8]=n*p-o*u,t},Tn.determinant=function(t){var e=t[3],n=t[4],o=t[5],c=t[6],u=t[7],p=t[8];return t[0]*(p*n-o*u)+t[1]*(-p*e+o*c)+t[2]*(u*e-n*c)},Tn.multiply=Ys,Tn.translate=function(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=e[4],x=e[5],w=e[6],E=e[7],I=e[8],S=n[0],A=n[1];return t[0]=o,t[1]=c,t[2]=u,t[3]=p,t[4]=_,t[5]=x,t[6]=S*o+A*p+w,t[7]=S*c+A*_+E,t[8]=S*u+A*x+I,t},Tn.rotate=function(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=e[4],x=e[5],w=e[6],E=e[7],I=e[8],S=Math.sin(n),A=Math.cos(n);return t[0]=A*o+S*p,t[1]=A*c+S*_,t[2]=A*u+S*x,t[3]=A*p-S*o,t[4]=A*_-S*c,t[5]=A*x-S*u,t[6]=w,t[7]=E,t[8]=I,t},Tn.scale=function(t,e,n){var o=n[0],c=n[1];return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=c*e[3],t[4]=c*e[4],t[5]=c*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Tn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Tn.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=-n,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Tn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Tn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Tn.fromQuat=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],p=n+n,_=o+o,x=c+c,w=n*p,E=o*p,I=o*_,S=c*p,A=c*_,R=c*x,k=u*p,z=u*_,j=u*x;return t[0]=1-I-R,t[3]=E-j,t[6]=S+z,t[1]=E+j,t[4]=1-w-R,t[7]=A-k,t[2]=S-z,t[5]=A+k,t[8]=1-w-I,t},Tn.normalFromMat4=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],p=e[4],_=e[5],x=e[6],w=e[7],E=e[8],I=e[9],S=e[10],A=e[11],R=e[12],k=e[13],z=e[14],j=e[15],W=n*_-o*p,X=n*x-c*p,Q=n*w-u*p,oe=o*x-c*_,J=o*w-u*_,le=c*w-u*x,ue=E*k-I*R,_e=E*z-S*R,Ie=E*j-A*R,ve=I*z-S*k,Se=I*j-A*k,Me=S*j-A*z,De=W*Me-X*Se+Q*ve+oe*Ie-J*_e+le*ue;return De?(t[0]=(_*Me-x*Se+w*ve)*(De=1/De),t[1]=(x*Ie-p*Me-w*_e)*De,t[2]=(p*Se-_*Ie+w*ue)*De,t[3]=(c*Se-o*Me-u*ve)*De,t[4]=(n*Me-c*Ie+u*_e)*De,t[5]=(o*Ie-n*Se-u*ue)*De,t[6]=(k*le-z*J+j*oe)*De,t[7]=(z*Q-R*le-j*X)*De,t[8]=(R*J-k*Q+j*W)*De,t):null},Tn.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Tn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Tn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Tn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},Tn.subtract=Qi,Tn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},Tn.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t},Tn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Tn.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=t[3],p=t[4],_=t[5],x=t[6],w=t[7],E=t[8],I=e[0],S=e[1],A=e[2],R=e[3],k=e[4],z=e[5],j=e[6],W=e[7],X=e[8];return Math.abs(n-I)<=ri.EPSILON*Math.max(1,Math.abs(n),Math.abs(I))&&Math.abs(o-S)<=ri.EPSILON*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(c-A)<=ri.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(u-R)<=ri.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(p-k)<=ri.EPSILON*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(_-z)<=ri.EPSILON*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(x-j)<=ri.EPSILON*Math.max(1,Math.abs(x),Math.abs(j))&&Math.abs(w-W)<=ri.EPSILON*Math.max(1,Math.abs(w),Math.abs(W))&&Math.abs(E-X)<=ri.EPSILON*Math.max(1,Math.abs(E),Math.abs(X))},Tn.sub=Tn.mul=void 0;var ri=function(t,e){if(t&&t.__esModule)return t;if(t===null||ja(t)!=="object"&&typeof t!="function")return{default:t};var n=Va(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(o,u,p):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(an);function Va(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Va=function(o){return o?n:e})(t)}function Ys(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=e[4],x=e[5],w=e[6],E=e[7],I=e[8],S=n[0],A=n[1],R=n[2],k=n[3],z=n[4],j=n[5],W=n[6],X=n[7],Q=n[8];return t[0]=S*o+A*p+R*w,t[1]=S*c+A*_+R*E,t[2]=S*u+A*x+R*I,t[3]=k*o+z*p+j*w,t[4]=k*c+z*_+j*E,t[5]=k*u+z*x+j*I,t[6]=W*o+X*p+Q*w,t[7]=W*c+X*_+Q*E,t[8]=W*u+X*x+Q*I,t}function Qi(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}Tn.mul=Ys,Tn.sub=Qi;var It={};function Xs(t){return Xs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xs(t)}Object.defineProperty(It,"__esModule",{value:!0}),It.create=function(){var t=new Jn.ARRAY_TYPE(16);return Jn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},It.clone=function(t){var e=new Jn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},It.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},It.fromValues=function(t,e,n,o,c,u,p,_,x,w,E,I,S,A,R,k){var z=new Jn.ARRAY_TYPE(16);return z[0]=t,z[1]=e,z[2]=n,z[3]=o,z[4]=c,z[5]=u,z[6]=p,z[7]=_,z[8]=x,z[9]=w,z[10]=E,z[11]=I,z[12]=S,z[13]=A,z[14]=R,z[15]=k,z},It.set=function(t,e,n,o,c,u,p,_,x,w,E,I,S,A,R,k,z){return t[0]=e,t[1]=n,t[2]=o,t[3]=c,t[4]=u,t[5]=p,t[6]=_,t[7]=x,t[8]=w,t[9]=E,t[10]=I,t[11]=S,t[12]=A,t[13]=R,t[14]=k,t[15]=z,t},It.identity=Ua,It.transpose=function(t,e){if(t===e){var n=e[1],o=e[2],c=e[3],u=e[6],p=e[7],_=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=o,t[9]=u,t[11]=e[14],t[12]=c,t[13]=p,t[14]=_}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},It.invert=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],p=e[4],_=e[5],x=e[6],w=e[7],E=e[8],I=e[9],S=e[10],A=e[11],R=e[12],k=e[13],z=e[14],j=e[15],W=n*_-o*p,X=n*x-c*p,Q=n*w-u*p,oe=o*x-c*_,J=o*w-u*_,le=c*w-u*x,ue=E*k-I*R,_e=E*z-S*R,Ie=E*j-A*R,ve=I*z-S*k,Se=I*j-A*k,Me=S*j-A*z,De=W*Me-X*Se+Q*ve+oe*Ie-J*_e+le*ue;return De?(t[0]=(_*Me-x*Se+w*ve)*(De=1/De),t[1]=(c*Se-o*Me-u*ve)*De,t[2]=(k*le-z*J+j*oe)*De,t[3]=(S*J-I*le-A*oe)*De,t[4]=(x*Ie-p*Me-w*_e)*De,t[5]=(n*Me-c*Ie+u*_e)*De,t[6]=(z*Q-R*le-j*X)*De,t[7]=(E*le-S*Q+A*X)*De,t[8]=(p*Se-_*Ie+w*ue)*De,t[9]=(o*Ie-n*Se-u*ue)*De,t[10]=(R*J-k*Q+j*W)*De,t[11]=(I*Q-E*J-A*W)*De,t[12]=(_*_e-p*ve-x*ue)*De,t[13]=(n*ve-o*_e+c*ue)*De,t[14]=(k*X-R*oe-z*W)*De,t[15]=(E*oe-I*X+S*W)*De,t):null},It.adjoint=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],p=e[4],_=e[5],x=e[6],w=e[7],E=e[8],I=e[9],S=e[10],A=e[11],R=e[12],k=e[13],z=e[14],j=e[15];return t[0]=_*(S*j-A*z)-I*(x*j-w*z)+k*(x*A-w*S),t[1]=-(o*(S*j-A*z)-I*(c*j-u*z)+k*(c*A-u*S)),t[2]=o*(x*j-w*z)-_*(c*j-u*z)+k*(c*w-u*x),t[3]=-(o*(x*A-w*S)-_*(c*A-u*S)+I*(c*w-u*x)),t[4]=-(p*(S*j-A*z)-E*(x*j-w*z)+R*(x*A-w*S)),t[5]=n*(S*j-A*z)-E*(c*j-u*z)+R*(c*A-u*S),t[6]=-(n*(x*j-w*z)-p*(c*j-u*z)+R*(c*w-u*x)),t[7]=n*(x*A-w*S)-p*(c*A-u*S)+E*(c*w-u*x),t[8]=p*(I*j-A*k)-E*(_*j-w*k)+R*(_*A-w*I),t[9]=-(n*(I*j-A*k)-E*(o*j-u*k)+R*(o*A-u*I)),t[10]=n*(_*j-w*k)-p*(o*j-u*k)+R*(o*w-u*_),t[11]=-(n*(_*A-w*I)-p*(o*A-u*I)+E*(o*w-u*_)),t[12]=-(p*(I*z-S*k)-E*(_*z-x*k)+R*(_*S-x*I)),t[13]=n*(I*z-S*k)-E*(o*z-c*k)+R*(o*S-c*I),t[14]=-(n*(_*z-x*k)-p*(o*z-c*k)+R*(o*x-c*_)),t[15]=n*(_*S-x*I)-p*(o*S-c*I)+E*(o*x-c*_),t},It.determinant=function(t){var e=t[0],n=t[1],o=t[2],c=t[3],u=t[4],p=t[5],_=t[6],x=t[7],w=t[8],E=t[9],I=t[10],S=t[11],A=t[12],R=t[13],k=t[14],z=t[15];return(e*p-n*u)*(I*z-S*k)-(e*_-o*u)*(E*z-S*R)+(e*x-c*u)*(E*k-I*R)+(n*_-o*p)*(w*z-S*A)-(n*x-c*p)*(w*k-I*A)+(o*x-c*_)*(w*R-E*A)},It.multiply=ws,It.translate=function(t,e,n){var o,c,u,p,_,x,w,E,I,S,A,R,k=n[0],z=n[1],j=n[2];return e===t?(t[12]=e[0]*k+e[4]*z+e[8]*j+e[12],t[13]=e[1]*k+e[5]*z+e[9]*j+e[13],t[14]=e[2]*k+e[6]*z+e[10]*j+e[14],t[15]=e[3]*k+e[7]*z+e[11]*j+e[15]):(c=e[1],u=e[2],p=e[3],_=e[4],x=e[5],w=e[6],E=e[7],I=e[8],S=e[9],A=e[10],R=e[11],t[0]=o=e[0],t[1]=c,t[2]=u,t[3]=p,t[4]=_,t[5]=x,t[6]=w,t[7]=E,t[8]=I,t[9]=S,t[10]=A,t[11]=R,t[12]=o*k+_*z+I*j+e[12],t[13]=c*k+x*z+S*j+e[13],t[14]=u*k+w*z+A*j+e[14],t[15]=p*k+E*z+R*j+e[15]),t},It.scale=function(t,e,n){var o=n[0],c=n[1],u=n[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},It.rotate=function(t,e,n,o){var c,u,p,_,x,w,E,I,S,A,R,k,z,j,W,X,Q,oe,J,le,ue,_e,Ie,ve,Se=o[0],Me=o[1],De=o[2],Fe=Math.hypot(Se,Me,De);return Fe<Jn.EPSILON?null:(Se*=Fe=1/Fe,Me*=Fe,De*=Fe,c=Math.sin(n),u=Math.cos(n),x=e[1],w=e[2],E=e[3],S=e[5],A=e[6],R=e[7],z=e[9],j=e[10],W=e[11],X=Se*Se*(p=1-u)+u,J=Se*Me*p-De*c,le=Me*Me*p+u,ue=De*Me*p+Se*c,_e=Se*De*p+Me*c,Ie=Me*De*p-Se*c,ve=De*De*p+u,t[0]=(_=e[0])*X+(I=e[4])*(Q=Me*Se*p+De*c)+(k=e[8])*(oe=De*Se*p-Me*c),t[1]=x*X+S*Q+z*oe,t[2]=w*X+A*Q+j*oe,t[3]=E*X+R*Q+W*oe,t[4]=_*J+I*le+k*ue,t[5]=x*J+S*le+z*ue,t[6]=w*J+A*le+j*ue,t[7]=E*J+R*le+W*ue,t[8]=_*_e+I*Ie+k*ve,t[9]=x*_e+S*Ie+z*ve,t[10]=w*_e+A*Ie+j*ve,t[11]=E*_e+R*Ie+W*ve,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},It.rotateX=function(t,e,n){var o=Math.sin(n),c=Math.cos(n),u=e[4],p=e[5],_=e[6],x=e[7],w=e[8],E=e[9],I=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*c+w*o,t[5]=p*c+E*o,t[6]=_*c+I*o,t[7]=x*c+S*o,t[8]=w*c-u*o,t[9]=E*c-p*o,t[10]=I*c-_*o,t[11]=S*c-x*o,t},It.rotateY=function(t,e,n){var o=Math.sin(n),c=Math.cos(n),u=e[0],p=e[1],_=e[2],x=e[3],w=e[8],E=e[9],I=e[10],S=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*c-w*o,t[1]=p*c-E*o,t[2]=_*c-I*o,t[3]=x*c-S*o,t[8]=u*o+w*c,t[9]=p*o+E*c,t[10]=_*o+I*c,t[11]=x*o+S*c,t},It.rotateZ=function(t,e,n){var o=Math.sin(n),c=Math.cos(n),u=e[0],p=e[1],_=e[2],x=e[3],w=e[4],E=e[5],I=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*c+w*o,t[1]=p*c+E*o,t[2]=_*c+I*o,t[3]=x*c+S*o,t[4]=w*c-u*o,t[5]=E*c-p*o,t[6]=I*c-_*o,t[7]=S*c-x*o,t},It.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},It.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},It.fromRotation=function(t,e,n){var o,c,u,p=n[0],_=n[1],x=n[2],w=Math.hypot(p,_,x);return w<Jn.EPSILON?null:(p*=w=1/w,_*=w,x*=w,o=Math.sin(e),c=Math.cos(e),t[0]=p*p*(u=1-c)+c,t[1]=_*p*u+x*o,t[2]=x*p*u-_*o,t[3]=0,t[4]=p*_*u-x*o,t[5]=_*_*u+c,t[6]=x*_*u+p*o,t[7]=0,t[8]=p*x*u+_*o,t[9]=_*x*u-p*o,t[10]=x*x*u+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},It.fromXRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},It.fromYRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},It.fromZRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},It.fromRotationTranslation=Ts,It.fromQuat2=function(t,e){var n=new Jn.ARRAY_TYPE(3),o=-e[0],c=-e[1],u=-e[2],p=e[3],_=e[4],x=e[5],w=e[6],E=e[7],I=o*o+c*c+u*u+p*p;return I>0?(n[0]=2*(_*p+E*o+x*u-w*c)/I,n[1]=2*(x*p+E*c+w*o-_*u)/I,n[2]=2*(w*p+E*u+_*c-x*o)/I):(n[0]=2*(_*p+E*o+x*u-w*c),n[1]=2*(x*p+E*c+w*o-_*u),n[2]=2*(w*p+E*u+_*c-x*o)),Ts(t,e,n),t},It.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},It.getScaling=Jl,It.getRotation=function(t,e){var n=new Jn.ARRAY_TYPE(3);Jl(n,e);var o=1/n[0],c=1/n[1],u=1/n[2],p=e[0]*o,_=e[1]*c,x=e[2]*u,w=e[4]*o,E=e[5]*c,I=e[6]*u,S=e[8]*o,A=e[9]*c,R=e[10]*u,k=p+E+R,z=0;return k>0?(z=2*Math.sqrt(k+1),t[3]=.25*z,t[0]=(I-A)/z,t[1]=(S-x)/z,t[2]=(_-w)/z):p>E&&p>R?(z=2*Math.sqrt(1+p-E-R),t[3]=(I-A)/z,t[0]=.25*z,t[1]=(_+w)/z,t[2]=(S+x)/z):E>R?(z=2*Math.sqrt(1+E-p-R),t[3]=(S-x)/z,t[0]=(_+w)/z,t[1]=.25*z,t[2]=(I+A)/z):(z=2*Math.sqrt(1+R-p-E),t[3]=(_-w)/z,t[0]=(S+x)/z,t[1]=(I+A)/z,t[2]=.25*z),t},It.fromRotationTranslationScale=function(t,e,n,o){var c=e[0],u=e[1],p=e[2],_=e[3],x=c+c,w=u+u,E=p+p,I=c*x,S=c*w,A=c*E,R=u*w,k=u*E,z=p*E,j=_*x,W=_*w,X=_*E,Q=o[0],oe=o[1],J=o[2];return t[0]=(1-(R+z))*Q,t[1]=(S+X)*Q,t[2]=(A-W)*Q,t[3]=0,t[4]=(S-X)*oe,t[5]=(1-(I+z))*oe,t[6]=(k+j)*oe,t[7]=0,t[8]=(A+W)*J,t[9]=(k-j)*J,t[10]=(1-(I+R))*J,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},It.fromRotationTranslationScaleOrigin=function(t,e,n,o,c){var u=e[0],p=e[1],_=e[2],x=e[3],w=u+u,E=p+p,I=_+_,S=u*w,A=u*E,R=u*I,k=p*E,z=p*I,j=_*I,W=x*w,X=x*E,Q=x*I,oe=o[0],J=o[1],le=o[2],ue=c[0],_e=c[1],Ie=c[2],ve=(1-(k+j))*oe,Se=(A+Q)*oe,Me=(R-X)*oe,De=(A-Q)*J,Fe=(1-(S+j))*J,Le=(z+W)*J,Ve=(R+X)*le,Be=(z-W)*le,Ce=(1-(S+k))*le;return t[0]=ve,t[1]=Se,t[2]=Me,t[3]=0,t[4]=De,t[5]=Fe,t[6]=Le,t[7]=0,t[8]=Ve,t[9]=Be,t[10]=Ce,t[11]=0,t[12]=n[0]+ue-(ve*ue+De*_e+Ve*Ie),t[13]=n[1]+_e-(Se*ue+Fe*_e+Be*Ie),t[14]=n[2]+Ie-(Me*ue+Le*_e+Ce*Ie),t[15]=1,t},It.fromQuat=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],p=n+n,_=o+o,x=c+c,w=n*p,E=o*p,I=o*_,S=c*p,A=c*_,R=c*x,k=u*p,z=u*_,j=u*x;return t[0]=1-I-R,t[1]=E+j,t[2]=S-z,t[3]=0,t[4]=E-j,t[5]=1-w-R,t[6]=A+k,t[7]=0,t[8]=S+z,t[9]=A-k,t[10]=1-w-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},It.frustum=function(t,e,n,o,c,u,p){var _=1/(n-e),x=1/(c-o),w=1/(u-p);return t[0]=2*u*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*u*x,t[6]=0,t[7]=0,t[8]=(n+e)*_,t[9]=(c+o)*x,t[10]=(p+u)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*u*2*w,t[15]=0,t},It.perspectiveNO=$a,It.perspectiveZO=function(t,e,n,o,c){var u,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=c*(u=1/(o-c)),t[14]=c*o*u):(t[10]=-1,t[14]=-o),t},It.perspectiveFromFieldOfView=function(t,e,n,o){var c=Math.tan(e.upDegrees*Math.PI/180),u=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),_=Math.tan(e.rightDegrees*Math.PI/180),x=2/(p+_),w=2/(c+u);return t[0]=x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=w,t[6]=0,t[7]=0,t[8]=-(p-_)*x*.5,t[9]=(c-u)*w*.5,t[10]=o/(n-o),t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n/(n-o),t[15]=0,t},It.orthoNO=Ir,It.orthoZO=function(t,e,n,o,c,u,p){var _=1/(e-n),x=1/(o-c),w=1/(u-p);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=w,t[11]=0,t[12]=(e+n)*_,t[13]=(c+o)*x,t[14]=u*w,t[15]=1,t},It.lookAt=function(t,e,n,o){var c,u,p,_,x,w,E,I,S,A,R=e[0],k=e[1],z=e[2],j=o[0],W=o[1],X=o[2],Q=n[0],oe=n[1],J=n[2];return Math.abs(R-Q)<Jn.EPSILON&&Math.abs(k-oe)<Jn.EPSILON&&Math.abs(z-J)<Jn.EPSILON?Ua(t):(E=R-Q,I=k-oe,S=z-J,c=W*(S*=A=1/Math.hypot(E,I,S))-X*(I*=A),u=X*(E*=A)-j*S,p=j*I-W*E,(A=Math.hypot(c,u,p))?(c*=A=1/A,u*=A,p*=A):(c=0,u=0,p=0),_=I*p-S*u,x=S*c-E*p,w=E*u-I*c,(A=Math.hypot(_,x,w))?(_*=A=1/A,x*=A,w*=A):(_=0,x=0,w=0),t[0]=c,t[1]=_,t[2]=E,t[3]=0,t[4]=u,t[5]=x,t[6]=I,t[7]=0,t[8]=p,t[9]=w,t[10]=S,t[11]=0,t[12]=-(c*R+u*k+p*z),t[13]=-(_*R+x*k+w*z),t[14]=-(E*R+I*k+S*z),t[15]=1,t)},It.targetTo=function(t,e,n,o){var c=e[0],u=e[1],p=e[2],_=o[0],x=o[1],w=o[2],E=c-n[0],I=u-n[1],S=p-n[2],A=E*E+I*I+S*S;A>0&&(E*=A=1/Math.sqrt(A),I*=A,S*=A);var R=x*S-w*I,k=w*E-_*S,z=_*I-x*E;return(A=R*R+k*k+z*z)>0&&(R*=A=1/Math.sqrt(A),k*=A,z*=A),t[0]=R,t[1]=k,t[2]=z,t[3]=0,t[4]=I*z-S*k,t[5]=S*R-E*z,t[6]=E*k-I*R,t[7]=0,t[8]=E,t[9]=I,t[10]=S,t[11]=0,t[12]=c,t[13]=u,t[14]=p,t[15]=1,t},It.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},It.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},It.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},It.subtract=Eu,It.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},It.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t[9]=e[9]+n[9]*o,t[10]=e[10]+n[10]*o,t[11]=e[11]+n[11]*o,t[12]=e[12]+n[12]*o,t[13]=e[13]+n[13]*o,t[14]=e[14]+n[14]*o,t[15]=e[15]+n[15]*o,t},It.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},It.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=t[3],p=t[4],_=t[5],x=t[6],w=t[7],E=t[8],I=t[9],S=t[10],A=t[11],R=t[12],k=t[13],z=t[14],j=t[15],W=e[0],X=e[1],Q=e[2],oe=e[3],J=e[4],le=e[5],ue=e[6],_e=e[7],Ie=e[8],ve=e[9],Se=e[10],Me=e[11],De=e[12],Fe=e[13],Le=e[14],Ve=e[15];return Math.abs(n-W)<=Jn.EPSILON*Math.max(1,Math.abs(n),Math.abs(W))&&Math.abs(o-X)<=Jn.EPSILON*Math.max(1,Math.abs(o),Math.abs(X))&&Math.abs(c-Q)<=Jn.EPSILON*Math.max(1,Math.abs(c),Math.abs(Q))&&Math.abs(u-oe)<=Jn.EPSILON*Math.max(1,Math.abs(u),Math.abs(oe))&&Math.abs(p-J)<=Jn.EPSILON*Math.max(1,Math.abs(p),Math.abs(J))&&Math.abs(_-le)<=Jn.EPSILON*Math.max(1,Math.abs(_),Math.abs(le))&&Math.abs(x-ue)<=Jn.EPSILON*Math.max(1,Math.abs(x),Math.abs(ue))&&Math.abs(w-_e)<=Jn.EPSILON*Math.max(1,Math.abs(w),Math.abs(_e))&&Math.abs(E-Ie)<=Jn.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ie))&&Math.abs(I-ve)<=Jn.EPSILON*Math.max(1,Math.abs(I),Math.abs(ve))&&Math.abs(S-Se)<=Jn.EPSILON*Math.max(1,Math.abs(S),Math.abs(Se))&&Math.abs(A-Me)<=Jn.EPSILON*Math.max(1,Math.abs(A),Math.abs(Me))&&Math.abs(R-De)<=Jn.EPSILON*Math.max(1,Math.abs(R),Math.abs(De))&&Math.abs(k-Fe)<=Jn.EPSILON*Math.max(1,Math.abs(k),Math.abs(Fe))&&Math.abs(z-Le)<=Jn.EPSILON*Math.max(1,Math.abs(z),Math.abs(Le))&&Math.abs(j-Ve)<=Jn.EPSILON*Math.max(1,Math.abs(j),Math.abs(Ve))},It.sub=It.mul=It.ortho=It.perspective=void 0;var Jn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Xs(t)!=="object"&&typeof t!="function")return{default:t};var n=Kl(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(o,u,p):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(an);function Kl(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Kl=function(o){return o?n:e})(t)}function Ua(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ws(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=e[4],x=e[5],w=e[6],E=e[7],I=e[8],S=e[9],A=e[10],R=e[11],k=e[12],z=e[13],j=e[14],W=e[15],X=n[0],Q=n[1],oe=n[2],J=n[3];return t[0]=X*o+Q*_+oe*I+J*k,t[1]=X*c+Q*x+oe*S+J*z,t[2]=X*u+Q*w+oe*A+J*j,t[3]=X*p+Q*E+oe*R+J*W,t[4]=(X=n[4])*o+(Q=n[5])*_+(oe=n[6])*I+(J=n[7])*k,t[5]=X*c+Q*x+oe*S+J*z,t[6]=X*u+Q*w+oe*A+J*j,t[7]=X*p+Q*E+oe*R+J*W,t[8]=(X=n[8])*o+(Q=n[9])*_+(oe=n[10])*I+(J=n[11])*k,t[9]=X*c+Q*x+oe*S+J*z,t[10]=X*u+Q*w+oe*A+J*j,t[11]=X*p+Q*E+oe*R+J*W,t[12]=(X=n[12])*o+(Q=n[13])*_+(oe=n[14])*I+(J=n[15])*k,t[13]=X*c+Q*x+oe*S+J*z,t[14]=X*u+Q*w+oe*A+J*j,t[15]=X*p+Q*E+oe*R+J*W,t}function Ts(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=o+o,x=c+c,w=u+u,E=o*_,I=o*x,S=o*w,A=c*x,R=c*w,k=u*w,z=p*_,j=p*x,W=p*w;return t[0]=1-(A+k),t[1]=I+W,t[2]=S-j,t[3]=0,t[4]=I-W,t[5]=1-(E+k),t[6]=R+z,t[7]=0,t[8]=S+j,t[9]=R-z,t[10]=1-(E+A),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Jl(t,e){var n=e[4],o=e[5],c=e[6],u=e[8],p=e[9],_=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,o,c),t[2]=Math.hypot(u,p,_),t}function $a(t,e,n,o,c){var u,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+o)*(u=1/(o-c)),t[14]=2*c*o*u):(t[10]=-1,t[14]=-2*o),t}function Ir(t,e,n,o,c,u,p){var _=1/(e-n),x=1/(o-c),w=1/(u-p);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+n)*_,t[13]=(c+o)*x,t[14]=(p+u)*w,t[15]=1,t}function Eu(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}It.perspective=$a,It.ortho=Ir,It.mul=ws,It.sub=Eu;var Pt={},Mt={};function ec(t){return ec=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ec(t)}Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=K,Mt.clone=function(t){var e=new Yi.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Mt.length=ie,Mt.fromValues=function(t,e,n){var o=new Yi.ARRAY_TYPE(3);return o[0]=t,o[1]=e,o[2]=n,o},Mt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Mt.set=function(t,e,n,o){return t[0]=e,t[1]=n,t[2]=o,t},Mt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Mt.subtract=pe,Mt.multiply=Ne,Mt.divide=je,Mt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Mt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Mt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Mt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Mt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Mt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Mt.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t},Mt.distance=qe,Mt.squaredDistance=mt,Mt.squaredLength=ke,Mt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Mt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Mt.normalize=function(t,e){var n=e[0],o=e[1],c=e[2],u=n*n+o*o+c*c;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t},Mt.dot=ct,Mt.cross=function(t,e,n){var o=e[0],c=e[1],u=e[2],p=n[0],_=n[1],x=n[2];return t[0]=c*x-u*_,t[1]=u*p-o*x,t[2]=o*_-c*p,t},Mt.lerp=function(t,e,n,o){var c=e[0],u=e[1],p=e[2];return t[0]=c+o*(n[0]-c),t[1]=u+o*(n[1]-u),t[2]=p+o*(n[2]-p),t},Mt.hermite=function(t,e,n,o,c,u){var p=u*u,_=p*(2*u-3)+1,x=p*(u-2)+u,w=p*(u-1),E=p*(3-2*u);return t[0]=e[0]*_+n[0]*x+o[0]*w+c[0]*E,t[1]=e[1]*_+n[1]*x+o[1]*w+c[1]*E,t[2]=e[2]*_+n[2]*x+o[2]*w+c[2]*E,t},Mt.bezier=function(t,e,n,o,c,u){var p=1-u,_=p*p,x=u*u,w=_*p,E=3*u*_,I=3*x*p,S=x*u;return t[0]=e[0]*w+n[0]*E+o[0]*I+c[0]*S,t[1]=e[1]*w+n[1]*E+o[1]*I+c[1]*S,t[2]=e[2]*w+n[2]*E+o[2]*I+c[2]*S,t},Mt.random=function(t,e){e=e||1;var n=2*Yi.RANDOM()*Math.PI,o=2*Yi.RANDOM()-1,c=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(n)*c,t[1]=Math.sin(n)*c,t[2]=o*e,t},Mt.transformMat4=function(t,e,n){var o=e[0],c=e[1],u=e[2],p=n[3]*o+n[7]*c+n[11]*u+n[15];return t[0]=(n[0]*o+n[4]*c+n[8]*u+n[12])/(p=p||1),t[1]=(n[1]*o+n[5]*c+n[9]*u+n[13])/p,t[2]=(n[2]*o+n[6]*c+n[10]*u+n[14])/p,t},Mt.transformMat3=function(t,e,n){var o=e[0],c=e[1],u=e[2];return t[0]=o*n[0]+c*n[3]+u*n[6],t[1]=o*n[1]+c*n[4]+u*n[7],t[2]=o*n[2]+c*n[5]+u*n[8],t},Mt.transformQuat=function(t,e,n){var o=n[0],c=n[1],u=n[2],p=e[0],_=e[1],x=e[2],w=c*x-u*_,E=u*p-o*x,I=o*_-c*p,S=c*I-u*E,A=u*w-o*I,R=o*E-c*w,k=2*n[3];return E*=k,I*=k,A*=2,R*=2,t[0]=p+(w*=k)+(S*=2),t[1]=_+E+A,t[2]=x+I+R,t},Mt.rotateX=function(t,e,n,o){var c=[],u=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],u[0]=c[0],u[1]=c[1]*Math.cos(o)-c[2]*Math.sin(o),u[2]=c[1]*Math.sin(o)+c[2]*Math.cos(o),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},Mt.rotateY=function(t,e,n,o){var c=[],u=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],u[0]=c[2]*Math.sin(o)+c[0]*Math.cos(o),u[1]=c[1],u[2]=c[2]*Math.cos(o)-c[0]*Math.sin(o),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},Mt.rotateZ=function(t,e,n,o){var c=[],u=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],u[0]=c[0]*Math.cos(o)-c[1]*Math.sin(o),u[1]=c[0]*Math.sin(o)+c[1]*Math.cos(o),u[2]=c[2],t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},Mt.angle=function(t,e){var n=t[0],o=t[1],c=t[2],u=e[0],p=e[1],_=e[2],x=Math.sqrt(n*n+o*o+c*c)*Math.sqrt(u*u+p*p+_*_),w=x&&ct(t,e)/x;return Math.acos(Math.min(Math.max(w,-1),1))},Mt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Mt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Mt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Mt.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=e[0],p=e[1],_=e[2];return Math.abs(n-u)<=Yi.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-p)<=Yi.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(c-_)<=Yi.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))},Mt.forEach=Mt.sqrLen=Mt.len=Mt.sqrDist=Mt.dist=Mt.div=Mt.mul=Mt.sub=void 0;var Yi=function(t,e){if(t&&t.__esModule)return t;if(t===null||ec(t)!=="object"&&typeof t!="function")return{default:t};var n=He(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(o,u,p):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(an);function He(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(He=function(o){return o?n:e})(t)}function K(){var t=new Yi.ARRAY_TYPE(3);return Yi.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ie(t){return Math.hypot(t[0],t[1],t[2])}function pe(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Ne(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function je(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function qe(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function mt(t,e){var n=e[0]-t[0],o=e[1]-t[1],c=e[2]-t[2];return n*n+o*o+c*c}function ke(t){var e=t[0],n=t[1],o=t[2];return e*e+n*n+o*o}function ct(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Mt.sub=pe,Mt.mul=Ne,Mt.div=je,Mt.dist=qe,Mt.sqrDist=mt,Mt.len=ie,Mt.sqrLen=ke;var ft,vt=(ft=K(),function(t,e,n,o,c,u){var p,_;for(e||(e=3),n||(n=0),_=o?Math.min(o*e+n,t.length):t.length,p=n;p<_;p+=e)ft[0]=t[p],ft[1]=t[p+1],ft[2]=t[p+2],c(ft,ft,u),t[p]=ft[0],t[p+1]=ft[1],t[p+2]=ft[2];return t});Mt.forEach=vt;var it={};function Bn(t){return Bn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bn(t)}Object.defineProperty(it,"__esModule",{value:!0}),it.create=Dn,it.clone=function(t){var e=new In.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},it.fromValues=function(t,e,n,o){var c=new In.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=o,c},it.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},it.set=function(t,e,n,o,c){return t[0]=e,t[1]=n,t[2]=o,t[3]=c,t},it.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},it.subtract=Mn,it.multiply=jn,it.divide=sr,it.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},it.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},it.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},it.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},it.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},it.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},it.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t},it.distance=zr,it.squaredDistance=Kn,it.length=mi,it.squaredLength=ii,it.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},it.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},it.normalize=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],p=n*n+o*o+c*c+u*u;return p>0&&(p=1/Math.sqrt(p)),t[0]=n*p,t[1]=o*p,t[2]=c*p,t[3]=u*p,t},it.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},it.cross=function(t,e,n,o){var c=n[0]*o[1]-n[1]*o[0],u=n[0]*o[2]-n[2]*o[0],p=n[0]*o[3]-n[3]*o[0],_=n[1]*o[2]-n[2]*o[1],x=n[1]*o[3]-n[3]*o[1],w=n[2]*o[3]-n[3]*o[2],E=e[0],I=e[1],S=e[2],A=e[3];return t[0]=I*w-S*x+A*_,t[1]=-E*w+S*p-A*u,t[2]=E*x-I*p+A*c,t[3]=-E*_+I*u-S*c,t},it.lerp=function(t,e,n,o){var c=e[0],u=e[1],p=e[2],_=e[3];return t[0]=c+o*(n[0]-c),t[1]=u+o*(n[1]-u),t[2]=p+o*(n[2]-p),t[3]=_+o*(n[3]-_),t},it.random=function(t,e){var n,o,c,u,p,_;e=e||1;do p=(n=2*In.RANDOM()-1)*n+(o=2*In.RANDOM()-1)*o;while(p>=1);do _=(c=2*In.RANDOM()-1)*c+(u=2*In.RANDOM()-1)*u;while(_>=1);var x=Math.sqrt((1-p)/_);return t[0]=e*n,t[1]=e*o,t[2]=e*c*x,t[3]=e*u*x,t},it.transformMat4=function(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3];return t[0]=n[0]*o+n[4]*c+n[8]*u+n[12]*p,t[1]=n[1]*o+n[5]*c+n[9]*u+n[13]*p,t[2]=n[2]*o+n[6]*c+n[10]*u+n[14]*p,t[3]=n[3]*o+n[7]*c+n[11]*u+n[15]*p,t},it.transformQuat=function(t,e,n){var o=e[0],c=e[1],u=e[2],p=n[0],_=n[1],x=n[2],w=n[3],E=w*o+_*u-x*c,I=w*c+x*o-p*u,S=w*u+p*c-_*o,A=-p*o-_*c-x*u;return t[0]=E*w+A*-p+I*-x-S*-_,t[1]=I*w+A*-_+S*-p-E*-x,t[2]=S*w+A*-x+E*-_-I*-p,t[3]=e[3],t},it.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},it.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},it.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},it.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=t[3],p=e[0],_=e[1],x=e[2],w=e[3];return Math.abs(n-p)<=In.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-_)<=In.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(c-x)<=In.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-w)<=In.EPSILON*Math.max(1,Math.abs(u),Math.abs(w))},it.forEach=it.sqrLen=it.len=it.sqrDist=it.dist=it.div=it.mul=it.sub=void 0;var In=function(t,e){if(t&&t.__esModule)return t;if(t===null||Bn(t)!=="object"&&typeof t!="function")return{default:t};var n=Fn(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(o,u,p):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(an);function Fn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Fn=function(o){return o?n:e})(t)}function Dn(){var t=new In.ARRAY_TYPE(4);return In.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Mn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function jn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function sr(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function zr(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Kn(t,e){var n=e[0]-t[0],o=e[1]-t[1],c=e[2]-t[2],u=e[3]-t[3];return n*n+o*o+c*c+u*u}function mi(t){return Math.hypot(t[0],t[1],t[2],t[3])}function ii(t){var e=t[0],n=t[1],o=t[2],c=t[3];return e*e+n*n+o*o+c*c}it.sub=Mn,it.mul=jn,it.div=sr,it.dist=zr,it.sqrDist=Kn,it.len=mi,it.sqrLen=ii;var lo=function(){var t=Dn();return function(e,n,o,c,u,p){var _,x;for(n||(n=4),o||(o=0),x=c?Math.min(c*n+o,e.length):e.length,_=o;_<x;_+=n)t[0]=e[_],t[1]=e[_+1],t[2]=e[_+2],t[3]=e[_+3],u(t,t,p),e[_]=t[0],e[_+1]=t[1],e[_+2]=t[2],e[_+3]=t[3];return e}}();function Dr(t){return Dr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dr(t)}it.forEach=lo,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.create=tt,Pt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Pt.setAxisAngle=nt,Pt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),o=Math.sin(n/2);return o>cr.EPSILON?(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o):(t[0]=1,t[1]=0,t[2]=0),n},Pt.getAngle=function(t,e){var n=Vn(t,e);return Math.acos(2*n*n-1)},Pt.multiply=Qe,Pt.rotateX=function(t,e,n){n*=.5;var o=e[0],c=e[1],u=e[2],p=e[3],_=Math.sin(n),x=Math.cos(n);return t[0]=o*x+p*_,t[1]=c*x+u*_,t[2]=u*x-c*_,t[3]=p*x-o*_,t},Pt.rotateY=function(t,e,n){n*=.5;var o=e[0],c=e[1],u=e[2],p=e[3],_=Math.sin(n),x=Math.cos(n);return t[0]=o*x-u*_,t[1]=c*x+p*_,t[2]=u*x+o*_,t[3]=p*x-c*_,t},Pt.rotateZ=function(t,e,n){n*=.5;var o=e[0],c=e[1],u=e[2],p=e[3],_=Math.sin(n),x=Math.cos(n);return t[0]=o*x+c*_,t[1]=c*x-o*_,t[2]=u*x+p*_,t[3]=p*x-u*_,t},Pt.calculateW=function(t,e){var n=e[0],o=e[1],c=e[2];return t[0]=n,t[1]=o,t[2]=c,t[3]=Math.sqrt(Math.abs(1-n*n-o*o-c*c)),t},Pt.exp=ot,Pt.ln=Ye,Pt.pow=function(t,e,n){return Ye(t,e),_t(t,t,n),ot(t,t),t},Pt.slerp=Ot,Pt.random=function(t){var e=cr.RANDOM(),n=cr.RANDOM(),o=cr.RANDOM(),c=Math.sqrt(1-e),u=Math.sqrt(e);return t[0]=c*Math.sin(2*Math.PI*n),t[1]=c*Math.cos(2*Math.PI*n),t[2]=u*Math.sin(2*Math.PI*o),t[3]=u*Math.cos(2*Math.PI*o),t},Pt.invert=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],p=n*n+o*o+c*c+u*u,_=p?1/p:0;return t[0]=-n*_,t[1]=-o*_,t[2]=-c*_,t[3]=u*_,t},Pt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Pt.fromMat3=ln,Pt.fromEuler=function(t,e,n,o){var c=.5*Math.PI/180;e*=c,n*=c,o*=c;var u=Math.sin(e),p=Math.cos(e),_=Math.sin(n),x=Math.cos(n),w=Math.sin(o),E=Math.cos(o);return t[0]=u*x*E-p*_*w,t[1]=p*_*E+u*x*w,t[2]=p*x*w-u*_*E,t[3]=p*x*E+u*_*w,t},Pt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Pt.setAxes=Pt.sqlerp=Pt.rotationTo=Pt.equals=Pt.exactEquals=Pt.normalize=Pt.sqrLen=Pt.squaredLength=Pt.len=Pt.length=Pt.lerp=Pt.dot=Pt.scale=Pt.mul=Pt.add=Pt.set=Pt.copy=Pt.fromValues=Pt.clone=void 0;var cr=We(an),Re=We(Tn),Oe=We(Mt),Ue=We(it);function Ze(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ze=function(o){return o?n:e})(t)}function We(t,e){if(t&&t.__esModule)return t;if(t===null||Dr(t)!=="object"&&typeof t!="function")return{default:t};var n=Ze(e);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(o,u,p):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}function tt(){var t=new cr.ARRAY_TYPE(4);return cr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function nt(t,e,n){n*=.5;var o=Math.sin(n);return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=Math.cos(n),t}function Qe(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=n[0],x=n[1],w=n[2],E=n[3];return t[0]=o*E+p*_+c*w-u*x,t[1]=c*E+p*x+u*_-o*w,t[2]=u*E+p*w+o*x-c*_,t[3]=p*E-o*_-c*x-u*w,t}function ot(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],p=Math.sqrt(n*n+o*o+c*c),_=Math.exp(u),x=p>0?_*Math.sin(p)/p:0;return t[0]=n*x,t[1]=o*x,t[2]=c*x,t[3]=_*Math.cos(p),t}function Ye(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],p=Math.sqrt(n*n+o*o+c*c),_=p>0?Math.atan2(p,u)/p:0;return t[0]=n*_,t[1]=o*_,t[2]=c*_,t[3]=.5*Math.log(n*n+o*o+c*c+u*u),t}function Ot(t,e,n,o){var c,u,p,_,x,w=e[0],E=e[1],I=e[2],S=e[3],A=n[0],R=n[1],k=n[2],z=n[3];return(u=w*A+E*R+I*k+S*z)<0&&(u=-u,A=-A,R=-R,k=-k,z=-z),1-u>cr.EPSILON?(c=Math.acos(u),p=Math.sin(c),_=Math.sin((1-o)*c)/p,x=Math.sin(o*c)/p):(_=1-o,x=o),t[0]=_*w+x*A,t[1]=_*E+x*R,t[2]=_*I+x*k,t[3]=_*S+x*z,t}function ln(t,e){var n,o=e[0]+e[4]+e[8];if(o>0)n=Math.sqrt(o+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var c=0;e[4]>e[0]&&(c=1),e[8]>e[3*c+c]&&(c=2);var u=(c+1)%3,p=(c+2)%3;n=Math.sqrt(e[3*c+c]-e[3*u+u]-e[3*p+p]+1),t[c]=.5*n,t[3]=(e[3*u+p]-e[3*p+u])*(n=.5/n),t[u]=(e[3*u+c]+e[3*c+u])*n,t[p]=(e[3*p+c]+e[3*c+p])*n}return t}Pt.clone=Ue.clone,Pt.fromValues=Ue.fromValues,Pt.copy=Ue.copy,Pt.set=Ue.set,Pt.add=Ue.add,Pt.mul=Qe;var _t=Ue.scale;Pt.scale=_t;var Vn=Ue.dot;Pt.dot=Vn,Pt.lerp=Ue.lerp;var ur=Ue.length;Pt.length=ur,Pt.len=ur;var hr=Ue.squaredLength;Pt.squaredLength=hr,Pt.sqrLen=hr;var vr=Ue.normalize;Pt.normalize=vr,Pt.exactEquals=Ue.exactEquals,Pt.equals=Ue.equals;var pr,pn,zi,co=(pr=Oe.create(),pn=Oe.fromValues(1,0,0),zi=Oe.fromValues(0,1,0),function(t,e,n){var o=Oe.dot(e,n);return o<-.999999?(Oe.cross(pr,pn,e),Oe.len(pr)<1e-6&&Oe.cross(pr,zi,e),Oe.normalize(pr,pr),nt(t,pr,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Oe.cross(pr,e,n),t[0]=pr[0],t[1]=pr[1],t[2]=pr[2],t[3]=1+o,vr(t,t))});Pt.rotationTo=co;var Vr,Ks,tc=(Vr=tt(),Ks=tt(),function(t,e,n,o,c,u){return Ot(Vr,e,c,u),Ot(Ks,n,o,u),Ot(t,Vr,Ks,2*u*(1-u)),t});Pt.sqlerp=tc;var gi,J0=(gi=Re.create(),function(t,e,n,o){return gi[0]=n[0],gi[3]=n[1],gi[6]=n[2],gi[1]=o[0],gi[4]=o[1],gi[7]=o[2],gi[2]=-e[0],gi[5]=-e[1],gi[8]=-e[2],vr(t,ln(t,gi))});Pt.setAxes=J0;var en={};function Bd(t){return Bd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bd(t)}Object.defineProperty(en,"__esModule",{value:!0}),en.create=function(){var t=new _i.ARRAY_TYPE(8);return _i.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},en.clone=function(t){var e=new _i.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},en.fromValues=function(t,e,n,o,c,u,p,_){var x=new _i.ARRAY_TYPE(8);return x[0]=t,x[1]=e,x[2]=n,x[3]=o,x[4]=c,x[5]=u,x[6]=p,x[7]=_,x},en.fromRotationTranslationValues=function(t,e,n,o,c,u,p){var _=new _i.ARRAY_TYPE(8);_[0]=t,_[1]=e,_[2]=n,_[3]=o;var x=.5*c,w=.5*u,E=.5*p;return _[4]=x*o+w*n-E*e,_[5]=w*o+E*t-x*n,_[6]=E*o+x*e-w*t,_[7]=-x*t-w*e-E*n,_},en.fromRotationTranslation=Fm,en.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},en.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},en.fromMat4=function(t,e){var n=Qo.create();Lm.getRotation(n,e);var o=new _i.ARRAY_TYPE(3);return Lm.getTranslation(o,e),Fm(t,n,o),t},en.copy=Nm,en.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},en.set=function(t,e,n,o,c,u,p,_,x){return t[0]=e,t[1]=n,t[2]=o,t[3]=c,t[4]=u,t[5]=p,t[6]=_,t[7]=x,t},en.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},en.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},en.getTranslation=function(t,e){var n=e[4],o=e[5],c=e[6],u=e[7],p=-e[0],_=-e[1],x=-e[2],w=e[3];return t[0]=2*(n*w+u*p+o*x-c*_),t[1]=2*(o*w+u*_+c*p-n*x),t[2]=2*(c*w+u*x+n*_-o*p),t},en.translate=function(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=.5*n[0],x=.5*n[1],w=.5*n[2],E=e[4],I=e[5],S=e[6],A=e[7];return t[0]=o,t[1]=c,t[2]=u,t[3]=p,t[4]=p*_+c*w-u*x+E,t[5]=p*x+u*_-o*w+I,t[6]=p*w+o*x-c*_+S,t[7]=-o*_-c*x-u*w+A,t},en.rotateX=function(t,e,n){var o=-e[0],c=-e[1],u=-e[2],p=e[3],_=e[4],x=e[5],w=e[6],E=e[7],I=_*p+E*o+x*u-w*c,S=x*p+E*c+w*o-_*u,A=w*p+E*u+_*c-x*o,R=E*p-_*o-x*c-w*u;return Qo.rotateX(t,e,n),t[4]=I*(p=t[3])+R*(o=t[0])+S*(u=t[2])-A*(c=t[1]),t[5]=S*p+R*c+A*o-I*u,t[6]=A*p+R*u+I*c-S*o,t[7]=R*p-I*o-S*c-A*u,t},en.rotateY=function(t,e,n){var o=-e[0],c=-e[1],u=-e[2],p=e[3],_=e[4],x=e[5],w=e[6],E=e[7],I=_*p+E*o+x*u-w*c,S=x*p+E*c+w*o-_*u,A=w*p+E*u+_*c-x*o,R=E*p-_*o-x*c-w*u;return Qo.rotateY(t,e,n),t[4]=I*(p=t[3])+R*(o=t[0])+S*(u=t[2])-A*(c=t[1]),t[5]=S*p+R*c+A*o-I*u,t[6]=A*p+R*u+I*c-S*o,t[7]=R*p-I*o-S*c-A*u,t},en.rotateZ=function(t,e,n){var o=-e[0],c=-e[1],u=-e[2],p=e[3],_=e[4],x=e[5],w=e[6],E=e[7],I=_*p+E*o+x*u-w*c,S=x*p+E*c+w*o-_*u,A=w*p+E*u+_*c-x*o,R=E*p-_*o-x*c-w*u;return Qo.rotateZ(t,e,n),t[4]=I*(p=t[3])+R*(o=t[0])+S*(u=t[2])-A*(c=t[1]),t[5]=S*p+R*c+A*o-I*u,t[6]=A*p+R*u+I*c-S*o,t[7]=R*p-I*o-S*c-A*u,t},en.rotateByQuatAppend=function(t,e,n){var o=n[0],c=n[1],u=n[2],p=n[3],_=e[0],x=e[1],w=e[2],E=e[3];return t[0]=_*p+E*o+x*u-w*c,t[1]=x*p+E*c+w*o-_*u,t[2]=w*p+E*u+_*c-x*o,t[3]=E*p-_*o-x*c-w*u,t[4]=(_=e[4])*p+(E=e[7])*o+(x=e[5])*u-(w=e[6])*c,t[5]=x*p+E*c+w*o-_*u,t[6]=w*p+E*u+_*c-x*o,t[7]=E*p-_*o-x*c-w*u,t},en.rotateByQuatPrepend=function(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=n[0],x=n[1],w=n[2],E=n[3];return t[0]=o*E+p*_+c*w-u*x,t[1]=c*E+p*x+u*_-o*w,t[2]=u*E+p*w+o*x-c*_,t[3]=p*E-o*_-c*x-u*w,t[4]=o*(E=n[7])+p*(_=n[4])+c*(w=n[6])-u*(x=n[5]),t[5]=c*E+p*x+u*_-o*w,t[6]=u*E+p*w+o*x-c*_,t[7]=p*E-o*_-c*x-u*w,t},en.rotateAroundAxis=function(t,e,n,o){if(Math.abs(o)<_i.EPSILON)return Nm(t,e);var c=Math.hypot(n[0],n[1],n[2]);o*=.5;var u=Math.sin(o),p=u*n[0]/c,_=u*n[1]/c,x=u*n[2]/c,w=Math.cos(o),E=e[0],I=e[1],S=e[2],A=e[3];t[0]=E*w+A*p+I*x-S*_,t[1]=I*w+A*_+S*p-E*x,t[2]=S*w+A*x+E*_-I*p,t[3]=A*w-E*p-I*_-S*x;var R=e[4],k=e[5],z=e[6],j=e[7];return t[4]=R*w+j*p+k*x-z*_,t[5]=k*w+j*_+z*p-R*x,t[6]=z*w+j*x+R*_-k*p,t[7]=j*w-R*p-k*_-z*x,t},en.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},en.multiply=zm,en.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},en.lerp=function(t,e,n,o){var c=1-o;return Bm(e,n)<0&&(o=-o),t[0]=e[0]*c+n[0]*o,t[1]=e[1]*c+n[1]*o,t[2]=e[2]*c+n[2]*o,t[3]=e[3]*c+n[3]*o,t[4]=e[4]*c+n[4]*o,t[5]=e[5]*c+n[5]*o,t[6]=e[6]*c+n[6]*o,t[7]=e[7]*c+n[7]*o,t},en.invert=function(t,e){var n=Iu(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},en.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},en.normalize=function(t,e){var n=Iu(e);if(n>0){n=Math.sqrt(n);var o=e[0]/n,c=e[1]/n,u=e[2]/n,p=e[3]/n,_=e[4],x=e[5],w=e[6],E=e[7],I=o*_+c*x+u*w+p*E;t[0]=o,t[1]=c,t[2]=u,t[3]=p,t[4]=(_-o*I)/n,t[5]=(x-c*I)/n,t[6]=(w-u*I)/n,t[7]=(E-p*I)/n}return t},en.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},en.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},en.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=t[3],p=t[4],_=t[5],x=t[6],w=t[7],E=e[0],I=e[1],S=e[2],A=e[3],R=e[4],k=e[5],z=e[6],j=e[7];return Math.abs(n-E)<=_i.EPSILON*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(o-I)<=_i.EPSILON*Math.max(1,Math.abs(o),Math.abs(I))&&Math.abs(c-S)<=_i.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(u-A)<=_i.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(p-R)<=_i.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(_-k)<=_i.EPSILON*Math.max(1,Math.abs(_),Math.abs(k))&&Math.abs(x-z)<=_i.EPSILON*Math.max(1,Math.abs(x),Math.abs(z))&&Math.abs(w-j)<=_i.EPSILON*Math.max(1,Math.abs(w),Math.abs(j))},en.sqrLen=en.squaredLength=en.len=en.length=en.dot=en.mul=en.setReal=en.getReal=void 0;var _i=jd(an),Qo=jd(Pt),Lm=jd(It);function km(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(km=function(o){return o?n:e})(t)}function jd(t,e){if(t&&t.__esModule)return t;if(t===null||Bd(t)!=="object"&&typeof t!="function")return{default:t};var n=km(e);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(o,u,p):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}function Fm(t,e,n){var o=.5*n[0],c=.5*n[1],u=.5*n[2],p=e[0],_=e[1],x=e[2],w=e[3];return t[0]=p,t[1]=_,t[2]=x,t[3]=w,t[4]=o*w+c*x-u*_,t[5]=c*w+u*p-o*x,t[6]=u*w+o*_-c*p,t[7]=-o*p-c*_-u*x,t}function Nm(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function zm(t,e,n){var o=e[0],c=e[1],u=e[2],p=e[3],_=n[4],x=n[5],w=n[6],E=n[7],I=e[4],S=e[5],A=e[6],R=e[7],k=n[0],z=n[1],j=n[2],W=n[3];return t[0]=o*W+p*k+c*j-u*z,t[1]=c*W+p*z+u*k-o*j,t[2]=u*W+p*j+o*z-c*k,t[3]=p*W-o*k-c*z-u*j,t[4]=o*E+p*_+c*w-u*x+I*W+R*k+S*j-A*z,t[5]=c*E+p*x+u*_-o*w+S*W+R*z+A*k-I*j,t[6]=u*E+p*w+o*x-c*_+A*W+R*j+I*z-S*k,t[7]=p*E-o*_-c*x-u*w+R*W-I*k-S*z-A*j,t}en.getReal=Qo.copy,en.setReal=Qo.copy,en.mul=zm;var Bm=Qo.dot;en.dot=Bm;var jm=Qo.length;en.length=jm,en.len=jm;var Iu=Qo.squaredLength;en.squaredLength=Iu,en.sqrLen=Iu;var $t={};function Vd(t){return Vd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vd(t)}Object.defineProperty($t,"__esModule",{value:!0}),$t.create=Um,$t.clone=function(t){var e=new Js.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},$t.fromValues=function(t,e){var n=new Js.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},$t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},$t.set=function(t,e,n){return t[0]=e,t[1]=n,t},$t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},$t.subtract=$m,$t.multiply=Gm,$t.divide=Hm,$t.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},$t.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},$t.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},$t.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},$t.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},$t.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},$t.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t},$t.distance=qm,$t.squaredDistance=Wm,$t.length=Zm,$t.squaredLength=Du,$t.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},$t.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},$t.normalize=function(t,e){var n=e[0],o=e[1],c=n*n+o*o;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t},$t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},$t.cross=function(t,e,n){var o=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=o,t},$t.lerp=function(t,e,n,o){var c=e[0],u=e[1];return t[0]=c+o*(n[0]-c),t[1]=u+o*(n[1]-u),t},$t.random=function(t,e){e=e||1;var n=2*Js.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},$t.transformMat2=function(t,e,n){var o=e[0],c=e[1];return t[0]=n[0]*o+n[2]*c,t[1]=n[1]*o+n[3]*c,t},$t.transformMat2d=function(t,e,n){var o=e[0],c=e[1];return t[0]=n[0]*o+n[2]*c+n[4],t[1]=n[1]*o+n[3]*c+n[5],t},$t.transformMat3=function(t,e,n){var o=e[0],c=e[1];return t[0]=n[0]*o+n[3]*c+n[6],t[1]=n[1]*o+n[4]*c+n[7],t},$t.transformMat4=function(t,e,n){var o=e[0],c=e[1];return t[0]=n[0]*o+n[4]*c+n[12],t[1]=n[1]*o+n[5]*c+n[13],t},$t.rotate=function(t,e,n,o){var c=e[0]-n[0],u=e[1]-n[1],p=Math.sin(o),_=Math.cos(o);return t[0]=c*_-u*p+n[0],t[1]=c*p+u*_+n[1],t},$t.angle=function(t,e){var n=t[0],o=t[1],c=e[0],u=e[1],p=Math.sqrt(n*n+o*o)*Math.sqrt(c*c+u*u);return Math.acos(Math.min(Math.max(p&&(n*c+o*u)/p,-1),1))},$t.zero=function(t){return t[0]=0,t[1]=0,t},$t.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},$t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},$t.equals=function(t,e){var n=t[0],o=t[1],c=e[0],u=e[1];return Math.abs(n-c)<=Js.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(o-u)<=Js.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},$t.forEach=$t.sqrLen=$t.sqrDist=$t.dist=$t.div=$t.mul=$t.sub=$t.len=void 0;var Js=function(t,e){if(t&&t.__esModule)return t;if(t===null||Vd(t)!=="object"&&typeof t!="function")return{default:t};var n=Vm(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(o,u,p):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(an);function Vm(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Vm=function(o){return o?n:e})(t)}function Um(){var t=new Js.ARRAY_TYPE(2);return Js.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function $m(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Gm(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function Hm(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function qm(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Wm(t,e){var n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o}function Zm(t){return Math.hypot(t[0],t[1])}function Du(t){var e=t[0],n=t[1];return e*e+n*n}$t.len=Zm,$t.sub=$m,$t.mul=Gm,$t.div=Hm,$t.dist=qm,$t.sqrDist=Wm,$t.sqrLen=Du;var ev=function(){var t=Um();return function(e,n,o,c,u,p){var _,x;for(n||(n=2),o||(o=0),x=c?Math.min(c*n+o,e.length):e.length,_=o;_<x;_+=n)t[0]=e[_],t[1]=e[_+1],u(t,t,p),e[_]=t[0],e[_+1]=t[1];return e}}();function Mu(t){return Mu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mu(t)}$t.forEach=ev,Object.defineProperty(bt,"__esModule",{value:!0}),i.aa=bt.vec4=i.Q=bt.vec3=bt.vec2=bt.quat2=i.bl=bt.quat=i.a9=bt.mat4=i.ct=bt.mat3=bt.mat2d=i.b7=bt.mat2=bt.glMatrix=void 0;var tv=Po(an);bt.glMatrix=tv;var nv=Po(wn);i.b7=bt.mat2=nv;var rv=Po(Wn);bt.mat2d=rv;var Tt=Po(Tn);i.ct=bt.mat3=Tt;var Ud=Po(It);i.a9=bt.mat4=Ud;var Ft=Po(Pt);i.bl=bt.quat=Ft;var Su=Po(en);bt.quat2=Su;var Qt=Po($t);bt.vec2=Qt;var $d=Po(Mt);i.Q=bt.vec3=$d;var Gd=Po(it);function At(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(At=function(o){return o?n:e})(t)}function Po(t,e){if(t&&t.__esModule)return t;if(t===null||Mu(t)!=="object"&&typeof t!="function")return{default:t};var n=At(e);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(o,u,p):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}i.aa=bt.vec4=Gd;var iv=ea;function ea(t,e,n,o){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=o}ea.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,o=0;o<8;o++){var c=this.sampleCurveX(n)-t;if(Math.abs(c)<e)return n;var u=this.sampleCurveDerivativeX(n);if(Math.abs(u)<1e-6)break;n-=c/u}var p=0,_=1;for(n=t,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-t)<e));o++)t>c?p=n:_=n,n=.5*(_-p)+p;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Qm=Rt(iv),Cu=uo;function uo(t,e){this.x=t,this.y=e}uo.prototype={clone:function(){return new uo(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(t,e){var n=Math.cos(t),o=Math.sin(t),c=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},uo.convert=function(t){return t instanceof uo?t:Array.isArray(t)?new uo(t[0],t[1]):t};var Je=Rt(Cu);let Hd=Math.PI/180,qd=180/Math.PI;function hn(t){return t*Hd}function yi(t){return t*qd}let Ym=[[0,0],[1,0],[1,1],[0,1]];function Au(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Xm(t,e,n,o){let c=new Qm(t,e,n,o);return function(u){return c.solve(u)}}let ho=Xm(.25,.1,.25,1);function tn(t,e,n){return Math.min(n,Math.max(e,t))}function nc(t,e,n){return(n=tn((n-t)/(e-t),0,1))*n*(3-2*n)}function Yo(t,e,n){let o=n-e,c=((t-e)%o+o)%o+e;return c===e?n:c}function Wd(t,e,n){if(!t.length)return n(null,[]);let o=t.length,c=new Array(t.length),u=null;t.forEach((p,_)=>{e(p,(x,w)=>{x&&(u=x),c[_]=w,--o==0&&n(u,c)})})}function Xi(t,...e){for(let n of e)for(let o in n)t[o]=n[o];return t}let Km=1;function yn(){return Km++}function Pu(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Zd(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Jm(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Qd(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function ta(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Ga(t,e,n){let o={};for(let c in t)o[c]=e.call(this,t[c],c,t);return o}function rc(t,e,n){let o={};for(let c in t)e.call(this,t[c],c,t)&&(o[c]=t[c]);return o}function Xo(t){return Array.isArray(t)?t.map(Xo):typeof t=="object"&&t?Ga(t,Xo):t}let Yd={};function dr(t){Yd[t]||(typeof console<"u"&&console.warn(t),Yd[t]=!0)}function Es(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function ic(t){let e=0;for(let n,o,c=0,u=t.length,p=u-1;c<u;p=c++)n=t[c],o=t[p],e+=(o.x-n.x)*(n.y+o.y);return e}function oc([t,e,n]){let o=hn(e+90),c=hn(n);return{x:t*Math.cos(o)*Math.sin(c),y:t*Math.sin(o)*Math.sin(c),z:t*Math.cos(c),azimuthal:e,polar:n}}function Ko(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Bi(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,u)=>{let p=c||u;return e[o]=!p||p.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Ru,Ou,Lu,sc,Is,Ha,ku=null;function Xd(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function na(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function ra(t,e,n,o){for(;e<n;){let c=e+n>>1;t[c]<o?e=c+1:n=c}return e}function Kd(t,e,n,o){for(;e<n;){let c=e+n>>1;t[c]<=o?e=c+1:n=c}return e}function fo(t){return t>0?1/(1.001-t):1+t}function eg(t){return t>0?1-1/(1.001-t):-t}function Fu(){return Ru==null&&(Ru=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ru}let Ro={now:()=>sc!==void 0?sc:performance.now(),setNow(t){sc=t},restoreNow(){sc=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:o}=t;Is||(Is=document.createElement("canvas"));let c=Is.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(n>Is.width||o>Is.height)&&(Is.width=n,Is.height=o),c.clearRect(-e,-e,n+2*e,o+2*e),c.drawImage(t,0,0,n,o),c.getImageData(-e,-e,n+2*e,o+2*e)},resolveURL:t=>(Ou||(Ou=document.createElement("a")),Ou.href=t,Ou.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Lu==null&&(Lu=window.matchMedia("(prefers-reduced-motion: reduce)")),Lu.matches)},hasCanvasFingerprintNoise(){if(Ha!==void 0)return Ha;if(!Fu())return Ha=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let c=0;c<t.width;++c)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(c,0,1,1);let o=e.getImageData(0,0,t.width,t.height);n=0;for(let c=0;c<o.data.length;++c)if(c%4!=3&&n++!==o.data[c])return Ha=!0,!0;return Ha=!1,!1}};function Nu(t,e){let n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;let o=new URLSearchParams(t.slice(n));for(let c in e)o.set(c,e[c]);return`${t.slice(0,n)}?${o.toString()}`}function zu(t,e={persistentParams:[]}){let n=t.indexOf("?");if(n<0)return t;let o=new URLSearchParams,c=new URLSearchParams(t.slice(n));for(let p of e.persistentParams){let _=c.get(p);_&&o.set(p,_)}let u=o.toString();return`${t.slice(0,n)}${u.length>0?`?${u}`:""}`}let qa="mapbox-tiles",Bu=500,tg=50,Jo,ju;function Jd(){try{return caches}catch{}}function Wa(){let t=Jd();t&&!Jo&&(Jo=t.open(qa))}let ef=1/0,ia={supported:!1,testSupport:function(t){!tf&&Za&&(ng?ig(t):ac=t)}},ac,Za,tf=!1,ng=!1,rg=typeof self<"u"?self:{};function ig(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Za),t.isContextLost())return;ia.supported=!0}catch{}t.deleteTexture(e),tf=!0}rg.document&&(Za=rg.document.createElement("img"),Za.onload=function(){ac&&ig(ac),ac=null,ng=!0},Za.onerror=function(){tf=!0,ac=null},Za.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Vu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Vu);class Uu extends Error{constructor(e,n,o){n===401&&q(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Qa=Ko()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,lc=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Qa())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,c){let u=new AbortController,p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Qa(),referrerPolicy:o.referrerPolicy,signal:u.signal}),_=!1,x=!1,w=(E=p.url).indexOf("sku=")>0&&q(E);var E;o.type==="json"&&p.headers.set("Accept","application/json");let I=(A,R,k)=>{if(x)return;if(A&&A.message!=="SecurityError"&&dr(A.toString()),R&&k)return S(R);let z=Date.now();fetch(p).then(j=>{if(j.ok){let W=w?j.clone():null;return S(j,W,z)}return c(new Uu(j.statusText,j.status,o.url))}).catch(j=>{j.name!=="AbortError"&&c(new Error(`${j.message} ${o.url}`))})},S=(A,R,k)=>{(o.type==="arrayBuffer"?A.arrayBuffer():o.type==="json"?A.json():A.text()).then(z=>{x||(R&&k&&function(j,W,X){if(Wa(),!Jo)return;let Q=Bi(W.headers.get("Cache-Control")||"");if(Q["no-store"])return;let oe={status:W.status,statusText:W.statusText,headers:new Headers};W.headers.forEach((ue,_e)=>oe.headers.set(_e,ue)),Q["max-age"]&&oe.headers.set("Expires",new Date(X+1e3*Q["max-age"]).toUTCString());let J=oe.headers.get("Expires");if(!J||new Date(J).getTime()-X<42e4)return;let le=zu(j.url,{persistentParams:["language","worldview"]});if(W.status===206){let ue=j.headers.get("Range");if(!ue)return;oe.status=200,le=Nu(le,{range:ue})}(function(ue,_e){if(ju===void 0)try{new Response(new ReadableStream),ju=!0}catch{ju=!1}ju?_e(ue.body):ue.blob().then(_e)})(W,ue=>{let _e=new Response(ue,oe);Wa(),Jo&&Jo.then(Ie=>Ie.put(le,_e)).catch(Ie=>dr(Ie.message))})}(p,R,k),_=!0,c(null,z,A.headers.get("Cache-Control"),A.headers.get("Expires")))}).catch(z=>{x||c(new Error(z.message))})};return w?function(A,R){if(Wa(),!Jo)return R(null);Jo.then(k=>{let z=zu(A.url,{persistentParams:["language","worldview"]}),j=A.headers.get("Range");j&&(z=Nu(z,{range:j})),k.match(z).then(W=>{let X=function(Q){if(!Q)return!1;let oe=new Date(Q.headers.get("Expires")||0),J=Bi(Q.headers.get("Cache-Control")||"");return oe>Date.now()&&!J["no-cache"]}(W);k.delete(z),X&&k.put(z,W.clone()),R(null,W,X)}).catch(R)}).catch(R)}(p,I):I(null,null),{cancel:()=>{x=!0,_||u.abort()}}}(t,e);if(Ko()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(o,c){let u=new XMLHttpRequest;u.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(let p in o.headers)u.setRequestHeader(p,o.headers[p]);return o.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=o.credentials==="include",u.onerror=()=>{c(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let p=u.response;if(o.type==="json")try{p=JSON.parse(u.response)}catch(_){return c(_)}c(null,p,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else c(new Uu(u.statusText,u.status,o.url))},u.send(o.body),{cancel:()=>u.abort()}}(t,e)},cc=function(t,e){return lc(Xi(t,{type:"arrayBuffer"}),e)};function nf(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let og="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",$u,uc;$u=[],uc=0;let rf=function(t,e){if(ia.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),uc>=B.MAX_PARALLEL_IMAGE_REQUESTS){let u={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return $u.push(u),u}uc++;let n=!1,o=()=>{if(!n)for(n=!0,uc--;$u.length&&uc<B.MAX_PARALLEL_IMAGE_REQUESTS;){let u=$u.shift(),{requestParameters:p,callback:_,cancelled:x}=u;x||(u.cancel=rf(p,_).cancel)}},c=cc(t,(u,p,_,x)=>{o(),u?e(u):p&&(self.createImageBitmap?function(w,E){let I=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(I).then(S=>{E(null,S)}).catch(S=>{E(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(w,E)=>e(w,E,_,x)):function(w,E){let I=new Image;I.onload=()=>{E(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=og})},I.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let S=new Blob([new Uint8Array(w)],{type:"image/png"});I.src=w.byteLength?URL.createObjectURL(S):og}(p,(w,E)=>e(w,E,_,x)))});return{cancel:()=>{c.cancel(),o()}}},hc="01",Gu="NO_ACCESS_TOKEN",of=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function po(t){let e=t.match(of);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ya(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let dc="mapbox.eventData";function sf(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Xa{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=sf(B.ACCESS_TOKEN),o="";return o=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,u)=>String.fromCharCode(+("0x"+u)))):B.ACCESS_TOKEN||"",e?`${dc}.${e}:${o}`:`${dc}:${o}`}fetchEventData(){let e=Xd("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{let c=localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));let u=localStorage.getItem(o);u&&(this.anonId=u)}catch{dr("Unable to read from LocalStorage")}}saveEventData(){let e=Xd("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid"),c=this.anonId;if(e&&c)try{localStorage.setItem(o,c),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{dr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,o,c){if(!B.EVENTS_URL)return;let u=po(B.EVENTS_URL);u.params.push(`access_token=${c||B.ACCESS_TOKEN||""}`);let p={event:this.type,created:new Date(e).toISOString()},_=n?Xi(p,n):p,x={url:Ya(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(w,E){return lc(Xi(w,{method:"POST"}),E)}(x,w=>{this.pendingRequest=null,o(w),this.saveEventData(),this.processRequests(c)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let Hu=new class extends Xa{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){B.EVENTS_URL&&B.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>se(n)||q(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=sf(B.ACCESS_TOKEN),n=e?e.u:B.ACCESS_TOKEN,o=n!==this.eventData.tokenU;Jm(this.anonId)||(this.anonId=Pu(),o=!0);let c=this.queue.shift();if(this.eventData.lastSuccess){let u=new Date(this.eventData.lastSuccess),p=new Date(c),_=(c-this.eventData.lastSuccess)/864e5;o=o||_>=1||_<-1||u.getDate()!==p.getDate()}else o=!0;o?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:hc,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},t):this.processRequests()}},Di=Hu.postTurnstileEvent.bind(Hu),Ds=new class extends Xa{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,o){this.skuToken=e,this.errorCb=o,B.EVENTS_URL&&(n||B.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Gu)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Jm(this.anonId)||(this.anonId=Pu()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:hc,skuToken:this.skuToken,userId:this.anonId},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},Mi=Ds.postMapLoadEvent.bind(Ds),sg=new class extends Xa{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=Pu(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:n,style:o,importedStyles:c}=e;if(!B.EVENTS_URL||!t&&!B.ACCESS_TOKEN)return;let u=this.getMapInstanceId(n),p={mapInstanceId:u,eventId:this.getEventId(u),style:o};c.length&&(p.importedStyles=c),this.queueRequest({timestamp:Date.now(),payload:p},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},t)}},ov=sg.postStyleLoadEvent.bind(sg),ag=new class extends Xa{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){B.EVENTS_URL&&(t||B.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),o=function(c){let u=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),_=function(A){let R={};if(A){for(let k in A)if(k!=="other")for(let z of A[k]){let j=`${k}ResolveRangeMin`,W=`${k}ResolveRangeMax`,X=`${k}RequestCount`,Q=`${k}RequestCachedCount`;R[j]=Math.min(R[j]||1/0,z.startTime),R[W]=Math.max(R[W]||-1/0,z.responseEnd);let oe=J=>{R[J]===void 0&&(R[J]=0),++R[J]};z.transferSize!==void 0&&z.transferSize===0&&oe(Q),oe(X)}}return R}(function(A,R){let k={};if(A)for(let z of A){let j=R(z);k[j]===void 0&&(k[j]=[]),k[j].push(z)}return k}(u,sn)),x=window.devicePixelRatio,w=navigator.connection||navigator.mozConnection||navigator.webkitConnection,E=w?w.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},S=(A,R,k)=>{k!=null&&A.push({name:R,value:k.toString()})};for(let A in _)S(I.counters,A,_[A]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(S(I.counters,"interactionRangeMin",c.interactionRange[0]),S(I.counters,"interactionRangeMax",c.interactionRange[1])),p)for(let A of Object.keys(Nt)){let R=Nt[A],k=p.find(z=>z.name===R);k&&S(I.counters,R,k.startTime)}return S(I.counters,"visibilityHidden",c.visibilityHidden),S(I.attributes,"style",function(A){if(A)for(let R of A){let k=R.name.split("?")[0];if(Ke(k)){let z=k.split("/").slice(-2);if(z.length===2)return`mapbox://styles/${z[0]}/${z[1]}`}}}(u)),S(I.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),S(I.attributes,"fogEnabled",c.fogEnabled?"true":"false"),S(I.attributes,"projection",c.projection),S(I.attributes,"zoom",c.zoom),S(I.metadata,"devicePixelRatio",x),S(I.metadata,"connectionEffectiveType",E),S(I.metadata,"navigatorUserAgent",navigator.userAgent),S(I.metadata,"screenWidth",window.screen.width),S(I.metadata,"screenHeight",window.screen.height),S(I.metadata,"windowWidth",window.innerWidth),S(I.metadata,"windowHeight",window.innerHeight),S(I.metadata,"mapWidth",c.width/x),S(I.metadata,"mapHeight",c.height/x),S(I.metadata,"webglRenderer",c.renderer),S(I.metadata,"webglVendor",c.vendor),S(I.metadata,"sdkVersion",M),S(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(n);for(let c of o.metadata);for(let c of o.counters);for(let c of o.attributes);this.postEvent(e,o,()=>{},t)}},qu=ag.postPerformanceEvent.bind(ag),Wu=new class extends Xa{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,o){if(!B.API_URL||!B.SESSION_PATH)return;let c=po(B.API_URL+B.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${o||B.ACCESS_TOKEN||""}`);let u={url:Ya(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,_){return lc(Xi(p,{method:"GET"}),_)}(u,p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(o)})}getSessionAPI(t,e,n,o){this.skuToken=e,this.errorCb=o,B.SESSION_PATH&&B.API_URL&&(n||B.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Gu)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},af=Wu.getSessionAPI.bind(Wu),Zu=new Set;var Oo={exports:{}},lg={exports:{}};lg.exports=function(t,e){var n,o,c,u,p,_,x,w;for(o=t.length-(n=3&t.length),c=e,p=3432918353,_=461845907,w=0;w<o;)x=255&t.charCodeAt(w)|(255&t.charCodeAt(++w))<<8|(255&t.charCodeAt(++w))<<16|(255&t.charCodeAt(++w))<<24,++w,c=27492+(65535&(u=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*p+(((x>>>16)*p&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&t.charCodeAt(w+2))<<16;case 2:x^=(255&t.charCodeAt(w+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&t.charCodeAt(w)))*p+(((x>>>16)*p&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var sv=lg.exports,lf={exports:{}};lf.exports=function(t,e){for(var n,o=t.length,c=e^o,u=0;o>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++u;switch(o){case 3:c^=(255&t.charCodeAt(u+2))<<16;case 2:c^=(255&t.charCodeAt(u+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(u)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var cf=sv,mo=lf.exports;Oo.exports=cf,Oo.exports.murmur3=cf,Oo.exports.murmur2=mo;var fc=Rt(Oo.exports);function uf(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function Qu(t,e,n){if(n&&n[t]){let o=n[t].indexOf(e);o!==-1&&n[t].splice(o,1)}}class Ms{constructor(e,n={}){Xi(this,n),this.type=e}}class Yu extends Ms{constructor(e,n={}){super("error",Xi({error:e},n))}}class oa{on(e,n){return this._listeners=this._listeners||{},uf(e,n,this._listeners),this}off(e,n){return Qu(e,n,this._listeners),Qu(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},uf(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new Ms(e,n||{}));let o=e.type;if(this.listens(o)){e.target=this;let c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(let _ of c)_.call(this,e);let u=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(let _ of u)Qu(o,_,this._oneTimeListeners),_.call(this,e);let p=this._eventedParent;p&&(Xi(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Yu&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}i.z=void 0;var hf={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function pc(t){return(t=Math.round(t))<0?0:t>255?255:t}function Xu(t){return pc(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function mc(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Ku(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{i.z={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in hf)return hf[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=n.indexOf("("),c=n.indexOf(")");if(o!==-1&&c+1===n.length){var u=n.substr(0,o),p=n.substr(o+1,c-(o+1)).split(","),_=1;switch(u){case"rgba":if(p.length!==4)return null;_=mc(p.pop());case"rgb":return p.length!==3?null:[Xu(p[0]),Xu(p[1]),Xu(p[2]),_];case"hsla":if(p.length!==4)return null;_=mc(p.pop());case"hsl":if(p.length!==3)return null;var x=(parseFloat(p[0])%360+360)%360/360,w=mc(p[1]),E=mc(p[2]),I=E<=.5?E*(w+1):E+w-E*w,S=2*E-I;return[pc(255*Ku(S,I,x+1/3)),pc(255*Ku(S,I,x)),pc(255*Ku(S,I,x-1/3)),_];default:return null}}return null}}catch{}class Sn{constructor(e,n,o,c=1){this.r=e,this.g=n,this.b=o,this.a=c}static parse(e){if(!e)return;if(e instanceof Sn)return e;if(typeof e!="string")return;let n=i.z(e);return n?new Sn(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,o,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(o)},${c})`}toArray(){let{r:e,g:n,b:o,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*n/c,255*o/c,c]}toArray01(){let{r:e,g:n,b:o,a:c}=this;return c===0?[0,0,0,0]:[e/c,n/c,o/c,c]}toArray01Scaled(e){let{r:n,g:o,b:c,a:u}=this;return u===0?[0,0,0]:[n/u*e,o/u*e,c/u*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:o,a:c}=this;return[e,n,o,c]}toArray01Linear(){let{r:e,g:n,b:o,a:c}=this;return c===0?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(n/c,2.2),Math.pow(o/c,2.2),c]}}function Zt(t,e,n){return t*(1-n)+e*n}function gc(t,e,n){return t.map((o,c)=>Zt(o,e[c],n))}Sn.black=new Sn(0,0,0,1),Sn.white=new Sn(1,1,1,1),Sn.transparent=new Sn(0,0,0,0),Sn.red=new Sn(1,0,0,1),Sn.blue=new Sn(0,0,1,1);var _c=Object.freeze({__proto__:null,array:gc,color:function(t,e,n){return new Sn(Zt(t.r,e.r,n),Zt(t.g,e.g,n),Zt(t.b,e.b,n),Zt(t.a,e.a,n))},number:Zt});function Ju(t,...e){for(let n of e)for(let o in n)t[o]=n[o];return t}class go extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Ss{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[o,c]of n)this.bindings[o]=c}concat(e){return new Ss(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Yt={kind:"null"},at={kind:"number"},vn={kind:"string"},xn={kind:"boolean"},ji={kind:"color"},Ka={kind:"object"},dn={kind:"value"},yc={kind:"collator"},Ja={kind:"formatted"},el={kind:"resolvedImage"};function Br(t,e){return{kind:"array",itemType:t,N:e}}function mr(t){if(t.kind==="array"){let e=mr(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let cg=[Yt,at,vn,xn,ji,Ja,Ka,Br(dn),el];function vc(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!vc(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of cg)if(!vc(n,e))return null}}return`Expected ${mr(t)} but found ${mr(e)} instead.`}function xc(t,e){return e.some(n=>n.kind===t.kind)}function sa(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}class df{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class eh{constructor(e,n,o,c,u){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=o,this.fontStack=c,this.textColor=u}}class Zr{constructor(e){this.sections=e}static fromString(e){return new Zr([new eh(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Zr?e:Zr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let o={};n.fontStack&&(o["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(o["font-scale"]=n.scale),n.textColor&&(o["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(o)}return e}}class Vi{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new Vi({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function ug(t,e,n,o){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[t,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[t,e,n,o]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function tl(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Sn||t instanceof df||t instanceof Zr||t instanceof Vi)return!0;if(Array.isArray(t)){for(let e of t)if(!tl(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!tl(t[e]))return!1;return!0}return!1}function Mr(t){if(t===null)return Yt;if(typeof t=="string")return vn;if(typeof t=="boolean")return xn;if(typeof t=="number")return at;if(t instanceof Sn)return ji;if(t instanceof df)return yc;if(t instanceof Zr)return Ja;if(t instanceof Vi)return el;if(Array.isArray(t)){let e=t.length,n;for(let o of t){let c=Mr(o);if(n){if(n===c)continue;n=dn;break}n=c}return Br(n||dn,e)}return Ka}function Ki(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Sn||t instanceof Zr||t instanceof Vi?t.toString():JSON.stringify(t)}class Lo{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!tl(e[1]))return n.error("invalid value");let o=e[1],c=Mr(o),u=n.expectedType;return c.kind!=="array"||c.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(c=u),new Lo(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Sn?["rgba"].concat(this.value.toArray()):this.value instanceof Zr?this.value.serialize():this.value}}class Rr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let th={string:vn,number:at,boolean:xn,object:Ka};class _o{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,c=1,u=e[0];if(u==="array"){let _,x;if(e.length>2){let w=e[1];if(typeof w!="string"||!(w in th)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=th[w],c++}else _=dn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}o=Br(_,x)}else o=th[u];let p=[];for(;c<e.length;c++){let _=n.parse(e[c],c,dn);if(!_)return null;p.push(_)}return new _o(o,p)}evaluate(e){for(let n=0;n<this.args.length;n++){let o=this.args[n].evaluate(e);if(!vc(this.type,Mr(o)))return o;if(n===this.args.length-1)throw new Rr(`Expected value to be of type ${mr(this.type)}, but found ${mr(Mr(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){n.push(o.kind);let c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(o=>o.serialize()))}}class bc{constructor(e){this.type=Ja,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");let c=[],u=!1;for(let p=1;p<=e.length-1;++p){let _=e[p];if(u&&typeof _=="object"&&!Array.isArray(_)){u=!1;let x=null;if(_["font-scale"]&&(x=n.parse(_["font-scale"],1,at),!x))return null;let w=null;if(_["text-font"]&&(w=n.parse(_["text-font"],1,Br(vn)),!w))return null;let E=null;if(_["text-color"]&&(E=n.parse(_["text-color"],1,ji),!E))return null;let I=c[c.length-1];I.scale=x,I.font=w,I.textColor=E}else{let x=n.parse(e[p],1,dn);if(!x)return null;let w=x.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new bc(c)}evaluate(e){return new Zr(this.sections.map(n=>{let o=n.content.evaluate(e);return Mr(o)===el?new eh("",o,null,null,null):new eh(Ki(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let o={};n.scale&&(o["font-scale"]=n.scale.serialize()),n.font&&(o["text-font"]=n.font.serialize()),n.textColor&&(o["text-color"]=n.textColor.serialize()),e.push(o)}return e}}class nl{constructor(e,n){this.type=el,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let o=n.parse(e[1],1,vn);if(!o)return n.error("No image name provided.");if(e.length===2)return new nl(o);let c=n.parse(e[2],1,vn);return c?new nl(o,c):n.error("Secondary image variant is not a string.")}evaluate(e){let n=Vi.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Cs(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let av={"to-boolean":xn,"to-color":ji,"to-number":at,"to-string":vn};class es{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=e[0],c=[],u=Yt;if(o==="to-array"){if(!Array.isArray(e[1]))return null;let p=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);u=Br(n.expectedType.itemType,p)}else{if(!(p>0&&tl(e[1][0])))return null;u=Br(Mr(e[1][0]),p)}for(let _=0;_<p;_++){let x=e[1][_],w;if(Cs(x)==="array")w=n.parse(x,void 0,u.itemType);else{let E=Cs(x);if(E!==u.itemType.kind)return n.error(`Expected ${u.itemType.kind} but found ${E}.`);w=n.registry.literal.parse(["literal",x===void 0?null:x],n)}if(!w)return null;c.push(w)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");u=av[o];for(let p=1;p<e.length;p++){let _=n.parse(e[p],p,dn);if(!_)return null;c.push(_)}}return new es(u,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,o;for(let c of this.args){if(n=c.evaluate(e),o=null,n instanceof Sn)return n;if(typeof n=="string"){let u=e.parseColor(n);if(u)return u}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:ug(n[0],n[1],n[2],n[3]),!o))return new Sn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Rr(o||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let o of this.args){if(n=o.evaluate(e),n===null)return 0;let c=Number(n);if(!isNaN(c))return c}throw new Rr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Zr.fromString(Ki(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Vi.fromString(Ki(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Ki(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new bc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new nl(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let lv=["Unknown","Point","LineString","Polygon"];class ff{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?lv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:o,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*n-e[0])+this.featureDistanceData.bearing[1]*(c*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Sn.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Si{constructor(e,n,o,c,u){this.name=e,this.type=n,this._evaluate=o,this.args=c,this._overloadIndex=u}evaluate(e){if(!this._evaluate){let n=Si.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let o=e[0],c=Si.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=[],x=null,w=-1;for(let[E,I]of p){if(Array.isArray(E)&&E.length!==e.length-1)continue;_.push(E),w++,x=new uh(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let S=[],A=!1;for(let R=1;R<e.length;R++){let k=e[R],z=Array.isArray(E)?E[R-1]:E.type,j=x.parse(k,1+S.length,z);if(!j){A=!0;break}S.push(j)}if(!A)if(Array.isArray(E)&&E.length!==S.length)x.error(`Expected ${E.length} arguments, but found ${S.length} instead.`);else{for(let R=0;R<S.length;R++){let k=Array.isArray(E)?E[R]:E.type,z=S[R];x.concat(R+1).checkSubtype(k,z.type)}if(x.errors.length===0)return new Si(o,u,I,S,w)}}if(_.length===1)n.errors.push(...x.errors);else{let E=(_.length?_:p.map(([S])=>S)).map(cv).join(" | "),I=[];for(let S=1;S<e.length;S++){let A=n.parse(e[S],1+I.length);if(!A)return null;I.push(mr(A.type))}n.error(`Expected arguments of type ${E}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){Si.definitions=n;for(let o in n)e[o]=Si}}function cv(t){return Array.isArray(t)?`(${t.map(mr).join(", ")})`:`(${mr(t.type)}...)`}class wc{constructor(e,n,o){this.type=yc,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");let c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,xn);if(!c)return null;let u=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,xn);if(!u)return null;let p=null;return o.locale&&(p=n.parse(o.locale,1,vn),!p)?null:new wc(c,u,p)}evaluate(e){return new df(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var pf={exports:{}};pf.exports=function(){function t(o,c,u,p,_){for(;p>u;){if(p-u>600){var x=p-u+1,w=c-u+1,E=Math.log(x),I=.5*Math.exp(2*E/3),S=.5*Math.sqrt(E*I*(x-I)/x)*(w-x/2<0?-1:1);t(o,c,Math.max(u,Math.floor(c-w*I/x+S)),Math.min(p,Math.floor(c+(x-w)*I/x+S)),_)}var A=o[c],R=u,k=p;for(e(o,u,c),_(o[p],A)>0&&e(o,u,p);R<k;){for(e(o,R,k),R++,k--;_(o[R],A)<0;)R++;for(;_(o[k],A)>0;)k--}_(o[u],A)===0?e(o,u,k):e(o,++k,p),k<=c&&(u=k+1),c<=k&&(p=k-1)}}function e(o,c,u){var p=o[c];o[c]=o[u],o[u]=p}function n(o,c){return o<c?-1:o>c?1:0}return function(o,c,u,p,_){t(o,c,u||0,p||o.length-1,_||n)}}();var hg=Rt(pf.exports);function uv(t){let e=0;for(let n,o,c=0,u=t.length,p=u-1;c<u;p=c++)n=t[c],o=t[p],e+=(o.x-n.x)*(n.y+o.y);return e}function Tc(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ec(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function hv(t,e,n){let o=t[0]-e[0],c=t[1]-e[1],u=t[0]-n[0],p=t[1]-n[1];return o*p-u*c==0&&o*u<=0&&c*p<=0}function aa(t,e,n=!1){let o=!1;for(let _=0,x=e.length;_<x;_++){let w=e[_];for(let E=0,I=w.length,S=I-1;E<I;S=E++){let A=w[S],R=w[E];if(hv(t,A,R))return n;(u=A)[1]>(c=t)[1]!=(p=R)[1]>c[1]&&c[0]<(p[0]-u[0])*(c[1]-u[1])/(p[1]-u[1])+u[0]&&(o=!o)}}var c,u,p;return o}function mf(t,e,n,o){let c=o[0]-n[0],u=o[1]-n[1],p=(t[0]-n[0])*u-c*(t[1]-n[1]),_=(e[0]-n[0])*u-c*(e[1]-n[1]);return p>0&&_<0||p<0&&_>0}function rl(t,e,n,o){return(c=[o[0]-n[0],o[1]-n[1]])[0]*(u=[e[0]-t[0],e[1]-t[1]])[1]-c[1]*u[0]!=0&&!(!mf(t,e,n,o)||!mf(n,o,t,e));var c,u}let As=8192;function dv(t,e){let n=(180+t[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*As),Math.round(o*c*As)]}function fv(t,e){for(let n=0;n<e.length;n++)if(aa(t,e[n]))return!0;return!1}function gf(t,e,n){for(let o of n)for(let c=0,u=o.length,p=u-1;c<u;p=c++)if(rl(t,e,o[p],o[c]))return!0;return!1}function nh(t,e){for(let n=0;n<t.length;++n)if(!aa(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(gf(t[n],t[n+1],e))return!1;return!0}function dg(t,e){for(let n=0;n<e.length;n++)if(nh(t,e[n]))return!0;return!1}function _f(t,e,n){let o=[];for(let c=0;c<t.length;c++){let u=[];for(let p=0;p<t[c].length;p++){let _=dv(t[c][p],n);Tc(e,_),u.push(_)}o.push(u)}return o}function Ic(t,e,n){let o=[];for(let c=0;c<t.length;c++){let u=_f(t[c],e,n);o.push(u)}return o}function yf(t,e,n,o){if(t[0]<n[0]||t[0]>n[2]){let c=.5*o,u=t[0]-n[0]>c?-o:n[0]-t[0]>c?o:0;u===0&&(u=t[0]-n[2]>c?-o:n[2]-t[0]>c?o:0),t[0]+=u}Tc(e,t)}function Dc(t,e,n,o){let c=Math.pow(2,o.z)*As,u=[o.x*As,o.y*As],p=[];if(!t)return p;for(let _ of t)for(let x of _){let w=[x.x+u[0],x.y+u[1]];yf(w,e,n,c),p.push(w)}return p}function vf(t,e,n,o){let c=Math.pow(2,o.z)*As,u=[o.x*As,o.y*As],p=[];if(!t)return p;for(let x of t){let w=[];for(let E of x){let I=[E.x+u[0],E.y+u[1]];Tc(e,I),w.push(I)}p.push(w)}if(e[2]-e[0]<=c/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(let x of p)for(let w of x)yf(w,e,n,c)}var _;return p}class la{constructor(e,n){this.type=xn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(tl(e[1])){let o=e[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){let u=o.features[c].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new la(o,o.features[c].geometry)}else if(o.type==="Feature"){let c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new la(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new la(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){let c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(o.type==="Polygon"){let _=_f(o.coordinates,u,p),x=Dc(n.geometry(),c,u,p);if(!Ec(c,u))return!1;for(let w of x)if(!aa(w,_))return!1}if(o.type==="MultiPolygon"){let _=Ic(o.coordinates,u,p),x=Dc(n.geometry(),c,u,p);if(!Ec(c,u))return!1;for(let w of x)if(!fv(w,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){let c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(o.type==="Polygon"){let _=_f(o.coordinates,u,p),x=vf(n.geometry(),c,u,p);if(!Ec(c,u))return!1;for(let w of x)if(!nh(w,_))return!1}if(o.type==="MultiPolygon"){let _=Ic(o.coordinates,u,p),x=vf(n.geometry(),c,u,p);if(!Ec(c,u))return!1;for(let w of x)if(!dg(w,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var fg={exports:{}};(function(t,e){t.exports=function(){var n={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},o=1/298.257223563,c=o*(2-o),u=Math.PI/180,p=function(I,S){if(I===void 0)throw new Error("No latitude given.");if(S&&!n[S])throw new Error("Unknown unit "+S+". Use one of: "+Object.keys(n).join(", "));var A=6378.137*u*(S?n[S]:1),R=Math.cos(I*u),k=1/(1-c*(1-R*R)),z=Math.sqrt(k);this.kx=A*z*R,this.ky=A*z*k*(1-c)},_={units:{configurable:!0}};function x(I,S){return I[0]===S[0]&&I[1]===S[1]}function w(I,S,A){var R=E(S[0]-I[0]);return[I[0]+R*A,I[1]+(S[1]-I[1])*A]}function E(I){for(;I<-180;)I+=360;for(;I>180;)I-=360;return I}return p.fromTile=function(I,S,A){var R=Math.PI*(1-2*(I+.5)/Math.pow(2,S)),k=Math.atan(.5*(Math.exp(R)-Math.exp(-R)))/u;return new p(k,A)},_.units.get=function(){return n},p.prototype.distance=function(I,S){var A=E(I[0]-S[0])*this.kx,R=(I[1]-S[1])*this.ky;return Math.sqrt(A*A+R*R)},p.prototype.bearing=function(I,S){var A=E(S[0]-I[0])*this.kx;return Math.atan2(A,(S[1]-I[1])*this.ky)/u},p.prototype.destination=function(I,S,A){var R=A*u;return this.offset(I,Math.sin(R)*S,Math.cos(R)*S)},p.prototype.offset=function(I,S,A){return[I[0]+S/this.kx,I[1]+A/this.ky]},p.prototype.lineDistance=function(I){for(var S=0,A=0;A<I.length-1;A++)S+=this.distance(I[A],I[A+1]);return S},p.prototype.area=function(I){for(var S=0,A=0;A<I.length;A++)for(var R=I[A],k=0,z=R.length,j=z-1;k<z;j=k++)S+=E(R[k][0]-R[j][0])*(R[k][1]+R[j][1])*(A?-1:1);return Math.abs(S)/2*this.kx*this.ky},p.prototype.along=function(I,S){var A=0;if(S<=0)return I[0];for(var R=0;R<I.length-1;R++){var k=I[R],z=I[R+1],j=this.distance(k,z);if((A+=j)>S)return w(k,z,(S-(A-j))/j)}return I[I.length-1]},p.prototype.pointToSegmentDistance=function(I,S,A){var R=S[0],k=S[1],z=E(A[0]-R)*this.kx,j=(A[1]-k)*this.ky,W=0;return z===0&&j===0||((W=(E(I[0]-R)*this.kx*z+(I[1]-k)*this.ky*j)/(z*z+j*j))>1?(R=A[0],k=A[1]):W>0&&(R+=z/this.kx*W,k+=j/this.ky*W)),z=E(I[0]-R)*this.kx,j=(I[1]-k)*this.ky,Math.sqrt(z*z+j*j)},p.prototype.pointOnLine=function(I,S){for(var A,R,k,z,j=1/0,W=0;W<I.length-1;W++){var X=I[W][0],Q=I[W][1],oe=E(I[W+1][0]-X)*this.kx,J=(I[W+1][1]-Q)*this.ky,le=0;oe===0&&J===0||((le=(E(S[0]-X)*this.kx*oe+(S[1]-Q)*this.ky*J)/(oe*oe+J*J))>1?(X=I[W+1][0],Q=I[W+1][1]):le>0&&(X+=oe/this.kx*le,Q+=J/this.ky*le));var ue=(oe=E(S[0]-X)*this.kx)*oe+(J=(S[1]-Q)*this.ky)*J;ue<j&&(j=ue,A=X,R=Q,k=W,z=le)}return{point:[A,R],index:k,t:Math.max(0,Math.min(1,z))}},p.prototype.lineSlice=function(I,S,A){var R=this.pointOnLine(A,I),k=this.pointOnLine(A,S);if(R.index>k.index||R.index===k.index&&R.t>k.t){var z=R;R=k,k=z}var j=[R.point],W=R.index+1,X=k.index;!x(A[W],j[0])&&W<=X&&j.push(A[W]);for(var Q=W+1;Q<=X;Q++)j.push(A[Q]);return x(A[X],k.point)||j.push(k.point),j},p.prototype.lineSliceAlong=function(I,S,A){for(var R=0,k=[],z=0;z<A.length-1;z++){var j=A[z],W=A[z+1],X=this.distance(j,W);if((R+=X)>I&&k.length===0&&k.push(w(j,W,(I-(R-X))/X)),R>=S)return k.push(w(j,W,(S-(R-X))/X)),k;R>I&&k.push(W)}return k},p.prototype.bufferPoint=function(I,S){var A=S/this.ky,R=S/this.kx;return[I[0]-R,I[1]-A,I[0]+R,I[1]+A]},p.prototype.bufferBBox=function(I,S){var A=S/this.ky,R=S/this.kx;return[I[0]-R,I[1]-A,I[2]+R,I[3]+A]},p.prototype.insideBBox=function(I,S){return E(I[0]-S[0])>=0&&E(I[0]-S[2])<=0&&I[1]>=S[1]&&I[1]<=S[3]},Object.defineProperties(p,_),p}()})(fg);var Mc=Rt(fg.exports),rh={exports:{}};(function(t,e){t.exports=function(){var n=function(c,u){if(c===void 0&&(c=[]),u===void 0&&(u=o),this.data=c,this.length=this.data.length,this.compare=u,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function o(c,u){return c<u?-1:c>u?1:0}return n.prototype.push=function(c){this.data.push(c),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var c=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),c}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(c){for(var u=this.data,p=this.compare,_=u[c];c>0;){var x=c-1>>1,w=u[x];if(p(_,w)>=0)break;u[c]=w,c=x}u[c]=_},n.prototype._down=function(c){for(var u=this.data,p=this.compare,_=this.length>>1,x=u[c];c<_;){var w=1+(c<<1),E=u[w],I=w+1;if(I<this.length&&p(u[I],E)<0&&(w=I,E=u[I]),p(E,x)>=0)break;u[c]=E,c=w}u[c]=x},n}()})(rh);var ih=Rt(rh.exports),et=8192;function ca(t,e){return e.dist-t.dist}let xf=100,bf=50;function pg(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function oh(t){return t[1]-t[0]+1}function ts(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function sh(t,e){if(t[0]>t[1])return[null,null];let n=oh(t);if(e){if(n===2)return[t,null];let o=Math.floor(n/2);return[[t[0],t[0]+o],[t[0]+o,t[1]]]}{if(n===1)return[t,null];let o=Math.floor(n/2)-1;return[[t[0],t[0]+o],[t[0]+o+1,t[1]]]}}function ns(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!ts(e,t.length))return n;for(let o=e[0];o<=e[1];++o)Tc(n,t[o]);return n}function ah(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let o=0;o<t[n].length;++o)Tc(e,t[n][o]);return e}function il(t,e,n){if(pg(t)||pg(e))return NaN;let o=0,c=0;return t[2]<e[0]&&(o=e[0]-t[2]),t[0]>e[2]&&(o=t[0]-e[2]),t[1]>e[3]&&(c=t[1]-e[3]),t[3]<e[1]&&(c=e[1]-t[3]),n.distance([0,0],[o,c])}function pv(t){return 360*t-180}function mv(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function wf(t,e){let n=Math.pow(2,e.z),o=(t.y/et+e.y)/n;return[pv((t.x/et+e.x)/n),mv(o)]}function gv(t,e){let n=[];for(let o=0;o<t.length;++o)n.push(wf(t[o],e));return n}function mg(t,e,n){let o=n.pointOnLine(e,t).point;return n.distance(t,o)}function gg(t,e,n,o,c){let u=n.slice(o[0],o[1]+1),p=1/0;for(let _=e[0];_<=e[1];++_)if((p=Math.min(p,mg(t[_],u,c)))===0)return 0;return p}function Tf(t,e,n,o,c){let u=Math.min(c.pointToSegmentDistance(t,n,o),c.pointToSegmentDistance(e,n,o)),p=Math.min(c.pointToSegmentDistance(n,t,e),c.pointToSegmentDistance(o,t,e));return Math.min(u,p)}function ol(t,e,n,o,c){if(!ts(e,t.length)||!ts(o,n.length))return NaN;let u=1/0;for(let p=e[0];p<e[1];++p)for(let _=o[0];_<o[1];++_){if(rl(t[p],t[p+1],n[_],n[_+1]))return 0;u=Math.min(u,Tf(t[p],t[p+1],n[_],n[_+1],c))}return u}function _g(t,e,n,o,c){if(!ts(e,t.length)||!ts(o,n.length))return NaN;let u=1/0;for(let p=e[0];p<=e[1];++p)for(let _=o[0];_<=o[1];++_)if((u=Math.min(u,c.distance(t[p],n[_])))===0)return u;return u}function yg(t,e,n){if(aa(t,e,!0))return 0;let o=1/0;for(let c of e){let u=c.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[u-1]&&(o=Math.min(o,n.pointToSegmentDistance(t,c[u-1],c[0])))===0||(o=Math.min(o,mg(t,c,n)))===0)return o}return o}function lh(t,e,n,o){if(!ts(e,t.length))return NaN;for(let u=e[0];u<=e[1];++u)if(aa(t[u],n,!0))return 0;let c=1/0;for(let u=e[0];u<e[1];++u)for(let p of n)for(let _=0,x=p.length,w=x-1;_<x;w=_++){if(rl(t[u],t[u+1],p[w],p[_]))return 0;c=Math.min(c,Tf(t[u],t[u+1],p[w],p[_],o))}return c}function vg(t,e){for(let n of t)for(let o=0;o<=n.length-1;++o)if(aa(n[o],e,!0))return!0;return!1}function _v(t,e,n,o=1/0){let c=ah(t),u=ah(e);if(o!==1/0&&il(c,u,n)>=o)return o;if(Ec(c,u)){if(vg(t,e))return 0}else if(vg(e,t))return 0;let p=o;for(let _ of t)for(let x=0,w=_.length,E=w-1;x<w;E=x++)for(let I of e)for(let S=0,A=I.length,R=A-1;S<A;R=S++){if(rl(_[E],_[x],I[R],I[S]))return 0;p=Math.min(p,Tf(_[E],_[x],I[R],I[S],n))}return p}function yo(t,e,n,o,c,u,p){if(u===null||p===null)return;let _=il(ns(o,u),ns(c,p),n);_<e&&t.push({dist:_,range1:u,range2:p})}function xg(t,e,n,o,c=1/0){let u=Math.min(o.distance(t[0],n[0][0]),c);if(u===0)return u;let p=new ih([{dist:0,range1:[0,t.length-1],range2:[0,0]}],ca),_=e?bf:xf,x=ah(n);for(;p.length;){let w=p.pop();if(w.dist>=u)continue;let E=w.range1;if(oh(E)<=_){if(!ts(E,t.length))return NaN;if(e){let I=lh(t,E,n,o);if((u=Math.min(u,I))===0)return u}else for(let I=E[0];I<=E[1];++I){let S=yg(t[I],n,o);if((u=Math.min(u,S))===0)return u}}else{let I=sh(E,e);if(I[0]!==null){let S=il(ns(t,I[0]),x,o);S<u&&p.push({dist:S,range1:I[0],range2:[0,0]})}if(I[1]!==null){let S=il(ns(t,I[1]),x,o);S<u&&p.push({dist:S,range1:I[1],range2:[0,0]})}}}return u}function ua(t,e,n,o,c,u=1/0){let p=Math.min(u,c.distance(t[0],n[0]));if(p===0)return p;let _=new ih([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],ca),x=e?bf:xf,w=o?bf:xf;for(;_.length;){let E=_.pop();if(E.dist>=p)continue;let I=E.range1,S=E.range2;if(oh(I)<=x&&oh(S)<=w){if(!ts(I,t.length)||!ts(S,n.length))return NaN;if(e&&o?p=Math.min(p,ol(t,I,n,S,c)):e||o?e&&!o?p=Math.min(p,gg(n,S,t,I,c)):!e&&o&&(p=Math.min(p,gg(t,I,n,S,c))):p=Math.min(p,_g(t,I,n,S,c)),p===0)return p}else{let A=sh(I,e),R=sh(S,o);yo(_,p,c,t,n,A[0],R[0]),yo(_,p,c,t,n,A[0],R[1]),yo(_,p,c,t,n,A[1],R[0]),yo(_,p,c,t,n,A[1],R[1])}}return p}function Ef(t,e,n,o,c=1/0){let u=c,p=ns(t,[0,t.length-1]);for(let _ of n)if(!(u!==1/0&&il(p,ns(_,[0,_.length-1]),o)>=u)&&(u=Math.min(u,ua(t,e,_,!0,o,u)),u===0))return u;return u}function ch(t,e,n,o,c=1/0){let u=c,p=ns(t,[0,t.length-1]);for(let _ of n){if(u!==1/0&&il(p,ah(_),o)>=u)continue;let x=xg(t,e,_,o,u);if(isNaN(x))return x;if((u=Math.min(u,x))===0)return u}return u}function If(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class ha{constructor(e,n){this.type=at,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(tl(e[1])){let o=e[1];if(o.type==="FeatureCollection"){for(let c=0;c<o.features.length;++c)if(If(o.features[c].geometry.type))return new ha(o,o.features[c].geometry)}else if(o.type==="Feature"){if(If(o.geometry.type))return new ha(o,o.geometry)}else if(If(o.type))return new ha(o,o)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),o=e.canonicalID();if(n!=null&&o!=null){if(e.geometryType()==="Point")return function(c,u,p){let _=[];for(let w of c)for(let E of w)_.push(wf(E,u));let x=new Mc(_[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?ua(_,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",x):p.type==="MultiLineString"?Ef(_,!1,p.coordinates,x):p.type==="Polygon"||p.type==="MultiPolygon"?ch(_,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,x):null}(n,o,this.geometries);if(e.geometryType()==="LineString")return function(c,u,p){let _=[];for(let w of c){let E=[];for(let I of w)E.push(wf(I,u));_.push(E)}let x=new Mc(_[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Ef(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",_,x);if(p.type==="MultiLineString"){let w=1/0;for(let E=0;E<p.coordinates.length;E++){let I=Ef(p.coordinates[E],!0,_,x,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}if(p.type==="Polygon"||p.type==="MultiPolygon"){let w=1/0;for(let E=0;E<_.length;E++){let I=ch(_[E],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,x,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}return null}(n,o,this.geometries);if(e.geometryType()==="Polygon")return function(c,u,p){let _=[];for(let w of function(E,I){let S=E.length;if(S<=1)return[E];let A=[],R,k;for(let z=0;z<S;z++){let j=uv(E[z]);j!==0&&(E[z].area=Math.abs(j),k===void 0&&(k=j<0),k===j<0?(R&&A.push(R),R=[E[z]]):R.push(E[z]))}return R&&A.push(R),A}(c)){let E=[];for(let I=0;I<w.length;++I)E.push(gv(w[I],u));_.push(E)}let x=new Mc(_[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return ch(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",_,x);if(p.type==="MultiLineString"){let w=1/0;for(let E=0;E<p.coordinates.length;E++){let I=ch(p.coordinates[E],!0,_,x,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}return p.type==="Polygon"||p.type==="MultiPolygon"?function(w,E,I){let S=1/0;for(let A of w)for(let R of E){let k=_v(A,R,I,S);if(isNaN(k))return k;if((S=Math.min(S,k))===0)return S}return S}(p.type==="Polygon"?[p.coordinates]:p.coordinates,_,x):null}(n,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Df(t,e){switch(t){case"string":return Ki(e);case"number":return+e;case"boolean":return!!e;case"color":return Sn.parse(e);case"formatted":return Zr.fromString(Ki(e));case"resolvedImage":return Vi.fromString(Ki(e))}return e}function Mf(t,e,n,o){return o!==void 0&&(t=o*Math.round(t/o)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}class Ps{constructor(e,n,o){this.type=e,this.key=n,this.scope=o}static parse(e,n){let o=n.expectedType;if(o==null&&(o=dn),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let c=n.parse(e[1],1);if(!(c instanceof Lo))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let u=n.parse(e[2],2);return u instanceof Lo?new Ps(o,Ki(c.value),Ki(u.value)):n.error("Scope of 'config' expression must be a string literal.")}return new Ps(o,Ki(c.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(n);if(!o)return null;let{type:c,value:u,values:p,minValue:_,maxValue:x,stepValue:w}=o,E=o.default.evaluate(e),I=E;if(u){let S=e.scope;e.scope=(S||"").split("").slice(1).join(""),I=u.evaluate(e),e.scope=S}return c&&(I=Df(c,I)),I===void 0||_===void 0&&x===void 0&&w===void 0||(typeof I=="number"?I=Mf(I,_,x,w):Array.isArray(I)&&(I=I.map(S=>typeof S=="number"?Mf(S,_,x,w):S))),u!==void 0&&I!==void 0&&p&&!p.includes(I)&&(I=E,c&&(I=Df(c,I))),(c&&c!==this.type||I!==void 0&&Mr(I)!==this.type)&&(I=Df(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Rs(t){if(t instanceof Si&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof la||t instanceof ha)return!1;let e=!0;return t.eachChild(n=>{e&&!Rs(n)&&(e=!1)}),e}function Sc(t){if(t instanceof Si&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!Sc(n)&&(e=!1)}),e}function Cc(t){if(t instanceof Ps)return!1;let e=!0;return t.eachChild(n=>{e&&!Cc(n)&&(e=!1)}),e}function Ac(t,e){if(t instanceof Si&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(o=>{n&&!Ac(o,e)&&(n=!1)}),n}class Ui{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let o=e[1];return n.scope.has(o)?new Ui(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class uh{constructor(e,n=[],o,c=new Ss,u=[],p,_){this.registry=e,this.path=n,this.key=n.map(x=>`[${x}]`).join(""),this.scope=c,this.errors=u,this.expectedType=o,this._scope=p,this.options=_}parse(e,n,o,c,u={}){return n||o?this.concat(n,o,c)._parse(e,u):this._parse(e,u)}_parse(e,n){function o(c,u,p){return p==="assert"?new _o(u,[c]):p==="coerce"?new es(u,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let u=c.parse(e,this);if(!u)return null;if(this.expectedType){let p=this.expectedType,_=u.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||_.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(p,_))return null}else u=o(u,p,n.typeAnnotation||"coerce");else u=o(u,p,n.typeAnnotation||"assert")}if(!(u instanceof Lo)&&u.type.kind!=="resolvedImage"&&hh(u)){let p=new ff(this._scope,this.options);try{u=new Lo(u.type,u.evaluate(p))}catch(_){return this.error(_.message),null}}return u}return es.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){let c=typeof e=="number"?this.path.concat(e):this.path,u=o?this.scope.concat(o):this.scope;return new uh(this.registry,c,n||null,u,this.errors,this._scope,this.options)}error(e,...n){let o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new go(o,e))}checkSubtype(e,n){let o=vc(e,n);return o&&this.error(o),o}}function hh(t){if(t instanceof Ui)return hh(t.boundExpression);if(t instanceof Si&&t.name==="error"||t instanceof wc||t instanceof la||t instanceof ha||t instanceof Ps)return!1;let e=t instanceof es||t instanceof _o,n=!0;return t.eachChild(o=>{n=e?n&&hh(o):n&&o instanceof Lo}),!!n&&Rs(t)&&Ac(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function dh(t,e){let n=t.length-1,o,c,u=0,p=n,_=0;for(;u<=p;)if(_=Math.floor((u+p)/2),o=t[_],c=t[_+1],o<=e){if(_===n||e<c)return _;u=_+1}else{if(!(o>e))throw new Rr("Input is not a number.");p=_-1}return 0}class Pc{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[c,u]of o)this.labels.push(c),this.outputs.push(u)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let o=n.parse(e[1],1,at);if(!o)return null;let c=[],u=null;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);for(let p=1;p<e.length;p+=2){let _=p===1?-1/0:e[p],x=e[p+1],w=p,E=p+1;if(typeof _!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);let I=n.parse(x,E,u);if(!I)return null;u=u||I.type,c.push([_,I])}return new Pc(u,o,c)}evaluate(e){let n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);let u=n.length;return c>=n[u-1]?o[u-1].evaluate(e):o[dh(n,c)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let bg=.95047,wg=1.08883,fh=4/29,da=6/29,Tg=3*da*da,Eg=da*da*da,yv=Math.PI/180,Ig=180/Math.PI;function sl(t){return t>Eg?Math.pow(t,1/3):t/Tg+fh}function Sf(t){return t>da?t*t*t:Tg*(t-fh)}function Cf(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Af(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Dg(t){let e=Af(t.r),n=Af(t.g),o=Af(t.b),c=sl((.4124564*e+.3575761*n+.1804375*o)/bg),u=sl((.2126729*e+.7151522*n+.072175*o)/1);return{l:116*u-16,a:500*(c-u),b:200*(u-sl((.0193339*e+.119192*n+.9503041*o)/wg)),alpha:t.a}}function Mg(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,o=isNaN(t.b)?e:e-t.b/200;return e=1*Sf(e),n=bg*Sf(n),o=wg*Sf(o),new Sn(Cf(3.2404542*n-1.5371385*e-.4985314*o),Cf(-.969266*n+1.8760108*e+.041556*o),Cf(.0556434*n-.2040259*e+1.0572252*o),t.alpha)}function ph(t,e,n){let o=e-t;return t+n*(o>180||o<-180?o-360*Math.round(o/360):o)}let Os={forward:Dg,reverse:Mg,interpolate:function(t,e,n){return{l:Zt(t.l,e.l,n),a:Zt(t.a,e.a,n),b:Zt(t.b,e.b,n),alpha:Zt(t.alpha,e.alpha,n)}}},Qr={forward:function(t){let{l:e,a:n,b:o}=Dg(t),c=Math.atan2(o,n)*Ig;return{h:c<0?c+360:c,c:Math.sqrt(n*n+o*o),l:e,alpha:t.a}},reverse:function(t){let e=t.h*yv,n=t.c;return Mg({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:ph(t.h,e.h,n),c:Zt(t.c,e.c,n),l:Zt(t.l,e.l,n),alpha:Zt(t.alpha,e.alpha,n)}}};var Rc=Object.freeze({__proto__:null,hcl:Qr,lab:Os});class $i{constructor(e,n,o,c,u){this.type=e,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(let[p,_]of u)this.labels.push(p),this.outputs.push(_)}static interpolationFactor(e,n,o,c){let u=0;if(e.name==="exponential")u=Pf(n,e.base,o,c);else if(e.name==="linear")u=Pf(n,1,o,c);else if(e.name==="cubic-bezier"){let p=e.controlPoints;u=new Qm(p[0],p[1],p[2],p[3]).solve(Pf(n,1,o,c))}return u}static parse(e,n){let[o,c,u,...p]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){let w=c[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{let w=c.slice(1);if(w.length!==4||w.some(E=>typeof E!="number"||E<0||E>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(u=n.parse(u,2,at),!u)return null;let _=[],x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=ji:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let w=0;w<p.length;w+=2){let E=p[w],I=p[w+1],S=w+3,A=w+4;if(typeof E!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(_.length&&_[_.length-1][0]>=E)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',S);let R=n.parse(I,A,x);if(!R)return null;x=x||R.type,_.push([E,R])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new $i(x,o,c,u,_):n.error(`Type ${mr(x)} is not interpolatable.`)}evaluate(e){let n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);let u=n.length;if(c>=n[u-1])return o[u-1].evaluate(e);let p=dh(n,c),_=$i.interpolationFactor(this.interpolation,c,n[p],n[p+1]),x=o[p].evaluate(e),w=o[p+1].evaluate(e);return this.operator==="interpolate"?_c[this.type.kind.toLowerCase()](x,w,_):this.operator==="interpolate-hcl"?Qr.reverse(Qr.interpolate(Qr.forward(x),Qr.forward(w),_)):Os.reverse(Os.interpolate(Os.forward(x),Os.forward(w),_))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)n.push(this.labels[o],this.outputs[o].serialize());return n}}function Pf(t,e,n,o){let c=o-n,u=t-n;return c===0?0:e===1?u/c:(Math.pow(e,u)-1)/(Math.pow(e,c)-1)}class mh{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null,c=n.expectedType;c&&c.kind!=="value"&&(o=c);let u=[];for(let _ of e.slice(1)){let x=n.parse(_,1+u.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,u.push(x)}let p=c&&u.some(_=>vc(c,_.type));return new mh(p?dn:o,u)}evaluate(e){let n,o=null,c=0;for(let u of this.args){if(c++,o=u.evaluate(e),o&&o instanceof Vi&&!o.available&&(n||(n=o),o=null,c===this.args.length))return n;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class gh{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let o=[];for(let u=1;u<e.length-1;u+=2){let p=e[u];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",u);let _=n.parse(e[u+1],u+1);if(!_)return null;o.push([p,_])}let c=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return c?new gh(o,c):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,o]of this.bindings)e.push(n,o.serialize());return e.push(this.result.serialize()),e}}class Oc{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,at),c=n.parse(e[2],2,Br(n.expectedType||dn));return o&&c?new Oc(c.type.itemType,o,c):null}evaluate(e){let n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new Rr(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Rr(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Rr(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Rf{constructor(e,n){this.type=xn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,dn),c=n.parse(e[2],2,dn);return o&&c?xc(o.type,[xn,vn,at,Yt,dn])?new Rf(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${mr(o.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!sa(n,["boolean","string","number","null"]))throw new Rr(`Expected first argument to be of type boolean, string, number or null, but found ${mr(Mr(n))} instead.`);if(!sa(o,["string","array"]))throw new Rr(`Expected second argument to be of type array or string, but found ${mr(Mr(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class al{constructor(e,n,o){this.type=at,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,dn),c=n.parse(e[2],2,dn);if(!o||!c)return null;if(!xc(o.type,[xn,vn,at,Yt,dn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${mr(o.type)} instead`);if(e.length===4){let u=n.parse(e[3],3,at);return u?new al(o,c,u):null}return new al(o,c)}evaluate(e){let n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!sa(n,["boolean","string","number","null"]))throw new Rr(`Expected first argument to be of type boolean, string, number or null, but found ${mr(Mr(n))} instead.`);if(!sa(o,["string","array"]))throw new Rr(`Expected second argument to be of type array or string, but found ${mr(Mr(o))} instead.`);if(this.fromIndex){let c=this.fromIndex.evaluate(e);return o.indexOf(n,c)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Of{constructor(e,n,o,c,u,p){this.inputType=e,this.type=n,this.input=o,this.cases=c,this.outputs=u,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);let u={},p=[];for(let w=2;w<e.length-1;w+=2){let E=e[w],I=e[w+1];Array.isArray(E)||(E=[E]);let S=n.concat(w);if(E.length===0)return S.error("Expected at least one branch label.");for(let R of E){if(typeof R!="number"&&typeof R!="string")return S.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return S.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return S.error("Numeric branch labels must be integer values.");if(o){if(S.checkSubtype(o,Mr(R)))return null}else o=Mr(R);if(u[String(R)]!==void 0)return S.error("Branch labels must be unique.");u[String(R)]=p.length}let A=n.parse(I,w,c);if(!A)return null;c=c||A.type,p.push(A)}let _=n.parse(e[1],1,dn);if(!_)return null;let x=n.parse(e[e.length-1],e.length-1,c);return x?_.type.kind!=="value"&&n.concat(1).checkSubtype(o,_.type)?null:new Of(o,c,_,u,p,x):null}evaluate(e){let n=this.input.evaluate(e);return(Mr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),o=[],c={};for(let p of n){let _=c[this.cases[p]];_===void 0?(c[this.cases[p]]=o.length,o.push([this.cases[p],[p]])):o[_][1].push(p)}let u=p=>this.inputType.kind==="number"?Number(p):p;for(let[p,_]of o)e.push(_.length===1?u(_[0]):_.map(u)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class Lf{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);let c=[];for(let p=1;p<e.length-1;p+=2){let _=n.parse(e[p],p,xn);if(!_)return null;let x=n.parse(e[p+1],p+1,o);if(!x)return null;c.push([_,x]),o=o||x.type}let u=n.parse(e[e.length-1],e.length-1,o);return u?new Lf(o,c,u):null}evaluate(e){for(let[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class ll{constructor(e,n,o,c){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,dn),c=n.parse(e[2],2,at);if(!o||!c)return null;if(!xc(o.type,[Br(dn),vn,dn]))return n.error(`Expected first argument to be of type array or string, but found ${mr(o.type)} instead`);if(e.length===4){let u=n.parse(e[3],3,at);return u?new ll(o.type,o,c,u):null}return new ll(o.type,o,c)}evaluate(e){let n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!sa(n,["string","array"]))throw new Rr(`Expected first argument to be of type array or string, but found ${mr(Mr(n))} instead.`);if(this.endIndex){let c=this.endIndex.evaluate(e);return n.slice(o,c)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Sg(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function kf(t,e,n,o){return o.compare(e,n)===0}function fa(t,e,n){let o=t!=="=="&&t!=="!=";return class zP{constructor(u,p,_){this.type=xn,this.lhs=u,this.rhs=p,this.collator=_,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");let _=u[0],x=p.parse(u[1],1,dn);if(!x)return null;if(!Sg(_,x.type))return p.concat(1).error(`"${_}" comparisons are not supported for type '${mr(x.type)}'.`);let w=p.parse(u[2],2,dn);if(!w)return null;if(!Sg(_,w.type))return p.concat(2).error(`"${_}" comparisons are not supported for type '${mr(w.type)}'.`);if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${mr(x.type)}' and '${mr(w.type)}'.`);o&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new _o(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new _o(x.type,[w])));let E=null;if(u.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(u[3],3,yc),!E)return null}return new zP(x,w,E)}evaluate(u){let p=this.lhs.evaluate(u),_=this.rhs.evaluate(u);if(o&&this.hasUntypedArgument){let x=Mr(p),w=Mr(_);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new Rr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${x.kind}, ${w.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){let x=Mr(p),w=Mr(_);if(x.kind!=="string"||w.kind!=="string")return e(u,p,_)}return this.collator?n(u,p,_,this.collator.evaluate(u)):e(u,p,_)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){let u=[t];return this.eachChild(p=>{u.push(p.serialize())}),u}}}let vv=fa("==",function(t,e,n){return e===n},kf),Ff=fa("!=",function(t,e,n){return e!==n},function(t,e,n,o){return!kf(0,e,n,o)}),_h=fa("<",function(t,e,n){return e<n},function(t,e,n,o){return o.compare(e,n)<0}),Cg=fa(">",function(t,e,n){return e>n},function(t,e,n,o){return o.compare(e,n)>0}),xv=fa("<=",function(t,e,n){return e<=n},function(t,e,n,o){return o.compare(e,n)<=0}),Ag=fa(">=",function(t,e,n){return e>=n},function(t,e,n,o){return o.compare(e,n)>=0});class Nf{constructor(e,n,o,c,u,p){this.type=vn,this.number=e,this.locale=n,this.currency=o,this.unit=c,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let o=n.parse(e[1],1,at);if(!o)return null;let c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let u=null;if(c.locale&&(u=n.parse(c.locale,1,vn),!u))return null;let p=null;if(c.currency&&(p=n.parse(c.currency,1,vn),!p))return null;let _=null;if(c.unit&&(_=n.parse(c.unit,1,vn),!_))return null;let x=null;if(c["min-fraction-digits"]&&(x=n.parse(c["min-fraction-digits"],1,at),!x))return null;let w=null;return c["max-fraction-digits"]&&(w=n.parse(c["max-fraction-digits"],1,at),!w)?null:new Nf(o,u,p,_,x,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Lc{constructor(e){this.type=at,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${mr(o.type)} instead.`):new Lc(o):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Rr(`Expected value to be of type string or array, but found ${mr(Mr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function Pg(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let cl={"==":vv,"!=":Ff,">":Cg,"<":_h,">=":Ag,"<=":xv,array:_o,at:Oc,boolean:_o,case:Lf,coalesce:mh,collator:wc,format:bc,image:nl,in:Rf,"index-of":al,interpolate:$i,"interpolate-hcl":$i,"interpolate-lab":$i,length:Lc,let:gh,literal:Lo,match:Of,number:_o,"number-format":Nf,object:_o,slice:ll,step:Pc,string:_o,"to-boolean":es,"to-color":es,"to-number":es,"to-string":es,var:Ui,within:la,distance:ha,config:Ps};function Rg(t,[e,n,o,c]){e=e.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);let u=c?c.evaluate(t):1,p=ug(e,n,o,u);if(p)throw new Rr(p);return new Sn(e/255*u,n/255*u,o/255*u,u)}function Og(t,[e,n,o,c]){e=e.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);let u=c?c.evaluate(t):1,p=function(w,E,I,S){return typeof w=="number"&&w>=0&&w<=360?typeof E=="number"&&E>=0&&E<=100&&typeof I=="number"&&I>=0&&I<=100?S===void 0||typeof S=="number"&&S>=0&&S<=1?null:`Invalid hsla value [${[w,E,I,S].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof S=="number"?[w,E,I,S]:[w,E,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof S=="number"?[w,E,I,S]:[w,E,I]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,o,u);if(p)throw new Rr(p);let _=`hsla(${e}, ${n}%, ${o}%, ${u})`,x=Sn.parse(_);if(!x)throw new Rr(`Failed to parse HSLA color: ${_}`);return x}function zf(t,e){return t in e}function Bf(t,e){let n=e[t];return n===void 0?null:n}function pa(t){return{type:t}}function Lg(t){return{result:"success",value:t}}function ma(t){return{result:"error",value:t}}function kg(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function yh(t){return t["property-type"]==="data-driven"}function Fg(t){return kg(t.expression,"measure-light")}function Ng(t){return kg(t.expression,"zoom")}function ul(t){return!!t.expression&&t.expression.interpolated}function jf(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function bv(t){return t}function kc(t,e){let n=e.type==="color",o=t.stops&&typeof t.stops[0][0]=="object",c=o||!(o||t.property!==void 0),u=t.type||(ul(e)?"exponential":"interval");if(n&&((t=Ju({},t)).stops&&(t.stops=t.stops.map(w=>[w[0],Sn.parse(w[1])])),t.default=Sn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Rc[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,_,x;if(u==="exponential")p=Vf;else if(u==="interval")p=wv;else if(u==="categorical"){p=zg,_=Object.create(null);for(let w of t.stops)_[w[0]]=w[1];x=typeof t.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);p=Bg}if(o){let w={},E=[];for(let A=0;A<t.stops.length;A++){let R=t.stops[A],k=R[0].zoom;w[k]===void 0&&(w[k]={zoom:k,type:t.type,property:t.property,default:t.default,stops:[]},E.push(k)),w[k].stops.push([R[0].value,R[1]])}let I=[];for(let A of E)I.push([w[A].zoom,kc(w[A],e)]);let S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:$i.interpolationFactor.bind(void 0,S),zoomStops:I.map(A=>A[0]),evaluate:({zoom:A},R)=>Vf({stops:I,base:t.base},e,A).evaluate(A,R)}}if(c){let w=u==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:$i.interpolationFactor.bind(void 0,w),zoomStops:t.stops.map(E=>E[0]),evaluate:({zoom:E})=>p(t,e,E,_,x)}}return{kind:"source",evaluate(w,E){let I=E&&E.properties?E.properties[t.property]:void 0;return I===void 0?Fc(t.default,e.default):p(t,e,I,_,x)}}}function Fc(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function zg(t,e,n,o,c){return Fc(typeof n===c?o[n]:void 0,t.default,e.default)}function wv(t,e,n){if(Cs(n)!=="number")return Fc(t.default,e.default);let o=t.stops.length;if(o===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[o-1][0])return t.stops[o-1][1];let c=dh(t.stops.map(u=>u[0]),n);return t.stops[c][1]}function Vf(t,e,n){let o=t.base!==void 0?t.base:1;if(Cs(n)!=="number")return Fc(t.default,e.default);let c=t.stops.length;if(c===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[c-1][0])return t.stops[c-1][1];let u=dh(t.stops.map(E=>E[0]),n),p=function(E,I,S,A){let R=A-S,k=E-S;return R===0?0:I===1?k/R:(Math.pow(I,k)-1)/(Math.pow(I,R)-1)}(n,o,t.stops[u][0],t.stops[u+1][0]),_=t.stops[u][1],x=t.stops[u+1][1],w=_c[e.type]||bv;if(t.colorSpace&&t.colorSpace!=="rgb"){let E=Rc[t.colorSpace];w=(I,S)=>E.reverse(E.interpolate(E.forward(I),E.forward(S),p))}return typeof _.evaluate=="function"?{evaluate(...E){let I=_.evaluate.apply(void 0,E),S=x.evaluate.apply(void 0,E);if(I!==void 0&&S!==void 0)return w(I,S,p)}}:w(_,x,p)}function Bg(t,e,n){return e.type==="color"?n=Sn.parse(n):e.type==="formatted"?n=Zr.fromString(n.toString()):e.type==="resolvedImage"?n=Vi.fromString(n.toString()):Cs(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Fc(n,t.default,e.default)}Si.register(cl,{error:[{kind:"error"},[vn],(t,[e])=>{throw new Rr(e.evaluate(t))}],typeof:[vn,[dn],(t,[e])=>mr(Mr(e.evaluate(t)))],"to-rgba":[Br(at,4),[ji],(t,[e])=>e.evaluate(t).toArray()],rgb:[ji,[at,at,at],Rg],rgba:[ji,[at,at,at,at],Rg],hsl:[ji,[at,at,at],Og],hsla:[ji,[at,at,at,at],Og],has:{type:xn,overloads:[[[vn],(t,[e])=>zf(e.evaluate(t),t.properties())],[[vn,Ka],(t,[e,n])=>zf(e.evaluate(t),n.evaluate(t))]]},get:{type:dn,overloads:[[[vn],(t,[e])=>Bf(e.evaluate(t),t.properties())],[[vn,Ka],(t,[e,n])=>Bf(e.evaluate(t),n.evaluate(t))]]},"feature-state":[dn,[vn],(t,[e])=>Bf(e.evaluate(t),t.featureState||{})],properties:[Ka,[],t=>t.properties()],"geometry-type":[vn,[],t=>t.geometryType()],id:[dn,[],t=>t.id()],zoom:[at,[],t=>t.globals.zoom],pitch:[at,[],t=>t.globals.pitch||0],"distance-from-center":[at,[],t=>t.distanceFromCenter()],"measure-light":[at,[vn],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[at,[],t=>t.globals.heatmapDensity||0],"line-progress":[at,[],t=>t.globals.lineProgress||0],"raster-value":[at,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[at,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[at,[],t=>t.globals.skyRadialProgress||0],accumulated:[dn,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[at,pa(at),(t,e)=>{let n=0;for(let o of e)n+=o.evaluate(t);return n}],"*":[at,pa(at),(t,e)=>{let n=1;for(let o of e)n*=o.evaluate(t);return n}],"-":{type:at,overloads:[[[at,at],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[at],(t,[e])=>-e.evaluate(t)]]},"/":[at,[at,at],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[at,[at,at],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[at,[],()=>Math.LN2],pi:[at,[],()=>Math.PI],e:[at,[],()=>Math.E],"^":[at,[at,at],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[at,[at],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[at,[at],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[at,[at],(t,[e])=>Math.log(e.evaluate(t))],log2:[at,[at],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[at,[at],(t,[e])=>Math.sin(e.evaluate(t))],cos:[at,[at],(t,[e])=>Math.cos(e.evaluate(t))],tan:[at,[at],(t,[e])=>Math.tan(e.evaluate(t))],asin:[at,[at],(t,[e])=>Math.asin(e.evaluate(t))],acos:[at,[at],(t,[e])=>Math.acos(e.evaluate(t))],atan:[at,[at],(t,[e])=>Math.atan(e.evaluate(t))],min:[at,pa(at),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[at,pa(at),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[at,[at],(t,[e])=>Math.abs(e.evaluate(t))],round:[at,[at],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[at,[at],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[at,[at],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[xn,[vn,dn],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[xn,[dn],(t,[e])=>t.id()===e.value],"filter-type-==":[xn,[vn],(t,[e])=>t.geometryType()===e.value],"filter-<":[xn,[vn,dn],(t,[e,n])=>{let o=t.properties()[e.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[xn,[dn],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[xn,[vn,dn],(t,[e,n])=>{let o=t.properties()[e.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[xn,[dn],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[xn,[vn,dn],(t,[e,n])=>{let o=t.properties()[e.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[xn,[dn],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[xn,[vn,dn],(t,[e,n])=>{let o=t.properties()[e.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[xn,[dn],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[xn,[dn],(t,[e])=>e.value in t.properties()],"filter-has-id":[xn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[xn,[Br(vn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[xn,[Br(dn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[xn,[vn,Br(dn)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[xn,[vn,Br(dn)],(t,[e,n])=>function(o,c,u,p){for(;u<=p;){let _=u+p>>1;if(c[_]===o)return!0;c[_]>o?p=_-1:u=_+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:xn,overloads:[[[xn,xn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[pa(xn),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:xn,overloads:[[[xn,xn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[pa(xn),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[xn,[xn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[xn,[vn],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[vn,[vn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[vn,[vn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[vn,pa(dn),(t,e)=>e.map(n=>Ki(n.evaluate(t))).join("")],"resolved-locale":[vn,[yc],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[at,[at,at,dn],(t,e)=>{let[n,o,c]=e.map(p=>p.evaluate(t));if(n>o||n===o)return n;let u;if(typeof c=="string")u=function(p){let _=0;if(p.length===0)return _;for(let x=0;x<p.length;x++)_=(_<<5)-_+p.charCodeAt(x),_|=0;return _}(c);else{if(typeof c!="number")throw new Rr(`Invalid seed input: ${c}`);u=c}return n+Pg(u)()*(o-n)}]});class vh{constructor(e,n,o,c){this.expression=e,this._warningHistory={},this._evaluator=new ff(o,c),this._defaultValue=n?function(u){return u.type==="color"&&(jf(u.default)||Array.isArray(u.default))?new Sn(0,0,0,0):u.type==="color"?Sn.parse(u.default)||null:u.default===void 0?null:u.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,c,u,p,_,x){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,c,u,p,_,x){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null;try{let w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Rr(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function xh(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in cl}function hl(t,e,n,o){let c=new uh(cl,[],e?function(p){let _={color:ji,string:vn,number:at,enum:vn,boolean:xn,formatted:Ja,resolvedImage:el};return p.type==="array"?Br(_[p.value]||dn,p.length):_[p.type]}(e):void 0,void 0,void 0,n,o),u=c.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Lg(new vh(u,e,n,o)):ma(c.errors)}class Nc{constructor(e,n,o){this.kind=e,this._styleExpression=n,this.isLightConstant=o,this.isStateDependent=e!=="constant"&&!Sc(n.expression),this.isConfigDependent=!Cc(n.expression)}evaluateWithoutErrorHandling(e,n,o,c,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,u,p)}evaluate(e,n,o,c,u,p){return this._styleExpression.evaluate(e,n,o,c,u,p)}}class zc{constructor(e,n,o,c,u){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Sc(n.expression),this.isLightConstant=u,this.isConfigDependent=!Cc(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,o,c,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,u,p)}evaluate(e,n,o,c,u,p){return this._styleExpression.evaluate(e,n,o,c,u,p)}interpolationFactor(e,n,o){return this.interpolationType?$i.interpolationFactor(this.interpolationType,e,n,o):0}}function jg(t,e,n,o){if((t=hl(t,e,n,o)).result==="error")return t;let c=t.value.expression,u=Rs(c);if(!u&&!yh(e))return ma([new go("","data expressions not supported")]);let p=Ac(c,["zoom","pitch","distance-from-center"]);if(!p&&!Ng(e))return ma([new go("","zoom expressions not supported")]);let _=Ac(c,["measure-light"]);if(!_&&!Fg(e))return ma([new go("","measure-light expression not supported")]);let x=e.expression&&e.expression.relaxZoomRestriction,w=bh(c);return w||p||x?w instanceof go?ma([w]):w instanceof $i&&!ul(e)?ma([new go("",'"interpolate" expressions cannot be used with this property')]):Lg(w?new zc(u?"camera":"composite",t.value,w.labels,w instanceof $i?w.interpolation:void 0,_):new Nc(u?"constant":"source",t.value,_)):ma([new go("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Bc{constructor(e,n){this._parameters=e,this._specification=n,Ju(this,kc(this._parameters,this._specification))}static deserialize(e){return new Bc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function bh(t){let e=null;if(t instanceof gh)e=bh(t.result);else if(t instanceof mh){for(let n of t.args)if(e=bh(n),e)break}else(t instanceof Pc||t instanceof $i)&&t.input instanceof Si&&t.input.name==="zoom"&&(e=t);return e instanceof go||t.eachChild(n=>{let o=bh(n);o instanceof go?e=o:e&&o&&e!==o&&(e=new go("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Vg=ko,Ls=3;function ko(t,e,n){var o=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var u=0;u<this.d*this.d;u++){var p=c[Ls+u],_=c[Ls+u+1];o.push(p===_?null:c.subarray(p,_))}var x=c[Ls+o.length+1];this.keys=c.subarray(c[Ls+o.length],x),this.bboxes=c.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var w=0;w<this.d*this.d;w++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var E=n/e*t;this.min=-E,this.max=t+E}ko.prototype.insert=function(t,e,n,o,c){this._forEachCell(e,n,o,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c)},ko.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ko.prototype._insertCell=function(t,e,n,o,c,u){this.cells[c].push(u)},ko.prototype.query=function(t,e,n,o,c){var u=this.min,p=this.max;if(t<=u&&e<=u&&p<=n&&p<=o&&!c)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(t,e,n,o,this._queryCell,_,{},c),_},ko.prototype._queryCell=function(t,e,n,o,c,u,p,_){var x=this.cells[c];if(x!==null)for(var w=this.keys,E=this.bboxes,I=0;I<x.length;I++){var S=x[I];if(p[S]===void 0){var A=4*S;(_?_(E[A+0],E[A+1],E[A+2],E[A+3]):t<=E[A+2]&&e<=E[A+3]&&n>=E[A+0]&&o>=E[A+1])?(p[S]=!0,u.push(w[S])):p[S]=!1}}},ko.prototype._forEachCell=function(t,e,n,o,c,u,p,_){for(var x=this._convertToCellCoord(t),w=this._convertToCellCoord(e),E=this._convertToCellCoord(n),I=this._convertToCellCoord(o),S=x;S<=E;S++)for(var A=w;A<=I;A++){var R=this.d*A+S;if((!_||_(this._convertFromCellCoord(S),this._convertFromCellCoord(A),this._convertFromCellCoord(S+1),this._convertFromCellCoord(A+1)))&&c.call(this,t,e,n,o,R,u,p,_))return}},ko.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ko.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ko.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Ls+this.cells.length+1+1,n=0,o=0;o<this.cells.length;o++)n+=this.cells[o].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var u=e,p=0;p<t.length;p++){var _=t[p];c[Ls+p]=u,c.set(_,u),u+=_.length}return c[Ls+t.length]=u,c.set(this.keys,u),c[Ls+t.length+1]=u+=this.keys.length,c.set(this.bboxes,u),u+=this.bboxes.length,c.buffer};var dl=Rt(Vg);let wh={};function lt(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),wh[e]={klass:t,omit:n.omit||[]}}lt(Object,"Object"),dl.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},dl.deserialize=function(t){return new dl(t.buffer)},Object.defineProperty(dl,"name",{value:"Grid"}),lt(dl,"Grid"),lt(Sn,"Color"),lt(Error,"Error"),lt(Zr,"Formatted"),lt(eh,"FormattedSection"),lt(Uu,"AJAXError"),lt(Vi,"ResolvedImage"),lt(Bc,"StylePropertyFunction"),lt(vh,"StyleExpression",{omit:["_evaluator"]}),lt(zc,"ZoomDependentExpression"),lt(Nc,"ZoomConstantExpression"),lt(Si,"CompoundExpression",{omit:["_evaluate"]});for(let t in cl)wh[cl[t]._classRegistryKey]||lt(cl[t],`Expression${t}`);function Ug(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function $g(t){return self.ImageBitmap&&t instanceof ImageBitmap}function jc(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Ug(t)||$g(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let o of t)n.push(jc(o,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[o,c]of t.entries())n[o]=jc(c);return n}if(typeof t=="object"){let n=t.constructor,o=n._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);let c=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let u in t)t.hasOwnProperty(u)&&(wh[o].omit.indexOf(u)>=0||(c[u]=jc(t[u],e)));t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof t)}function h(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Ug(t)||$g(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(h);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let c=new Map;for(let u of Object.keys(t))u!=="$name"&&c.set(u,h(t[u]));return c}let{klass:n}=wh[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let o=Object.create(n.prototype);for(let c of Object.keys(t))c!=="$name"&&(o[c]=h(t[c]));return o}throw new Error("can't deserialize object of type "+typeof t)}let r={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function l(t){for(let e of t)if(v(e.charCodeAt(0)))return!0;return!1}function f(t){for(let e of t)if(!g(e.charCodeAt(0)))return!1;return!0}function g(t){return!(r.Arabic(t)||r["Arabic Supplement"](t)||r["Arabic Extended-A"](t)||r["Arabic Presentation Forms-A"](t)||r["Arabic Presentation Forms-B"](t))}function v(t){return!(t!==746&&t!==747&&(t<4352||!(r["Bopomofo Extended"](t)||r.Bopomofo(t)||r["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||r["CJK Compatibility Ideographs"](t)||r["CJK Compatibility"](t)||r["CJK Radicals Supplement"](t)||r["CJK Strokes"](t)||!(!r["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||r["CJK Unified Ideographs Extension A"](t)||r["CJK Unified Ideographs"](t)||r["Enclosed CJK Letters and Months"](t)||r["Hangul Compatibility Jamo"](t)||r["Hangul Jamo Extended-A"](t)||r["Hangul Jamo Extended-B"](t)||r["Hangul Jamo"](t)||r["Hangul Syllables"](t)||r.Hiragana(t)||r["Ideographic Description Characters"](t)||r.Kanbun(t)||r["Kangxi Radicals"](t)||r["Katakana Phonetic Extensions"](t)||r.Katakana(t)&&t!==12540||!(!r["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!r["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||r["Unified Canadian Aboriginal Syllabics"](t)||r["Unified Canadian Aboriginal Syllabics Extended"](t)||r["Vertical Forms"](t)||r["Yijing Hexagram Symbols"](t)||r["Yi Syllables"](t)||r["Yi Radicals"](t))))}function b(t){return!(v(t)||function(e){return!!(r["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||r["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||r["Letterlike Symbols"](e)||r["Number Forms"](e)||r["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||r["Control Pictures"](e)&&e!==9251||r["Optical Character Recognition"](e)||r["Enclosed Alphanumerics"](e)||r["Geometric Shapes"](e)||r["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||r["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||r["CJK Symbols and Punctuation"](e)||r.Katakana(e)||r["Private Use Area"](e)||r["CJK Compatibility Forms"](e)||r["Small Form Variants"](e)||r["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function T(t){return t>=1424&&t<=2303||r["Arabic Presentation Forms-A"](t)||r["Arabic Presentation Forms-B"](t)}function D(t,e){return!(!e&&T(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||r.Khmer(t))}function C(t){for(let e of t)if(T(e.charCodeAt(0)))return!0;return!1}let P="deferred",O="loading",F="loaded",N=null,U="unavailable",V=null,$=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(U="error"),N&&N(t)};function G(){Z.fire(new Ms("pluginStateChange",{pluginStatus:U,pluginURL:V}))}let Z=new oa,te=function(){return U},ee=function(){if(U!==P||!V)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");U=O,G(),V&&cc({url:V},t=>{t?$(t):(U=F,G())})},re={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>U===F||re.applyArabicShaping!=null,isLoading:()=>U===O,setState(t){U=t.pluginStatus,V=t.pluginURL},isParsed:()=>re.applyArabicShaping!=null&&re.processBidirectionalText!=null&&re.processStyledBidirectionalText!=null,getPluginURL:()=>V};class H{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,o){for(let c of n)if(!D(c.charCodeAt(0),o))return!1;return!0}(e,re.isLoaded())}}class Y{constructor(e,n,o,c){this.property=e,this.value=n,this.expression=function(u,p,_,x){if(jf(u))return new Bc(u,p);if(xh(u)||Array.isArray(u)&&u.length>0){let w=jg(u,p,_,x);if(w.result==="error")throw new Error(w.value.map(E=>`${E.key}: ${E.message}`).join(", "));return w.value}{let w=u;return typeof u=="string"&&p.type==="color"&&(w=Sn.parse(u)),{kind:"constant",isConfigDependent:!1,evaluate:()=>w}}}(n===void 0?e.specification.default:n,e.specification,o,c)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class ce{constructor(e,n,o){this.property=e,this.value=new Y(e,void 0,n,o)}transitioned(e,n){return new fe(this.property,this.value,n,Xi({},e.transition,this.transition),e.now)}untransitioned(){return new fe(this.property,this.value,null,{},0)}}class ae{constructor(e,n,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=o,this.isConfigDependent=!1}getValue(e){return Xo(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new ce(this._values[e].property,this._scope,this._options)),this._values[e].value=new Y(this._values[e].property,n===null?void 0:Xo(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let o=this._properties.properties;if(e)for(let c in e){let u=e[c];if(ta(c,"-transition")){let p=c.slice(0,-11);o[p]&&this.setTransition(p,u)}else o[c]&&this.setValue(c,u)}}getTransition(e){return Xo(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new ce(this._values[e].property)),this._values[e].transition=Xo(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let o=this.getValue(n);o!==void 0&&(e[n]=o);let c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){let o=new we(this._properties);for(let c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,n._values[c]);return o}untransitioned(){let e=new we(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class fe{constructor(e,n,o,c,u){let p=c.delay||0,_=c.duration||0;u=u||0,this.property=e,this.value=n,this.begin=u+p,this.end=this.begin+_,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){let c=e.now||0,u=this.value.possiblyEvaluate(e,n,o),p=this.prior;if(p){if(c>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(c<this.begin)return p.possiblyEvaluate(e,n,o);{let _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,o),u,Au(_))}}return u}}class we{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){let c=new Ee(this._properties);for(let u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(e,n,o);return c}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class de{constructor(e,n,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=o,this.isConfigDependent=!1}getValue(e){return Xo(this._values[e].value)}setValue(e,n){this._values[e]=new Y(this._values[e].property,n===null?void 0:Xo(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){let c=new Ee(this._properties);for(let u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(e,n,o);return c}}class xe{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,c){return this.property.evaluate(this.value,this.parameters,e,n,o,c)}}class Ee{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class he{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,o){let c=_c[this.specification.type];return c?c(e,n,o):e}}class ye{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,c){return new xe(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,c)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new xe(this,{kind:"constant",value:void 0},e.parameters);let c=_c[this.specification.type];return c?new xe(this,{kind:"constant",value:c(e.value.value,n.value.value,o)},e.parameters):e}evaluate(e,n,o,c,u,p){return e.kind==="constant"?e.value:e.evaluate(n,o,c,u,p)}}class ze{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){return!!e.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class me{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new H(0,{});for(let o in e){let c=e[o];c.specification.overridable&&this.overridableProperties.push(o);let u=this.defaultPropertyValues[o]=new Y(c,void 0),p=this.defaultTransitionablePropertyValues[o]=new ce(c);this.defaultTransitioningPropertyValues[o]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=u.possiblyEvaluate(n)}}}function be(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Te(t){if(Array.isArray(t))return t.map(Te);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=Te(t[n]);return e}return be(t)}lt(ye,"DataDrivenProperty"),lt(he,"DataConstantProperty"),lt(ze,"ColorRampProperty");var ne=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ae(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Ae(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function rt(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ae(t)||(t=cn(t));let n=t,o=!0;try{o=function(w){if(!pt(w))return w;let E=Te(w);return yt(E),E=ut(E),E}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let c=ne[`filter_${e}`],u=hl(o,c),p=null;if(u.result==="error")throw new Error(u.value.map(w=>`${w.key}: ${w.message}`).join(", "));p=(w,E,I)=>u.value.evaluate(w,E,{},I);let _=null,x=null;if(o!==n){let w=hl(n,c);if(w.result==="error")throw new Error(w.value.map(E=>`${E.key}: ${E.message}`).join(", "));_=(E,I,S,A,R)=>w.value.evaluate(E,I,{},S,void 0,void 0,A,R),x=!Rs(w.value.expression)}return{filter:p,dynamicFilter:_||void 0,needGeometry:Lt(o),needFeature:!!x}}function ut(t){if(!Array.isArray(t))return t;let e=function(n){if(wt.has(n[0])){for(let o=1;o<n.length;o++)if(pt(n[o]))return!0}return n}(t);return e===!0?e:e.map(n=>ut(n))}function yt(t){let e=!1,n=[];if(t[0]==="case"){for(let o=1;o<t.length-1;o+=2)e=e||pt(t[o]),n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||pt(t[1]);for(let o=2;o<t.length-1;o+=2)n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||pt(t[1]);for(let o=1;o<t.length-1;o+=2)n.push(t[o+1])}e&&(t.length=0,t.push("any",...n));for(let o=1;o<t.length;o++)yt(t[o])}function pt(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(pt(t[n]))return!0;return!1}let wt=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function nn(t,e){return t<e?-1:t>e?1:0}function Lt(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Lt(t[e]))return!0;return!1}function cn(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?rn(t[1],t[2],"=="):e==="!="?Sr(rn(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?rn(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(cn))):e==="all"?["all"].concat(t.slice(1).map(cn)):e==="none"?["all"].concat(t.slice(1).map(cn).map(Sr)):e==="in"?er(t[1],t.slice(2)):e==="!in"?Sr(er(t[1],t.slice(2))):e==="has"?Cn(t[1]):e!=="!has"||Sr(Cn(t[1]));var n}function rn(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function er(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(nn)]]:["filter-in-small",t,["literal",e]]}}function Cn(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Sr(t){return["!",t]}let xr="";function Un(t,e){return e?`${t}${xr}${e}`:t}let Pn="-transition",Gt=new Set(["fill","line","background","hillshade","raster"]);class qt extends oa{constructor(e,n,o,c){if(super(),this.id=e.id,this.fqid=Un(this.id,o),this.type=e.type,this.scope=o,this.options=c,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new de(n.layout,this.scope,c),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new ae(n.paint,this.scope,c);for(let u in e.paint)this.setPaintProperty(u,e.paint[u]);for(let u in e.layout)this.setLayoutProperty(u,e.layout[u]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ee(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return Gt.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,n),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return ta(e,Pn)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let o=this._transitionablePaint,c=o._properties.properties;if(ta(e,Pn)){let I=e.slice(0,-11);return c[I]&&o.setTransition(I,n||void 0),!1}if(!c[e])return!1;let u=o._values[e],p=u.value.isDataDriven(),_=u.value;o.setValue(e,n),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let x=o._values[e].value,w=x.isDataDriven(),E=ta(e,"pattern")||e==="line-dasharray";return w||p||E||this._handleOverridablePaintPropertyUpdate(e,_,x)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n){return null}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return rc({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof xe&&yh(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=rt(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,o,c,u,p,_,x,w){}queryIntersectsMatchingFeature(e,n,o,c){}}let Zn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $n{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Kt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Bt(t,e=1){let n=0,o=0;return{members:t.map(c=>{let u=Zn[c.type].BYTES_PER_ELEMENT,p=n=vi(n,Math.max(e,u)),_=c.components||1;return o=Math.max(o,u),n+=u*_,{name:c.name,type:c.type,components:_,offset:p}}),size:vi(n,Math.max(o,e)),alignment:e}}function vi(t,e){return Math.ceil(t/e)*e}class Yr extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let c=2*e;return this.int16[c+0]=n,this.int16[c+1]=o,e}}Yr.prototype.bytesPerElement=4,lt(Yr,"StructArrayLayout2i4");class Or extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){let u=3*e;return this.int16[u+0]=n,this.int16[u+1]=o,this.int16[u+2]=c,e}}Or.prototype.bytesPerElement=6,lt(Or,"StructArrayLayout3i6");class Xr extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,c)}emplace(e,n,o,c,u){let p=4*e;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=c,this.int16[p+3]=u,e}}Xr.prototype.bytesPerElement=8,lt(Xr,"StructArrayLayout4i8");class xi extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,c,u)}emplace(e,n,o,c,u,p){let _=5*e;return this.int16[_+0]=n,this.int16[_+1]=o,this.int16[_+2]=c,this.int16[_+3]=u,this.int16[_+4]=p,e}}xi.prototype.bytesPerElement=10,lt(xi,"StructArrayLayout5i10");class oi extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,p,_){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,c,u,p,_)}emplace(e,n,o,c,u,p,_,x){let w=6*e,E=12*e,I=3*e;return this.int16[w+0]=n,this.int16[w+1]=o,this.uint8[E+4]=c,this.uint8[E+5]=u,this.uint8[E+6]=p,this.uint8[E+7]=_,this.float32[I+2]=x,e}}oi.prototype.bytesPerElement=12,lt(oi,"StructArrayLayout2i4ub1f12");class Lr extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,c)}emplace(e,n,o,c,u){let p=4*e;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=c,this.float32[p+3]=u,e}}Lr.prototype.bytesPerElement=16,lt(Lr,"StructArrayLayout4f16");class Ur extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let c=2*e;return this.float32[c+0]=n,this.float32[c+1]=o,e}}Ur.prototype.bytesPerElement=8,lt(Ur,"StructArrayLayout2f8");class $r extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,c,u)}emplace(e,n,o,c,u,p){let _=6*e,x=3*e;return this.uint16[_+0]=n,this.uint16[_+1]=o,this.uint16[_+2]=c,this.uint16[_+3]=u,this.float32[x+2]=p,e}}$r.prototype.bytesPerElement=12,lt($r,"StructArrayLayout4ui1f12");class Fo extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,c)}emplace(e,n,o,c,u){let p=4*e;return this.uint16[p+0]=n,this.uint16[p+1]=o,this.uint16[p+2]=c,this.uint16[p+3]=u,e}}Fo.prototype.bytesPerElement=8,lt(Fo,"StructArrayLayout4ui8");class vo extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,p){let _=this.length;return this.resize(_+1),this.emplace(_,e,n,o,c,u,p)}emplace(e,n,o,c,u,p,_){let x=6*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.int16[x+3]=u,this.int16[x+4]=p,this.int16[x+5]=_,e}}vo.prototype.bytesPerElement=12,lt(vo,"StructArrayLayout6i12");class No extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,p,_,x,w,E,I,S){let A=this.length;return this.resize(A+1),this.emplace(A,e,n,o,c,u,p,_,x,w,E,I,S)}emplace(e,n,o,c,u,p,_,x,w,E,I,S,A){let R=12*e;return this.int16[R+0]=n,this.int16[R+1]=o,this.int16[R+2]=c,this.int16[R+3]=u,this.uint16[R+4]=p,this.uint16[R+5]=_,this.uint16[R+6]=x,this.uint16[R+7]=w,this.int16[R+8]=E,this.int16[R+9]=I,this.int16[R+10]=S,this.int16[R+11]=A,e}}No.prototype.bytesPerElement=24,lt(No,"StructArrayLayout4i4ui4i24");class zo extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,p){let _=this.length;return this.resize(_+1),this.emplace(_,e,n,o,c,u,p)}emplace(e,n,o,c,u,p,_){let x=10*e,w=5*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.float32[w+2]=u,this.float32[w+3]=p,this.float32[w+4]=_,e}}zo.prototype.bytesPerElement=20,lt(zo,"StructArrayLayout3i3f20");class ks extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}ks.prototype.bytesPerElement=4,lt(ks,"StructArrayLayout1ul4");class Ji extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=o,e}}Ji.prototype.bytesPerElement=4,lt(Ji,"StructArrayLayout2ui4");class Vc extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,p,_,x,w,E,I,S,A){let R=this.length;return this.resize(R+1),this.emplace(R,e,n,o,c,u,p,_,x,w,E,I,S,A)}emplace(e,n,o,c,u,p,_,x,w,E,I,S,A,R){let k=20*e,z=10*e;return this.int16[k+0]=n,this.int16[k+1]=o,this.int16[k+2]=c,this.int16[k+3]=u,this.int16[k+4]=p,this.float32[z+3]=_,this.float32[z+4]=x,this.float32[z+5]=w,this.float32[z+6]=E,this.int16[k+14]=I,this.uint32[z+8]=S,this.uint16[k+18]=A,this.uint16[k+19]=R,e}}Vc.prototype.bytesPerElement=40,lt(Vc,"StructArrayLayout5i4f1i1ul2ui40");class fl extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,p,_){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,c,u,p,_)}emplace(e,n,o,c,u,p,_,x){let w=8*e;return this.int16[w+0]=n,this.int16[w+1]=o,this.int16[w+2]=c,this.int16[w+4]=u,this.int16[w+5]=p,this.int16[w+6]=_,this.int16[w+7]=x,e}}fl.prototype.bytesPerElement=16,lt(fl,"StructArrayLayout3i2i2i16");class Uc extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,c,u)}emplace(e,n,o,c,u,p){let _=4*e,x=8*e;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=c,this.int16[x+6]=u,this.int16[x+7]=p,e}}Uc.prototype.bytesPerElement=16,lt(Uc,"StructArrayLayout2f1f2i16");class rs extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,c)}emplace(e,n,o,c,u){let p=12*e,_=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=o,this.float32[_+1]=c,this.float32[_+2]=u,e}}rs.prototype.bytesPerElement=12,lt(rs,"StructArrayLayout2ub2f12");class kr extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){let u=3*e;return this.uint16[u+0]=n,this.uint16[u+1]=o,this.uint16[u+2]=c,e}}kr.prototype.bytesPerElement=6,lt(kr,"StructArrayLayout3ui6");class $c extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,p,_,x,w,E,I,S,A,R,k,z,j,W,X,Q,oe){let J=this.length;return this.resize(J+1),this.emplace(J,e,n,o,c,u,p,_,x,w,E,I,S,A,R,k,z,j,W,X,Q,oe)}emplace(e,n,o,c,u,p,_,x,w,E,I,S,A,R,k,z,j,W,X,Q,oe,J){let le=30*e,ue=15*e,_e=60*e;return this.int16[le+0]=n,this.int16[le+1]=o,this.int16[le+2]=c,this.float32[ue+2]=u,this.float32[ue+3]=p,this.uint16[le+8]=_,this.uint16[le+9]=x,this.uint32[ue+5]=w,this.uint32[ue+6]=E,this.uint32[ue+7]=I,this.uint16[le+16]=S,this.uint16[le+17]=A,this.uint16[le+18]=R,this.float32[ue+10]=k,this.float32[ue+11]=z,this.uint8[_e+48]=j,this.uint8[_e+49]=W,this.uint8[_e+50]=X,this.uint32[ue+13]=Q,this.int16[le+28]=oe,this.uint8[_e+58]=J,e}}$c.prototype.bytesPerElement=60,lt($c,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Tv extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,p,_,x,w,E,I,S,A,R,k,z,j,W,X,Q,oe,J,le,ue,_e,Ie,ve,Se,Me,De,Fe,Le){let Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,e,n,o,c,u,p,_,x,w,E,I,S,A,R,k,z,j,W,X,Q,oe,J,le,ue,_e,Ie,ve,Se,Me,De,Fe,Le)}emplace(e,n,o,c,u,p,_,x,w,E,I,S,A,R,k,z,j,W,X,Q,oe,J,le,ue,_e,Ie,ve,Se,Me,De,Fe,Le,Ve){let Be=20*e,Ce=40*e,ht=80*e;return this.float32[Be+0]=n,this.float32[Be+1]=o,this.int16[Ce+4]=c,this.int16[Ce+5]=u,this.int16[Ce+6]=p,this.int16[Ce+7]=_,this.int16[Ce+8]=x,this.int16[Ce+9]=w,this.int16[Ce+10]=E,this.int16[Ce+11]=I,this.int16[Ce+12]=S,this.uint16[Ce+13]=A,this.uint16[Ce+14]=R,this.uint16[Ce+15]=k,this.uint16[Ce+16]=z,this.uint16[Ce+17]=j,this.uint16[Ce+18]=W,this.uint16[Ce+19]=X,this.uint16[Ce+20]=Q,this.uint16[Ce+21]=oe,this.uint16[Ce+22]=J,this.uint16[Ce+23]=le,this.uint16[Ce+24]=ue,this.uint16[Ce+25]=_e,this.uint16[Ce+26]=Ie,this.uint16[Ce+27]=ve,this.uint32[Be+14]=Se,this.float32[Be+15]=Me,this.float32[Be+16]=De,this.float32[Be+17]=Fe,this.float32[Be+18]=Le,this.uint8[ht+76]=Ve,e}}Tv.prototype.bytesPerElement=80,lt(Tv,"StructArrayLayout2f9i15ui1ul4f1ub80");class Uf extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Uf.prototype.bytesPerElement=4,lt(Uf,"StructArrayLayout1f4");class Gc extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,c,u)}emplace(e,n,o,c,u,p){let _=5*e;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=c,this.float32[_+3]=u,this.float32[_+4]=p,e}}Gc.prototype.bytesPerElement=20,lt(Gc,"StructArrayLayout5f20");class Ev extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,p,_){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,c,u,p,_)}emplace(e,n,o,c,u,p,_,x){let w=7*e;return this.float32[w+0]=n,this.float32[w+1]=o,this.float32[w+2]=c,this.float32[w+3]=u,this.float32[w+4]=p,this.float32[w+5]=_,this.float32[w+6]=x,e}}Ev.prototype.bytesPerElement=28,lt(Ev,"StructArrayLayout7f28");class Iv extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,c)}emplace(e,n,o,c,u){let p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=o,this.uint16[p+3]=c,this.uint16[p+4]=u,e}}Iv.prototype.bytesPerElement=12,lt(Iv,"StructArrayLayout1ul3ui12");class Dv extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Dv.prototype.bytesPerElement=2,lt(Dv,"StructArrayLayout1ui2");class Hc extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){let u=3*e;return this.float32[u+0]=n,this.float32[u+1]=o,this.float32[u+2]=c,e}}Hc.prototype.bytesPerElement=12,lt(Hc,"StructArrayLayout3f12");class Mv extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,p,_,x,w,E,I,S,A,R,k,z){let j=this.length;return this.resize(j+1),this.emplace(j,e,n,o,c,u,p,_,x,w,E,I,S,A,R,k,z)}emplace(e,n,o,c,u,p,_,x,w,E,I,S,A,R,k,z,j){let W=16*e;return this.float32[W+0]=n,this.float32[W+1]=o,this.float32[W+2]=c,this.float32[W+3]=u,this.float32[W+4]=p,this.float32[W+5]=_,this.float32[W+6]=x,this.float32[W+7]=w,this.float32[W+8]=E,this.float32[W+9]=I,this.float32[W+10]=S,this.float32[W+11]=A,this.float32[W+12]=R,this.float32[W+13]=k,this.float32[W+14]=z,this.float32[W+15]=j,e}}Mv.prototype.bytesPerElement=64,lt(Mv,"StructArrayLayout16f64");class Gg extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,p,_){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,c,u,p,_)}emplace(e,n,o,c,u,p,_,x){let w=10*e,E=5*e;return this.uint16[w+0]=n,this.uint16[w+1]=o,this.uint16[w+2]=c,this.uint16[w+3]=u,this.float32[E+2]=p,this.float32[E+3]=_,this.float32[E+4]=x,e}}Gg.prototype.bytesPerElement=20,lt(Gg,"StructArrayLayout4ui3f20");class Sv extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}Sv.prototype.bytesPerElement=2,lt(Sv,"StructArrayLayout1i2");class Cv extends Kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Cv.prototype.bytesPerElement=1,lt(Cv,"StructArrayLayout1ub1");class FT extends $n{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}FT.prototype.size=40;class NT extends Vc{get(e){return new FT(this,e)}}lt(NT,"CollisionBoxArray");class zT extends $n{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}zT.prototype.size=60;class BT extends $c{get(e){return new zT(this,e)}}lt(BT,"PlacedSymbolArray");class jT extends $n{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}jT.prototype.size=80;class VT extends Tv{get(e){return new jT(this,e)}}lt(VT,"SymbolInstanceArray");class UT extends Uf{getoffsetX(e){return this.float32[1*e+0]}}lt(UT,"GlyphOffsetArray");class $T extends Yr{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}lt($T,"SymbolLineVertexArray");class GT extends $n{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}GT.prototype.size=12;class HT extends Iv{get(e){return new GT(this,e)}}lt(HT,"FeatureIndexArray");class qT extends Ji{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}lt(qT,"FillExtrusionCentroidArray");let XP=Bt([{name:"a_pos",components:2,type:"Int16"}],4),KP=Bt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class br{constructor(e=[]){this.segments=e}_prepareSegment(e,n,o,c){let u=this.segments[this.segments.length-1];return e>br.MAX_VERTEX_ARRAY_LENGTH&&dr(`Max vertices per segment is ${br.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>br.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==c)&&(u={vertexOffset:n,primitiveOffset:o,vertexLength:0,primitiveLength:0},c!==void 0&&(u.sortKey=c),this.segments.push(u)),u}prepareSegment(e,n,o,c){return this._prepareSegment(e,n.length,o.length,c)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,c){return new br([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function WT(t,e){return 256*(t=tn(Math.floor(t),0,255))+tn(Math.floor(e),0,255)}br.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,lt(br,"SegmentVector");let JP=Bt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),eR=Bt([{name:"a_dash",components:4,type:"Uint16"}]);class $f{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,o,c){this.ids.push(ZT(e)),this.positions.push(n,o,c)}eachPosition(e,n){let o=ZT(e),c=0,u=this.ids.length-1;for(;c<u;){let p=c+u>>1;this.ids[p]>=o?u=p:c=p+1}for(;this.ids[c]===o;)n(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,n){let o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Av(o,c,0,o.length-1),n&&(n.add(o.buffer),n.add(c.buffer)),{ids:o,positions:c}}static deserialize(e){let n=new $f,o;n.ids=e.ids,n.positions=e.positions;for(let c of n.ids)c!==o&&n.uniqueIds.push(c),o=c;return n.indexed=!0,n}}function ZT(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:fc(String(t))}function Av(t,e,n,o){for(;n<o;){let c=t[n+o>>1],u=n-1,p=o+1;for(;;){do u++;while(t[u]<c);do p--;while(t[p]>c);if(u>=p)break;Hg(t,u,p),Hg(e,3*u,3*p),Hg(e,3*u+1,3*p+1),Hg(e,3*u+2,3*p+2)}p-n<o-p?(Av(t,e,n,p),n=p+1):(Av(t,e,p+1,o),o=p)}}function Hg(t,e,n){let o=t[e];t[e]=t[n],t[n]=o}lt($f,"FeaturePositionMap");class ga{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class qg extends ga{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class Ci extends ga{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class pl extends ga{constructor(e){super(e),this.current=[0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class Pv extends ga{constructor(e){super(e),this.current=[0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class QT extends ga{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class YT extends ga{constructor(e){super(e),this.current=Sn.transparent}set(e,n,o){this.fetchUniformLocation(e,n)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}let tR=new Float32Array(16);class Gf extends ga{constructor(e){super(e),this.current=tR}set(e,n,o){if(this.fetchUniformLocation(e,n)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let c=1;c<16;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}let nR=new Float32Array(9),rR=new Float32Array(4);class Rv extends ga{constructor(e){super(e),this.current=rR}set(e,n,o){if(this.fetchUniformLocation(e,n)){for(let c=0;c<4;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function Ov(t){return[WT(255*t.r,255*t.g),WT(255*t.b,255*t.a)]}class Hf{constructor(e,n,o){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(e,n,o,c,u){n.set(e,u,c.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new YT(e):new Ci(e)}}class Th{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,o,c,u){let p=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;p&&n.set(e,u,p)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new QT(e):new Ci(e)}}class _a{constructor(e,n,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(u=>({name:`a_${u}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,o,c,u,p,_){let x=this.paintVertexArray.length,w=this.expression.evaluate(new H(0,{brightness:p}),n,{},u,c,_);this.paintVertexArray.resize(e),this._setPaintValue(x,e,w)}updatePaintArray(e,n,o,c,u,p,_){let x=this.expression.evaluate({zoom:0,brightness:_},o,c,void 0,u);this._setPaintValue(e,n,x)}_setPaintValue(e,n,o){if(this.type==="color"){let c=Ov(o);for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class is{constructor(e,n,o,c,u,p){this.expression=e,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,o,c,u,p,_){let x=this.expression.evaluate(new H(this.zoom,{brightness:p}),n,{},u,c,_),w=this.expression.evaluate(new H(this.zoom+1,{brightness:p}),n,{},u,c,_),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,x,w)}updatePaintArray(e,n,o,c,u,p,_){let x=this.expression.evaluate({zoom:this.zoom,brightness:_},o,c,void 0,u),w=this.expression.evaluate({zoom:this.zoom+1,brightness:_},o,c,void 0,u);this._setPaintValue(e,n,x,w)}_setPaintValue(e,n,o,c){if(this.type==="color"){let u=Ov(o),p=Ov(c);for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,u[0],u[1],p[0],p[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,o,c,u){let p=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,_=tn(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);n.set(e,u,_)}getBinding(e,n){return new Ci(e)}}class ml{constructor(e,n,o,c,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(o==="array"?eR:JP).members;for(let p=0;p<n.length;++p);this.paintVertexArray=new c}populatePaintArray(e,n,o){let c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,c,u,p,_){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],p)}_setPaintValues(e,n,o,c){if(!c||!o)return;let u=c[o];if(!u)return;let{tl:p,br:_,pixelRatio:x}=u;for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,p[0],p[1],_[0],_[1],x)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qc{constructor(e,n,o=()=>!0){this.binders={},this._buffers=[];let c=[];for(let u in e.paint._values){let p=e.paint.get(u);if(!o(u)||!(p instanceof xe&&yh(p.property.specification)))continue;let _=oR(u,e.type),x=p.value,w=p.property.specification.type,E=!!p.property.useIntegerZoom,I=u==="line-dasharray"||u.endsWith("pattern"),S=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||S)if(x.kind==="source"||S||I){let A=XT(u,w,"source");this.binders[u]=I?new ml(x,_,w,A,e.id):new _a(x,_,w,A),c.push(`/a_${u}`)}else{let A=XT(u,w,"composite");this.binders[u]=new is(x,_,w,E,n,A),c.push(`/z_${u}`)}else this.binders[u]=I?new Th(x.value,_):new Hf(x.value,_,w),c.push(`/u_${u}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof _a||n instanceof is?n.maxValue:0}populatePaintArrays(e,n,o,c,u,p,_){for(let x in this.binders){let w=this.binders[x];(w instanceof _a||w instanceof is||w instanceof ml)&&w.populatePaintArray(e,n,o,c,u,p,_)}}setConstantPatternPositions(e){for(let n in this.binders){let o=this.binders[n];o instanceof Th&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,n,o,c,u,p,_,x){let w=!1,E=Object.keys(e),I=E.length!==0,S=I?E:n.uniqueIds;for(let A in this.binders){let R=this.binders[A];if((R instanceof _a||R instanceof is||R instanceof ml)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){let k=u.paint.get(A);R.expression=k.value;for(let z of S){let j=e[z.toString()];n.eachPosition(z,(W,X,Q)=>{let oe=c.feature(W);R.updatePaintArray(X,Q,oe,j,p,_,x)})}if(!I)for(let z of o.uniqueIds){let j=e[z.toString()];o.eachPosition(z,(W,X,Q)=>{let oe=c.feature(W);R.updatePaintArray(X,Q,oe,j,p,_,x)})}w=!0}}return w}defines(){let e=[];for(let n in this.binders){let o=this.binders[n];(o instanceof Hf||o instanceof Th)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let o=this.binders[n];if(o instanceof _a||o instanceof is||o instanceof ml)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let o=this.binders[n];if(o instanceof Hf||o instanceof Th||o instanceof is)for(let c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let o in this.binders){let c=this.binders[o];if(c instanceof Hf||c instanceof Th||c instanceof is)for(let u of c.uniformNames)n.push({name:u,property:o,binding:c.getBinding(e,u)})}return n}setUniforms(e,n,o,c,u){for(let{name:p,property:_,binding:x}of o)this.binders[_].setUniform(e,x,u,c.get(_),p)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof _a||n instanceof is||n instanceof ml)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let o=this.binders[n];(o instanceof _a||o instanceof is||o instanceof ml)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof _a||n instanceof is||n instanceof ml)&&n.destroy()}}}class gl{constructor(e,n,o=()=>!0){this.programConfigurations={};for(let c of e)this.programConfigurations[c.id]=new qc(c,n,o);this.needsUpload=!1,this._featureMap=new $f,this._featureMapWithoutIds=new $f,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,o,c,u,p,_,x){for(let w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,n,c,u,p,_,x);n.id!==void 0?this._featureMap.add(n.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,c,u,p){for(let _ of o)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,_,c,u,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let iR={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function oR(t,e){return iR[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let sR={"line-pattern":{source:$r,composite:$r},"fill-pattern":{source:$r,composite:$r},"fill-extrusion-pattern":{source:$r,composite:$r},"line-dasharray":{source:Fo,composite:Fo}},aR={color:{source:Ur,composite:Lr},number:{source:Uf,composite:Ur}};function XT(t,e,n){let o=sR[t];return o&&o[n]||aR[e][n]}lt(Hf,"ConstantBinder"),lt(Th,"PatternConstantBinder"),lt(_a,"SourceExpressionBinder"),lt(ml,"PatternCompositeBinder"),lt(is,"CompositeExpressionBinder"),lt(qc,"ProgramConfiguration",{omit:["_buffers"]}),lt(gl,"ProgramConfigurationSet");let Ai=et/Math.PI/2,Lv=5,KT=6,lR=16383,Eh=64,kv=[Eh,32,16],Bo=-Ai,jo=Ai;function Ih(t,e,n,o=Ai){return n=hn(n),[t*Math.sin(n)*o,-e*o,t*Math.cos(n)*o]}function Wc(t,e,n){return Ih(Math.cos(hn(t)),Math.sin(hn(t)),e,n)}let Dh=63710088e-1,Fv=2*Math.PI*Dh;class mn{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mn(Yo(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,o=this.lat*n,c=e.lat*n,u=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Dh*Math.acos(Math.min(u,1))}toBounds(e=0){let n=360*e/40075017,o=n/Math.cos(Math.PI/180*this.lat);return new _l({lng:this.lng-o,lat:this.lat-n},{lng:this.lng+o,lat:this.lat+n})}toEcef(e){return Wc(this.lat,this.lng,Ai+e*Ai/Dh)}static convert(e){if(e instanceof mn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new mn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new mn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class _l{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{let o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof mn?new mn(e.lng,e.lat):mn.convert(e),this}setSouthWest(e){return this._sw=e instanceof mn?new mn(e.lng,e.lat):mn.convert(e),this}extend(e){let n=this._sw,o=this._ne,c,u;if(e instanceof mn)c=e,u=e;else{if(!(e instanceof _l))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(_l.convert(e)):this.extend(mn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(mn.convert(e)):this;if(c=e._sw,u=e._ne,!c||!u)return this}return n||o?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),o.lng=Math.max(u.lng,o.lng),o.lat=Math.max(u.lat,o.lat)):(this._sw=new mn(c.lng,c.lat),this._ne=new mn(u.lng,u.lat)),this}getCenter(){return new mn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new mn(this.getWest(),this.getNorth())}getSouthEast(){return new mn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:o}=mn.convert(e),c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(e){return!e||e instanceof _l?e:new _l(e)}}var JT={};(function(t,e){(function(n){function o(u,p,_){var x=c(256*u,256*(p=Math.pow(2,_)-p-1),_),w=c(256*(u+1),256*(p+1),_);return x[0]+","+x[1]+","+w[0]+","+w[1]}function c(u,p,_){var x=2*Math.PI*6378137/256/Math.pow(2,_);return[u*x-2*Math.PI*6378137/2,p*x-2*Math.PI*6378137/2]}n.getURL=function(u,p,_,x,w,E){return E=E||{},u+"?"+["bbox="+o(_,x,w),"format="+(E.format||"image/png"),"service="+(E.service||"WMS"),"version="+(E.version||"1.1.1"),"request="+(E.request||"GetMap"),"srs="+(E.srs||"EPSG:3857"),"width="+(E.width||256),"height="+(E.height||256),"layers="+p].join("&")},n.getTileBBox=o,n.getMercCoords=c,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,JT);var cR=JT;class Zc{constructor(e,n,o){this.z=e,this.x=n,this.y=o,this.key=qf(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let o=cR.getTileBBox(this.x,this.y,this.z),c=function(u,p,_){let x,w="";for(let E=u;E>0;E--)x=1<<E-1,w+=(p&x?1:0)+(_&x?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class eE{constructor(e,n){this.wrap=e,this.canonical=n,this.key=qf(e,n.z,n.z,n.x,n.y)}}class si{constructor(e,n,o,c,u){this.overscaledZ=e,this.wrap=n,this.canonical=new Zc(o,+c,+u),this.key=n===0&&e===o?this.canonical.key:qf(n,e,o,c,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new si(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new si(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return qf(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let o=this.canonical.z-e;return qf(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new si(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new si(n,this.wrap,n,o,c),new si(n,this.wrap,n,o+1,c),new si(n,this.wrap,n,o,c+1),new si(n,this.wrap,n,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new si(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new si(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new eE(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function qf(t,e,n,o,c){let u=1<<Math.min(n,22),p=u*(c%u)+o%u;return t&&n<22&&(p+=u*u*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}let uR=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new si(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new si(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new si(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new si(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];lt(Zc,"CanonicalTileID"),lt(si,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let hR=0,dR=25.5;function Nv(t){return Fv*Math.cos(t*Math.PI/180)}function yl(t){return(180+t)/360}function ya(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Pi(t,e){return t/Nv(e)}function eo(t){return 360*t-180}function Kr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function tE(t,e){return t*Nv(Kr(e))}let wr=85.051129;function nE(t){return Math.cos(hn(tn(t,-wr,wr)))}function Qc(t,e){let n=tn(e,hR,dR),o=Math.pow(2,n);return nE(t)*Fv/(512*o)}function rE(t){return 1/Math.cos(t*Math.PI/180)}function Wg(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/et)/(1<<t.z)*2));return 80150034*n/(n*n+1)/et/(1<<t.z)}class ai{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){let o=mn.convert(e);return new ai(yl(o.lng),ya(o.lat),Pi(n,o.lat))}toLngLat(){return new mn(eo(this.x),Kr(this.y))}toAltitude(){return tE(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Fv*rE(Kr(this.y))}}function zv(t,e,n,o,c,u,p,_,x){let w=(e+o)/2,E=(n+c)/2,I=new Je(w,E);_(I),function(S,A,R,k,z,j){let W=R-z,X=k-j;return Math.abs((k-A)*W-(R-S)*X)/Math.hypot(W,X)}(I.x,I.y,u.x,u.y,p.x,p.y)>=x?(zv(t,e,n,w,E,u,I,_,x),zv(t,w,E,o,c,I,p,_,x)):t.push(p)}function iE(t,e,n){let o=t[0],c=o.x,u=o.y;e(o);let p=[o];for(let _=1;_<t.length;_++){let x=t[_],{x:w,y:E}=x;e(x),zv(p,c,u,w,E,o,x,e,n),c=w,u=E,o=x}return p}function Bv(t,e,n,o){if(o(e,n)){let c=e.add(n)._mult(.5);Bv(t,e,c,o),Bv(t,c,n,o)}else t.push(n)}function fR(t,e){let n=t[0],o=[n];for(let c=1;c<t.length;c++){let u=t[c];Bv(o,n,u,e),n=u}return o}let jv=Math.pow(2,14)-1,oE=-jv-1;function pR(t,e){let n=Math.round(t.x*e),o=Math.round(t.y*e);return t.x=tn(n,oE,jv),t.y=tn(o,oE,jv),(n<t.x||n>t.x+1||o<t.y||o>t.y+1)&&dr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function va(t,e,n){let o=t.loadGeometry(),c=t.extent,u=et/c;if(e&&n&&n.projection.isReprojectedInTileSpace){let p=1<<e.z,{scale:_,x,y:w,projection:E}=n,I=S=>{let A=eo((e.x+S.x/c)/p),R=Kr((e.y+S.y/c)/p),k=E.project(A,R);S.x=(k.x*_-x)*c,S.y=(k.y*_-w)*c};for(let S=0;S<o.length;S++)if(t.type!==1)o[S]=iE(o[S],I,1);else{let A=[];for(let R of o[S])R.x<0||R.x>=c||R.y<0||R.y>=c||(I(R),A.push(R));o[S]=A}}for(let p of o)for(let _ of p)pR(_,u);return o}function vl(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?va(t):[]}}function Zg(t,e,n,o,c){t.emplaceBack(2*e+(o+1)/2,2*n+(c+1)/2)}function Qg(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Vv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Yr,this.indexArray=new kr,this.segments=new br,this.programConfigurations=new gl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o,c){let u=this.layers[0],p=[],_=null;u.type==="circle"&&(_=u.layout.get("circle-sort-key"));for(let{feature:w,id:E,index:I,sourceLayerIndex:S}of e){let A=this.layers[0]._featureFilter.needGeometry,R=vl(w,A);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),R,o))continue;let k=_?_.evaluate(R,{},o):void 0,z={id:E,properties:w.properties,type:w.type,sourceLayerIndex:S,index:I,geometry:A?R.geometry:va(w,o,c),patterns:{},sortKey:k};p.push(z)}_&&p.sort((w,E)=>w.sortKey-E.sortKey);let x=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new vo,x=c.projection);for(let w of p){let{geometry:E,index:I,sourceLayerIndex:S}=w,A=e[I].feature;this.addFeature(w,E,I,n.availableImages,o,x,n.brightness),n.featureIndex.insert(A,E,I,S,this.index)}}update(e,n,o,c,u){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,o,c,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,XP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,KP.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,o,c,u,p,_){for(let x of n)for(let w of x){let E=w.x,I=w.y;if(E<0||E>=et||I<0||I>=et)continue;if(p){let R=p.projectTilePoint(E,I,u),k=p.upVector(u,E,I),z=this.globeExtVertexArray;Qg(z,R,k),Qg(z,R,k),Qg(z,R,k),Qg(z,R,k)}let S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),A=S.vertexLength;Zg(this.layoutVertexArray,E,I,-1,-1),Zg(this.layoutVertexArray,E,I,1,-1),Zg(this.layoutVertexArray,E,I,1,1),Zg(this.layoutVertexArray,E,I,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c,u,_)}}function Uv(t,e){for(let n=0;n<t.length;n++)if(Yc(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Yc(t,e[n]))return!0;return!!$v(t,e)}function mR(t,e,n){return!!Yc(t,e)||!!Gv(e,t,n)}function sE(t,e){if(t.length===1)return lE(e,t[0]);for(let n=0;n<e.length;n++){let o=e[n];for(let c=0;c<o.length;c++)if(Yc(t,o[c]))return!0}for(let n=0;n<t.length;n++)if(lE(e,t[n]))return!0;for(let n=0;n<e.length;n++)if($v(t,e[n]))return!0;return!1}function gR(t,e,n){if(t.length>1){if($v(t,e))return!0;for(let o=0;o<e.length;o++)if(Gv(e[o],t,n))return!0}for(let o=0;o<t.length;o++)if(Gv(t[o],e,n))return!0;return!1}function $v(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let o=t[n],c=t[n+1];for(let u=0;u<e.length-1;u++)if(_R(o,c,e[u],e[u+1]))return!0}return!1}function _R(t,e,n,o){return Es(t,n,o)!==Es(e,n,o)&&Es(t,e,n)!==Es(t,e,o)}function Gv(t,e,n){let o=n*n;if(e.length===1)return t.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(aE(t,e[c-1],e[c])<o)return!0;return!1}function aE(t,e,n){let o=e.distSqr(n);if(o===0)return t.distSqr(e);let c=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/o;return t.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function lE(t,e){let n,o,c,u=!1;for(let p=0;p<t.length;p++){n=t[p];for(let _=0,x=n.length-1;_<n.length;x=_++)o=n[_],c=n[x],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(u=!u)}return u}function Yc(t,e){let n=!1;for(let o=0,c=t.length-1;o<t.length;c=o++){let u=t[o],p=t[c];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(n=!n)}return n}function cE(t,e,n,o,c){for(let p of t)if(e<=p.x&&n<=p.y&&o>=p.x&&c>=p.y)return!0;let u=[new Je(e,n),new Je(e,c),new Je(o,c),new Je(o,n)];if(t.length>2){for(let p of u)if(Yc(t,p))return!0}for(let p=0;p<t.length-1;p++)if(yR(t[p],t[p+1],u))return!0;return!1}function yR(t,e,n){let o=n[0],c=n[2];if(t.x<o.x&&e.x<o.x||t.x>c.x&&e.x>c.x||t.y<o.y&&e.y<o.y||t.y>c.y&&e.y>c.y)return!1;let u=Es(t,e,n[0]);return u!==Es(t,e,n[1])||u!==Es(t,e,n[2])||u!==Es(t,e,n[3])}function Mh(t,e,n,o,c,u){let p=e.y-t.y,_=t.x-e.x;if(u=u||0){let x=p*p+_*_;if(x===0)return!0;let w=Math.sqrt(x);p/=w,_/=w}return!((n.x-t.x)*p+(n.y-t.y)*_-u<0||(o.x-t.x)*p+(o.y-t.y)*_-u<0||(c.x-t.x)*p+(c.y-t.y)*_-u<0)}function Hv(t,e,n,o,c,u,p){return!(Mh(t,e,o,c,u,p)||Mh(e,n,o,c,u,p)||Mh(n,t,o,c,u,p)||Mh(o,c,t,e,n,p)||Mh(c,u,t,e,n,p)||Mh(u,o,t,e,n,p))}function Sh(t,e,n){let o=e.paint.get(t).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Yg(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function uE(t,e,n,o,c){if(!e[0]&&!e[1])return t;let u=Je.convert(e)._mult(c);n==="viewport"&&u._rotate(-o);let p=[];for(let _=0;_<t.length;_++)p.push(t[_].sub(u));return p}function hE(t,e,n,o){let c=Je.convert(t)._mult(o);return e==="viewport"&&c._rotate(-n),c}lt(Vv,"CircleBucket",{omit:["layers"]});let vR=new me({"circle-sort-key":new ye(ne.layout_circle["circle-sort-key"]),visibility:new he(ne.layout_circle.visibility)});var xR={paint:new me({"circle-radius":new ye(ne.paint_circle["circle-radius"]),"circle-color":new ye(ne.paint_circle["circle-color"]),"circle-blur":new ye(ne.paint_circle["circle-blur"]),"circle-opacity":new ye(ne.paint_circle["circle-opacity"]),"circle-translate":new he(ne.paint_circle["circle-translate"]),"circle-translate-anchor":new he(ne.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new he(ne.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new he(ne.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ye(ne.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ye(ne.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ye(ne.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new he(ne.paint_circle["circle-emissive-strength"])}),layout:vR};class qv{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,o){let c=i.Q.dot(n,this.dir);if(Math.abs(c)<1e-6)return!1;let u=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/c;return o[0]=this.pos[0]+this.dir[0]*u,o[1]=this.pos[1]+this.dir[1]*u,o[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,n,o){if(i.Q.equals(this.pos,e)||n===0)return o[0]=o[1]=o[2]=0,!1;let[c,u,p]=this.dir,_=this.pos[0]-e[0],x=this.pos[1]-e[1],w=this.pos[2]-e[2],E=c*c+u*u+p*p,I=2*(_*c+x*u+w*p),S=I*I-4*E*(_*_+x*x+w*w-n*n);if(S<0){let A=Math.max(-I/2,0),R=_+c*A,k=x+u*A,z=w+p*A,j=Math.hypot(R,k,z);return o[0]=R*n/j,o[1]=k*n/j,o[2]=z*n/j,!1}{let A=(-I-Math.sqrt(S))/(2*E);if(A<0){let R=Math.hypot(_,x,w);return o[0]=_*n/R,o[1]=x*n/R,o[2]=w*n/R,!1}return o[0]=_+c*A,o[1]=x+u*A,o[2]=w+p*A,!0}}}class Wv{constructor(e,n,o,c,u){this.TL=e,this.TR=n,this.BR=o,this.BL=c,this.horizon=u}static fromInvProjectionMatrix(e,n,o){let c=[-1,1,1],u=[1,1,1],p=[1,-1,1],_=[-1,-1,1],x=i.Q.transformMat4(c,c,e),w=i.Q.transformMat4(u,u,e),E=i.Q.transformMat4(p,p,e),I=i.Q.transformMat4(_,_,e);return new Wv(x,w,E,I,n/o)}}function Wf(t,e,n){let o=1/0,c=-1/0,u=[];for(let p of t){i.Q.sub(u,p,e);let _=i.Q.dot(u,n);o=Math.min(o,_),c=Math.max(c,_)}return[o,c]}function dE(t,e){let n=!0;for(let o=0;o<t.planes.length;o++){let c=t.planes[o],u=0;for(let p=0;p<e.length;p++)u+=i.Q.dot(c,e[p])+c[3]>=0;if(u===0)return 0;u!==e.length&&(n=!1)}return n?2:1}function fE(t,e){for(let n of t.projections){let o=Wf(e,t.points[0],n.axis);if(n.projection[1]<o[0]||n.projection[0]>o[1])return 0}return 1}function pE(t,e){let n=0,o=[0,0,0,0];for(let c=0;c<t.length;c++)o[0]=t[c][0],o[1]=t[c][1],o[2]=t[c][2],o[3]=1,i.aa.dot(o,e)>=0&&n++;return n}class Zv{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=tr.fromPoints(this.points),this.projections=[],this.frustumEdges=[i.Q.sub([],this.points[2],this.points[3]),i.Q.sub([],this.points[0],this.points[3]),i.Q.sub([],this.points[4],this.points[0]),i.Q.sub([],this.points[5],this.points[1]),i.Q.sub([],this.points[6],this.points[2]),i.Q.sub([],this.points[7],this.points[3])];for(let o of this.frustumEdges){let c=[0,-o[2],o[1]],u=[o[2],0,-o[0]];this.projections.push({axis:c,projection:Wf(this.points,this.points[0],c)}),this.projections.push({axis:u,projection:Wf(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,n,o,c){let u=Math.pow(2,o),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{let E=i.aa.transformMat4([],w,e),I=1/E[3]/n*u;return i.aa.mul(E,E,[I,I,c?1/E[3]:I,I])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{let E=i.Q.sub([],p[w[0]],p[w[1]]),I=i.Q.sub([],p[w[2]],p[w[1]]),S=i.Q.normalize([],i.Q.cross([],E,I)),A=-i.Q.dot(S,p[w[1]]);return S.concat(A)}),x=[];for(let w=0;w<p.length;w++)x.push([p[w][0],p[w][1],p[w][2]]);return new Zv(x,_)}intersectsPrecise(e,n,o){for(let c=0;c<n.length;c++)if(!pE(e,n[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!pE(e,this.planes[c]))return 0;for(let c of o)for(let u of this.frustumEdges){let p=i.Q.cross([],c,u),_=i.Q.length(p);if(_===0)continue;i.Q.scale(p,p,1/_);let x=Wf(this.points,this.points[0],p),w=Wf(e,this.points[0],p);if(x[0]>w[1]||w[0]>x[1])return 0}return 1}}class tr{static fromPoints(e){let n=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(let c of e)i.Q.min(n,n,c),i.Q.max(o,o,c);return new tr(n,o)}static fromTileIdAndHeight(e,n,o){let c=1<<e.canonical.z,u=e.canonical.x,p=e.canonical.y;return new tr([u/c,p/c,n],[(u+1)/c,(p+1)/c,o])}static applyTransform(e,n){let o=e.getCorners();for(let c=0;c<o.length;++c)i.Q.transformMat4(o[c],o[c],n);return tr.fromPoints(o)}static projectAabbCorners(e,n){let o=e.getCorners();for(let c=0;c<o.length;++c)i.Q.transformMat4(o[c],o[c],n);return o}constructor(e,n){this.min=e,this.max=n,this.center=i.Q.scale([],i.Q.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],o=i.Q.clone(this.min),c=i.Q.clone(this.max);for(let u=0;u<n.length;u++)o[u]=n[u]?this.min[u]:this.center[u],c[u]=n[u]?this.center[u]:this.max[u];return c[2]=this.max[2],new tr(o,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?dE(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?dE(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?fE(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?fE(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}lt(tr,"Aabb");let bR=Bt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Xg}=bR,wR=Bt([{name:"a_pos_3",components:3,type:"Int16"}]);var mE=Bt([{name:"a_pos",type:"Int16",components:2}]);function Kg(t){return t*Ai/Dh}let TR=[new tr([Bo,Bo,Bo],[jo,jo,jo]),new tr([Bo,Bo,Bo],[0,0,jo]),new tr([0,Bo,Bo],[jo,0,jo]),new tr([Bo,0,Bo],[0,jo,jo]),new tr([0,0,Bo],[jo,jo,jo])];function gE(t,e,n,o=!0){let c=i.Q.scale([],t._camera.position,t.worldSize),u=[e,n,1,1];i.aa.transformMat4(u,u,t.pixelMatrixInverse),i.aa.scale(u,u,1/u[3]);let p=i.Q.sub([],u,c),_=i.Q.normalize([],p),x=t.globeMatrix,w=[x[12],x[13],x[14]],E=i.Q.sub([],w,c),I=i.Q.length(E),S=i.Q.normalize([],E),A=t.worldSize/(2*Math.PI),R=i.Q.dot(S,_),k=Math.asin(A/I);if(k<Math.acos(R)){if(!o)return null;let ve=[],Se=[];i.Q.scale(ve,_,I/R),i.Q.normalize(Se,i.Q.sub(Se,ve,E)),i.Q.normalize(_,i.Q.add(_,E,i.Q.scale(_,Se,Math.tan(k)*I)))}let z=[];new qv(c,_).closestPointOnSphere(w,A,z);let j=i.Q.normalize([],na(x,0)),W=i.Q.normalize([],na(x,1)),X=i.Q.normalize([],na(x,2)),Q=i.Q.dot(j,z),oe=i.Q.dot(W,z),J=i.Q.dot(X,z),le=yi(Math.asin(-oe/A)),ue=yi(Math.atan2(Q,J));ue=t.center.lng+function(ve,Se){let Me=(Se-ve+180)%360-180;return Me<-180?Me+360:Me}(t.center.lng,ue);let _e=yl(ue),Ie=tn(ya(le),0,1);return new ai(_e,Ie)}class ER{constructor(e,n,o){this.a=i.Q.sub([],e,o),this.b=i.Q.sub([],n,o),this.center=o;let c=i.Q.normalize([],this.a),u=i.Q.normalize([],this.b);this.angle=Math.acos(i.Q.dot(c,u))}}function Qv(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(o,c,u,p){let _=Math.sin(u);return o*(Math.sin((1-p)*u)/_)+c*(Math.sin(p*u)/_)}(t.a[e],t.b[e],t.angle,tn(n,0,1))+t.center[e]}function Fs(t){if(t.z<=1)return TR[t.z+2*t.y+t.x];let e=Yv(Jg(t));return tr.fromPoints(e)}function xa(t,e,n){return i.Q.scale(t,t,1-n),i.Q.scaleAndAdd(t,t,e,n)}function _E(t,e,n){for(let o of t)i.Q.transformMat4(o,o,e),i.Q.scale(o,o,n)}function yE(t,e,n,o){let c=e/t.worldSize,u=t.globeMatrix;if(n.z<=1){let _e=Fs(n).getCorners();return _E(_e,u,c),tr.fromPoints(_e)}let p=Jg(n,o),_=Yv(p,Ai+Kg(t._tileCoverLift));_E(_,u,c);let x=Number.MAX_VALUE,w=[-x,-x,-x],E=[x,x,x];if(p.contains(t.center)){for(let ve of _)i.Q.min(E,E,ve),i.Q.max(w,w,ve);w[2]=0;let _e=t.point,Ie=[_e.x*c,_e.y*c,0];return i.Q.min(E,E,Ie),i.Q.max(w,w,Ie),new tr(E,w)}if(t._tileCoverLift>0){for(let _e of _)i.Q.min(E,E,_e),i.Q.max(w,w,_e);return new tr(E,w)}let I=[u[12]*c,u[13]*c,u[14]*c],S=p.getCenter(),A=tn(t.center.lat,-wr,wr),R=tn(S.lat,-wr,wr),k=yl(t.center.lng),z=ya(A),j=k-yl(S.lng),W=z-ya(R);j>.5?j-=1:j<-.5&&(j+=1);let X=0;if(Math.abs(j)>Math.abs(W))X=j>=0?1:3;else{X=W>=0?0:2;let _e=[u[4]*c,u[5]*c,u[6]*c],Ie=-Math.sin(hn(W>=0?p.getSouth():p.getNorth()))*Ai;i.Q.scaleAndAdd(I,I,_e,Ie)}let Q=_[X],oe=_[(X+1)%4],J=new ER(Q,oe,I),le=[Qv(J,0)||Q[0],Qv(J,1)||Q[1],Qv(J,2)||Q[2]],ue=xl(t.zoom);if(ue>0){let _e=function({x:ve,y:Se,z:Me},De,Fe,Le,Ve){let Be=1/(1<<Me),Ce=ve*Be,ht=Ce+Be,st=Se*Be,$e=st+Be,Et=0,gt=(Ce+ht)/2-Le;return gt>.5?Et=-1:gt<-.5&&(Et=1),Ce=((Ce+Et)*De-(Le*=De))*Fe+Le,ht=((ht+Et)*De-Le)*Fe+Le,st=(st*De-(Ve*=De))*Fe+Ve,$e=($e*De-Ve)*Fe+Ve,[[Ce,$e,0],[ht,$e,0],[ht,st,0],[Ce,st,0]]}(n,e,t._pixelsPerMercatorPixel,k,z);for(let ve=0;ve<_.length;ve++)xa(_[ve],_e[ve],ue);let Ie=i.Q.add([],_e[X],_e[(X+1)%4]);i.Q.scale(Ie,Ie,.5),xa(le,Ie,ue)}for(let _e of _)i.Q.min(E,E,_e),i.Q.max(w,w,_e);return E[2]=Math.min(Q[2],oe[2]),i.Q.min(E,E,le),i.Q.max(w,w,le),new tr(E,w)}function Jg({x:t,y:e,z:n},o=!1){let c=1/(1<<n),u=new mn(eo(t*c),e===(1<<n)-1&&o?-90:Kr((e+1)*c)),p=new mn(eo((t+1)*c),e===0&&o?90:Kr(e*c));return new _l(u,p)}function Yv(t,e=Ai){let n=hn(t.getNorth()),o=hn(t.getSouth()),c=Math.cos(n),u=Math.cos(o),p=Math.sin(n),_=Math.sin(o),x=t.getWest(),w=t.getEast();return[Ih(u,_,x,e),Ih(u,_,w,e),Ih(c,p,w,e),Ih(c,p,x,e)]}function Zf(t,e,n,o){let c=1<<n.z,u=(t/et+n.x)/c;return Wc(Kr((e/et+n.y)/c),eo(u),o)}function e_({min:t,max:e}){return lR/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let vE=new Float64Array(16);function t_(t){let e=e_(t),n=i.a9.fromScaling(vE,[e,e,e]);return i.a9.translate(n,n,i.Q.negate([],t.min))}function Xv(t){let e=i.a9.fromTranslation(vE,t.min),n=1/e_(t);return i.a9.scale(e,e,[n,n,n])}function Kv(t){let e=et/(2*Math.PI);return t/(2*Math.PI)/e}function xE(t,e){return et/(512*Math.pow(2,t))*e_(Fs(e))}function bE(t,e,n,o,c){let u=Kv(n),p=[t,e,-n/(2*Math.PI)],_=i.a9.identity(new Float64Array(16));return i.a9.translate(_,_,p),i.a9.scale(_,_,[u,u,u]),i.a9.rotateX(_,_,hn(-c)),i.a9.rotateY(_,_,hn(-o)),_}function xl(t){return nc(Lv,KT,t)}function wE(t,e){let n=Wc(e.lat,e.lng),o=function(u){let p=Wc(u._center.lat,u._center.lng),_=i.Q.fromValues(0,1,0),x=i.Q.cross([],_,p),w=i.a9.fromRotation([],-u.angle,p);x=i.Q.transformMat4(x,x,w),i.a9.fromRotation(w,-u._pitch,x);let E=i.Q.normalize([],p);return i.Q.scale(E,E,Kg(u.cameraToCenterDistance/u.pixelsPerMeter)),i.Q.transformMat4(E,E,w),i.Q.add([],p,E)}(t),c=i.Q.subtract([],o,n);return i.Q.angle(c,n)}function Jv(t,e){return wE(t,e)>Math.PI/2*1.01}let TE=hn(85),IR=Math.cos(TE),DR=Math.sin(TE),MR=i.a9.create(),EE=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function IE(t,e,n,o,c,u,p,_,x){if(u&&t.queryGeometry.isAboveHorizon)return!1;u&&(x*=t.pixelToTileUnitsFactor);let w=t.tileID.canonical,E=n.projection.upVectorScale(w,n.center.lat,n.worldSize).metersToTile;for(let I of e)for(let S of I){let A=S.add(_),R=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(A.x,A.y,!0):0,k=n.projection.projectTilePoint(A.x,A.y,w);if(R>0){let X=n.projection.upVector(w,A.x,A.y);k.x+=X[0]*E*R,k.y+=X[1]*E*R,k.z+=X[2]*E*R}let z=u?A:SR(k.x,k.y,k.z,o),j=u?t.tilespaceRays.map(X=>AR(X,R)):t.queryGeometry.screenGeometry,W=i.aa.transformMat4([],[k.x,k.y,k.z,1],o);if(!p&&u?x*=W[3]/n.cameraToCenterDistance:p&&!u&&(x*=n.cameraToCenterDistance/W[3]),u){let X=Kr((S.y/et+w.y)/(1<<w.z));x/=n.projection.pixelsPerMeter(X,1)/Pi(1,X)}if(mR(j,z,x))return!0}return!1}function SR(t,e,n,o){let c=i.aa.transformMat4([],[t,e,n,1],o);return new Je(c[0]/c[3],c[1]/c[3])}let DE=i.Q.fromValues(0,0,0),CR=i.Q.fromValues(0,0,1);function AR(t,e){let n=i.Q.create();return DE[2]=e,t.intersectsPlane(DE,CR,n),new Je(n[0],n[1])}class ME extends Vv{}function SE(t,{width:e,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*o)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*o);return t.width=e,t.height=n,t.data=c,t}function CE(t,e,n){let{width:o,height:c}=e;o===t.width&&c===t.height||(ex(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,o),height:Math.min(t.height,c)},n),t.width=o,t.height=c,t.data=e.data)}function ex(t,e,n,o,c,u,p){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||n.x>t.width-c.width||n.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");let _=t.data,x=e.data,w=u===4&&p;for(let E=0;E<c.height;E++){let I=((n.y+E)*t.width+n.x)*u,S=((o.y+E)*e.width+o.x)*u;if(w)for(let A=0;A<c.width;A++){let R=I+A*u+3,k=S+A*u;x[k+0]=255,x[k+1]=255,x[k+2]=255,x[k+3]=_[R]}else for(let A=0;A<c.width*u;A++)x[S+A]=_[I+A]}return e}lt(ME,"HeatmapBucket",{omit:["layers"]});class bl{constructor(e,n){SE(this,e,1,n)}resize(e){CE(this,new bl(e),1)}clone(){return new bl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,u){ex(e,n,o,c,u,1)}}class xo{constructor(e,n){SE(this,e,4,n)}resize(e){CE(this,new xo(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new xo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,u,p){ex(e,n,o,c,u,4,p)}}class AE{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}lt(bl,"AlphaImage"),lt(xo,"RGBAImage");let PR=new me({visibility:new he(ne.layout_heatmap.visibility)});var RR={paint:new me({"heatmap-radius":new ye(ne.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ye(ne.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new he(ne.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ze(ne.paint_heatmap["heatmap-color"]),"heatmap-opacity":new he(ne.paint_heatmap["heatmap-opacity"])}),layout:PR};function Qf(t){let e={},n=t.resolution||256,o=t.clips?t.clips.length:1,c=t.image||new xo({width:n,height:o}),u=(p,_,x)=>{e[t.evaluationKey]=x;let w=t.expression.evaluate(e);w&&(c.data[p+_+0]=Math.floor(255*w.r/w.a),c.data[p+_+1]=Math.floor(255*w.g/w.a),c.data[p+_+2]=Math.floor(255*w.b/w.a),c.data[p+_+3]=Math.floor(255*w.a))};if(t.clips)for(let p=0,_=0;p<o;++p,_+=4*n)for(let x=0,w=0;x<n;x++,w+=4){let E=x/(n-1),{start:I,end:S}=t.clips[p];u(_,w,I*(1-E)+S*E)}else for(let p=0,_=0;p<n;p++,_+=4)u(0,_,p/(n-1));return c}let OR=new me({visibility:new he(ne.layout_hillshade.visibility)});var LR={paint:new me({"hillshade-illumination-direction":new he(ne.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new he(ne.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new he(ne.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new he(ne.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new he(ne.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new he(ne.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new he(ne.paint_hillshade["hillshade-emissive-strength"])}),layout:OR};let kR=Bt([{name:"a_pos",components:2,type:"Int16"}],4),{members:FR}=kR;var tx={exports:{}};function n_(t,e,n){n=n||2;var o,c,u,p,_,x,w,E=e&&e.length,I=E?e[0]*n:t.length,S=PE(t,0,I,n,!0),A=[];if(!S||S.next===S.prev)return A;if(E&&(S=function(k,z,j,W){var X,Q,oe,J=[];for(X=0,Q=z.length;X<Q;X++)(oe=PE(k,z[X]*W,X<Q-1?z[X+1]*W:k.length,W,!1))===oe.next&&(oe.steiner=!0),J.push(GR(oe));for(J.sort(VR),X=0;X<J.length;X++)j=UR(J[X],j);return j}(t,e,S,n)),t.length>80*n){o=u=t[0],c=p=t[1];for(var R=n;R<I;R+=n)(_=t[R])<o&&(o=_),(x=t[R+1])<c&&(c=x),_>u&&(u=_),x>p&&(p=x);w=(w=Math.max(u-o,p-c))!==0?32767/w:0}return Yf(S,A,n,o,c,w,0),A}function PE(t,e,n,o,c){var u,p;if(c===ix(t,e,n,o)>0)for(u=e;u<n;u+=o)p=LE(u,t[u],t[u+1],p);else for(u=n-o;u>=e;u-=o)p=LE(u,t[u],t[u+1],p);return p&&r_(p,p.next)&&(Kf(p),p=p.next),p}function Xc(t,e){if(!t)return t;e||(e=t);var n,o=t;do if(n=!1,o.steiner||!r_(o,o.next)&&Ar(o.prev,o,o.next)!==0)o=o.next;else{if(Kf(o),(o=e=o.prev)===o.next)break;n=!0}while(n||o!==e);return e}function Yf(t,e,n,o,c,u,p){if(t){!p&&u&&function(E,I,S,A){var R=E;do R.z===0&&(R.z=nx(R.x,R.y,I,S,A)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==E);R.prevZ.nextZ=null,R.prevZ=null,function(k){var z,j,W,X,Q,oe,J,le,ue=1;do{for(j=k,k=null,Q=null,oe=0;j;){for(oe++,W=j,J=0,z=0;z<ue&&(J++,W=W.nextZ);z++);for(le=ue;J>0||le>0&&W;)J!==0&&(le===0||!W||j.z<=W.z)?(X=j,j=j.nextZ,J--):(X=W,W=W.nextZ,le--),Q?Q.nextZ=X:k=X,X.prevZ=Q,Q=X;j=W}Q.nextZ=null,ue*=2}while(oe>1)}(R)}(t,o,c,u);for(var _,x,w=t;t.prev!==t.next;)if(_=t.prev,x=t.next,u?zR(t,o,c,u):NR(t))e.push(_.i/n|0),e.push(t.i/n|0),e.push(x.i/n|0),Kf(t),t=x.next,w=x.next;else if((t=x)===w){p?p===1?Yf(t=BR(Xc(t),e,n),e,n,o,c,u,2):p===2&&jR(t,e,n,o,c,u):Yf(Xc(t),e,n,o,c,u,1);break}}}function NR(t){var e=t.prev,n=t,o=t.next;if(Ar(e,n,o)>=0)return!1;for(var c=e.x,u=n.x,p=o.x,_=e.y,x=n.y,w=o.y,E=c<u?c<p?c:p:u<p?u:p,I=_<x?_<w?_:w:x<w?x:w,S=c>u?c>p?c:p:u>p?u:p,A=_>x?_>w?_:w:x>w?x:w,R=o.next;R!==e;){if(R.x>=E&&R.x<=S&&R.y>=I&&R.y<=A&&Ch(c,_,u,x,p,w,R.x,R.y)&&Ar(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function zR(t,e,n,o){var c=t.prev,u=t,p=t.next;if(Ar(c,u,p)>=0)return!1;for(var _=c.x,x=u.x,w=p.x,E=c.y,I=u.y,S=p.y,A=_<x?_<w?_:w:x<w?x:w,R=E<I?E<S?E:S:I<S?I:S,k=_>x?_>w?_:w:x>w?x:w,z=E>I?E>S?E:S:I>S?I:S,j=nx(A,R,e,n,o),W=nx(k,z,e,n,o),X=t.prevZ,Q=t.nextZ;X&&X.z>=j&&Q&&Q.z<=W;){if(X.x>=A&&X.x<=k&&X.y>=R&&X.y<=z&&X!==c&&X!==p&&Ch(_,E,x,I,w,S,X.x,X.y)&&Ar(X.prev,X,X.next)>=0||(X=X.prevZ,Q.x>=A&&Q.x<=k&&Q.y>=R&&Q.y<=z&&Q!==c&&Q!==p&&Ch(_,E,x,I,w,S,Q.x,Q.y)&&Ar(Q.prev,Q,Q.next)>=0))return!1;Q=Q.nextZ}for(;X&&X.z>=j;){if(X.x>=A&&X.x<=k&&X.y>=R&&X.y<=z&&X!==c&&X!==p&&Ch(_,E,x,I,w,S,X.x,X.y)&&Ar(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;Q&&Q.z<=W;){if(Q.x>=A&&Q.x<=k&&Q.y>=R&&Q.y<=z&&Q!==c&&Q!==p&&Ch(_,E,x,I,w,S,Q.x,Q.y)&&Ar(Q.prev,Q,Q.next)>=0)return!1;Q=Q.nextZ}return!0}function BR(t,e,n){var o=t;do{var c=o.prev,u=o.next.next;!r_(c,u)&&RE(c,o,o.next,u)&&Xf(c,u)&&Xf(u,c)&&(e.push(c.i/n|0),e.push(o.i/n|0),e.push(u.i/n|0),Kf(o),Kf(o.next),o=t=u),o=o.next}while(o!==t);return Xc(o)}function jR(t,e,n,o,c,u){var p=t;do{for(var _=p.next.next;_!==p.prev;){if(p.i!==_.i&&HR(p,_)){var x=OE(p,_);return p=Xc(p,p.next),x=Xc(x,x.next),Yf(p,e,n,o,c,u,0),void Yf(x,e,n,o,c,u,0)}_=_.next}p=p.next}while(p!==t)}function VR(t,e){return t.x-e.x}function UR(t,e){var n=function(c,u){var p,_=u,x=c.x,w=c.y,E=-1/0;do{if(w<=_.y&&w>=_.next.y&&_.next.y!==_.y){var I=_.x+(w-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(I<=x&&I>E&&(E=I,p=_.x<_.next.x?_:_.next,I===x))return p}_=_.next}while(_!==u);if(!p)return null;var S,A=p,R=p.x,k=p.y,z=1/0;_=p;do x>=_.x&&_.x>=R&&x!==_.x&&Ch(w<k?x:E,w,R,k,w<k?E:x,w,_.x,_.y)&&(S=Math.abs(w-_.y)/(x-_.x),Xf(_,c)&&(S<z||S===z&&(_.x>p.x||_.x===p.x&&$R(p,_)))&&(p=_,z=S)),_=_.next;while(_!==A);return p}(t,e);if(!n)return e;var o=OE(n,t);return Xc(o,o.next),Xc(n,n.next)}function $R(t,e){return Ar(t.prev,t,e.prev)<0&&Ar(e.next,t,t.next)<0}function nx(t,e,n,o,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function GR(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Ch(t,e,n,o,c,u,p,_){return(c-p)*(e-_)>=(t-p)*(u-_)&&(t-p)*(o-_)>=(n-p)*(e-_)&&(n-p)*(u-_)>=(c-p)*(o-_)}function HR(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,o){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&RE(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(t,e)&&(Xf(t,e)&&Xf(e,t)&&function(n,o){var c=n,u=!1,p=(n.x+o.x)/2,_=(n.y+o.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&p<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(u=!u),c=c.next;while(c!==n);return u}(t,e)&&(Ar(t.prev,t,e.prev)||Ar(t,e.prev,e))||r_(t,e)&&Ar(t.prev,t,t.next)>0&&Ar(e.prev,e,e.next)>0)}function Ar(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function r_(t,e){return t.x===e.x&&t.y===e.y}function RE(t,e,n,o){var c=o_(Ar(t,e,n)),u=o_(Ar(t,e,o)),p=o_(Ar(n,o,t)),_=o_(Ar(n,o,e));return c!==u&&p!==_||!(c!==0||!i_(t,n,e))||!(u!==0||!i_(t,o,e))||!(p!==0||!i_(n,t,o))||!(_!==0||!i_(n,e,o))}function i_(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function o_(t){return t>0?1:t<0?-1:0}function Xf(t,e){return Ar(t.prev,t,t.next)<0?Ar(t,e,t.next)>=0&&Ar(t,t.prev,e)>=0:Ar(t,e,t.prev)<0||Ar(t,t.next,e)<0}function OE(t,e){var n=new rx(t.i,t.x,t.y),o=new rx(e.i,e.x,e.y),c=t.next,u=e.prev;return t.next=e,e.prev=t,n.next=c,c.prev=n,o.next=n,n.prev=o,u.next=o,o.prev=u,o}function LE(t,e,n,o){var c=new rx(t,e,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function Kf(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function rx(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ix(t,e,n,o){for(var c=0,u=e,p=n-o;u<n;u+=o)c+=(t[p]-t[u])*(t[u+1]+t[p+1]),p=u;return c}tx.exports=n_,tx.exports.default=n_,n_.deviation=function(t,e,n,o){var c=e&&e.length,u=Math.abs(ix(t,0,c?e[0]*n:t.length,n));if(c)for(var p=0,_=e.length;p<_;p++)u-=Math.abs(ix(t,e[p]*n,p<_-1?e[p+1]*n:t.length,n));var x=0;for(p=0;p<o.length;p+=3){var w=o[p]*n,E=o[p+1]*n,I=o[p+2]*n;x+=Math.abs((t[w]-t[I])*(t[E+1]-t[w+1])-(t[w]-t[E])*(t[I+1]-t[w+1]))}return u===0&&x===0?0:Math.abs((x-u)/u)},n_.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},o=0,c=0;c<t.length;c++){for(var u=0;u<t[c].length;u++)for(var p=0;p<e;p++)n.vertices.push(t[c][u][p]);c>0&&n.holes.push(o+=t[c-1].length)}return n};var s_=Rt(tx.exports);function ox(t,e){let n=t.length;if(n<=1)return[t];let o=[],c,u;for(let p=0;p<n;p++){let _=ic(t[p]);_!==0&&(t[p].area=Math.abs(_),u===void 0&&(u=_<0),u===_<0?(c&&o.push(c),c=[t[p]]):c.push(t[p]))}if(c&&o.push(c),e>1)for(let p=0;p<o.length;p++)o[p].length<=e||(hg(o[p],e,1,o[p].length-1,qR),o[p]=o[p].slice(0,e));return o}function qR(t,e){return e.area-t.area}function sx(t,e,n){let o=n.patternDependencies,c=!1;for(let u of e){let p=u.paint.get(`${t}-pattern`);p.isConstant()||(c=!0);let _=p.constantOr(null);_&&(c=!0,o[_]=!0)}return c}function ax(t,e,n,o,c){let u=c.patternDependencies;for(let p of e){let _=p.paint.get(`${t}-pattern`).value;if(_.kind!=="constant"){let x=_.evaluate({zoom:o},n,{},c.availableImages);x=x&&x.name?x.name:x,u[x]=!0,n.patterns[p.id]=x}}return n}class lx{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Yr,this.indexArray=new kr,this.indexArray2=new Ji,this.programConfigurations=new gl(e.layers,e.zoom),this.segments=new br,this.segments2=new br,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,o,c){this.hasPattern=sx("fill",this.layers,n);let u=this.layers[0].layout.get("fill-sort-key"),p=[];for(let{feature:_,id:x,index:w,sourceLayerIndex:E}of e){let I=this.layers[0]._featureFilter.needGeometry,S=vl(_,I);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),S,o))continue;let A=u?u.evaluate(S,{},o,n.availableImages):void 0,R={id:x,properties:_.properties,type:_.type,sourceLayerIndex:E,index:w,geometry:I?S.geometry:va(_,o,c),patterns:{},sortKey:A};p.push(R)}u&&p.sort((_,x)=>_.sortKey-x.sortKey);for(let _ of p){let{geometry:x,index:w,sourceLayerIndex:E}=_;if(this.hasPattern){let I=ax("fill",this.layers,_,this.zoom,n);this.patternFeatures.push(I)}else this.addFeature(_,x,w,o,{},n.availableImages,n.brightness);n.featureIndex.insert(e[w].feature,x,w,E,this.index)}}update(e,n,o,c,u){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,o,c,u)}addFeatures(e,n,o,c,u,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,o,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,FR),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,c,u,p=[],_){for(let x of ox(n,500)){let w=0;for(let k of x)w+=k.length;let E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),I=E.vertexLength,S=[],A=[];for(let k of x){if(k.length===0)continue;k!==x[0]&&A.push(S.length/2);let z=this.segments2.prepareSegment(k.length,this.layoutVertexArray,this.indexArray2),j=z.vertexLength;this.layoutVertexArray.emplaceBack(k[0].x,k[0].y),this.indexArray2.emplaceBack(j+k.length-1,j),S.push(k[0].x),S.push(k[0].y);for(let W=1;W<k.length;W++)this.layoutVertexArray.emplaceBack(k[W].x,k[W].y),this.indexArray2.emplaceBack(j+W-1,j+W),S.push(k[W].x),S.push(k[W].y);z.vertexLength+=k.length,z.primitiveLength+=k.length}let R=s_(S,A);for(let k=0;k<R.length;k+=3)this.indexArray.emplaceBack(I+R[k],I+R[k+1],I+R[k+2]);E.vertexLength+=w,E.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,p,c,_)}}lt(lx,"FillBucket",{omit:["layers","patternFeatures"]});let WR=new me({"fill-sort-key":new ye(ne.layout_fill["fill-sort-key"]),visibility:new he(ne.layout_fill.visibility)});var ZR={paint:new me({"fill-antialias":new he(ne.paint_fill["fill-antialias"]),"fill-opacity":new ye(ne.paint_fill["fill-opacity"]),"fill-color":new ye(ne.paint_fill["fill-color"]),"fill-outline-color":new ye(ne.paint_fill["fill-outline-color"]),"fill-translate":new he(ne.paint_fill["fill-translate"]),"fill-translate-anchor":new he(ne.paint_fill["fill-translate-anchor"]),"fill-pattern":new ye(ne.paint_fill["fill-pattern"]),"fill-emissive-strength":new he(ne.paint_fill["fill-emissive-strength"])}),layout:WR};let QR=Bt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),YR=Bt([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),XR=Bt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),KR=Bt([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),JR=Bt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:eO}=QR;var a_={},tO=Cu,kE=Ah;function Ah(t,e,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=c,t.readFields(nO,this,e)}function nO(t,e,n){t==1?e.id=n.readVarint():t==2?function(o,c){for(var u=o.readVarint()+o.pos;o.pos<u;){var p=c._keys[o.readVarint()],_=c._values[o.readVarint()];c.properties[p]=_}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function rO(t){for(var e,n,o=0,c=0,u=t.length,p=u-1;c<u;p=c++)o+=((n=t[p]).x-(e=t[c]).x)*(e.y+n.y);return o}Ah.types=["Unknown","Point","LineString","Polygon"],Ah.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,o=1,c=0,u=0,p=0,_=[];t.pos<n;){if(c<=0){var x=t.readVarint();o=7&x,c=x>>3}if(c--,o===1||o===2)u+=t.readSVarint(),p+=t.readSVarint(),o===1&&(e&&_.push(e),e=[]),e.push(new tO(u,p));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&_.push(e),_},Ah.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,o=0,c=0,u=0,p=1/0,_=-1/0,x=1/0,w=-1/0;t.pos<e;){if(o<=0){var E=t.readVarint();n=7&E,o=E>>3}if(o--,n===1||n===2)(c+=t.readSVarint())<p&&(p=c),c>_&&(_=c),(u+=t.readSVarint())<x&&(x=u),u>w&&(w=u);else if(n!==7)throw new Error("unknown command "+n)}return[p,x,_,w]},Ah.prototype.toGeoJSON=function(t,e,n){var o,c,u=this.extent*Math.pow(2,n),p=this.extent*t,_=this.extent*e,x=this.loadGeometry(),w=Ah.types[this.type];function E(A){for(var R=0;R<A.length;R++){var k=A[R];A[R]=[360*(k.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(k.y+_)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(o=0;o<x.length;o++)I[o]=x[o][0];E(x=I);break;case 2:for(o=0;o<x.length;o++)E(x[o]);break;case 3:for(x=function(A){var R=A.length;if(R<=1)return[A];for(var k,z,j=[],W=0;W<R;W++){var X=rO(A[W]);X!==0&&(z===void 0&&(z=X<0),z===X<0?(k&&j.push(k),k=[A[W]]):k.push(A[W]))}return k&&j.push(k),j}(x),o=0;o<x.length;o++)for(c=0;c<x[o].length;c++)E(x[o][c])}x.length===1?x=x[0]:w="Multi"+w;var S={type:"Feature",geometry:{type:w,coordinates:x},properties:this.properties};return"id"in this&&(S.id=this.id),S};var iO=kE,FE=NE;function NE(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(oO,this,e),this.length=this._features.length}function oO(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(o){for(var c=null,u=o.readVarint()+o.pos;o.pos<u;){var p=o.readVarint()>>3;c=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}return c}(n))}NE.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new iO(this._pbf,e,this.extent,this._keys,this._values)};var sO=FE;function aO(t,e,n){if(t===3){var o=new sO(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}var cx=a_.VectorTile=function(t,e){this.layers=t.readFields(aO,{},e)},l_=a_.VectorTileFeature=kE;function c_(t,e,n,o){let c=[],u=o===0?(p,_,x,w,E,I)=>{p.push(new Je(I,x+(I-_)/(w-_)*(E-x)))}:(p,_,x,w,E,I)=>{p.push(new Je(_+(I-x)/(E-x)*(w-_),I))};for(let p of t){let _=[];for(let x of p){if(x.length<=2)continue;let w=[];for(let S=0;S<x.length-1;S++){let A=x[S].x,R=x[S].y,k=x[S+1].x,z=x[S+1].y,j=o===0?A:R,W=o===0?k:z;j<e?W>e&&u(w,A,R,k,z,e):j>n?W<n&&u(w,A,R,k,z,n):w.push(x[S]),W<e&&j>=e&&u(w,A,R,k,z,e),W>n&&j<=n&&u(w,A,R,k,z,n)}let E=x[x.length-1],I=o===0?E.x:E.y;I>=e&&I<=n&&w.push(E),w.length&&(E=w[w.length-1],w[0].x===E.x&&w[0].y===E.y||w.push(w[0]),_.push(w))}_.length&&c.push(_)}return c}function u_(t,e){return t.x-e.x||t.y-e.y}function zE(t,e){return u_(t.min,e.min)===0&&u_(t.max,e.max)===0}function BE(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function jE(t,e,n){let o=1/et,c=1/(1<<n.canonical.z),u=(e.x*o+n.canonical.x)*c+n.wrap,p=(e.y*o+n.canonical.y)*c;return{min:new Je((t.x*o+n.canonical.x)*c+n.wrap,(t.y*o+n.canonical.y)*c),max:new Je(u,p)}}function lO(t,e,n){let o=1<<n.canonical.z,c=((e.x-n.wrap)*o-n.canonical.x)*et,u=(e.y*o-n.canonical.y)*et;return{min:new Je(((t.x-n.wrap)*o-n.canonical.x)*et,(t.y*o-n.canonical.y)*et),max:new Je(c,u)}}function VE(t,e,n,o,c,u,p){let _=t.indices,x=t.vertices,w=[];for(let E=o;E<o+c;E+=3){let I=e[n[E+0]+u],S=e[n[E+1]+u],A=e[n[E+2]+u],R=Math.min(I.x,S.x,A.x),k=Math.max(I.x,S.x,A.x),z=Math.min(I.y,S.y,A.y),j=Math.max(I.y,S.y,A.y);w.length=0,t.grid.query(new Je(R,z),new Je(k,j),w);for(let W=0;W<w.length;W++){let X=w[W];if(Hv(x[_[3*X+0]],x[_[3*X+1]],x[_[3*X+2]],I,S,A,p))return!0}}return!1}function UE(t,e,n,o){if(!t||!n)return!1;let c=t.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(n.vertices.length<t.vertices.length)return UE(n,o,t,e);let u=e.canonical,p=o.canonical,_=Math.pow(2,p.z-u.z);c=t.vertices.map(x=>new Je((x.x+u.x*et)*_-p.x*et,(x.y+u.y*et)*_-p.y*et))}return VE(n,c,t.indices,0,t.indices.length,0,0)}a_.VectorTileLayer=FE;class $E{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let o=this.toIdx(e,n);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function GE(t,e,n,o){let c=0,u=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(o[p])<1e-15){if(n[p]<t[p]||n[p]>e[p])return null}else{let _=1/o[p],x=(t[p]-n[p])*_,w=(e[p]-n[p])*_;if(x>w){let E=x;x=w,w=E}if(x>c&&(c=x),w<u&&(u=w),c>u)return null}return c}function HE(t,e,n,o,c,u,p,_,x,w,E){let I=o-t,S=c-e,A=u-n,R=p-t,k=_-e,z=x-n,j=E[1]*z-E[2]*k,W=E[2]*R-E[0]*z,X=E[0]*k-E[1]*R,Q=I*j+S*W+A*X;if(Math.abs(Q)<1e-15)return null;let oe=1/Q,J=w[0]-t,le=w[1]-e,ue=w[2]-n,_e=(J*j+le*W+ue*X)*oe;if(_e<0||_e>1)return null;let Ie=le*A-ue*S,ve=ue*I-J*A,Se=J*S-le*I,Me=(E[0]*Ie+E[1]*ve+E[2]*Se)*oe;return Me<0||_e+Me>1?null:(R*Ie+k*ve+z*Se)*oe}function qE(t,e,n){return(t-e)/(n-e)}function WE(t,e,n,o,c,u,p,_,x){let w=1<<n,E=u-o,I=p-c,S=(t+1)/w*E+o,A=(e+0)/w*I+c,R=(e+1)/w*I+c;_[0]=(t+0)/w*E+o,_[1]=A,x[0]=S,x[1]=R}class ZE{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(u){let p=Math.ceil(Math.log2(u.dim/8)),_=[],x=Math.ceil(Math.pow(2,p)),w=1/x,E=(A,R,k,z,j)=>{let W=z?1:0,X=(A+1)*k-W,Q=R*k,oe=(R+1)*k-W;j[0]=A*k,j[1]=Q,j[2]=X,j[3]=oe},I=new $E(x),S=[];for(let A=0;A<x*x;A++){E(A%x,Math.floor(A/x),w,!1,S);let R=wl(S[0],S[1],u),k=wl(S[2],S[1],u),z=wl(S[2],S[3],u),j=wl(S[0],S[3],u);I.minimums.push(Math.min(R,k,z,j)),I.maximums.push(Math.max(R,k,z,j)),I.leaves.push(1)}for(_.push(I),x/=2;x>=1;x/=2){let A=_[_.length-1];I=new $E(x);for(let R=0;R<x*x;R++){E(R%x,Math.floor(R/x),2,!0,S);let k=A.getElevation(S[0],S[1]),z=A.getElevation(S[2],S[1]),j=A.getElevation(S[2],S[3]),W=A.getElevation(S[0],S[3]),X=A.isLeaf(S[0],S[1]),Q=A.isLeaf(S[2],S[1]),oe=A.isLeaf(S[2],S[3]),J=A.isLeaf(S[0],S[3]),le=Math.min(k.min,z.min,j.min,W.min),ue=Math.max(k.max,z.max,j.max,W.max),_e=X&&Q&&oe&&J;I.maximums.push(ue),I.minimums.push(le),I.leaves.push(ue-le<=5&&_e?1:0)}_.push(I)}return _}(this.dem),o=n.length-1,c=n[o];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,o,0)}raycastRoot(e,n,o,c,u,p,_=1){return GE([e,n,-100],[o,c,this.maximums[0]*_],u,p)}raycast(e,n,o,c,u,p,_=1){if(!this.nodeCount)return null;let x=this.raycastRoot(e,n,o,c,u,p,_);if(x==null)return null;let w=[],E=[],I=[],S=[],A=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;A.length>0;){let{idx:R,t:k,nodex:z,nodey:j,depth:W}=A.pop();if(this.leaves[R]){WE(z,j,W,e,n,o,c,I,S);let Q=1<<W,oe=(z+0)/Q,J=(z+1)/Q,le=(j+0)/Q,ue=(j+1)/Q,_e=wl(oe,le,this.dem)*_,Ie=wl(J,le,this.dem)*_,ve=wl(J,ue,this.dem)*_,Se=wl(oe,ue,this.dem)*_,Me=HE(I[0],I[1],_e,S[0],I[1],Ie,S[0],S[1],ve,u,p),De=HE(S[0],S[1],ve,I[0],S[1],Se,I[0],I[1],_e,u,p),Fe=Math.min(Me!==null?Me:Number.MAX_VALUE,De!==null?De:Number.MAX_VALUE);if(Fe!==Number.MAX_VALUE)return Fe;{let Le=i.Q.scaleAndAdd([],u,p,k);if(QE(_e,Ie,Se,ve,qE(Le[0],I[0],S[0]),qE(Le[1],I[1],S[1]))>=Le[2])return k}continue}let X=0;for(let Q=0;Q<this._siblingOffset.length;Q++){WE((z<<1)+this._siblingOffset[Q][0],(j<<1)+this._siblingOffset[Q][1],W+1,e,n,o,c,I,S),I[2]=-100,S[2]=this.maximums[this.childOffsets[R]+Q]*_;let oe=GE(I,S,u,p);if(oe!=null){let J=oe;w[Q]=J;let le=!1;for(let ue=0;ue<X&&!le;ue++)J>=w[E[ue]]&&(E.splice(ue,0,Q),le=!0);le||(E[X]=Q),X++}}for(let Q=0;Q<X;Q++){let oe=E[Q];A.push({idx:this.childOffsets[R]+oe,t:w[oe],nodex:(z<<1)+this._siblingOffset[oe][0],nodey:(j<<1)+this._siblingOffset[oe][1],depth:W+1})}}return null}_addNode(e,n,o){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,o,c,u){if(e[c].isLeaf(n,o)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);let p=c-1,_=e[p],x=0,w=0;for(let E=0;E<this._siblingOffset.length;E++){let I=2*n+this._siblingOffset[E][0],S=2*o+this._siblingOffset[E][1],A=_.getElevation(I,S),R=_.isLeaf(I,S),k=this._addNode(A.min,A.max,R);R&&(x|=1<<E),w||(w=k)}for(let E=0;E<this._siblingOffset.length;E++)x&1<<E||this._construct(e,2*n+this._siblingOffset[E][0],2*o+this._siblingOffset[E][1],p,w+E)}}function QE(t,e,n,o,c,u){return Zt(Zt(t,n,u),Zt(e,o,u),c)}function wl(t,e,n){let o=n.dim,c=tn(t*o-.5,0,o-1),u=tn(e*o-.5,0,o-1),p=Math.floor(c),_=Math.floor(u),x=Math.min(p+1,o-1),w=Math.min(_+1,o-1);return QE(n.get(p,_),n.get(x,_),n.get(p,w),n.get(x,w),c-p,u-_)}let cO={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function uO(t,e,n){return(256*t*256+256*e+n)/10-1e4}function hO(t,e,n){return 256*t+e+n/256-32768}class h_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,o,c=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return dr(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let u=this.dim=n.height-2,p=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let x=0;x<u;x++)p[this._idx(-1,x)]=p[this._idx(0,x)],p[this._idx(u,x)]=p[this._idx(u-1,x)],p[this._idx(x,-1)]=p[this._idx(x,0)],p[this._idx(x,u)]=p[this._idx(x,u-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(u,-1)]=p[this._idx(u-1,0)],p[this._idx(-1,u)]=p[this._idx(0,u-1)],p[this._idx(u,u)]=p[this._idx(u-1,u-1)]}let _=o==="terrarium"?hO:uO;for(let x=0;x<p.length;++x){let w=4*x;this.floatView[x]=_(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=Ro.now()}_buildQuadTree(){this._tree=new ZE(this)}get(e,n,o=!1){o&&(e=tn(e,-1,this.dim),n=tn(n,-1,this.dim));let c=this._idx(e,n);return this.floatView[c]}set(e,n,o){let c=this._idx(e,n),u=this.floatView[c];return this.floatView[c]=o,o-u}static getUnpackVector(e){return cO[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let o=[0,0,0,0],c=h_.getUnpackVector(n),u=Math.floor((e+c[3])/c[2]);return o[2]=u%256,u=Math.floor(u/256),o[1]=u%256,u=Math.floor(u/256),o[0]=u,o}getPixels(){return new AE({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,u=n*this.dim+this.dim,p=o*this.dim,_=o*this.dim+this.dim;switch(n){case-1:c=u-1;break;case 1:u=c+1}switch(o){case-1:p=_-1;break;case 1:_=p+1}let x=-n*this.dim,w=-o*this.dim;for(let E=p;E<_;E++)for(let I=c;I<u;I++){let S=4*this._idx(I,E),A=4*this._idx(I+x,E+w);this.pixels[S+0]=e.pixels[A+0],this.pixels[S+1]=e.pixels[A+1],this.pixels[S+2]=e.pixels[A+2],this.pixels[S+3]=e.pixels[A+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}lt(h_,"DEMData"),lt(ZE,"DemMinMaxQuadTree",{omit:["dem"]});class Ph{constructor(e,n,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=o}static create(e,n,o){let c=o||e.findDEMTileFor(n);if(!c||!c.dem)return;let u=c.dem,p=c.tileID,_=1<<n.canonical.z-p.canonical.z;return new Ph(c,u.dim/et/_,[(n.canonical.x/_-p.canonical.x)*u.dim,(n.canonical.y/_-p.canonical.y)*u.dim])}tileCoordToPixel(e,n){let o=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(o);return new Je(c,u)}getElevationAt(e,n,o,c){let u=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],_=Math.floor(u),x=Math.floor(p),w=this._dem;return c=!!c,o?Zt(Zt(w.get(_,x,c),w.get(_,x+1,c),p-x),Zt(w.get(_+1,x,c),w.get(_+1,x+1,c),p-x),u-_):w.get(_,x,c)}getElevationAtPixel(e,n,o){return this._dem.get(e,n,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Pi(1,e)*this._dem.stride}}let dO=l_.types,fO=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],pO=["fill-extrusion-flood-light-ground-radius"],mO=Math.pow(2,13),gO=Math.pow(2,15)-1,YE=new Je(0,1),Tl=2147483648;function Jf(t,e,n,o,c,u,p,_){t.emplaceBack((e<<1)+p,(n<<1)+u,(Math.floor(o*mO)<<1)+c,Math.round(_))}function d_(t,e,n,o,c,u){t.emplaceBack(e.x,e.y,(n.x<<1)+o,(n.y<<1)+c,u)}function ep(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class XE{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class KE{constructor(){this.centroidXY=new Je(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Je(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Je(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Je(this.max.x-this.min.x,this.max.y-this.min.y)}}class JE{constructor(){this.acc=new Je(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,o){this.accCount++,this.acc._add(n);let c=!!this.borders;n.x<e.min.x?(e.min.x=n.x,c=!0):n.x>e.max.x&&(e.max.x=n.x,c=!0),n.y<e.min.y?(e.min.y=n.y,c=!0):n.y>e.max.y&&(e.max.y=n.y,c=!0),((n.x===0||n.x===et)&&n.x===o.x)!=((n.y===0||n.y===et)&&n.y===o.y)&&this.processBorderOverlap(n,o),c&&this.checkBorderIntersection(n,o)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Zt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>et!=e.x>et&&this.addBorderIntersection(1,Zt(n.y,e.y,(et-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Zt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>et!=e.y>et&&this.addBorderIntersection(3,Zt(n.x,e.x,(et-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let o=this.borders[e];n<o[0]&&(o[0]=n),n>o[1]&&(o[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let o=e.x===0?0:1;this.addBorderIntersection(o,n.y),this.addBorderIntersection(o,e.y)}else{let o=e.y===0?2:3;this.addBorderIntersection(o,n.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new Je(0,0):new Je(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function eI(t,e){let n=t.add(e)._unit(),o=tn(t.x*n.x+t.y*n.y,-1,1);var c,u,p;return c=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(c)))/4*gO*((u=t).x*(p=e).y-u.y*p.x<0?-1:1)}let _O=[t=>t.x<0,t=>t.x>et,t=>t.y<0,t=>t.y>et];function yO(t,e,n,o){let c=[4];if(o===0)return c;n._mult(o);let u=t.sub(n),p=e.sub(n),_=[t,e,u,p];for(let x=0;x<4;x++)for(let w of _)if(_O[x](w)){c.push(x);break}return c}class tI{constructor(e){this.vertexArray=new xi,this.indexArray=new kr,this.programConfigurations=new gl(e.layers,e.zoom,n=>pO.includes(n)),this._segments=new br,this.hiddenByLandmarkVertexArray=new Cv,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new br}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,o,c=!1){let u=e.length;if(u>2){let p=Math.max(0,this._segments.get().length-1),_=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[p].length),x;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{let w=e[0],E=e[1];x=eI(w.sub(e[u-1])._perp()._unit(),E.sub(w)._perp()._unit())}for(let w=0;w<u;w++){let E=w===u-1?0:w+1,I=e[w],S=e[E],A=e[E===u-1?0:E+1],R=S.sub(I)._perp()._unit(),k=eI(R,A.sub(S)._perp()._unit()),z=x,j=k;if(ux(I,S,n)||c&&iI(I,n)&&iI(S,n)){x=k;continue}let W=_.vertexLength;d_(this.vertexArray,I,S,1,1,z),d_(this.vertexArray,I,S,1,0,z),d_(this.vertexArray,I,S,0,1,j),d_(this.vertexArray,I,S,0,0,j),_.vertexLength+=4;let X=yO(I,S,R,o);for(let Q of X)this._segmentToGroundQuads[p].push({id:W,region:Q}),this._segmentToRegionTriCounts[p][Q]+=2,_.primitiveLength+=2;x=k}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let o=0;o<n;o++)this._segmentToGroundQuads[o].sort((c,u)=>c.region-u.region);for(let o=0;o<n;o++){let c=this._segmentToGroundQuads[o],u=e[o],p=this._segmentToRegionTriCounts[o];p.reduce((x,w)=>x+w,0);let _=0;for(let x=0;x<=4;x++){let w=p[x];if(w!==0){let E=this.regionSegments[x];E||(E=this.regionSegments[x]=new br);let I={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+_,vertexLength:u.vertexLength,primitiveLength:w};E.get().push(I)}_+=w}for(let x=0;x<c.length;x++){let w=c[x].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,o,c,u,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,o,c,u,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,YR.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,o,c,u,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,o,c,u,p)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let o=e.flags&Tl?1:0;for(let c=e.groundVertexArrayOffset;c<n;++c)this.hiddenByLandmarkVertexArray.emplace(c,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,KR.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class f_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new kr,this.footprintVertices=new Yr,this.footprintSegments=[],this.layoutVertexArray=new Xr,this.centroidVertexArray=new qT,this.indexArray=new kr,this.programConfigurations=new gl(e.layers,e.zoom,n=>fO.includes(n)),this.segments=new br,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new tI(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,n,o,c){this.features=[],this.hasPattern=sx("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Wg(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:u,id:p,index:_,sourceLayerIndex:x}of e){let w=this.layers[0]._featureFilter.needGeometry,E=vl(u,w);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),E,o))continue;let I={id:p,sourceLayerIndex:x,index:_,geometry:w?E.geometry:va(u,o,c),properties:u.properties,type:u.type,patterns:{}},S=this.layoutVertexArray.length;this.hasPattern?this.features.push(ax("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,_,o,{},n.availableImages,c,n.brightness),n.featureIndex.insert(u,I.geometry,_,x,this.index,S)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,o,c,u,p){for(let _ of this.features){let{geometry:x}=_;this.addFeature(_,x,_.index,n,o,c,u,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,o,c,u){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let _=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,_,o,c,u),this.groundEffect.update(e,n,_,o,c,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,eO),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,JR.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,XR.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,c,u,p,_,x){let w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,E=[new Je(0,0),new Je(et,et)],I=_.projection,S=I.name==="globe",A=dO[e.type]==="Polygon",R=new JE;R.centroidDataIndex=this.centroidData.length;let k=new KE,z=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);k.height=j,k.vertexArrayOffset=this.layoutVertexArray.length,k.groundVertexArrayOffset=this.groundEffect.vertexArray.length,S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new vo);let W=ox(n,500);for(let ue=W.length-1;ue>=0;ue--){let _e=W[ue];(_e.length===0||(X=_e[0]).every(Ie=>Ie.x<=0)||X.every(Ie=>Ie.x>=et)||X.every(Ie=>Ie.y<=0)||X.every(Ie=>Ie.y>=et))&&W.splice(ue,1)}var X;let Q;if(S)Q=lI(W,E,c);else{Q=[];for(let ue of W)Q.push({polygon:ue,bounds:E})}let oe=A?this.edgeRadius:0,J=oe>0&&this.zoom<17,le=(ue,_e)=>{if(ue.length===0)return!1;let Ie=ue[ue.length-1];return _e.x===Ie.x&&_e.y===Ie.y};for(let{polygon:ue,bounds:_e}of Q){let Ie=0,ve=0;for(let Fe of ue)A&&!Fe[0].equals(Fe[Fe.length-1])&&Fe.push(Fe[0]),ve+=A?Fe.length-1:Fe.length;let Se=this.segments.prepareSegment((A?5:4)*ve,this.layoutVertexArray,this.indexArray);k.footprintSegIdx<0&&(k.footprintSegIdx=this.footprintSegments.length),k.polygonSegIdx<0&&(k.polygonSegIdx=this.polygonSegments.length);let Me={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},De=new XE;if(De.vertexOffset=this.footprintVertices.length,De.indexOffset=3*this.footprintIndices.length,De.ringIndices=[],A){let Fe=[],Le=[];Ie=Se.vertexLength;for(let Be=0;Be<ue.length;Be++){let Ce=ue[Be];Ce.length&&Be!==0&&Le.push(Fe.length/2);let ht=[],st,$e;st=Ce[1].sub(Ce[0])._perp()._unit(),De.ringIndices.push(Ce.length-1);for(let Et=1;Et<Ce.length;Et++){let gt=Ce[Et],dt=Ce[Et===Ce.length-1?1:Et+1],Ge=gt.clone();if(oe){$e=dt.sub(gt)._perp()._unit();let xt=st.add($e)._unit(),Vt=oe*Math.min(4,1/(st.x*xt.x+st.y*xt.y));Ge.x+=Vt*xt.x,Ge.y+=Vt*xt.y,Ge.x=Math.round(Ge.x),Ge.y=Math.round(Ge.y),st=$e}!z||oe!==0&&!J||le(ht,Ge)||ht.push(Ge),Jf(this.layoutVertexArray,Ge.x,Ge.y,0,0,1,1,0),Se.vertexLength++,this.footprintVertices.emplaceBack(gt.x,gt.y),Fe.push(gt.x,gt.y),S&&ep(this.layoutVertexExtArray,I.projectTilePoint(Ge.x,Ge.y,c),I.upVector(c,Ge.x,Ge.y))}z&&(oe===0||J)&&(ht.length!==0&&le(ht,ht[0])&&ht.pop(),this.groundEffect.addData(ht,_e,w))}let Ve=s_(Fe,Le);for(let Be=0;Be<Ve.length;Be+=3)this.footprintIndices.emplaceBack(De.vertexOffset+Ve[Be+0],De.vertexOffset+Ve[Be+1],De.vertexOffset+Ve[Be+2]),this.indexArray.emplaceBack(Ie+Ve[Be],Ie+Ve[Be+2],Ie+Ve[Be+1]),Se.primitiveLength++;De.indexCount+=Ve.length,De.vertexCount+=this.footprintVertices.length-De.vertexOffset}for(let Fe=0;Fe<ue.length;Fe++){let Le=ue[Fe];R.startRing(k,Le[0]);let Ve=Le.length>4&&oI(Le[Le.length-2],Le[0],Le[1]),Be=oe?vO(Le[Le.length-2],Le[0],Le[1],oe):0,Ce=[],ht,st,$e;st=Le[1].sub(Le[0])._perp()._unit();let Et=!0;for(let gt=1,dt=0;gt<Le.length;gt++){let Ge=Le[gt-1],xt=Le[gt],Vt=Le[gt===Le.length-1?1:gt+1];if(R.appendEdge(k,xt,Ge),ux(xt,Ge,_e)){oe&&(st=Vt.sub(xt)._perp()._unit(),Et=!Et);continue}let St=xt.sub(Ge)._perp(),Ht=St.x/(Math.abs(St.x)+Math.abs(St.y)),Ut=St.y>0?1:0,Jt=Ge.dist(xt);if(dt+Jt>32768&&(dt=0),oe){$e=Vt.sub(xt)._perp()._unit();let gn=rI(Ge,xt,Vt,nI(st,$e),oe);isNaN(gn)&&(gn=0);let un=xt.sub(Ge)._unit();Ge=Ge.add(un.mult(Be))._round(),xt=xt.add(un.mult(-gn))._round(),Be=gn,st=$e,z&&this.zoom>=17&&(le(Ce,Ge)||Ce.push(Ge),le(Ce,xt)||Ce.push(xt))}let Dt=Se.vertexLength,Nn=Le.length>4&&oI(Ge,xt,Vt),Rn=sI(dt,Ve,Et);if(Jf(this.layoutVertexArray,Ge.x,Ge.y,Ht,Ut,0,0,Rn),Jf(this.layoutVertexArray,Ge.x,Ge.y,Ht,Ut,0,1,Rn),dt+=Jt,Rn=sI(dt,Nn,!Et),Ve=Nn,Jf(this.layoutVertexArray,xt.x,xt.y,Ht,Ut,0,0,Rn),Jf(this.layoutVertexArray,xt.x,xt.y,Ht,Ut,0,1,Rn),Se.vertexLength+=4,this.indexArray.emplaceBack(Dt+0,Dt+1,Dt+2),this.indexArray.emplaceBack(Dt+1,Dt+3,Dt+2),Se.primitiveLength+=2,oe){let gn=Ie+(gt===1?Le.length-2:gt-2),un=gt===1?Ie:gn+1;if(this.indexArray.emplaceBack(Dt+1,gn,Dt+3),this.indexArray.emplaceBack(gn,un,Dt+3),Se.primitiveLength+=2,ht===void 0&&(ht=Dt),!ux(Vt,Le[gt],_e)){let _n=gt===Le.length-1?ht:Se.vertexLength;this.indexArray.emplaceBack(Dt+2,Dt+3,_n),this.indexArray.emplaceBack(Dt+3,_n+1,_n),this.indexArray.emplaceBack(Dt+3,un,_n+1),Se.primitiveLength+=3}Et=!Et}if(S){let gn=this.layoutVertexExtArray,un=I.projectTilePoint(Ge.x,Ge.y,c),_n=I.projectTilePoint(xt.x,xt.y,c),Qn=I.upVector(c,Ge.x,Ge.y),Gn=I.upVector(c,xt.x,xt.y);ep(gn,un,Qn),ep(gn,un,Qn),ep(gn,_n,Gn),ep(gn,_n,Gn)}}A&&(Ie+=Le.length-1),z&&oe&&this.zoom>=17&&(Ce.length!==0&&le(Ce,Ce[0])&&Ce.pop(),this.groundEffect.addData(Ce,_e,w,oe>0))}this.footprintSegments.push(De),Me.triangleCount=this.indexArray.length-Me.triangleArrayOffset,this.polygonSegments.push(Me),++k.footprintSegLen,++k.polygonSegLen}if(k.vertexCount=this.layoutVertexArray.length-k.vertexArrayOffset,k.groundVertexCount=this.groundEffect.vertexArray.length-k.groundVertexArrayOffset,k.vertexCount!==0){if(k.centroidXY=R.borders?YE:this.encodeCentroid(R,k),this.centroidData.push(k),R.borders){this.featuresOnBorder.push(R);let ue=this.featuresOnBorder.length-1;for(let _e=0;_e<R.borders.length;_e++)R.borders[_e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[_e].push(ue)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,p,c,x),this.groundEffect.addPaintPropertiesData(e,o,u,p,c,x),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,o)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){let e=[];for(let _=0;_<this.centroidData.length;_++){let x=this.centroidData[_],w=+(x.min.y+x.max.y>et),E=2*w+(+(x.min.x+x.max.x>et)^w);for(let I=0;I<x.polygonSegLen;I++){let S=x.polygonSegIdx+I;e.push({centroidIdx:_,subtile:E,polygonSegmentIdx:S,triangleSegmentIdx:this.polygonSegments[S].triangleSegIdx})}}let n=new kr;e.sort((_,x)=>_.triangleSegmentIdx===x.triangleSegmentIdx?_.subtile-x.subtile:_.triangleSegmentIdx-x.triangleSegmentIdx);let o=0,c=0,u=0;for(let _ of e){if(_.triangleSegmentIdx!==o)break;u++}let p=e.length;for(;c!==e.length;){o=e[c].triangleSegmentIdx;let _=0,x=c,w=c;for(let E=x;E<u&&e[E].subtile===_;E++)w++;for(;x!==u;){let E=e[x];_=E.subtile;let I=this.centroidData[E.centroidIdx].min.clone(),S=this.centroidData[E.centroidIdx].max.clone(),A={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=x;R<w;R++){let k=e[R],z=this.polygonSegments[k.polygonSegmentIdx],j=this.centroidData[k.centroidIdx].min,W=this.centroidData[k.centroidIdx].max,X=this.indexArray.uint16;for(let Q=z.triangleArrayOffset;Q<z.triangleArrayOffset+z.triangleCount;Q++)n.emplaceBack(X[3*Q],X[3*Q+1],X[3*Q+2]);A.primitiveLength+=z.triangleCount,I.x=Math.min(I.x,j.x),I.y=Math.min(I.y,j.y),S.x=Math.max(S.x,W.x),S.y=Math.max(S.y,W.y)}A.primitiveLength>0&&this.triangleSubSegments.push({segment:A,min:I,max:S}),x=w;for(let R=x;R<u&&e[R].subtile===e[x].subtile;R++)w++}c=u;for(let E=c;E<p&&e[E].triangleSegmentIdx===e[c].triangleSegmentIdx;E++)u++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,o){let c=0,u=0,p=1<<e.canonical.z;if(n){let k=n.getMinMaxForTile(e);k&&(c=k.min,u=k.max)}u+=this.maxHeight;let _=e.toUnwrapped(),x,w=[_.canonical.x/p+_.wrap,_.canonical.y/p],E=[(_.canonical.x+1)/p+_.wrap,(_.canonical.y+1)/p],I=new br,S=(k,z,j)=>[k[0]*(1-j[0])+z[0]*j[0],k[1]*(1-j[1])+z[1]*j[1]],A=[],R=[];for(let k of this.triangleSubSegments){A[0]=k.min.x/et,A[1]=k.min.y/et,R[0]=k.max.x/et,R[1]=k.max.y/et;let z=S(w,E,A),j=S(w,E,R);if(new tr([z[0],z[1],c],[j[0],j[1],u]).intersectsPrecise(o)===0){x&&(I.segments.push(x),x=void 0);continue}let W=k.segment;x&&x.vertexOffset!==W.vertexOffset&&(I.segments.push(x),x=void 0),x?(x.vertexLength+=W.vertexLength,x.primitiveLength+=W.primitiveLength):x={vertexOffset:W.vertexOffset,primitiveLength:W.primitiveLength,vertexLength:W.vertexLength,primitiveOffset:W.primitiveOffset,sortKey:void 0,vaos:{}}}return x&&I.segments.push(x),I}encodeCentroid(e,n){let o=e.centroid(),c=n.span(),u=Math.min(7,Math.round(c.x*this.tileToMeter/10)),p=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new Je(tn(o.x,1,et-1)<<3|u,tn(o.y,1,et-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new Je(0,0);let n=e.borders,o=Number.MAX_VALUE;if(n[0][0]!==o||n[1][0]!==o){let c=n[0][0]!==o?0:1;return new Je(6|(n[0][0]!==o?0:65528),(n[c][0]+n[c][1])/2<<3|6)}{let c=n[2][0]!==o?2:3;return new Je((n[c][0]+n[c][1])/2<<3|6,6|(n[2][0]!==o?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=Tl,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,c=e.flags&Tl?YE:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==c.y||u!==c.x){for(let p=n;p<o;++p)this.centroidVertexArray.emplace(p,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let o=n.getReplacementRegionsForTile(e.toUnwrapped());if(function(u,p){if(u.length!==p.length)return!1;for(let _=0;_<u.length;_++)if(u[_].sourceId!==p[_].sourceId||!zE(u[_],p[_]))return!1;return!0}(this.activeReplacements,o))return;if(this.activeReplacements=o,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let u of this.centroidData)u.flags&=2147483647;let c=[];for(let u of this.activeReplacements){let p=Math.pow(2,u.footprintTileId.canonical.z-e.canonical.z);for(let _ of this.centroidData)if(!(_.flags&Tl||u.min.x>_.max.x||_.min.x>u.max.x||u.min.y>_.max.y||_.min.y>u.max.y))for(let x=0;x<_.footprintSegLen;x++){let w=this.footprintSegments[_.footprintSegIdx+x];if(c.length=0,xO(this.footprintVertices,w.vertexOffset,w.vertexCount,u.footprintTileId.canonical,e.canonical,c),VE(u.footprint,c,this.footprintIndices.uint16,w.indexOffset,w.indexCount,-w.vertexOffset,-p)){_.flags|=Tl;break}}}for(let u of this.centroidData)this.writeCentroidToBuffer(u);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,o){let c=!1;for(let u=0;u<o.footprintSegLen;u++){let p=this.footprintSegments[o.footprintSegIdx+u],_=0;for(let x of p.ringIndices){for(let w=_,E=x+_-1;w<x+_;E=w++){let I=this.footprintVertices.int16[2*(w+p.vertexOffset)+0],S=this.footprintVertices.int16[2*(w+p.vertexOffset)+1],A=this.footprintVertices.int16[2*(E+p.vertexOffset)+1];S>n!=A>n&&e<(this.footprintVertices.int16[2*(E+p.vertexOffset)+0]-I)*(n-S)/(A-S)+I&&(c=!c)}_=x}}return c}getHeightAtTileCoord(e,n){let o=Number.NEGATIVE_INFINITY,c=!0,u=4*(e+et)*et+(n+et);if(this.partLookup.hasOwnProperty(u)){let p=this.partLookup[u];return p?{height:p.height,hidden:!!(p.flags&Tl)}:void 0}for(let p of this.centroidData)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||this.footprintContainsPoint(e,n,p)&&p&&p.height>o&&(o=p.height,this.partLookup[u]=p,c=!!(p.flags&Tl));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:c};this.partLookup[u]=void 0}}function nI(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function vO(t,e,n,o){let c=e.sub(t)._perp()._unit(),u=n.sub(e)._perp()._unit();return rI(t,e,n,nI(c,u),o)}function rI(t,e,n,o,c){let u=Math.sqrt(1-o*o);return Math.min(t.dist(e)/3,e.dist(n)/3,c*u/o)}function ux(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function iI(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function oI(t,e,n){if(t.x<0||t.x>=et||e.x<0||e.x>=et||n.x<0||n.x>=et)return!1;let o=n.sub(e),c=o.perp(),u=t.sub(e);return(o.x*u.x+o.y*u.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(u.x*u.x+u.y*u.y))>-.866&&c.x*u.x+c.y*u.y<0}function sI(t,e,n){let o=e?2|t:-3&t;return n?1|o:-2&o}function aI(){let t=Math.PI/32,e=Math.tan(t),n=Dh;return n*Math.sqrt(1+2*e*e)-n}function lI(t,e,n){let o=1<<n.z,c=eo(n.x/o),u=eo((n.x+1)/o),p=Kr(n.y/o),_=Kr((n.y+1)/o);return function(x,w,E,I,S=0,A){let R=[];if(!x.length||!E||!I)return R;let k=(J,le)=>{for(let ue of J)R.push({polygon:ue,bounds:le})},z=Math.ceil(Math.log2(E)),j=Math.ceil(Math.log2(I)),W=z-j,X=[];for(let J=0;J<Math.abs(W);J++)X.push(W>0?0:1);for(let J=0;J<Math.min(z,j);J++)X.push(0),X.push(1);let Q=x;if(Q=c_(Q,w[0].y-S,w[1].y+S,1),Q=c_(Q,w[0].x-S,w[1].x+S,0),!Q.length)return R;let oe=[];for(X.length?oe.push({polygons:Q,bounds:w,depth:0}):k(Q,w);oe.length;){let J=oe.pop(),le=J.depth,ue=X[le],_e=J.bounds[0],Ie=J.bounds[1],ve=ue===0?_e.x:_e.y,Se=ue===0?Ie.x:Ie.y,Me=A?A(ue,ve,Se):.5*(ve+Se),De=c_(J.polygons,ve-S,Me+S,ue),Fe=c_(J.polygons,Me-S,Se+S,ue);if(De.length){let Le=[_e,new Je(ue===0?Me:Ie.x,ue===1?Me:Ie.y)];X.length>le+1?oe.push({polygons:De,bounds:Le,depth:le+1}):k(De,Le)}if(Fe.length){let Le=[new Je(ue===0?Me:_e.x,ue===1?Me:_e.y),Ie];X.length>le+1?oe.push({polygons:Fe,bounds:Le,depth:le+1}):k(Fe,Le)}}return R}(t,e,Math.ceil((u-c)/11.25),Math.ceil((p-_)/11.25),1,(x,w,E)=>{if(x===0)return .5*(w+E);{let I=Kr((n.y+w/et)/o);return(ya(.5*(Kr((n.y+E/et)/o)+I))*o-n.y)*et}})}function xO(t,e,n,o,c,u){let p=Math.pow(2,o.z-c.z);for(let _=0;_<n;_++){let x=t.int16[2*(_+e)+0],w=t.int16[2*(_+e)+1];x=(x+c.x*et)*p-o.x*et,w=(w+c.y*et)*p-o.y*et,u.push(new Je(x,w))}}lt(f_,"FillExtrusionBucket",{omit:["layers","features"]}),lt(KE,"PartData"),lt(XE,"FootprintSegment"),lt(JE,"BorderCentroidData"),lt(tI,"GroundEffect");let bO=new me({visibility:new he(ne["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new he(ne["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var wO={paint:new me({"fill-extrusion-opacity":new he(ne["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ye(ne["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new he(ne["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new he(ne["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ye(ne["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ye(ne["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ye(ne["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new he(ne["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new he(ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new he(ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new he(ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new he(ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new he(ne["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new he(ne["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new he(ne["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ye(ne["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ye(ne["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new he(ne["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new he(ne["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new he(ne["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new he(ne["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new he(ne["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:bO};class Rh extends Je{constructor(e,n,o){super(e,n),this.z=o}}function tp(t,e){return t.x*e.x+t.y*e.y}function cI(t,e){if(t.length===1){let n=0,o=e[n++],c;for(;!c||o.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){let u=e[n],p=t[0],_=c.sub(o),x=u.sub(o),w=p.sub(o),E=tp(_,_),I=tp(_,x),S=tp(x,x),A=tp(w,_),R=tp(w,x),k=E*S-I*I,z=(S*A-I*R)/k,j=(E*R-I*A)/k,W=o.z*(1-z-j)+c.z*z+u.z*j;if(isFinite(W))return W}return 1/0}{let n=1/0;for(let o of e)n=Math.min(n,o.z);return n}}function uI(t,e,n,o,c,u,p,_){let x=p*c.getElevationAt(t,e,!0,!0),w=u[0]!==0,E=w?u[1]===0?p*(u[0]/7-450):p*function(I,S,A){let R=Math.floor(S[0]/8),k=Math.floor(S[1]/8),z=10*(S[0]-8*R),j=10*(S[1]-8*k),W=I.getElevationAt(R,k,!0,!0),X=I.getMeterToDEM(A),Q=Math.floor(.5*(z*X-1)),oe=Math.floor(.5*(j*X-1)),J=I.tileCoordToPixel(R,k),le=2*Q+1,ue=2*oe+1,_e=function(Fe,Le,Ve,Be,Ce){return[Fe.getElevationAtPixel(Le,Ve,!0),Fe.getElevationAtPixel(Le+Ce,Ve,!0),Fe.getElevationAtPixel(Le,Ve+Ce,!0),Fe.getElevationAtPixel(Le+Be,Ve+Ce,!0)]}(I,J.x-Q,J.y-oe,le,ue),Ie=Math.abs(_e[0]-_e[1]),ve=Math.abs(_e[2]-_e[3]),Se=Math.abs(_e[0]-_e[2])+Math.abs(_e[1]-_e[3]),Me=Math.min(.25,.5*X*(Ie+ve)/le),De=Math.min(.25,.5*X*Se/ue);return W+Math.max(Me*z,De*j)}(c,u,_):x;return{base:x+(n===0)?-1:n,top:w?Math.max(E+o,x+n+2):x+o}}let TO=Bt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:EO}=TO,IO=Bt([{name:"a_packed",components:4,type:"Float32"}]),{members:DO}=IO,MO=Bt([{name:"a_pattern_data",components:2,type:"Float32"}]),{members:SO}=MO;class hI{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new bl({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let o=this.getKey(e,n);return this.positions[o]}trim(){let e=this.width,n=this.height=Zd(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,o){let c=[],u=e.length%2==1?-e[e.length-1]*o:0,p=e[0]*o,_=!0;c.push({left:u,right:p,isDash:_,zeroLength:e[0]===0});let x=e[0];for(let w=1;w<e.length;w++){_=!_;let E=e[w];u=x*o,x+=E,p=x*o,c.push({left:u,right:p,isDash:_,zeroLength:E===0})}return c}addRoundDash(e,n,o){let c=n/2;for(let u=-o;u<=o;u++){let p=this.width*(this.nextRow+o+u),_=0,x=e[_];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++_]);let E=Math.abs(w-x.left),I=Math.abs(w-x.right),S=Math.min(E,I),A,R=u/o*(c+1);if(x.isDash){let k=c-Math.abs(R);A=Math.sqrt(S*S+k*k)}else A=c-Math.sqrt(S*S+R*R);this.image.data[p+w]=Math.max(0,Math.min(255,A+128))}}}addRegularDash(e,n){for(let x=e.length-1;x>=0;--x){let w=e[x],E=e[x+1];w.zeroLength?e.splice(x,1):E&&E.isDash===w.isDash&&(E.left=w.left,e.splice(x,1))}let o=e[0],c=e[e.length-1];o.isDash===c.isDash&&(o.left=c.left-this.width,c.right=o.right+this.width);let u=this.width*this.nextRow,p=0,_=e[p];for(let x=0;x<this.width;x++){x/_.right>1&&(_=e[++p]);let w=Math.abs(x-_.left),E=Math.abs(x-_.right),I=Math.min(w,E);this.image.data[u+x]=Math.max(0,Math.min(255,(_.isDash?I:-I)+n+128))}}addDash(e,n){let o=this.getKey(e,n);if(this.positions[o])return this.positions[o];let c=n==="round",u=c?7:0,p=2*u+1;if(this.nextRow+p>this.height)return dr("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let E=0;E<e.length;E++)e[E]<0&&(dr("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),_+=e[E];if(_!==0){let E=this.width/_,I=this.getDashRanges(e,this.width,E);c?this.addRoundDash(I,E,u):this.addRegularDash(I,n==="square"?.5*E:0)}let x=this.nextRow+u;this.nextRow+=p;let w={tl:[x,u],br:[_,0]};return this.positions[o]=w,w}}lt(hI,"LineAtlas");let CO=l_.types,AO=Math.cos(Math.PI/180*37.5),PO=Math.cos(Math.PI/180*5);class hx{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new oi,this.layoutVertexArray2=new Lr,this.patternVertexArray=new Ur,this.indexArray=new kr,this.programConfigurations=new gl(e.layers,e.zoom),this.segments=new br,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o,c){this.hasPattern=sx("line",this.layers,n);let u=this.layers[0].layout.get("line-sort-key"),p=[];for(let{feature:E,id:I,index:S,sourceLayerIndex:A}of e){let R=this.layers[0]._featureFilter.needGeometry,k=vl(E,R);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),k,o))continue;let z=u?u.evaluate(k,{},o):void 0,j={id:I,properties:E.properties,type:E.type,sourceLayerIndex:A,index:S,geometry:R?k.geometry:va(E,o,c),patterns:{},sortKey:z};p.push(j)}u&&p.sort((E,I)=>E.sortKey-I.sortKey);let{lineAtlas:_,featureIndex:x}=n,w=this.addConstantDashes(_);for(let E of p){let{geometry:I,index:S,sourceLayerIndex:A}=E;if(w&&this.addFeatureDashes(E,_),this.hasPattern){let R=ax("line",this.layers,E,this.zoom,n);this.patternFeatures.push(R)}else this.addFeature(E,I,S,o,_.positions,n.availableImages,n.brightness);x.insert(e[S].feature,I,S,A,this.index)}}addConstantDashes(e){let n=!1;for(let o of this.layers){let c=o.paint.get("line-dasharray").value,u=o.layout.get("line-cap").value;if(c.kind!=="constant"||u.kind!=="constant")n=!0;else{let p=u.value,_=c.value;if(!_)continue;e.addDash(_,p)}}return n}addFeatureDashes(e,n){let o=this.zoom;for(let c of this.layers){let u=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(u.kind==="constant"&&p.kind==="constant")continue;let _,x;if(u.kind==="constant"){if(_=u.value,!_)continue}else _=u.evaluate({zoom:o},e);x=p.kind==="constant"?p.value:p.evaluate({zoom:o},e),n.addDash(_,x),e.patterns[c.id]=n.getKey(_,x)}}update(e,n,o,c,u){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,o,c,u)}addFeatures(e,n,o,c,u,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,o,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,DO)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,SO)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,EO),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,c,u,p,_){let x=this.layers[0].layout,w=x.get("line-join").evaluate(e,{}),E=x.get("line-cap").evaluate(e,{}),I=x.get("line-miter-limit"),S=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let A of n)this.addLine(A,e,w,E,I,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,p,c,_)}addLine(e,n,o,c,u,p){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0;let _=o==="none";if(this.patternJoinNone=this.hasPattern&&_,this.segmentStart=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let W=0;W<e.length-1;W++)this.totalDistance+=e[W].dist(e[W+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let x=CO[n.type]==="Polygon",w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let E=0;for(;E<w-1&&e[E].equals(e[E+1]);)E++;if(w<(x?3:2))return;o==="bevel"&&(u=1.05);let I=this.overscaling<=16?15*et/(512*this.overscaling):0,S=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray),A,R,k,z,j;this.e1=this.e2=-1,x&&(A=e[w-2],j=e[E].sub(A)._unit()._perp());for(let W=E;W<w;W++){if(k=W===w-1?x?e[E+1]:void 0:e[W+1],k&&e[W].equals(k))continue;j&&(z=j),A&&(R=A),A=e[W],j=k?k.sub(A)._unit()._perp():z,z=z||j;let X=R&&k,Q=X?o:x||_?"butt":c,oe=z.x*j.x+z.y*j.y;if(_){let Se=function(Me){if(Me.patternJoinNone){let De=Me.segmentPoints.length/2,Fe=Me.lineSoFar-Me.segmentStart;for(let Le=0;Le<De;++Le){let Ve=Me.segmentPoints[2*Le+1],Be=Math.round(Me.segmentPoints[2*Le])+.5+.25*Ve;Me.patternVertexArray.emplaceBack(Be,Fe),Me.patternVertexArray.emplaceBack(Be,Fe)}Me.segmentPoints=[],Me.segmentStart=Me.lineSoFar}Me.e1=Me.e2=-1};if(X&&oe<PO){this.updateDistance(R,A),this.addCurrentVertex(A,z,1,1,S),Se(this),this.addCurrentVertex(A,j,-1,-1,S);continue}if(R){if(!k){this.updateDistance(R,A),this.addCurrentVertex(A,z,1,1,S),Se(this);continue}Q="miter"}}let J=z.add(j);J.x===0&&J.y===0||J._unit();let le=J.x*j.x+J.y*j.y,ue=le!==0?1/le:1/0,_e=2*Math.sqrt(2-2*le),Ie=le<AO&&R&&k,ve=z.x*j.y-z.y*j.x>0;if(Ie&&W>E){let Se=A.dist(R);if(Se>2*I){let Me=A.sub(A.sub(R)._mult(I/Se)._round());this.updateDistance(R,Me),this.addCurrentVertex(Me,z,0,0,S),R=Me}}if(X&&Q==="round"&&(ue<p?Q="miter":ue<=2&&(Q="fakeround")),Q==="miter"&&ue>u&&(Q="bevel"),Q==="bevel"&&(ue>2&&(Q="flipbevel"),ue<u&&(Q="miter")),R&&this.updateDistance(R,A),Q==="miter")J._mult(ue),this.addCurrentVertex(A,J,0,0,S);else if(Q==="flipbevel"){if(ue>100)J=j.mult(-1);else{let Se=ue*z.add(j).mag()/z.sub(j).mag();J._perp()._mult(Se*(ve?-1:1))}this.addCurrentVertex(A,J,0,0,S),this.addCurrentVertex(A,J.mult(-1),0,0,S)}else if(Q==="bevel"||Q==="fakeround"){let Se=-Math.sqrt(ue*ue-1),Me=ve?Se:0,De=ve?0:Se;if(R&&this.addCurrentVertex(A,z,Me,De,S),Q==="fakeround"){let Fe=Math.round(180*_e/Math.PI/20);for(let Le=1;Le<Fe;Le++){let Ve=Le/Fe;if(Ve!==.5){let Ce=Ve-.5;Ve+=Ve*Ce*(Ve-1)*((1.0904+oe*(oe*(3.55645-1.43519*oe)-3.2452))*Ce*Ce+(.848013+oe*(.215638*oe-1.06021)))}let Be=j.sub(z)._mult(Ve)._add(z)._unit()._mult(ve?-1:1);this.addHalfVertex(A,Be.x,Be.y,!1,ve,0,S)}}k&&this.addCurrentVertex(A,j,-Me,-De,S)}else Q==="butt"?this.addCurrentVertex(A,J,0,0,S):Q==="square"?(R||this.addCurrentVertex(A,J,-1,-1,S),this.addCurrentVertex(A,J,0,0,S),R&&this.addCurrentVertex(A,J,1,1,S)):Q==="round"&&(R&&(this.addCurrentVertex(A,z,0,0,S),this.addCurrentVertex(A,z,1,1,S,!0)),k&&(this.addCurrentVertex(A,j,-1,-1,S,!0),this.addCurrentVertex(A,j,0,0,S)));if(Ie&&W<w-1){let Se=A.dist(k);if(Se>2*I){let Me=A.add(k.sub(A)._mult(I/Se)._round());this.updateDistance(A,Me),this.addCurrentVertex(Me,j,0,0,S),A=Me}}}}addCurrentVertex(e,n,o,c,u,p=!1){let _=n.y*c-n.x,x=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,p,!1,o,u),this.addHalfVertex(e,_,x,p,!0,-c,u),this.patternJoinNone&&this.segmentPoints.push(this.lineSoFar-this.segmentStart,o)}addHalfVertex({x:e,y:n},o,c,u,p,_,x){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(n<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let w=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),x.primitiveLength++),p?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}lt(hx,"LineBucket",{omit:["layers","patternFeatures"]});let RO=new me({"line-cap":new ye(ne.layout_line["line-cap"]),"line-join":new ye(ne.layout_line["line-join"]),"line-miter-limit":new he(ne.layout_line["line-miter-limit"]),"line-round-limit":new he(ne.layout_line["line-round-limit"]),"line-sort-key":new ye(ne.layout_line["line-sort-key"]),visibility:new he(ne.layout_line.visibility)});var dI={paint:new me({"line-opacity":new ye(ne.paint_line["line-opacity"]),"line-color":new ye(ne.paint_line["line-color"]),"line-translate":new he(ne.paint_line["line-translate"]),"line-translate-anchor":new he(ne.paint_line["line-translate-anchor"]),"line-width":new ye(ne.paint_line["line-width"]),"line-gap-width":new ye(ne.paint_line["line-gap-width"]),"line-offset":new ye(ne.paint_line["line-offset"]),"line-blur":new ye(ne.paint_line["line-blur"]),"line-dasharray":new ye(ne.paint_line["line-dasharray"]),"line-pattern":new ye(ne.paint_line["line-pattern"]),"line-gradient":new ze(ne.paint_line["line-gradient"]),"line-trim-offset":new he(ne.paint_line["line-trim-offset"]),"line-emissive-strength":new he(ne.paint_line["line-emissive-strength"]),"line-border-width":new ye(ne.paint_line["line-border-width"]),"line-border-color":new ye(ne.paint_line["line-border-color"])}),layout:RO};function fI(t,e,n){return e*(et/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function pI(t,e){return 1/fI(t,1,e.tileZoom)}function mI(t,e,n,o){return t.translatePosMatrix(o||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let gI=t=>{let e=[];_I(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let o=t.layout.get("line-join").constantOr("miter")==="none",c=!!t.paint.get("line-pattern").constantOr(1);return o&&c&&e.push("LINE_JOIN_NONE"),e};function _I(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let yI=new class extends ye{possiblyEvaluate(t,e){return e=new H(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,o){return e=Xi({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,o)}}(dI.paint.properties["line-width"].specification);function vI(t,e){return e>0?e+2*t:t}yI.useIntegerZoom=!0;let OO=Bt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),LO=Bt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),kO=Bt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Bt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let FO=Bt([{name:"a_z_offset",components:1,type:"Float32"}],4),NO=Bt([{name:"a_texb",components:2,type:"Uint16"}]),zO=Bt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),BO=Bt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Bt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let xI=Bt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),jO=Bt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Bt([{name:"triangle",components:3,type:"Uint16"}]),Bt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Bt([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Bt([{type:"Float32",name:"offsetX"}]),Bt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Jr=24;let os=128;function dx(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new H(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:o,interpolationType:c}=n,u=0;for(;u<o.length&&o[u]<=t;)u++;u=Math.max(0,u-1);let p=u;for(;p<o.length&&o[p]<t+1;)p++;p=Math.min(o.length-1,p);let _=o[u],x=o[p];return n.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:x,minSize:n.evaluate(new H(_)),maxSize:n.evaluate(new H(x)),interpolationType:c}}}function p_(t,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:c}){return t.kind==="source"?o/os:t.kind==="composite"?Zt(o/os,c/os,n):e}function Oh(t,e){let n=0,o=0;if(t.kind==="constant")o=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:c,minZoom:u,maxZoom:p}=t,_=c?tn($i.interpolationFactor(c,e,u,p),0,1):0;t.kind==="camera"?o=Zt(t.minSize,t.maxSize,_):n=_}return{uSizeT:n,uSize:o}}var VO=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:os,evaluateSizeForFeature:p_,evaluateSizeForZoom:Oh,getSizeData:dx});function UO(t,e,n){return t.sections.forEach(o=>{o.text=function(c,u,p){let _=u.layout.get("text-transform").evaluate(p,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),re.applyArabicShaping&&(c=re.applyArabicShaping(c)),c}(o.text,e,n)}),t}let np={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function $O(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function GO(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var HO={read:function(t,e,n,o,c){var u,p,_=8*c-o-1,x=(1<<_)-1,w=x>>1,E=-7,I=n?c-1:0,S=n?-1:1,A=t[e+I];for(I+=S,u=A&(1<<-E)-1,A>>=-E,E+=_;E>0;u=256*u+t[e+I],I+=S,E-=8);for(p=u&(1<<-E)-1,u>>=-E,E+=o;E>0;p=256*p+t[e+I],I+=S,E-=8);if(u===0)u=1-w;else{if(u===x)return p?NaN:1/0*(A?-1:1);p+=Math.pow(2,o),u-=w}return(A?-1:1)*p*Math.pow(2,u-o)},write:function(t,e,n,o,c,u){var p,_,x,w=8*u-c-1,E=(1<<w)-1,I=E>>1,S=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=o?0:u-1,R=o?1:-1,k=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,p=E):(p=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-p))<1&&(p--,x*=2),(e+=p+I>=1?S/x:S*Math.pow(2,1-I))*x>=2&&(p++,x/=2),p+I>=E?(_=0,p=E):p+I>=1?(_=(e*x-1)*Math.pow(2,c),p+=I):(_=e*Math.pow(2,I-1)*Math.pow(2,c),p=0));c>=8;t[n+A]=255&_,A+=R,_/=256,c-=8);for(p=p<<c|_,w+=c;w>0;t[n+A]=255&p,A+=R,p/=256,w-=8);t[n+A-R]|=128*k}},bI=nr,m_=HO;function nr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}nr.Varint=0,nr.Fixed64=1,nr.Bytes=2,nr.Fixed32=5;var fx=4294967296,wI=1/fx,TI=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ba(t){return t.type===nr.Bytes?t.readVarint()+t.pos:t.pos+1}function Lh(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function EI(t,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=t;c--)n.buf[c+o]=n.buf[c]}function qO(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function WO(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function ZO(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function QO(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function YO(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function XO(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function KO(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function JO(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function eL(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function g_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function kh(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function II(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}nr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,u=this.pos;this.type=7&o,t(c,e,this),this.pos===u&&this.skip(o)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=g_(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=II(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=g_(this.buf,this.pos)+g_(this.buf,this.pos+4)*fx;return this.pos+=8,t},readSFixed64:function(){var t=g_(this.buf,this.pos)+II(this.buf,this.pos+4)*fx;return this.pos+=8,t},readFloat:function(){var t=m_.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=m_.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(c,u,p){var _,x,w=p.buf;if(_=(112&(x=w[p.pos++]))>>4,x<128||(_|=(127&(x=w[p.pos++]))<<3,x<128)||(_|=(127&(x=w[p.pos++]))<<10,x<128)||(_|=(127&(x=w[p.pos++]))<<17,x<128)||(_|=(127&(x=w[p.pos++]))<<24,x<128)||(_|=(1&(x=w[p.pos++]))<<31,x<128))return Lh(c,_,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&TI?function(n,o,c){return TI.decode(n.subarray(o,c))}(this.buf,e,t):function(n,o,c){for(var u="",p=o;p<c;){var _,x,w,E=n[p],I=null,S=E>239?4:E>223?3:E>191?2:1;if(p+S>c)break;S===1?E<128&&(I=E):S===2?(192&(_=n[p+1]))==128&&(I=(31&E)<<6|63&_)<=127&&(I=null):S===3?(x=n[p+2],(192&(_=n[p+1]))==128&&(192&x)==128&&((I=(15&E)<<12|(63&_)<<6|63&x)<=2047||I>=55296&&I<=57343)&&(I=null)):S===4&&(x=n[p+2],w=n[p+3],(192&(_=n[p+1]))==128&&(192&x)==128&&(192&w)==128&&((I=(15&E)<<18|(63&_)<<12|(63&x)<<6|63&w)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,S=1):I>65535&&(I-=65536,u+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),u+=String.fromCharCode(I),p+=S}return u}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==nr.Bytes)return t.push(this.readVarint(e));var n=ba(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==nr.Bytes)return t.push(this.readSVarint());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==nr.Bytes)return t.push(this.readBoolean());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==nr.Bytes)return t.push(this.readFloat());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==nr.Bytes)return t.push(this.readDouble());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==nr.Bytes)return t.push(this.readFixed32());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==nr.Bytes)return t.push(this.readSFixed32());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==nr.Bytes)return t.push(this.readFixed64());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==nr.Bytes)return t.push(this.readSFixed64());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===nr.Varint)for(;this.buf[this.pos++]>127;);else if(e===nr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===nr.Fixed32)this.pos+=4;else{if(e!==nr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),kh(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),kh(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),kh(this.buf,-1&t,this.pos),kh(this.buf,Math.floor(t*wI),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),kh(this.buf,-1&t,this.pos),kh(this.buf,Math.floor(t*wI),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(u,p,_){_.buf[_.pos++]=127&u|128,u>>>=7,_.buf[_.pos++]=127&u|128,u>>>=7,_.buf[_.pos++]=127&u|128,u>>>=7,_.buf[_.pos++]=127&u|128,_.buf[_.pos]=127&(u>>>=7)}(o,0,n),function(u,p){var _=(7&u)<<4;p.buf[p.pos++]|=_|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(c,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(o,c,u){for(var p,_,x=0;x<c.length;x++){if((p=c.charCodeAt(x))>55295&&p<57344){if(!_){p>56319||x+1===c.length?(o[u++]=239,o[u++]=191,o[u++]=189):_=p;continue}if(p<56320){o[u++]=239,o[u++]=191,o[u++]=189,_=p;continue}p=_-55296<<10|p-56320|65536,_=null}else _&&(o[u++]=239,o[u++]=191,o[u++]=189,_=null);p<128?o[u++]=p:(p<2048?o[u++]=p>>6|192:(p<65536?o[u++]=p>>12|224:(o[u++]=p>>18|240,o[u++]=p>>12&63|128),o[u++]=p>>6&63|128),o[u++]=63&p|128)}return u}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&EI(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),m_.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),m_.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var o=this.pos-n;o>=128&&EI(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(t,e,n){this.writeTag(t,nr.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,qO,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,WO,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,YO,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,ZO,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,QO,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,XO,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,KO,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,JO,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,eL,e)},writeBytesField:function(t,e){this.writeTag(t,nr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,nr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,nr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,nr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,nr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,nr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,nr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,nr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,nr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,nr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Fh=Rt(bI);let px=3;function tL(t,e,n){e.glyphs=[],t===1&&n.readMessage(nL,e)}function nL(t,e,n){if(t===3){let{id:o,bitmap:c,width:u,height:p,left:_,top:x,advance:w}=n.readMessage(rL,{});e.glyphs.push({id:o,bitmap:new bl({width:u+2*px,height:p+2*px},c),metrics:{width:u,height:p,left:_,top:x,advance:w}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function rL(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let DI=px,bo={horizontal:1,vertical:2,horizontalOnly:3};class rp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let o=new rp;return o.scale=e||1,o.fontStack=n,o}static forImage(e){let n=new rp;return n.imageName=e,n}}class Nh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let o=new Nh;for(let c=0;c<e.sections.length;c++){let u=e.sections[c];u.image?o.addImageSection(u):o.addTextSection(u,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,o){let c="";for(let u=0;u<n.length;u++){let p=n.charCodeAt(u+1)||null,_=n.charCodeAt(u-1)||null;c+=!o&&(p&&b(p)&&!np[n[u+1]]||_&&b(_)&&!np[n[u-1]])||!np[n[u]]?n[u]:np[n[u]]}return c}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&__[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&__[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let o=new Nh;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(rp.forText(e.scale,e.fontStack||n));let o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void dr("Can't add FormattedSection with an empty image.");let o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(rp.forImage(n)),this.sectionIndex.push(this.sections.length-1)):dr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function mx(t,e,n,o,c,u,p,_,x,w,E,I,S,A,R){let k=Nh.fromFeature(t,c);I===bo.vertical&&k.verticalizePunctuation(S);let z=[],j=function(J,le,ue,_e,Ie,ve){if(!J)return[];let Se=[],Me=function(Ve,Be,Ce,ht,st,$e){let Et=0;for(let gt=0;gt<Ve.length();gt++){let dt=Ve.getSection(gt);Et+=MI(Ve.getCodePoint(gt),dt,ht,st,Be,$e)}return Et/Math.max(1,Math.ceil(Et/Ce))}(J,le,ue,_e,Ie,ve),De=J.text.indexOf("\u200B")>=0,Fe=0;for(let Ve=0;Ve<J.length();Ve++){let Be=J.getSection(Ve),Ce=J.getCodePoint(Ve);if(__[Ce]||(Fe+=MI(Ce,Be,_e,Ie,le,ve)),Ve<J.length()-1){let ht=!((Le=Ce)<11904||!(r["Bopomofo Extended"](Le)||r.Bopomofo(Le)||r["CJK Compatibility Forms"](Le)||r["CJK Compatibility Ideographs"](Le)||r["CJK Compatibility"](Le)||r["CJK Radicals Supplement"](Le)||r["CJK Strokes"](Le)||r["CJK Symbols and Punctuation"](Le)||r["CJK Unified Ideographs Extension A"](Le)||r["CJK Unified Ideographs"](Le)||r["Enclosed CJK Letters and Months"](Le)||r["Halfwidth and Fullwidth Forms"](Le)||r.Hiragana(Le)||r["Ideographic Description Characters"](Le)||r["Kangxi Radicals"](Le)||r["Katakana Phonetic Extensions"](Le)||r.Katakana(Le)||r["Vertical Forms"](Le)||r["Yi Radicals"](Le)||r["Yi Syllables"](Le)));(iL[Ce]||ht||Be.imageName)&&Se.push(CI(Ve+1,Fe,Me,Se,oL(Ce,J.getCodePoint(Ve+1),ht&&De),!1))}}var Le;return AI(CI(J.length(),Fe,Me,Se,0,!0))}(k,w,u,e,o,A),{processBidirectionalText:W,processStyledBidirectionalText:X}=re;if(W&&k.sections.length===1){let J=W(k.toString(),j);for(let le of J){let ue=new Nh;ue.text=le,ue.sections=k.sections;for(let _e=0;_e<le.length;_e++)ue.sectionIndex.push(0);z.push(ue)}}else if(X){let J=X(k.text,k.sectionIndex,j);for(let le of J){let ue=new Nh;ue.text=le[0],ue.sectionIndex=le[1],ue.sections=k.sections,z.push(ue)}}else z=function(J,le){let ue=[],_e=J.text,Ie=0;for(let ve of le)ue.push(J.substring(Ie,ve)),Ie=ve;return Ie<_e.length&&ue.push(J.substring(Ie,_e.length)),ue}(k,j);let Q=[],oe={positionedLines:Q,text:k.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(J,le,ue,_e,Ie,ve,Se,Me,De,Fe,Le,Ve){let Be=0,Ce=0,ht=0,st=Me==="right"?1:Me==="left"?0:.5,$e=!1;for(let Vt of Ie){let St=Vt.getSections();for(let Ht of St){if(Ht.imageName)continue;let Ut=le[Ht.fontStack];if(Ut&&($e=Ut.ascender!==void 0&&Ut.descender!==void 0,!$e))break}if(!$e)break}let Et=0;for(let Vt of Ie){Vt.trim();let St=Vt.getMaxScale(),Ht=(St-1)*Jr,Ut={positionedGlyphs:[],lineOffset:0};J.positionedLines[Et]=Ut;let Jt=Ut.positionedGlyphs,Dt=0;if(!Vt.length()){Ce+=ve,++Et;continue}let Nn=0,Rn=0;for(let un=0;un<Vt.length();un++){let _n=Vt.getSection(un),Qn=Vt.getSectionIndex(un),Gn=Vt.getCodePoint(un),fr=_n.scale,ar=null,li=null,gr=null,rr=Jr,Cr=0,Gr=!(De===bo.horizontal||!Le&&!v(Gn)||Le&&(__[Gn]||(gt=Gn,r.Arabic(gt)||r["Arabic Supplement"](gt)||r["Arabic Extended-A"](gt)||r["Arabic Presentation Forms-A"](gt)||r["Arabic Presentation Forms-B"](gt))));if(_n.imageName){let Hr=_e[_n.imageName];if(!Hr)continue;gr=_n.imageName,J.iconsInText=J.iconsInText||!0,li=Hr.paddedRect;let Hn=Hr.displaySize;fr=fr*Jr/Ve,ar={width:Hn[0],height:Hn[1],left:0,top:-DI,advance:Gr?Hn[1]:Hn[0],localGlyph:!1},Cr=$e?-ar.height*fr:St*Jr-17-Hn[1]*fr,rr=ar.advance;let Ri=(Gr?Hn[0]:Hn[1])*fr-Jr*St;Ri>0&&Ri>Dt&&(Dt=Ri)}else{let Hr=ue[_n.fontStack];if(!Hr)continue;Hr[Gn]&&(li=Hr[Gn]);let Hn=le[_n.fontStack];if(!Hn)continue;let Ri=Hn.glyphs[Gn];if(!Ri)continue;if(ar=Ri.metrics,rr=Gn!==8203?Jr:0,$e){let Ta=Hn.ascender!==void 0?Math.abs(Hn.ascender):0,Vo=Hn.descender!==void 0?Math.abs(Hn.descender):0,hs=(Ta+Vo)*fr;Nn<hs&&(Nn=hs,Rn=(Ta-Vo)/2*fr),Cr=-Ta*fr}else Cr=(St-fr)*Jr-17}Gr?(J.verticalizable=!0,Jt.push({glyph:Gn,imageName:gr,x:Be,y:Ce+Cr,vertical:Gr,scale:fr,localGlyph:ar.localGlyph,fontStack:_n.fontStack,sectionIndex:Qn,metrics:ar,rect:li}),Be+=rr*fr+Fe):(Jt.push({glyph:Gn,imageName:gr,x:Be,y:Ce+Cr,vertical:Gr,scale:fr,localGlyph:ar.localGlyph,fontStack:_n.fontStack,sectionIndex:Qn,metrics:ar,rect:li}),Be+=ar.advance*fr+Fe)}Jt.length!==0&&(ht=Math.max(Be-Fe,ht),$e?PI(Jt,st,Dt,Rn,ve*St/2):PI(Jt,st,Dt,0,ve/2)),Be=0;let gn=ve*St+Dt;Ut.lineOffset=Math.max(Dt,Ht),Ce+=gn,++Et}var gt;let dt=Ce,{horizontalAlign:Ge,verticalAlign:xt}=gx(Se);(function(Vt,St,Ht,Ut,Jt,Dt){let Nn=(St-Ht)*Jt,Rn=-Dt*Ut;for(let gn of Vt)for(let un of gn.positionedGlyphs)un.x+=Nn,un.y+=Rn})(J.positionedLines,st,Ge,xt,ht,dt),J.top+=-xt*dt,J.bottom=J.top+dt,J.left+=-Ge*ht,J.right=J.left+ht,J.hasBaseline=$e}(oe,e,n,o,z,p,_,x,I,w,S,R),!function(J){for(let le of J)if(le.positionedGlyphs.length!==0)return!1;return!0}(Q)&&oe}let __={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},iL={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function MI(t,e,n,o,c,u){if(e.imageName){let p=o[e.imageName];return p?p.displaySize[0]*e.scale*Jr/u+c:0}{let p=n[e.fontStack],_=p&&p.glyphs[t];return _?_.metrics.advance*e.scale+c:0}}function SI(t,e,n,o){let c=Math.pow(t-e,2);return o?t<e?c/2:2*c:c+Math.abs(n)*n}function oL(t,e,n){let o=0;return t===10&&(o-=1e4),n&&(o+=150),t!==40&&t!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function CI(t,e,n,o,c,u){let p=null,_=SI(e,n,c,u);for(let x of o){let w=SI(e-x.x,n,c,u)+x.badness;w<=_&&(p=x,_=w)}return{index:t,x:e,priorBreak:p,badness:_}}function AI(t){return t?AI(t.priorBreak).concat(t.index):[]}function gx(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function PI(t,e,n,o,c){if(!(e||n||o||c))return;let u=t.length-1,p=t[u],_=(p.x+p.metrics.advance*p.scale)*e;for(let x=0;x<=u;x++)t[x].x-=_,t[x].y+=n+o+c}function sL(t,e,n,o){let{horizontalAlign:c,verticalAlign:u}=gx(o),p=n[0]-t.displaySize[0]*c,_=n[1]-t.displaySize[1]*u;return{imagePrimary:t,imageSecondary:e,top:_,bottom:_+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function RI(t,e,n,o,c,u){let p=t.imagePrimary,_;if(p.content){let z=p.content,j=p.pixelRatio||1;_=[z[0]/j,z[1]/j,p.displaySize[0]-z[2]/j,p.displaySize[1]-z[3]/j]}let x=e.left*u,w=e.right*u,E,I,S,A;n==="width"||n==="both"?(A=c[0]+x-o[3],I=c[0]+w+o[1]):(A=c[0]+(x+w-p.displaySize[0])/2,I=A+p.displaySize[0]);let R=e.top*u,k=e.bottom*u;return n==="height"||n==="both"?(E=c[1]+R-o[0],S=c[1]+k+o[2]):(E=c[1]+(R+k-p.displaySize[1])/2,S=E+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:E,right:I,bottom:S,left:A,collisionPadding:_}}class wa extends Je{constructor(e,n,o,c,u){super(e,n),this.angle=c,this.z=o,u!==void 0&&(this.segment=u)}clone(){return new wa(this.x,this.y,this.z,this.angle,this.segment)}}function OI(t,e,n,o,c){if(e.segment===void 0)return!0;let u=e,p=e.segment+1,_=0;for(;_>-n/2;){if(p--,p<0)return!1;_-=t[p].dist(u),u=t[p]}_+=t[p].dist(t[p+1]),p++;let x=[],w=0;for(;_<n/2;){let E=t[p],I=t[p+1];if(!I)return!1;let S=t[p-1].angleTo(E)-E.angleTo(I);for(S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:S}),w+=S;_-x[0].distance>o;)w-=x.shift().angleDelta;if(w>c)return!1;p++,_+=E.dist(I)}return!0}function LI(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function kI(t,e,n){return t?.6*e*n:0}function FI(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function aL(t,e,n,o,c,u){let p=kI(n,c,u),_=FI(n,o)*u,x=0,w=LI(t)/2;for(let E=0;E<t.length-1;E++){let I=t[E],S=t[E+1],A=I.dist(S);if(x+A>w){let R=(w-x)/A,k=Zt(I.x,S.x,R),z=Zt(I.y,S.y,R),j=new wa(k,z,0,S.angleTo(I),E);return!p||OI(t,j,_,p,e)?j:void 0}x+=A}}function lL(t,e,n,o,c,u,p,_,x){let w=kI(o,u,p),E=FI(o,c),I=E*p,S=t[0].x===0||t[0].x===x||t[0].y===0||t[0].y===x;return e-I<e/4&&(e=I+e/4),NI(t,S?e/2*_%e:(E/2+2*u)*p*_%e,e,w,n,I,S,!1,x)}function NI(t,e,n,o,c,u,p,_,x){let w=u/2,E=LI(t),I=0,S=e-n,A=[];for(let R=0;R<t.length-1;R++){let k=t[R],z=t[R+1],j=k.dist(z),W=z.angleTo(k);for(;S+n<I+j;){S+=n;let X=(S-I)/j,Q=Zt(k.x,z.x,X),oe=Zt(k.y,z.y,X);if(Q>=0&&Q<x&&oe>=0&&oe<x&&S-w>=0&&S+w<=E){let J=new wa(Q,oe,0,W,R);o&&!OI(t,J,u,o,c)||A.push(J)}}I+=j}return _||A.length||p||(A=NI(t,I/2,n,o,c,u,p,!0,x)),A}function zI(t,e,n,o,c){let u=[];for(let p=0;p<t.length;p++){let _=t[p],x;for(let w=0;w<_.length-1;w++){let E=_[w],I=_[w+1];E.x<e&&I.x<e||(E.x<e?E=new Je(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x<e&&(I=new Je(e,E.y+(e-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y<n&&I.y<n||(E.y<n?E=new Je(E.x+(n-E.y)/(I.y-E.y)*(I.x-E.x),n)._round():I.y<n&&(I=new Je(E.x+(n-E.y)/(I.y-E.y)*(I.x-E.x),n)._round()),E.x>=o&&I.x>=o||(E.x>=o?E=new Je(o,E.y+(o-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x>=o&&(I=new Je(o,E.y+(o-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y>=c&&I.y>=c||(E.y>=c?E=new Je(E.x+(c-E.y)/(I.y-E.y)*(I.x-E.x),c)._round():I.y>=c&&(I=new Je(E.x+(c-E.y)/(I.y-E.y)*(I.x-E.x),c)._round()),x&&E.equals(x[x.length-1])||(x=[E],u.push(x)),x.push(I)))))}}return u}function BI(t){let e=0,n=0;for(let p of t)e+=p.w*p.h,n=Math.max(n,p.w);t.sort((p,_)=>_.h-p.h);let o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],c=0,u=0;for(let p of t)for(let _=o.length-1;_>=0;_--){let x=o[_];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,u=Math.max(u,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===x.w&&p.h===x.h){let w=o.pop();_<o.length&&(o[_]=w)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(o.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:c,h:u,fill:e/(c*u)||0}}lt(wa,"Anchor");let to=1;class _x{constructor(e,{pixelRatio:n,version:o,stretchX:c,stretchY:u,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=u,this.content=p,this.version=o}get tl(){return[this.paddedRect.x+to,this.paddedRect.y+to]}get br(){return[this.paddedRect.x+this.paddedRect.w-to,this.paddedRect.y+this.paddedRect.h-to]}get displaySize(){return[(this.paddedRect.w-2*to)/this.pixelRatio,(this.paddedRect.h-2*to)/this.pixelRatio]}}class jI{constructor(e,n){let o={},c={};this.haveRenderCallbacks=[];let u=[];this.addImages(e,o,u),this.addImages(n,c,u);let{w:p,h:_}=BI(u),x=new xo({width:p||1,height:_||1});for(let w in e){let E=e[w],I=o[w].paddedRect;xo.copy(E.data,x,{x:0,y:0},{x:I.x+to,y:I.y+to},E.data,E.sdf)}for(let w in n){let E=n[w],I=c[w].paddedRect,S=I.x+to,A=I.y+to,R=E.data.width,k=E.data.height;xo.copy(E.data,x,{x:0,y:0},{x:S,y:A},E.data),xo.copy(E.data,x,{x:0,y:k-1},{x:S,y:A-1},{width:R,height:1}),xo.copy(E.data,x,{x:0,y:0},{x:S,y:A+k},{width:R,height:1}),xo.copy(E.data,x,{x:R-1,y:0},{x:S-1,y:A},{width:1,height:k}),xo.copy(E.data,x,{x:0,y:0},{x:S+R,y:A},{width:1,height:k})}this.image=x,this.iconPositions=o,this.patternPositions=c}addImages(e,n,o){for(let c in e){let u=e[c],p={x:0,y:0,w:u.data.width+2*to,h:u.data.height+2*to};o.push(p),n[c]=new _x(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(let c in e.getUpdatedImages(o))this.patchUpdatedImage(this.iconPositions[c],e.getImage(c,o),n),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c,o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;let[c,u]=e.tl,p=!!Object.keys(this.patternPositions).length;o.update(n.data,{useMipmap:p},{x:c,y:u})}}lt(_x,"ImagePosition"),lt(jI,"ImageAtlas");let ip=1e20;function VI(t,e,n,o,c,u,p,_,x){for(let w=e;w<e+o;w++)UI(t,n*u+w,u,c,p,_,x);for(let w=n;w<n+c;w++)UI(t,w*u+e,1,o,p,_,x)}function UI(t,e,n,o,c,u,p){u[0]=0,p[0]=-ip,p[1]=ip,c[0]=t[e];for(let _=1,x=0,w=0;_<o;_++){c[_]=t[e+_*n];let E=_*_;do{let I=u[x];w=(c[_]-c[I]+E-I*I)/(_-I)/2}while(w<=p[x]&&--x>-1);x++,u[x]=_,p[x]=w,p[x+1]=ip}for(let _=0,x=0;_<o;_++){for(;p[x+1]<_;)x++;let w=u[x],E=_-w;t[e+_*n]=c[w]+E*E}}let ss=2,yx={none:0,ideographs:1,all:2};class zh{constructor(e,n,o){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,o){let c=[],u=this.urls[n]||B.GLYPHS_URL;for(let p in e)for(let _ of e[p])c.push({stack:p,id:_});Wd(c,({stack:p,id:_},x)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=w.glyphs[_];if(E!==void 0)return void x(null,{stack:p,id:_,glyph:E});if(E=this._tinySDF(w,p,_),E)return w.glyphs[_]=E,void x(null,{stack:p,id:_,glyph:E});let I=Math.floor(_/256);if(256*I>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[I])return void x(null,{stack:p,id:_,glyph:E});let S=w.requests[I];S||(S=w.requests[I]=[],zh.loadGlyphRange(p,I,u,this.requestManager,(A,R)=>{if(R){w.ascender=R.ascender,w.descender=R.descender;for(let k in R.glyphs)this._doesCharSupportLocalGlyph(+k)||(w.glyphs[+k]=R.glyphs[+k]);w.ranges[I]=!0}for(let k of S)k(A,R);delete w.requests[I]})),S.push((A,R)=>{A?x(A):R&&x(null,{stack:p,id:_,glyph:R.glyphs[_]||null})})},(p,_)=>{if(p)o(p);else if(_){let x={};for(let{stack:w,id:E,glyph:I}of _)x[w]===void 0&&(x[w]={}),x[w].glyphs===void 0&&(x[w].glyphs={}),x[w].glyphs[E]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},x[w].ascender=this.entries[w].ascender,x[w].descender=this.entries[w].descender;o(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==yx.none&&(this.localGlyphMode===yx.all?!!this.localFontFamily:!!this.localFontFamily&&(r["CJK Unified Ideographs"](e)||r["Hangul Syllables"](e)||r.Hiragana(e)||r.Katakana(e)||r["CJK Symbols and Punctuation"](e)||r["CJK Unified Ideographs Extension A"](e)||r["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,o){let c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let u=e.tinySDF;if(!u){let k="400";/bold/i.test(n)?k="900":/medium/i.test(n)?k="500":/light/i.test(n)&&(k="200"),u=e.tinySDF=new zh.TinySDF({fontFamily:c,fontWeight:k,fontSize:24*ss,buffer:3*ss,radius:8*ss}),u.fontWeight=k}if(this.localGlyphs[u.fontWeight][o])return this.localGlyphs[u.fontWeight][o];let p=String.fromCodePoint(o),{data:_,width:x,height:w,glyphWidth:E,glyphHeight:I,glyphLeft:S,glyphTop:A,glyphAdvance:R}=u.draw(p);return this.localGlyphs[u.fontWeight][o]={id:o,bitmap:new bl({width:x,height:w},_),metrics:{width:E/ss,height:I/ss,left:S/ss,top:A/ss-27,advance:R/ss,localGlyph:!0}}}}zh.loadGlyphRange=function(t,e,n,o,c){let u=256*e,p=u+255,_=o.transformRequest(o.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${u}-${p}`),Vu.Glyphs);cc(_,(x,w)=>{if(x)c(x);else if(w){let E={},I=function(S){return new Fh(S).readFields(tL,{})}(w);for(let S of I.glyphs)E[S.id]=S;c(null,{glyphs:E,ascender:I.ascender,descender:I.descender})}})},zh.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:u="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=n;let _=this.size=t+4*e,x=this._createCanvas(_),w=this.ctx=x.getContext("2d",{willReadFrequently:!0});w.font=`${p} ${u} ${t}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:u}=this.ctx.measureText(t),p=Math.ceil(n),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-c))),x=Math.min(this.size-this.buffer,p+Math.ceil(o)),w=_+2*this.buffer,E=x+2*this.buffer,I=Math.max(w*E,0),S=new Uint8ClampedArray(I),A={data:S,width:w,height:E,glyphWidth:_,glyphHeight:x,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(_===0||x===0)return A;let{ctx:R,buffer:k,gridInner:z,gridOuter:j}=this;R.clearRect(k,k,_,x),R.fillText(t,k,k+p);let W=R.getImageData(k,k,_,x);j.fill(ip,0,I),z.fill(0,0,I);for(let X=0;X<x;X++)for(let Q=0;Q<_;Q++){let oe=W.data[4*(X*_+Q)+3]/255;if(oe===0)continue;let J=(X+k)*w+Q+k;if(oe===1)j[J]=0,z[J]=ip;else{let le=.5-oe;j[J]=le>0?le*le:0,z[J]=le<0?le*le:0}}VI(j,0,0,w,E,w,this.f,this.v,this.z),VI(z,k,k,_,x,w,this.f,this.v,this.z);for(let X=0;X<I;X++){let Q=Math.sqrt(j[X])-Math.sqrt(z[X]);S[X]=Math.round(255-255*(Q/this.radius+this.cutoff))}return A}};let El=to;function $I(t,e,n,o){let c=[],u=t.imagePrimary,p=u.pixelRatio,_=u.paddedRect.w-2*El,x=u.paddedRect.h-2*El,w=t.right-t.left,E=t.bottom-t.top,I=u.stretchX||[[0,_]],S=u.stretchY||[[0,x]],A=(ve,Se)=>ve+Se[1]-Se[0],R=I.reduce(A,0),k=S.reduce(A,0),z=_-R,j=x-k,W=0,X=R,Q=0,oe=k,J=0,le=z,ue=0,_e=j;if(u.content&&o){let ve=u.content;W=y_(I,0,ve[0]),Q=y_(S,0,ve[1]),X=y_(I,ve[0],ve[2]),oe=y_(S,ve[1],ve[3]),J=ve[0]-W,ue=ve[1]-Q,le=ve[2]-ve[0]-X,_e=ve[3]-ve[1]-oe}let Ie=(ve,Se,Me,De)=>{let Fe=v_(ve.stretch-W,X,w,t.left),Le=x_(ve.fixed-J,le,ve.stretch,R),Ve=v_(Se.stretch-Q,oe,E,t.top),Be=x_(Se.fixed-ue,_e,Se.stretch,k),Ce=v_(Me.stretch-W,X,w,t.left),ht=x_(Me.fixed-J,le,Me.stretch,R),st=v_(De.stretch-Q,oe,E,t.top),$e=x_(De.fixed-ue,_e,De.stretch,k),Et=new Je(Fe,Ve),gt=new Je(Ce,Ve),dt=new Je(Ce,st),Ge=new Je(Fe,st),xt=new Je(Le/p,Be/p),Vt=new Je(ht/p,$e/p),St=e*Math.PI/180;if(St){let Rn=Math.sin(St),gn=Math.cos(St),un=[gn,-Rn,Rn,gn];Et._matMult(un),gt._matMult(un),Ge._matMult(un),dt._matMult(un)}let Ht=ve.stretch+ve.fixed,Ut=Me.stretch+Me.fixed,Jt=Se.stretch+Se.fixed,Dt=De.stretch+De.fixed,Nn=t.imageSecondary;return{tl:Et,tr:gt,bl:Ge,br:dt,texPrimary:{x:u.paddedRect.x+El+Ht,y:u.paddedRect.y+El+Jt,w:Ut-Ht,h:Dt-Jt},texSecondary:Nn?{x:Nn.paddedRect.x+El+Ht,y:Nn.paddedRect.y+El+Jt,w:Ut-Ht,h:Dt-Jt}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xt,pixelOffsetBR:Vt,minFontScaleX:le/p/w,minFontScaleY:_e/p/E,isSDF:n}};if(o&&(u.stretchX||u.stretchY)){let ve=GI(I,z,R),Se=GI(S,j,k);for(let Me=0;Me<ve.length-1;Me++){let De=ve[Me],Fe=ve[Me+1];for(let Le=0;Le<Se.length-1;Le++)c.push(Ie(De,Se[Le],Fe,Se[Le+1]))}}else c.push(Ie({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:x+1}));return c}function y_(t,e,n){let o=0;for(let c of t)o+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return o}function GI(t,e,n){let o=[{fixed:-El,stretch:0}];for(let[c,u]of t){let p=o[o.length-1];o.push({fixed:c-p.stretch,stretch:p.stretch}),o.push({fixed:c-p.stretch,stretch:p.stretch+(u-c)})}return o.push({fixed:e+El,stretch:n}),o}function v_(t,e,n,o){return t/e*n+o}function x_(t,e,n,o){return t-e*n/o}function cL(t,e,n,o){let c=e+t.positionedLines[o].lineOffset;return o===0?n+c/2:n+(c+(e+t.positionedLines[o-1].lineOffset))/2}function uL(t,e=1,n=!1){let o=1/0,c=1/0,u=-1/0,p=-1/0,_=t[0];for(let A=0;A<_.length;A++){let R=_[A];(!A||R.x<o)&&(o=R.x),(!A||R.y<c)&&(c=R.y),(!A||R.x>u)&&(u=R.x),(!A||R.y>p)&&(p=R.y)}let x=Math.min(u-o,p-c),w=x/2,E=new ih([],hL);if(x===0)return new Je(o,c);for(let A=o;A<u;A+=x)for(let R=c;R<p;R+=x)E.push(new Bh(A+w,R+w,w,t));let I=function(A){let R=0,k=0,z=0,j=A[0];for(let W=0,X=j.length,Q=X-1;W<X;Q=W++){let oe=j[W],J=j[Q],le=oe.x*J.y-J.x*oe.y;k+=(oe.x+J.x)*le,z+=(oe.y+J.y)*le,R+=3*le}return new Bh(k/R,z/R,0,A)}(t),S=E.length;for(;E.length;){let A=E.pop();(A.d>I.d||!I.d)&&(I=A,n&&console.log("found best %d after %d probes",Math.round(1e4*A.d)/1e4,S)),A.max-I.d<=e||(w=A.h/2,E.push(new Bh(A.p.x-w,A.p.y-w,w,t)),E.push(new Bh(A.p.x+w,A.p.y-w,w,t)),E.push(new Bh(A.p.x-w,A.p.y+w,w,t)),E.push(new Bh(A.p.x+w,A.p.y+w,w,t)),S+=4)}return n&&(console.log(`num probes: ${S}`),console.log(`best distance: ${I.d}`)),I.p}function hL(t,e){return e.max-t.max}class Bh{constructor(e,n,o,c){this.p=new Je(e,n),this.h=o,this.d=function(u,p){let _=!1,x=1/0;for(let w=0;w<p.length;w++){let E=p[w];for(let I=0,S=E.length,A=S-1;I<S;A=I++){let R=E[I],k=E[A];R.y>u.y!=k.y>u.y&&u.x<(k.x-R.x)*(u.y-R.y)/(k.y-R.y)+R.x&&(_=!_),x=Math.min(x,aE(u,R,k))}}return(_?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}let vx=Number.POSITIVE_INFINITY,dL=Math.sqrt(2);function HI(t,[e,n]){let o=0,c=0;if(n===vx){e<0&&(e=0);let u=e/dL;switch(t){case"top-right":case"top-left":c=u-7;break;case"bottom-right":case"bottom-left":c=7-u;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(t){case"top-right":case"bottom-right":o=-u;break;case"top-left":case"bottom-left":o=u;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":c=n-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-n}switch(t){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,c]}function xx(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fL(t,e,n,o,c,u,p,_,x,w,E,I,S,A,R){let k=u.textMaxSize.evaluate(e,{},I);k===void 0&&(k=p);let z=t.layers[0].layout,j=z.get("icon-offset").evaluate(e,{},I),W=WI(n.horizontal)||n.vertical,X=S.name==="globe",Q=Jr,oe=p/Q,J=t.tilePixelRatio*k/Q,le=(Fe=t.overscaling,t.zoom>18&&Fe>2&&(Fe>>=1),Math.max(et/(512*Fe),1)*z.get("symbol-spacing")),ue=z.get("text-padding")*t.tilePixelRatio,_e=z.get("icon-padding")*t.tilePixelRatio,Ie=hn(z.get("text-max-angle")),ve=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Se=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Me=z.get("symbol-placement"),De=le/2;var Fe;let Le=z.get("icon-text-fit").evaluate(e,{},I),Ve=z.get("icon-text-fit-padding").evaluate(e,{},I),Be=Le!=="none",Ce;t.hasAnyIconTextFit===!1&&Be&&(t.hasAnyIconTextFit=!0),o&&Be&&(t.allowVerticalPlacement&&n.vertical&&(Ce=RI(o,n.vertical,Le,Ve,j,oe)),W&&(o=RI(o,W,Le,Ve,j,oe)));let ht=(st,$e,Et)=>{if($e.x<0||$e.x>=et||$e.y<0||$e.y>=et)return;let gt=null;if(X){let{x:dt,y:Ge,z:xt}=S.projectTilePoint($e.x,$e.y,Et);gt={anchor:new wa(dt,Ge,xt,0,void 0),up:S.upVector(Et,$e.x,$e.y)}}(function(dt,Ge,xt,Vt,St,Ht,Ut,Jt,Dt,Nn,Rn,gn,un,_n,Qn,Gn,fr,ar,li,gr,rr,Cr,Gr,Hr,Hn,Ri,Ta){let Vo=dt.addToLineVertexArray(Ge,Vt),hs,Al,Pl,tu,ZD,QD,YD,XD=0,KD=0,JD=0,eM=0,Hx=-1,qx=-1,Ns={},tM=fc(""),nu=xt?xt.anchor:Ge,Wx=Dt.layout.get("icon-text-fit").evaluate(rr,{},Hn)!=="none",Zx=0,Qx=0;if(Dt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Zx,Qx]=Dt.layout.get("text-offset").evaluate(rr,{},Hn).map(no=>no*Jr):(Zx=Dt.layout.get("text-radial-offset").evaluate(rr,{},Hn)*Jr,Qx=vx),dt.allowVerticalPlacement&&St.vertical){let no=St.vertical;if(Qn)QD=bx(no),Jt&&(YD=bx(Jt));else{let ro=Dt.layout.get("text-rotate").evaluate(rr,{},Hn)+90;Pl=b_(Nn,nu,Ge,Rn,gn,un,no,_n,ro,Gn),Jt&&(tu=b_(Nn,nu,Ge,Rn,gn,un,Jt,ar,ro))}}if(Ht){let no=Dt.layout.get("icon-rotate").evaluate(rr,{},Hn),ro=$I(Ht,no,Gr,Wx),qh=Jt?$I(Jt,no,Gr,Wx):void 0;Al=b_(Nn,nu,Ge,Rn,gn,un,Ht,ar,no),XD=4*ro.length;let nM=dt.iconSizeData,ru=null;nM.kind==="source"?(ru=[os*Dt.layout.get("icon-size").evaluate(rr,{},Hn)],ru[0]>Il&&dr(`${dt.layerIds[0]}: Value for "icon-size" is >= ${op}. Reduce your "icon-size".`)):nM.kind==="composite"&&(ru=[os*Cr.compositeIconSizes[0].evaluate(rr,{},Hn),os*Cr.compositeIconSizes[1].evaluate(rr,{},Hn)],(ru[0]>Il||ru[1]>Il)&&dr(`${dt.layerIds[0]}: Value for "icon-size" is >= ${op}. Reduce your "icon-size".`)),dt.addSymbols(dt.icon,ro,ru,gr,li,rr,!1,xt,Ge,Vo.lineStartIndex,Vo.lineLength,-1,Hr,Hn,Ri,Ta),Hx=dt.icon.placedSymbolArray.length-1,qh&&(KD=4*qh.length,dt.addSymbols(dt.icon,qh,ru,gr,li,rr,bo.vertical,xt,Ge,Vo.lineStartIndex,Vo.lineLength,-1,Hr,Hn,Ri,Ta),qx=dt.icon.placedSymbolArray.length-1)}for(let no in St.horizontal){let ro=St.horizontal[no];hs||(tM=fc(ro.text),Qn?ZD=bx(ro):hs=b_(Nn,nu,Ge,Rn,gn,un,ro,_n,Dt.layout.get("text-rotate").evaluate(rr,{},Hn),Gn));let qh=ro.positionedLines.length===1;if(JD+=qI(dt,xt,Ge,ro,Ut,Dt,Qn,rr,Gn,Vo,St.vertical?bo.horizontal:bo.horizontalOnly,qh?Object.keys(St.horizontal):[no],Ns,Hx,Cr,Hr,Hn,Ri),qh)break}St.vertical&&(eM+=qI(dt,xt,Ge,St.vertical,Ut,Dt,Qn,rr,Gn,Vo,bo.vertical,["vertical"],Ns,qx,Cr,Hr,Hn,Ri));let Rl=-1,Yx=(no,ro)=>no?Math.max(no,ro):ro;Rl=Yx(ZD,Rl),Rl=Yx(QD,Rl),Rl=Yx(YD,Rl);let Pk=Rl>-1?1:0;dt.glyphOffsetArray.length>=65535&&dr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),rr.sortKey!==void 0&&dt.addToSortKeyRanges(dt.symbolInstances.length,rr.sortKey),dt.symbolInstances.emplaceBack(Ge.x,Ge.y,nu.x,nu.y,nu.z,Ns.right>=0?Ns.right:-1,Ns.center>=0?Ns.center:-1,Ns.left>=0?Ns.left:-1,Ns.vertical>=0?Ns.vertical:-1,Hx,qx,tM,hs!==void 0?hs:dt.collisionBoxArray.length,hs!==void 0?hs+1:dt.collisionBoxArray.length,Pl!==void 0?Pl:dt.collisionBoxArray.length,Pl!==void 0?Pl+1:dt.collisionBoxArray.length,Al!==void 0?Al:dt.collisionBoxArray.length,Al!==void 0?Al+1:dt.collisionBoxArray.length,tu||dt.collisionBoxArray.length,tu?tu+1:dt.collisionBoxArray.length,Rn,JD,eM,XD,KD,Pk,0,Zx,Qx,Rl,0,Wx?1:0)})(t,$e,gt,st,n,o,c,Ce,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ue,ve,x,0,_e,Se,j,e,u,w,E,I,A,R)};if(Me==="line")for(let st of zI(e.geometry,0,0,et,et)){let $e=lL(st,le,Ie,n.vertical||W,o,Q,J,t.overscaling,et);for(let Et of $e)W&&pL(t,W.text,De,Et)||ht(st,Et,I)}else if(Me==="line-center"){for(let st of e.geometry)if(st.length>1){let $e=aL(st,Ie,n.vertical||W,o,Q,J);$e&&ht(st,$e,I)}}else if(e.type==="Polygon")for(let st of ox(e.geometry,0)){let $e=uL(st,16);ht(st[0],new wa($e.x,$e.y,0,0,void 0),I)}else if(e.type==="LineString")for(let st of e.geometry)ht(st,new wa(st[0].x,st[0].y,0,0,void 0),I);else if(e.type==="Point")for(let st of e.geometry)for(let $e of st)ht([$e],new wa($e.x,$e.y,0,0,void 0),I)}let op=255,Il=op*os;function qI(t,e,n,o,c,u,p,_,x,w,E,I,S,A,R,k,z,j){let W=function(oe,J,le,ue,_e,Ie,ve,Se){let Me=[];if(J.positionedLines.length===0)return Me;let De=ue.layout.get("text-rotate").evaluate(Ie,{})*Math.PI/180,Fe=function(ht){let st=ht[0],$e=ht[1],Et=st*$e;return Et>0?[st,-$e]:Et<0?[-st,$e]:st===0?[$e,st]:[$e,-st]}(le),Le=Math.abs(J.top-J.bottom);for(let ht of J.positionedLines)Le-=ht.lineOffset;let Ve=J.positionedLines.length,Be=Le/Ve,Ce=J.top-le[1];for(let ht=0;ht<Ve;++ht){let st=J.positionedLines[ht];Ce=cL(J,Be,Ce,ht);for(let $e of st.positionedGlyphs){if(!$e.rect)continue;let Et=$e.rect||{},gt=DI+1,dt=!0,Ge=1,xt=0;if($e.imageName){let gr=ve[$e.imageName];if(!gr)continue;if(gr.sdf){dr("SDF images are not supported in formatted text and will be ignored.");continue}dt=!1,Ge=gr.pixelRatio,gt=to/Ge}let Vt=(_e||Se)&&$e.vertical,St=$e.metrics.advance*$e.scale/2,Ht=$e.metrics,Ut=$e.rect;if(Ut===null)continue;Se&&J.verticalizable&&(xt=$e.imageName?St-$e.metrics.width*$e.scale/2:0);let Jt=_e?[$e.x+St,$e.y]:[0,0],Dt=[0,0],Nn=[0,0],Rn=!1;_e||(Vt?(Nn=[$e.x+St+Fe[0],$e.y+Fe[1]-xt],Rn=!0):Dt=[$e.x+St+le[0],$e.y+le[1]-xt]);let gn=Ut.w*$e.scale/(Ge*($e.localGlyph?ss:1)),un=Ut.h*$e.scale/(Ge*($e.localGlyph?ss:1)),_n,Qn,Gn,fr;if(Vt){let gr=$e.y-Ce,rr=new Je(-St,St-gr),Cr=-Math.PI/2,Gr=new Je(...Nn);_n=new Je(-St+Dt[0],Dt[1]),_n._rotateAround(Cr,rr)._add(Gr),_n.x+=-gr+St,_n.y-=(Ht.left-gt)*$e.scale;let Hr=$e.imageName?Ht.advance*$e.scale:Jr*$e.scale,Hn=String.fromCodePoint($e.glyph);$O(Hn)?_n.x+=(1-gt)*$e.scale:GO(Hn)?_n.x+=Hr-Ht.height*$e.scale+(-gt-1)*$e.scale:_n.x+=$e.imageName||Ht.width+2*gt===Ut.w&&Ht.height+2*gt===Ut.h?(Hr-un)/2:(Hr-(Ht.height+2*gt)*$e.scale)/2,Qn=new Je(_n.x,_n.y-gn),Gn=new Je(_n.x+un,_n.y),fr=new Je(_n.x+un,_n.y-gn)}else{let gr=(Ht.left-gt)*$e.scale-St+Dt[0],rr=(-Ht.top-gt)*$e.scale+Dt[1],Cr=gr+gn,Gr=rr+un;_n=new Je(gr,rr),Qn=new Je(Cr,rr),Gn=new Je(gr,Gr),fr=new Je(Cr,Gr)}if(De){let gr;gr=_e?new Je(0,0):Rn?new Je(Fe[0],Fe[1]):new Je(le[0],le[1]),_n._rotateAround(De,gr),Qn._rotateAround(De,gr),Gn._rotateAround(De,gr),fr._rotateAround(De,gr)}let ar=new Je(0,0),li=new Je(0,0);Me.push({tl:_n,tr:Qn,bl:Gn,br:fr,texPrimary:Et,texSecondary:void 0,writingMode:J.writingMode,glyphOffset:Jt,sectionIndex:$e.sectionIndex,isSDF:dt,pixelOffsetTL:ar,pixelOffsetBR:li,minFontScaleX:0,minFontScaleY:0})}}return Me}(0,o,x,u,p,_,c,t.allowVerticalPlacement),X=t.textSizeData,Q=null;X.kind==="source"?(Q=[os*u.layout.get("text-size").evaluate(_,{},z)],Q[0]>Il&&dr(`${t.layerIds[0]}: Value for "text-size" is >= ${op}. Reduce your "text-size".`)):X.kind==="composite"&&(Q=[os*R.compositeTextSizes[0].evaluate(_,{},z),os*R.compositeTextSizes[1].evaluate(_,{},z)],(Q[0]>Il||Q[1]>Il)&&dr(`${t.layerIds[0]}: Value for "text-size" is >= ${op}. Reduce your "text-size".`)),t.addSymbols(t.text,W,Q,x,p,_,E,e,n,w.lineStartIndex,w.lineLength,A,k,z,j,!1);for(let oe of I)S[oe]=t.text.placedSymbolArray.length-1;return 4*W.length}function WI(t){for(let e in t)return t[e];return null}function b_(t,e,n,o,c,u,p,_,x,w){let E=p.top,I=p.bottom,S=p.left,A=p.right,R=p.collisionPadding;if(R&&(S-=R[0],E-=R[1],A+=R[2],I+=R[3]),x){let k=new Je(S,E),z=new Je(A,E),j=new Je(S,I),W=new Je(A,I),X=hn(x),Q=new Je(0,0);w&&(Q=new Je(w[0],w[1])),k._rotateAround(X,Q),z._rotateAround(X,Q),j._rotateAround(X,Q),W._rotateAround(X,Q),S=Math.min(k.x,z.x,j.x,W.x),A=Math.max(k.x,z.x,j.x,W.x),E=Math.min(k.y,z.y,j.y,W.y),I=Math.max(k.y,z.y,j.y,W.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,S,E,A,I,_,o,c,u),t.length-1}function bx(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function pL(t,e,n,o){let c=t.compareText;if(e in c){let u=c[e];for(let p=u.length-1;p>=0;p--)if(o.dist(u[p])<n)return!0}else c[e]=[];return c[e].push(o),!1}function ZI(t,e){let n=t.fovAboveCenter,o=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-o)/Math.cos(t._pitch),u=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),p=Math.sin(t._pitch)*u+c;return Math.min(1.01*p,c*(1/t._horizonShift))}function sp(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),o=t.x*n,c=(t.x+1)*n,u=t.y*n,p=(t.y+1)*n,_=eo(o),x=eo(c),w=Kr(u),E=Kr(p),I=e.project(_,w),S=e.project(x,w),A=e.project(x,E),R=e.project(_,E),k=Math.min(I.x,S.x,A.x,R.x),z=Math.min(I.y,S.y,A.y,R.y),j=Math.max(I.x,S.x,A.x,R.x),W=Math.max(I.y,S.y,A.y,R.y),X=n/16;function Q(J,le,ue,_e,Ie,ve){let Se=(ue+Ie)/2,Me=(_e+ve)/2,De=e.project(eo(Se),Kr(Me)),Fe=Math.max(0,k-De.x,z-De.y,De.x-j,De.y-W);k=Math.min(k,De.x),j=Math.max(j,De.x),z=Math.min(z,De.y),W=Math.max(W,De.y),Fe>X&&(Q(J,De,ue,_e,Se,Me),Q(De,le,Se,Me,Ie,ve))}Q(I,S,o,u,c,u),Q(S,A,c,u,c,p),Q(A,R,c,p,o,p),Q(R,I,o,p,o,u),k-=X,z-=X,j+=X,W+=X;let oe=1/Math.max(j-k,W-z);return{scale:oe,x:k*oe,y:z*oe,x2:j*oe,y2:W*oe,projection:e}}function QI(t,{x:e,y:n},o=0){return new Je(((e-o)*t.scale-t.x)*et,(n*t.scale-t.y)*et)}let mL=i.a9.identity(new Float32Array(16));class Dl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new mn(0,0)}projectTilePoint(e,n,o){return{x:e,y:n,z:0}}locationPoint(e,n,o=!0){return e._coordinatePoint(e.locationCoordinate(n),o)}pixelsPerMeter(e,n){return Pi(1,e)*n}pixelSpaceConversion(e,n,o){return 1}farthestPixelDistance(e){return ZI(e,e.pixelsPerMeter)}pointCoordinate(e,n,o,c){let u=e.horizonLineFromTop(!1),p=new Je(n,Math.max(u,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,c))}pointCoordinate3D(e,n,o){let c=new Je(n,o);if(e.elevation)return e.elevation.pointCoordinate(c);{let u=this.pointCoordinate(e,c.x,c.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);let o=e.horizonLineFromTop();return n.y<o}createInversionMatrix(e,n){return mL}createTileMatrix(e,n,o){let c,u,p,_=o.canonical,x=i.a9.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let w=sp(_,this);c=1,u=w.x+o.wrap*w.scale,p=w.y,i.a9.scale(x,x,[c/w.scale,c/w.scale,e.pixelsPerMeter/n])}else c=n/e.zoomScale(_.z),u=(_.x+Math.pow(2,_.z)*o.wrap)*c,p=_.y*c;return i.a9.translate(x,x,[u,p,0]),i.a9.scale(x,x,[c/et,c/et,1]),x}upVector(e,n,o){return[0,0,1]}upVectorScale(e,n,o){return{metersToTile:1}}}class gL extends Dl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,o]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(hn(n));this.n=(c+Math.sin(hn(o)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:o,c,r0:u}=this,p=hn(e-this.center[0]),_=hn(n),x=Math.sqrt(c-2*o*Math.sin(_))/o;return{x:x*Math.sin(p*o),y:x*Math.cos(p*o)-u,z:0}}unproject(e,n){let{n:o,c,r0:u}=this,p=u+n,_=Math.atan2(e,Math.abs(p))*Math.sign(p);p*o<0&&(_-=Math.PI*Math.sign(e)*Math.sign(p));let x=hn(this.center[0])*o;_=Yo(_,-Math.PI-x,Math.PI-x);let w=tn(yi(_/o)+this.center[0],-180,180),E=Math.asin(tn((c-(e*e+p*p)*o*o)/(2*o),-1,1)),I=tn(yi(E),-wr,wr);return new mn(w,I)}}let ap=1.340264,lp=-.081106,cp=893e-6,up=.003796,w_=Math.sqrt(3)/2;class _L extends Dl{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let o=Math.asin(w_*Math.sin(n)),c=o*o,u=c*c*c;return{x:.5*(e*Math.cos(o)/(w_*(ap+3*lp*c+u*(7*cp+9*up*c)))/Math.PI+.5),y:1-.5*(o*(ap+lp*c+u*(cp+up*c))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,c=o*o,u=c*c*c;for(let E,I,S,A=0;A<12&&(I=o*(ap+lp*c+u*(cp+up*c))-n,S=ap+3*lp*c+u*(7*cp+9*up*c),E=I/S,o=tn(o-E,-Math.PI/3,Math.PI/3),c=o*o,u=c*c*c,!(Math.abs(E)<1e-12));++A);let p=w_*e*(ap+3*lp*c+u*(7*cp+9*up*c))/Math.cos(o),_=Math.asin(Math.sin(o)/w_),x=tn(180*p/Math.PI,-180,180),w=tn(180*_/Math.PI,-wr,wr);return new mn(x,w)}}class yL extends Dl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let o=360*(e-.5),c=tn(360*(.5-n),-wr,wr);return new mn(o,c)}}let jh=Math.PI/2;function T_(t){return Math.tan((jh+t)/2)}class vL extends Dl{constructor(e){super(e),this.center=e.center||[0,30];let[n,o]=this.parallels=e.parallels||[30,30],c=hn(n),u=hn(o);this.southernCenter=c+u<0,this.southernCenter&&(c=-c,u=-u);let p=Math.cos(c),_=T_(c);this.n=c===u?Math.sin(c):Math.log(p/Math.cos(u))/Math.log(T_(u)/_),this.f=p*Math.pow(T_(c),this.n)/this.n}project(e,n){n=hn(n),this.southernCenter&&(n=-n),e=hn(e-this.center[0]);let o=1e-6,{n:c,f:u}=this;u>0?n<-jh+o&&(n=-jh+o):n>jh-o&&(n=jh-o);let p=u/Math.pow(T_(n),c),_=p*Math.sin(c*e),x=u-p*Math.cos(c*e);return _=.5*(_/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:_,y:this.southernCenter?x:1-x,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:o,f:c}=this,u=c-n,p=Math.sign(u),_=Math.sign(o)*Math.sqrt(e*e+u*u),x=Math.atan2(e,Math.abs(u))*p;u*o<0&&(x-=Math.PI*Math.sign(e)*p);let w=tn(yi(x/o)+this.center[0],-180,180),E=tn(yi(2*Math.atan(Math.pow(c/_,1/o))-jh),-wr,wr);return new mn(w,this.southernCenter?-E:E)}}class YI extends Dl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:yl(e),y:ya(n),z:0}}unproject(e,n){let o=eo(e),c=Kr(n);return new mn(o,c)}}let XI=hn(wr);class xL extends Dl{project(e,n){let o=(n=hn(n))*n,c=o*o;return{x:.5*((e=hn(e))*(.8707-.131979*o+c*(c*(.003971*o-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+o*(.015085+c*(.028874*o-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,c=25,u=0,p=o*o;do{p=o*o;let w=p*p;u=(o*(1.007226+p*(.015085+w*(.028874*p-.044475-.005916*w)))-n)/(1.007226+p*(.045255+w*(.259866*p-.311325-.005916*11*w))),o=tn(o-u,-XI,XI)}while(Math.abs(u)>1e-6&&--c>0);p=o*o;let _=tn(yi(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),x=yi(o);return new mn(_,x)}}let KI=hn(wr);class bL extends Dl{project(e,n){n=hn(n),e=hn(e);let o=Math.cos(n),c=2/Math.PI,u=Math.acos(o*Math.cos(e/2)),p=Math.sin(u)/u,_=.5*(e*c+2*o*Math.sin(e/2)/p)||0,x=.5*(n+Math.sin(n)/p)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,n){let o=e=(2*e-.5)*Math.PI,c=n=(2*(1-n)-1)*Math.PI,u=25,p=1e-6,_=0,x=0;do{let w=Math.cos(c),E=Math.sin(c),I=2*E*w,S=E*E,A=w*w,R=Math.cos(o/2),k=Math.sin(o/2),z=2*R*k,j=k*k,W=1-A*R*R,X=W?1/W:0,Q=W?Math.acos(w*R)*Math.sqrt(1/W):0,oe=.5*(2*Q*w*k+2*o/Math.PI)-e,J=.5*(Q*E+c)-n,le=.5*X*(A*j+Q*w*R*S)+1/Math.PI,ue=X*(z*I/4-Q*E*k),_e=.125*X*(I*k-Q*E*A*z),Ie=.5*X*(S*R+Q*j*w)+.5,ve=ue*_e-Ie*le;_=(J*ue-oe*Ie)/ve,x=(oe*_e-J*le)/ve,o=tn(o-_,-Math.PI,Math.PI),c=tn(c-x,-KI,KI)}while((Math.abs(_)>p||Math.abs(x)>p)&&--u>0);return new mn(yi(o),yi(c))}}class JI extends Dl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(hn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:o,cosPhi:c}=this;return{x:hn(e)*c*o+.5,y:-Math.sin(hn(n))/c*o+.5,z:0}}unproject(e,n){let{scale:o,cosPhi:c}=this,u=-(n-.5)/o,p=tn(yi((e-.5)/o)/c,-180,180),_=Math.asin(tn(u*c,-1,1)),x=tn(yi(_),-wr,wr);return new mn(p,x)}}class wL extends YI{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,o){let c=Zf(e,n,o),u=t_(Fs(o));return i.Q.transformMat4(c,c,u),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,n){let o=Wc(n.lat,n.lng),c=i.Q.normalize([],o),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,p=Pi(1,0)*et*u;i.Q.scaleAndAdd(o,o,c,p);let _=i.a9.identity(new Float64Array(16));return i.a9.multiply(_,e.pixelMatrix,e.globeMatrix),i.Q.transformMat4(o,o,_),new Je(o[0],o[1])}pixelsPerMeter(e,n){return Pi(1,0)*n}pixelSpaceConversion(e,n,o){let c=Pi(1,e)*n,u=Zt(Pi(1,45)*n,c,o);return this.pixelsPerMeter(e,n)/u}createTileMatrix(e,n,o){let c=Xv(Fs(o.canonical));return i.a9.multiply(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,n){let{center:o}=e,c=t_(Fs(n));return i.a9.rotateY(c,c,hn(o.lng)),i.a9.rotateX(c,c,hn(o.lat)),i.a9.scale(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,n,o,c){return gE(e,n,o,!0)||new ai(0,0)}pointCoordinate3D(e,n,o){let c=this.pointCoordinate(e,n,o,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,n){return!gE(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(c,u){let p=c.cameraToCenterDistance,_=c._centerAltitude*u,x=c._camera,w=c._camera.forward(),E=i.Q.add([],i.Q.scale([],w,-p),[0,0,_]),I=c.worldSize/(2*Math.PI),S=[0,0,-I],A=c.width/c.height,R=Math.tan(c.fovAboveCenter),k=i.Q.scale([],x.up(),R),z=i.Q.scale([],x.right(),R*A),j=i.Q.normalize([],i.Q.add([],i.Q.add([],w,k),z)),W=[],X;if(new qv(E,j).closestPointOnSphere(S,I,W)){let Q=i.Q.add([],W,S),oe=i.Q.sub([],Q,E);X=Math.cos(c.fovAboveCenter)*i.Q.length(oe)}else{let Q=i.Q.sub([],E,S),oe=i.Q.sub([],S,E);i.Q.normalize(oe,oe);let J=i.Q.length(Q)-I;X=Math.sqrt(J*(J+2*I));let le=Math.acos(X/(I+J))-Math.acos(i.Q.dot(w,oe));X*=Math.cos(le)}return 1.01*X}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=xl(e.zoom);if(o>0){let c=ZI(e,Pi(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Zt(n,c+u*(1-Math.cos(p)),Math.pow(o,10))}return n}upVector(e,n,o){return Zf(n,o,e,1)}upVectorScale(e){return{metersToTile:Kg(e_(Fs(e)))}}}function eD(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new YI(t);case"equirectangular":return new yL(t);case"naturalEarth":return new xL(t);case"equalEarth":return new _L(t);case"winkelTripel":return new bL(t);case"albers":return n?new JI(t):new gL(t);case"lambertConformalConic":return n?new JI(t):new vL(t);case"globe":return new wL(t)}throw new Error(`Invalid projection name: ${t.name}`)}let TL=l_.types,EL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function E_(t,e,n,o,c,u,p,_,x,w,E,I,S){let A=_?Math.min(Il,Math.round(_[0])):0,R=_?Math.min(Il,Math.round(_[1])):0;t.emplaceBack(e,n,Math.round(32*o),Math.round(32*c),u,p,(A<<1)+(x?1:0),R,16*w,16*E,256*I,256*S)}function I_(t,e,n){t.emplaceBack(e,n)}function D_(t,e,n,o,c,u,p){t.emplaceBack(e,n,o,c,u,p)}function M_(t,e,n,o,c){t.emplaceBack(e,n,o,c),t.emplaceBack(e,n,o,c),t.emplaceBack(e,n,o,c),t.emplaceBack(e,n,o,c)}function IL(t){for(let e of t.sections)if(C(e.text))return!0;return!1}class wx{constructor(e){this.layoutVertexArray=new No,this.indexArray=new kr,this.programConfigurations=e,this.segments=new br,this.dynamicLayoutVertexArray=new Lr,this.opacityVertexArray=new ks,this.placedSymbolArray=new BT,this.iconTransitioningVertexArray=new Ji,this.globeExtVertexArray=new zo,this.zOffsetVertexArray=new Uf}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,o,c,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,OO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,kO.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,EL,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,NO.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,LO.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,FO.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}lt(wx,"SymbolBuffers");class Tx{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new br,this.collisionVertexArray=new rs,this.collisionVertexArrayExt=new Lr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,zO.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,BO.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}lt(Tx,"CollisionBuffers");class S_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=i.a9.identity([]),this.placementViewportMatrix=i.a9.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dx(this.zoom,n["text-size"]),this.iconSizeData=dx(this.zoom,n["icon-size"]);let o=this.layers[0].layout,c=o.get("symbol-sort-key"),u=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(p=>bo[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate")}createArrays(){this.text=new wx(new gl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new wx(new gl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new UT,this.lineVertexArray=new $T,this.symbolInstances=new VT}calculateGlyphDependencies(e,n,o,c,u){for(let p=0;p<e.length;p++){let _=e.codePointAt(p);if(_===void 0)break;if(n[_]=!0,c&&u&&_<=65535){let x=np[e.charAt(p)];x&&(n[x.charCodeAt(0)]=!0)}}}populate(e,n,o,c){let u=this.layers[0],p=u.layout,_=this.projection.name==="globe",x=p.get("text-font"),w=p.get("text-field"),E=p.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof Zr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),S=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,A=p.get("symbol-sort-key");if(this.features=[],!I&&!S)return;let R=n.iconDependencies,k=n.glyphDependencies,z=n.availableImages,j=new H(this.zoom);for(let{feature:W,id:X,index:Q,sourceLayerIndex:oe}of e){let J=u._featureFilter.needGeometry,le=vl(W,J);if(!u._featureFilter.filter(j,le,o))continue;if(J||(le.geometry=va(W,o,c)),_&&W.type!==1&&o.z<=5){let ve=le.geometry,Se=.98078528056,Me=(De,Fe)=>{let Le=Zf(De.x,De.y,o,1),Ve=Zf(Fe.x,Fe.y,o,1);return i.Q.dot(Le,Ve)<Se};for(let De=0;De<ve.length;De++)ve[De]=fR(ve[De],Me)}let ue,_e;if(I){let ve=u.getValueAndResolveTokens("text-field",le,o,z),Se=Zr.factory(ve);IL(Se)&&(this.hasRTLText=!0),(!this.hasRTLText||te()==="unavailable"||this.hasRTLText&&re.isParsed())&&(ue=UO(Se,u,le))}if(S){let ve=u.getValueAndResolveTokens("icon-image",le,o,z);_e=ve instanceof Vi?ve:Vi.fromString(ve)}if(!ue&&!_e)continue;let Ie=this.sortFeaturesByKey?A.evaluate(le,{},o):void 0;if(this.features.push({id:X,text:ue,icon:_e,index:Q,sourceLayerIndex:oe,geometry:le.geometry,properties:W.properties,type:TL[W.type],sortKey:Ie}),_e&&(R[_e.namePrimary]=!0,_e.nameSecondary&&(R[_e.nameSecondary]=!0)),ue){let ve=x.evaluate(le,{},o).join(","),Se=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(bo.vertical)>=0;for(let Me of ue.sections)if(Me.image)R[Me.image.namePrimary]=!0;else{let De=l(ue.toString()),Fe=Me.fontStack||ve,Le=k[Fe]=k[Fe]||{};this.calculateGlyphDependencies(Me.text,Le,Se,this.allowVerticalPlacement,De)}}}p.get("symbol-placement")==="line"&&(this.features=function(W){let X={},Q={},oe=[],J=0;function le(ve){oe.push(W[ve]),J++}function ue(ve,Se,Me){let De=Q[ve];return delete Q[ve],Q[Se]=De,oe[De].geometry[0].pop(),oe[De].geometry[0]=oe[De].geometry[0].concat(Me[0]),De}function _e(ve,Se,Me){let De=X[Se];return delete X[Se],X[ve]=De,oe[De].geometry[0].shift(),oe[De].geometry[0]=Me[0].concat(oe[De].geometry[0]),De}function Ie(ve,Se,Me){let De=Me?Se[0][Se[0].length-1]:Se[0][0];return`${ve}:${De.x}:${De.y}`}for(let ve=0;ve<W.length;ve++){let Se=W[ve],Me=Se.geometry,De=Se.text?Se.text.toString():null;if(!De){le(ve);continue}let Fe=Ie(De,Me),Le=Ie(De,Me,!0);if(Fe in Q&&Le in X&&Q[Fe]!==X[Le]){let Ve=_e(Fe,Le,Me),Be=ue(Fe,Le,oe[Ve].geometry);delete X[Fe],delete Q[Le],Q[Ie(De,oe[Be].geometry,!0)]=Be,oe[Ve].geometry=null}else Fe in Q?ue(Fe,Le,Me):Le in X?_e(Fe,Le,Me):(le(ve),X[Fe]=J-1,Q[Le]=J-1)}return oe.filter(ve=>ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,X)=>W.sortKey-X.sortKey)}update(e,n,o,c,u){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let _=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,_,o,c,u),this.icon.programConfigurations.updatePaintArrays(e,n,_,o,c,u)}updateZOffset(){let e=(u,p,_)=>{o+=p,o>u.length&&u.resize(o);for(let x=-p;x<0;x++)u.emplace(x+o,_)},n=(u,p,_)=>{c+=p,c>u.length&&u.resize(c);for(let x=-p;x<0;x++)u.emplace(x+c,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,c=0;for(let u=0;u<this.symbolInstances.length;u++){let p=this.symbolInstances.get(u),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:x,numIconVertices:w}=p,E=p.zOffset,I=w>0;if((_>0||x>0)&&(e(this.text.zOffsetVertexArray,_,E),e(this.text.zOffsetVertexArray,x,E)),I){let{placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:A}=p;S>=0&&n(this.icon.zOffsetVertexArray,w,E),A>=0&&n(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,E)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=eD(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){let o=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:c,y:u}of n)this.lineVertexArray.emplaceBack(c,u);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,c,u,p,_,x,w,E,I,S,A,R,k,z){let j=e.indexArray,W=e.layoutVertexArray,X=e.globeExtVertexArray,Q=e.segments.prepareSegment(4*n.length,W,j,this.canOverlap?p.sortKey:void 0),oe=this.glyphOffsetArray.length,J=Q.vertexLength,le=this.allowVerticalPlacement&&_===bo.vertical?Math.PI/2:0,ue=p.text&&p.text.sections;for(let Ie=0;Ie<n.length;Ie++){let{tl:ve,tr:Se,bl:Me,br:De,texPrimary:Fe,texSecondary:Le,pixelOffsetTL:Ve,pixelOffsetBR:Be,minFontScaleX:Ce,minFontScaleY:ht,glyphOffset:st,isSDF:$e,sectionIndex:Et}=n[Ie],gt=Q.vertexLength,dt=st[1];if(E_(W,w.x,w.y,ve.x,dt+ve.y,Fe.x,Fe.y,o,$e,Ve.x,Ve.y,Ce,ht),E_(W,w.x,w.y,Se.x,dt+Se.y,Fe.x+Fe.w,Fe.y,o,$e,Be.x,Ve.y,Ce,ht),E_(W,w.x,w.y,Me.x,dt+Me.y,Fe.x,Fe.y+Fe.h,o,$e,Ve.x,Be.y,Ce,ht),E_(W,w.x,w.y,De.x,dt+De.y,Fe.x+Fe.w,Fe.y+Fe.h,o,$e,Be.x,Be.y,Ce,ht),x){let{x:Ge,y:xt,z:Vt}=x.anchor,[St,Ht,Ut]=x.up;D_(X,Ge,xt,Vt,St,Ht,Ut),D_(X,Ge,xt,Vt,St,Ht,Ut),D_(X,Ge,xt,Vt,St,Ht,Ut),D_(X,Ge,xt,Vt,St,Ht,Ut),M_(e.dynamicLayoutVertexArray,Ge,xt,Vt,le)}else M_(e.dynamicLayoutVertexArray,w.x,w.y,w.z,le);if(z){let Ge=Le||Fe;I_(e.iconTransitioningVertexArray,Ge.x,Ge.y),I_(e.iconTransitioningVertexArray,Ge.x+Ge.w,Ge.y),I_(e.iconTransitioningVertexArray,Ge.x,Ge.y+Ge.h),I_(e.iconTransitioningVertexArray,Ge.x+Ge.w,Ge.y+Ge.h)}j.emplaceBack(gt,gt+1,gt+2),j.emplaceBack(gt+1,gt+2,gt+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(st[0]),Ie!==n.length-1&&Et===n[Ie+1].sectionIndex||e.programConfigurations.populatePaintArrays(W.length,p,p.index,{},A,R,k,ue&&ue[Et])}let _e=x?x.anchor:w;e.placedSymbolArray.emplaceBack(_e.x,_e.y,_e.z,w.x,w.y,oe,this.glyphOffsetArray.length-oe,J,E,I,w.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],_,0,!1,0,S,0)}_commitLayoutVertex(e,n,o,c,u,p,_){e.emplaceBack(n,o,c,u,p,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,n,o,c,u,p,_){let x=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),w=x.vertexLength,E=_.tileAnchorX,I=_.tileAnchorY;for(let A=0;A<4;A++)o.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,n,e.padding,_.zOffset),this._commitLayoutVertex(o.layoutVertexArray,c,u,p,E,I,new Je(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,u,p,E,I,new Je(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,u,p,E,I,new Je(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,c,u,p,E,I,new Je(e.x1,e.y2)),x.vertexLength+=4;let S=o.indexArray;S.emplaceBack(w,w+1),S.emplaceBack(w+1,w+2),S.emplaceBack(w+2,w+3),S.emplaceBack(w+3,w),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,o,c,u,p){for(let _=c;_<u;_++){let x=o.get(_),w=this.getSymbolInstanceTextSize(e,p,n,_);this._addCollisionDebugVertices(x,w,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,o,c,u,p){for(let _=c;_<u;_++){let x=o.get(_),w=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._addCollisionDebugVertices(x,w,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Tx(fl,xI.members,Ji),this.iconCollisionBox=new Tx(fl,xI.members,Ji);let o=Oh(this.iconSizeData,e),c=Oh(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){let p=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(o,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(o,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,o,c){let u=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),p=p_(this.textSizeData,e,u)/Jr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,o){let c=this.icon.placedSymbolArray.get(o),u=p_(this.iconSizeData,e,c);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,n,o,c){e.emplaceBack(n,-o,-o,c),e.emplaceBack(n,o,-o,c),e.emplaceBack(n,o,o,c),e.emplaceBack(n,-o,o,c)}_updateTextDebugCollisionBoxes(e,n,o,c,u,p){for(let _=c;_<u;_++){let x=o.get(_),w=this.getSymbolInstanceTextSize(e,p,n,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,x.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,n,o,c,u,p){for(let _=c;_<u;_++){let x=o.get(_),w=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,x.padding,p.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let o=Oh(this.iconSizeData,e),c=Oh(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){let p=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(o,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(o,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,o,c,u,p,_,x,w){let E={};if(n<o){let{x1:I,y1:S,x2:A,y2:R,padding:k,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Q,featureIndex:oe}=e.get(n);E.textBox={x1:I,y1:S,x2:A,y2:R,padding:k,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Q},E.textFeatureIndex=oe}if(c<u){let{x1:I,y1:S,x2:A,y2:R,padding:k,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Q,featureIndex:oe}=e.get(c);E.verticalTextBox={x1:I,y1:S,x2:A,y2:R,padding:k,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Q},E.verticalTextFeatureIndex=oe}if(p<_){let{x1:I,y1:S,x2:A,y2:R,padding:k,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Q,featureIndex:oe}=e.get(p);E.iconBox={x1:I,y1:S,x2:A,y2:R,padding:k,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Q},E.iconFeatureIndex=oe}if(x<w){let{x1:I,y1:S,x2:A,y2:R,padding:k,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Q,featureIndex:oe}=e.get(x);E.verticalIconBox={x1:I,y1:S,x2:A,y2:R,padding:k,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:W,tileAnchorX:X,tileAnchorY:Q},E.verticalIconFeatureIndex=oe}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let o=e.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let u=o.vertexStartIndex;u<c;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),o=Math.cos(e),c=[],u=[],p=[];for(let _=0;_<this.symbolInstances.length;++_){p.push(_);let x=this.symbolInstances.get(_);c.push(0|Math.round(n*x.tileAnchorX+o*x.tileAnchorY)),u.push(x.featureIndex)}return p.sort((_,x)=>c[_]-c[x]||u[x]-u[_]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex);let{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:w}=o;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),u>=0&&u!==c&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&p!==c&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}lt(S_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),S_.addDynamicAttributes=M_;let DL=new me({"symbol-placement":new he(ne.layout_symbol["symbol-placement"]),"symbol-spacing":new he(ne.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new he(ne.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ye(ne.layout_symbol["symbol-sort-key"]),"symbol-z-order":new he(ne.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new he(ne.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new he(ne.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new he(ne.layout_symbol["icon-ignore-placement"]),"icon-optional":new he(ne.layout_symbol["icon-optional"]),"icon-rotation-alignment":new he(ne.layout_symbol["icon-rotation-alignment"]),"icon-size":new ye(ne.layout_symbol["icon-size"]),"icon-text-fit":new ye(ne.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ye(ne.layout_symbol["icon-text-fit-padding"]),"icon-image":new ye(ne.layout_symbol["icon-image"]),"icon-rotate":new ye(ne.layout_symbol["icon-rotate"]),"icon-padding":new he(ne.layout_symbol["icon-padding"]),"icon-keep-upright":new he(ne.layout_symbol["icon-keep-upright"]),"icon-offset":new ye(ne.layout_symbol["icon-offset"]),"icon-anchor":new ye(ne.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new he(ne.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new he(ne.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new he(ne.layout_symbol["text-rotation-alignment"]),"text-field":new ye(ne.layout_symbol["text-field"]),"text-font":new ye(ne.layout_symbol["text-font"]),"text-size":new ye(ne.layout_symbol["text-size"]),"text-max-width":new ye(ne.layout_symbol["text-max-width"]),"text-line-height":new ye(ne.layout_symbol["text-line-height"]),"text-letter-spacing":new ye(ne.layout_symbol["text-letter-spacing"]),"text-justify":new ye(ne.layout_symbol["text-justify"]),"text-radial-offset":new ye(ne.layout_symbol["text-radial-offset"]),"text-variable-anchor":new he(ne.layout_symbol["text-variable-anchor"]),"text-anchor":new ye(ne.layout_symbol["text-anchor"]),"text-max-angle":new he(ne.layout_symbol["text-max-angle"]),"text-writing-mode":new he(ne.layout_symbol["text-writing-mode"]),"text-rotate":new ye(ne.layout_symbol["text-rotate"]),"text-padding":new he(ne.layout_symbol["text-padding"]),"text-keep-upright":new he(ne.layout_symbol["text-keep-upright"]),"text-transform":new ye(ne.layout_symbol["text-transform"]),"text-offset":new ye(ne.layout_symbol["text-offset"]),"text-allow-overlap":new he(ne.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new he(ne.layout_symbol["text-ignore-placement"]),"text-optional":new he(ne.layout_symbol["text-optional"]),visibility:new he(ne.layout_symbol.visibility)});var Ex={paint:new me({"icon-opacity":new ye(ne.paint_symbol["icon-opacity"]),"icon-emissive-strength":new ye(ne.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ye(ne.paint_symbol["text-emissive-strength"]),"icon-color":new ye(ne.paint_symbol["icon-color"]),"icon-halo-color":new ye(ne.paint_symbol["icon-halo-color"]),"icon-halo-width":new ye(ne.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ye(ne.paint_symbol["icon-halo-blur"]),"icon-translate":new he(ne.paint_symbol["icon-translate"]),"icon-translate-anchor":new he(ne.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ye(ne.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ye(ne.paint_symbol["text-opacity"]),"text-color":new ye(ne.paint_symbol["text-color"],{runtimeType:ji,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ye(ne.paint_symbol["text-halo-color"]),"text-halo-width":new ye(ne.paint_symbol["text-halo-width"]),"text-halo-blur":new ye(ne.paint_symbol["text-halo-blur"]),"text-translate":new he(ne.paint_symbol["text-translate"]),"text-translate-anchor":new he(ne.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new he(ne.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new he(ne.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new he(ne.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new he(ne.paint_symbol["icon-color-brightness-max"])}),layout:DL};class tD{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Yt,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}lt(tD,"FormatSectionOverride",{omit:["defaultValue"]});class C_ extends qt{constructor(e,n,o){super(e,Ex,n,o),this._colorAdjustmentMatrix=i.a9.identity([])}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let o=this.layout.get("text-writing-mode");if(o){let c=[];for(let u of o)c.indexOf(u)<0&&c.push(u);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,o,c){return this._saturation===e&&this._contrast===n&&this._brightnessMin===o&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(u,p,_,x){u=eg(u),p=fo(p);let w=i.a9.create(),E=u/3,I=1-2*E,S=[I,E,E,0,E,I,E,0,E,E,I,0,0,0,0,1],A=.5-.5*p,R=x-_;return i.a9.multiply(w,[R,0,0,0,0,R,0,0,0,0,R,0,_,_,_,1],[p,0,0,0,0,p,0,0,0,0,p,0,A,A,A,1]),i.a9.multiply(w,w,S),w}(e,n,o,c),this._saturation=e,this._contrast=n,this._brightnessMin=o,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,o,c){let u=this.layout.get(e).evaluate(n,{},o,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||xh(p.value)||!u?u:function(_,x){return x.replace(/{([^{}]+)}/g,(w,E)=>E in _?String(_[E]):"")}(n.properties,u)}createBucket(e){return new S_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of Ex.paint.overridableProperties){if(!C_.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),o=new tD(n),c=new vh(o,n.property.specification,this.scope,this.options),u=null;u=n.value.kind==="constant"||n.value.kind==="source"?new Nc("source",c):new zc("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new xe(n.property,u,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&C_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let o=e.get("text-field"),c=Ex.paint.properties[n],u=!1,p=_=>{for(let x of _)if(c.overrides&&c.overrides.hasOverride(x))return void(u=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Zr)p(o.value.value.sections);else if(o.value.kind==="source"){let _=w=>{u||(w instanceof Lo&&Mr(w.value)===Ja?p(w.value.sections):w instanceof bc?p(w.sections):w.eachChild(_))},x=o.value;x._styleExpression&&_(x._styleExpression.expression)}return u}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,o=[];return e&&o.push("symbolIcon"),n&&o.push("symbolSDF"),o}getDefaultProgramParams(e,n){return{config:new qc(this,n),overrideFog:!1}}}let ML=new me({visibility:new he(ne.layout_background.visibility)});var SL={paint:new me({"background-color":new he(ne.paint_background["background-color"]),"background-pattern":new he(ne.paint_background["background-pattern"]),"background-opacity":new he(ne.paint_background["background-opacity"]),"background-emissive-strength":new he(ne.paint_background["background-emissive-strength"])}),layout:ML};let CL=new me({visibility:new he(ne.layout_raster.visibility)});var AL={paint:new me({"raster-opacity":new he(ne.paint_raster["raster-opacity"]),"raster-color":new ze(ne.paint_raster["raster-color"]),"raster-color-mix":new he(ne.paint_raster["raster-color-mix"]),"raster-color-range":new he(ne.paint_raster["raster-color-range"]),"raster-hue-rotate":new he(ne.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new he(ne.paint_raster["raster-brightness-min"]),"raster-brightness-max":new he(ne.paint_raster["raster-brightness-max"]),"raster-saturation":new he(ne.paint_raster["raster-saturation"]),"raster-contrast":new he(ne.paint_raster["raster-contrast"]),"raster-resampling":new he(ne.paint_raster["raster-resampling"]),"raster-fade-duration":new he(ne.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new he(ne.paint_raster["raster-emissive-strength"]),"raster-array-band":new he(ne.paint_raster["raster-array-band"]),"raster-elevation":new he(ne.paint_raster["raster-elevation"])}),layout:CL},Ix=Bt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Dx{constructor(e,n,o,c){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,o){let{width:c,height:u}=e,{context:p}=this,{gl:_}=p;if(_.bindTexture(_.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!n||n.premultiply!==!1)),o||this.size&&this.size[0]===c&&this.size[1]===u){let{x,y:w}=o||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)_.texSubImage2D(_.TEXTURE_2D,0,x,w,_.RGBA,_.UNSIGNED_BYTE,e);else{let E=this.format,I=_.UNSIGNED_BYTE;this.format===_.R32F&&(E=_.RED,I=_.FLOAT),_.texSubImage2D(_.TEXTURE_2D,0,x,w,c,u,E,I,e.data)}}else if(this.size=[c,u],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let x=this.format;this.format===_.R8&&(x=_.RED),_.texImage2D(_.TEXTURE_2D,0,this.format,x,_.UNSIGNED_BYTE,e)}else{let x=this.format,w=this.format,E=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(x=_.DEPTH_COMPONENT16,E=_.UNSIGNED_SHORT),this.format===_.R8&&(w=_.RED),this.format===_.R32F&&(E=_.FLOAT,w=_.RED),_.texImage2D(_.TEXTURE_2D,0,x,c,u,0,w,E,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,n,o=!1){let{context:c}=this,{gl:u}=c;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,o,c){let{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),this.wrapS=o),c!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class A_{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}}function P_(t,e,n,o,c,u,p,_){let x=[t,e,1,n,o,1,c,u,1],w=[p,_,1],E=i.ct.adjoint([],x),[I,S,A]=i.Q.transformMat3(w,w,E);return i.ct.multiply(x,x,[I,0,0,0,S,0,0,0,A])}function nD(t,e,n,o,c,u,p,_){let x=function(w,E,I,S,A,R,k,z){let j=P_(0,0,1,0,1,1,0,1),W=P_(w,E,I,S,A,R,k,z),X=i.ct.adjoint([],j);return i.ct.multiply(W,W,X)}(t,e,n,o,c,u,p,_);return[x[2]/x[8]/et,x[5]/x[8]/et]}function R_(t){return[t[0],Math.min(Math.max(t[1],-wr),wr)]}class rD extends oa{constructor(e,n,o,c){super(),this.id=e,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Ms("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=rf(this.map._requestManager.transformRequest(this.url,Vu.Image),(o,c)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new Yu(o)):c&&(this.image=c instanceof HTMLImageElement?Ro.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new A_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ms("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof A_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],o=e[0][1];for(let u of e)u[1]>o&&(o=u[1]),u[1]<n&&(n=u[1]);let c=(o+n)/2;if(c>wr?this.onNorthPole=!0:c<-wr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let u=e.map(ai.fromLngLat);this.tileID=function(p){let _=1/0,x=1/0,w=-1/0,E=-1/0;for(let k of p)_=Math.min(_,k.x),x=Math.min(x,k.y),w=Math.max(w,k.x),E=Math.max(E,k.y);let I=Math.max(w-_,E-x),S=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),A=Math.pow(2,S),R=Math.floor((_+w)/2*A);return R>1&&(R-=1),new Zc(S,R,Math.floor((x+E)/2*A))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ms("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let j in this.tiles){let W=this.tiles[j];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=sp(new Zc(0,0,0),this.map.transform.projection),o=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){let W=j[1].x-j[0].x,X=j[1].y-j[0].y,Q=j[2].x-j[1].x,oe=j[2].y-j[1].y,J=j[3].x-j[2].x,le=j[3].y-j[2].y,ue=j[0].x-j[3].x,_e=j[0].y-j[3].y,Ie=W*oe-Q*X,ve=Q*le-J*oe,Se=J*_e-ue*le,Me=ue*X-W*_e;return Ie>0&&ve>0&&Se>0&&Me>0||Ie<0&&ve<0&&Se<0&&Me<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let c=sp(this.tileID,this.map.transform.projection),[u,p,_,x]=this.coordinates.map(j=>{let W=c.projection.project(j[0],j[1]);return QI(c,W)._round()});this.perspectiveTransform=nD(u.x,u.y,p.x,p.y,_.x,_.y,x.x,x.y);let w=this._boundsArray=new Xr;w.emplaceBack(u.x,u.y,0,0),w.emplaceBack(p.x,p.y,et,0),w.emplaceBack(x.x,x.y,0,et),w.emplaceBack(_.x,_.y,et,et),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,Ix.members),this.boundsSegments=br.simpleSegment(0,0,4,2);let E=[],I=[R_((S=this.coordinates)[0]),R_(S[1]),R_(S[2]),R_(S[3])];var S;let[A,R,k,z]=function(j){let W=j[0][0],X=W,Q=j[0][1],oe=Q;for(let J=1;J<j.length;J++)j[J][0]<W?W=j[J][0]:j[J][0]>X&&(X=j[J][0]),j[J][1]<Q?Q=j[J][1]:j[J][1]>oe&&(oe=j[J][1]);return[W,Q,X-W,oe-Q]}(I);{let j=new Xr,[W,X,Q,oe]=function(Ve){let Be=Ve[0].x,Ce=Be,ht=Ve[0].y,st=ht;for(let $e=1;$e<Ve.length;$e++)Ve[$e].x<Be?Be=Ve[$e].x:Ve[$e].x>Ce&&(Ce=Ve[$e].x),Ve[$e].y<ht?ht=Ve[$e].y:Ve[$e].y>st&&(st=Ve[$e].y);return[Be,ht,Ce-Be,st-ht]}(o),J=Ve=>[(Ve.x-W)/Q,(Ve.y-X)/oe],[le,ue,_e,Ie]=o.map(J),ve=function(Ve,Be,Ce,ht,st,$e,Et,gt){let dt=P_(0,0,1,0,1,1,0,1),Ge=P_(Ve,Be,Ce,ht,st,$e,Et,gt),xt=i.ct.adjoint([],Ge);return i.ct.multiply(dt,dt,xt)}(le[0],le[1],ue[0],ue[1],_e[0],_e[1],Ie[0],Ie[1]);this.elevatedGlobePerspectiveTransform=nD(le[0],le[1],ue[0],ue[1],_e[0],_e[1],Ie[0],Ie[1]);let Se=(Ve,Be)=>{E.push(Ve.lng);let Ce=Math.round((Ve.lng-A)/k*et),ht=Math.round((Ve.lat-R)/z*et),st=J(Be),$e=i.Q.transformMat3([],[st[0],st[1],1],ve),Et=Math.round($e[0]/$e[2]*et),gt=Math.round($e[1]/$e[2]*et);j.emplaceBack(Ce,ht,Et,gt)},Me=o[3].x-o[0].x,De=o[3].y-o[0].y,Fe=o[2].x-o[1].x,Le=o[2].y-o[1].y;for(let Ve=0;Ve<65;Ve++){let Be=Ve/64,Ce=[o[0].x+Be*Me,o[0].y+Be*De],ht=[o[1].x+Be*Fe,o[1].y+Be*Le],st=ht[0]-Ce[0],$e=ht[1]-Ce[1];for(let Et=0;Et<65;Et++){let gt=Et/64,dt={x:Ce[0]+st*gt,y:Ce[1]+$e*gt,z:0};Se(n.projection.unproject(dt.x,dt.y),dt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(j,Ix.members)}{this.maxLongitudeTriangleSize=0;let j=[],W=new kr,X=(Q,oe,J)=>{W.emplaceBack(Q,oe,J);let le=E[Q],ue=E[oe],_e=E[J],Ie=Math.min(Math.min(le,ue),_e),ve=Math.max(Math.max(le,ue),_e)-Ie;ve>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ve),j.push(Ie+ve/2)};for(let Q=0;Q<64;Q++)for(let oe=0;oe<64;oe++){let J=65*Q+oe,le=J+1,ue=J+65,_e=ue+1;X(J,ue,le),X(le,ue,_e)}[j,W]=function(Q,oe){let J=Array.from({length:Q.length},(_e,Ie)=>Ie);J.sort((_e,Ie)=>Q[_e]-Q[Ie]);let le=[],ue=new kr;for(let _e=0;_e<J.length;_e++){let Ie=J[_e];le.push(Q[Ie]);let ve=3*Ie,Se=ve+1;ue.emplaceBack(oe.uint16[ve],oe.uint16[Se],oe.uint16[Se+1])}return[le,ue]}(j,W),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(W)}this.elevatedGlobeSegments=br.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,k/et,0,z/et,0,0,R,A,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,o=n.gl;!this._dirty||this.texture instanceof A_||(this.texture?this.texture.update(this.image):(this.texture=new Dx(n,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let o=this.elevatedGlobeTrianglesCenterLongitudes,c=((E,I)=>E+360*Math.round((I-E)/360))(e+180,o[0]),u=new br,p=(E,I)=>{u.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:n.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},_=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-c)<=_){let E=Kd(o,0,o.length,c+_);return E===o.length||p(E,ra(o,E+1,o.length,c+360-_)-E),u}c<o[0]&&(c+=360);let x=ra(o,0,o.length,c-_);if(x===o.length)return p(0,o.length),u;p(0,x-0);let w=Kd(o,x+1,o.length,c+_);return w!==o.length&&p(w,o.length-w),u}}let PL=(Math.pow(256,2)-1)/16907520;class iD extends qt{constructor(e,n,o){super(e,AL,n,o),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof rD&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[o,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(c)||o===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=Qf({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,c])}}let RL=new me({visibility:new he(ne["layout_raster-particle"].visibility)});var OL={paint:new me({"raster-particle-array-band":new he(ne["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new he(ne["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ze(ne["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new he(ne["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new he(ne["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new he(ne["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new he(ne["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:RL};class oD extends qt{constructor(e,n,o){super(e,OL,n,o),this._updateColorRamp(),this.lastInvalidatedAt=Ro.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Qf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ro.now()}}class LL extends qt{constructor(e,n){super(e,{},n),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let kL=new me({visibility:new he(ne.layout_sky.visibility)});var FL={paint:new me({"sky-type":new he(ne.paint_sky["sky-type"]),"sky-atmosphere-sun":new he(ne.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new he(ne.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new he(ne.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new he(ne.paint_sky["sky-gradient-radius"]),"sky-gradient":new ze(ne.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new he(ne.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new he(ne.paint_sky["sky-atmosphere-color"]),"sky-opacity":new he(ne.paint_sky["sky-opacity"])}),layout:kL};function Mx(t,e,n){let o=[0,0,1],c=i.bl.identity([]);return i.bl.rotateY(c,c,n?-hn(t)+Math.PI:hn(t)),i.bl.rotateX(c,c,-hn(e)),i.Q.transformQuat(o,o,c),i.Q.normalize(o,o)}var NL={paint:new me({})};function sD(t,e){let n=O_(t.projection,t.zoom,t.width,t.height),o=function(u,p,_,x,w){let E=new mn(_.lng-180*Ml,_.lat),I=new mn(_.lng+180*Ml,_.lat),S=u.project(E.lng,E.lat),A=u.project(I.lng,I.lat),R=-Math.atan2(A.y-S.y,A.x-S.x),k=ai.fromLngLat(_);k.y=tn(k.y,-1+Ml,1-Ml);let z=k.toLngLat(),j=u.project(z.lng,z.lat),W=ai.fromLngLat(z);W.x+=Ml;let X=W.toLngLat(),Q=u.project(X.lng,X.lat),oe=cD(Q.x-j.x,Q.y-j.y,R),J=ai.fromLngLat(z);J.y+=Ml;let le=J.toLngLat(),ue=u.project(le.lng,le.lat),_e=cD(ue.x-j.x,ue.y-j.y,R),Ie=Math.abs(oe.x)/Math.abs(_e.y),ve=i.a9.identity([]);i.a9.rotateZ(ve,ve,-R*(1-(w?0:x)));let Se=i.a9.identity([]);return i.a9.scale(Se,Se,[1,1-(1-Ie)*x,1]),Se[4]=-_e.x/_e.y*x,i.a9.rotateZ(Se,Se,R),i.a9.multiply(Se,ve,Se),Se}(t.projection,0,t.center,n,e),c=aD(t);return i.a9.scale(o,o,[c,c,1]),o}function aD(t){let e=t.projection,n=O_(t.projection,t.zoom,t.width,t.height),o=lD(e,t.center),c=lD(e,mn.convert(e.center));return Math.pow(2,o*n+(1-n)*c)}function O_(t,e,n,o,c=1/0){let u=t.range;if(!u)return 0;let p=Math.min(c,Math.max(n,o)),_=Math.log(p/1024)/Math.LN2;return nc(u[0]+_,u[1]+_,e)}let Ml=1/4e4;function lD(t,e){let n=tn(e.lat,-wr,wr),o=new mn(e.lng-180*Ml,n),c=new mn(e.lng+180*Ml,n),u=t.project(o.lng,n),p=t.project(c.lng,n),_=ai.fromLngLat(o),x=ai.fromLngLat(c),w=p.x-u.x,E=p.y-u.y,I=x.x-_.x,S=x.y-_.y,A=Math.sqrt((I*I+S*S)/(w*w+E*E));return Math.log(A)/Math.LN2}function cD(t,e,n){let o=Math.cos(n),c=Math.sin(n);return{x:t*o-e*c,y:t*c+e*o}}function uD(t,e,n){i.a9.identity(t),i.a9.rotateZ(t,t,hn(e[2])),i.a9.rotateX(t,t,hn(e[0])),i.a9.rotateY(t,t,hn(e[1])),i.a9.scale(t,t,n),i.a9.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function L_(t,e,n,o,c,u,p,_){let x=[n[0]-e[0],n[1]-e[1],0],w=[o[0]-e[0],o[1]-e[1],0];if(i.Q.length(x)<1e-12||i.Q.length(w)<1e-12)return i.bl.identity(t);let E=i.Q.cross([],x,w);i.Q.normalize(E,E),i.Q.subtract(w,o,e),x[2]=(u-c)*_,w[2]=(p-c)*_;let I=x;return i.Q.cross(I,x,w),i.Q.normalize(I,I),i.bl.rotationTo(t,E,I)}function Sx(t,e,n=!1){let o=xl(e.zoom),c=function(u,p,_){let x=p.worldSize,w=[u[12],u[13],u[14]],E=Kr(w[1]/x),I=eo(w[0]/x),S=i.a9.identity([]),A=Pi(1,E)*x,R=Pi(1,0)*x*Qc(E,p.zoom),k=1/Kv(x),z=R*k;if(_){let Q=O_(p.projection,p.zoom,p.width,p.height,1024);z=k*p.projection.pixelSpaceConversion(p.center.lat,x,Q)}let j=Wc(E,I);i.Q.add(j,j,i.Q.scale([],i.Q.normalize([],j),A*z*w[2]));let W=function(Q){let oe=[Q[0],Q[1],Q[2]],J=[0,1,0],le=i.Q.cross([],J,oe);return i.Q.cross(J,oe,le),i.Q.squaredLength(J)===0&&(J=[0,1,0],i.Q.cross(le,oe,J)),i.Q.normalize(le,le),i.Q.normalize(J,J),i.Q.normalize(oe,oe),[le[0],le[1],le[2],0,J[0],J[1],J[2],0,oe[0],oe[1],oe[2],0,Q[0],Q[1],Q[2],1]}(j);i.a9.scale(S,S,[z,z,z*A]),i.a9.translate(S,S,[-w[0],-w[1],-w[2]]);let X=i.a9.multiply([],p.globeMatrix,W);return i.a9.multiply(X,X,S),i.a9.multiply(X,X,u),X}(t,e,n);if(o>0){let u=function(p,_){let x=_.worldSize,w=Pi(1,0)*x*Qc(_.center.lat,_.zoom)/Kv(x),E=Pi(1,_.center.lat)*x,I=i.a9.identity([]);return i.a9.rotateY(I,I,hn(_.center.lng)),i.a9.rotateX(I,I,hn(_.center.lat)),i.a9.translate(I,I,[0,0,Ai]),i.a9.scale(I,I,[w,w,w*E]),i.a9.translate(I,I,[_.point.x-.5*x,_.point.y-.5*x,0]),i.a9.multiply(I,I,p),i.a9.multiply(I,_.globeMatrix,I)}(t,e);return function(p,_,x){let w=(R,k,z)=>{let j=i.Q.length(R),W=i.Q.length(k),X=xa(R,k,z);return i.Q.scale(X,X,1/i.Q.length(X)*Zt(j,W,z))},E=w([p[0],p[1],p[2]],[_[0],_[1],_[2]],x),I=w([p[4],p[5],p[6]],[_[4],_[5],_[6]],x),S=w([p[8],p[9],p[10]],[_[8],_[9],_[10]],x),A=xa([p[12],p[13],p[14]],[_[12],_[13],_[14]],x);return[E[0],E[1],E[2],0,I[0],I[1],I[2],0,S[0],S[1],S[2],0,A[0],A[1],A[2],1]}(c,u,o)}return c}function hD(t,e,n,o){let c=tr.projectAabbCorners(o,n),u=Number.MAX_VALUE,p=-1;for(let w=0;w<c.length;++w){let E=c[w];E[0]=(.5*E[0]+.5)*e.width,E[1]=(.5-.5*E[1])*e.height,E[2]<u&&(p=w,u=E[2])}let _=w=>new Je(c[w][0],c[w][1]),x;switch(p){case 0:case 6:x=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:x=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:x=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:x=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(Uv(t,x))return u}let zL=Bt([{name:"a_pos_3f",components:3,type:"Float32"}]),BL=Bt([{name:"a_color_3f",components:3,type:"Float32"}]),jL=Bt([{name:"a_color_4f",components:4,type:"Float32"}]),VL=Bt([{name:"a_uv_2f",components:2,type:"Float32"}]),UL=Bt([{name:"a_normal_3f",components:3,type:"Float32"}]),$L=Bt([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),GL=Bt([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class k_{constructor(e,n,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function dD(t,e){let n=t.indexOf("://")===-1;try{return new URL(t,n&&e?"http://example.com":void 0),!0}catch{return!1}}class fD{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class pD{constructor(){this.instancedDataArray=new Mv,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Cx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1}populate(e,n,o,c){this.tileToMeter=Wg(o);let u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:p,id:_,index:x,sourceLayerIndex:w}of e){let E=_??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),I=vl(p,u);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),I,o))continue;let S={id:E,sourceLayerIndex:w,index:x,geometry:u?I.geometry:va(p,o,c),properties:p.properties,type:p.type,patterns:{}},A=this.addFeature(S,S.geometry,I);A&&n.featureIndex.insert(p,S.geometry,x,w,this.index,this.instancesPerModel[A].instancedDataArray.length,et/32)}this.lookup=null}update(e,n,o,c){for(let u in this.instancesPerModel){let p=this.instancesPerModel[u];for(let _ in e)p.idToFeaturesIndex.hasOwnProperty(_)&&(this.evaluate(p.features[p.idToFeaturesIndex[_]],e[_],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let o=this.instancesPerModel[n];for(let c of o.features){let u=this.layers[0],p=c.feature,_=this.canonical,x=u.paint.get("model-rotation").evaluate(p,{},_),w=u.paint.get("model-scale").evaluate(p,{},_),E=u.paint.get("model-translation").evaluate(p,{},_);i.Q.exactEquals(c.rotation,x)&&i.Q.exactEquals(c.scale,w)&&i.Q.exactEquals(c.translation,E)||(this.evaluate(c,c.featureStates,o,!0),e=!0)}}return e}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let o=this.instancesPerModel[n];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,$L.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let o=this.instancesPerModel[n];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,o){let c=this.layers[0],u=c.layout.get("model-id").evaluate(o,{},this.canonical);if(!u)return dr(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),u;dD(u,!1)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new pD);let p=this.instancesPerModel[u],_=p.instancedDataArray,x=new fD(o,_.length);for(let w of n)for(let E of w){if(E.x<0||E.x>=et||E.y<0||E.y>=et)continue;let I=(this.lookupDim-1)/et,S=this.lookupDim*(E.y*I|0)+E.x*I|0;if(this.lookup){if(this.lookup[S]!==0)continue;this.lookup[S]=1}this.instanceCount++;let A=_.length;_.resize(A+1),p.instancesEvaluatedElevation.push(0),_.float32[16*A]=E.x,_.float32[16*A+1]=E.y}return x.instancedDataCount=p.instancedDataArray.length-x.instancedDataOffset,x.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(x),this.evaluate(x,{},p,!1)),u}getModelUris(){return this.modelUris}evaluate(e,n,o,c){let u=this.layers[0],p=e.feature,_=this.canonical,x=e.rotation=u.paint.get("model-rotation").evaluate(p,n,_),w=e.scale=u.paint.get("model-scale").evaluate(p,n,_),E=e.translation=u.paint.get("model-translation").evaluate(p,n,_),I=u.paint.get("model-color").evaluate(p,n,_);I.a=u.paint.get("model-color-mix-intensity").evaluate(p,n,_);let S=[];this.maxVerticalOffset<E[2]&&(this.maxVerticalOffset=E[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),uD(S,x,w);let A=Math.round(100*I.a)+I.b/1.05;for(let R=0;R<e.instancedDataCount;++R){let k=e.instancedDataOffset+R,z=16*k,j=o.instancedDataArray.float32,W=0;c&&(W=j[z+6]-o.instancesEvaluatedElevation[k]);let X=0|j[z+1];j[z]=(0|j[z])+I.r/1.05,j[z+1]=X+I.g/1.05,j[z+2]=A,j[z+3]=1/(_.z>10?this.tileToMeter:Wg(_,X)),j[z+4]=E[0],j[z+5]=E[1],j[z+6]=E[2]+W,j[z+7]=S[0],j[z+8]=S[1],j[z+9]=S[2],j[z+10]=S[4],j[z+11]=S[5],j[z+12]=S[6],j[z+13]=S[8],j[z+14]=S[9],j[z+15]=S[10],o.instancesEvaluatedElevation[k]=E[2]}}}lt(Cx,"ModelBucket",{omit:["layers"]}),lt(pD,"PerModelAttributes"),lt(fD,"ModelFeature");let HL=new me({visibility:new he(ne.layout_model.visibility),"model-id":new ye(ne.layout_model["model-id"])});var qL={paint:new me({"model-opacity":new he(ne.paint_model["model-opacity"]),"model-rotation":new ye(ne.paint_model["model-rotation"]),"model-scale":new ye(ne.paint_model["model-scale"]),"model-translation":new ye(ne.paint_model["model-translation"]),"model-color":new ye(ne.paint_model["model-color"]),"model-color-mix-intensity":new ye(ne.paint_model["model-color-mix-intensity"]),"model-type":new he(ne.paint_model["model-type"]),"model-cast-shadows":new he(ne.paint_model["model-cast-shadows"]),"model-receive-shadows":new he(ne.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new he(ne.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ye(ne.paint_model["model-emissive-strength"]),"model-roughness":new ye(ne.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ye(ne.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new he(ne.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new he(ne.paint_model["model-front-cutoff"])}),layout:HL};let Kc=64,Vh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function mD(t,e,n,o,c,u,p,_,x,w=!1){let E=n.zoom,I=n.project(o),S=Qc(o.lat,E),A=1/S;i.a9.identity(t),i.a9.translate(t,t,[I.x+p[0]*A,I.y+p[1]*A,p[2]]);let R=1,k=1,z=n.worldSize;if(w){if(n.projection.name==="mercator"){let Q=0;n.elevation&&(Q=n.elevation.getAtPointOrZero(new ai(I.x/z,I.y/z),0));let oe=i.aa.transformMat4([],[I.x,I.y,Q,1],n.projMatrix)[3]/n.cameraToCenterDistance;R=oe,k=oe*Qc(n.center.lat,E)}else if(n.projection.name==="globe"){let Q=Sx(t,n),oe=i.a9.multiply([],n.projMatrix,Q),J=[0,0,0,1];i.aa.transformMat4(J,J,oe);let le=J[3]/n.cameraToCenterDistance,ue=xl(E),_e=n.projection.pixelsPerMeter(o.lat,z)*Qc(o.lat,E),Ie=n.projection.pixelsPerMeter(n.center.lat,z)*Qc(n.center.lat,E);R=le/Zt(_e,nE(n.center.lat),ue),k=le*S/_e,R*=Ie,k*=Ie}}else R=A;i.a9.scale(t,t,[R,R,k]);let j=[...t],W=e.orientation,X=[];if(uD(X,[W[0]+c[0],W[1]+c[1],W[2]+c[2]],u),i.a9.multiply(t,j,X),_&&n.elevation){let Q=0,oe=[];if(x&&n.elevation){Q=function(ue,_e,Ie,ve,Se){let Me=_e.elevation;if(!Me)return 0;let De=tr.projectAabbCorners(Ie,ve),Fe=Pi(1,Se.lat)*_e.worldSize,Le=function(xt,Vt){let St=[0,0,1],Ht=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Ut of Ht){let Jt=xt[Ut.corners[0]],Dt=xt[Ut.corners[1]],Nn=xt[Ut.corners[2]],Rn=[Dt[0]-Jt[0],Dt[1]-Jt[1],Vt*(Dt[2]-Jt[2])],gn=i.Q.cross(Rn,Rn,[Nn[0]-Jt[0],Nn[1]-Jt[1],Vt*(Nn[2]-Jt[2])]);i.Q.normalize(gn,gn),Ut.dotProductWithUp=i.Q.dot(gn,St)}return Ht.sort((Ut,Jt)=>Ut.dotProductWithUp-Jt.dotProductWithUp),Ht[0].corners}(De,Fe),Ve=De[Le[0]],Be=De[Le[1]],Ce=De[Le[2]],ht=De[Le[3]],st=Me.getAtPointOrZero(new ai(Ve[0]/_e.worldSize,Ve[1]/_e.worldSize),0),$e=Me.getAtPointOrZero(new ai(Be[0]/_e.worldSize,Be[1]/_e.worldSize),0),Et=Me.getAtPointOrZero(new ai(Ce[0]/_e.worldSize,Ce[1]/_e.worldSize),0),gt=Me.getAtPointOrZero(new ai(ht[0]/_e.worldSize,ht[1]/_e.worldSize),0),dt=(st+gt)/2,Ge=($e+Et)/2;return dt>Ge?$e<Et?L_(ue,Be,ht,Ve,$e,gt,st,Fe):L_(ue,Ce,Ve,ht,Et,st,gt,Fe):st<gt?L_(ue,Ve,Be,Ce,st,$e,Et,Fe):L_(ue,ht,Ce,Be,gt,Et,$e,Fe),Math.max(dt,Ge)}(oe,n,e.aabb,t,o);let J=i.a9.fromQuat([],oe),le=i.a9.multiply([],J,X);i.a9.multiply(t,j,le)}else Q=n.elevation.getAtPointOrZero(new ai(I.x/z,I.y/z),0);Q!==0&&(t[14]+=Q)}}function hp(t,e,n=!1){t.uploaded||(t.gfxTexture=new Dx(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function WL(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,zL.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,UL.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,VL.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?BL:jL).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,GL.members,!0)),t.segments=br.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let o=t.material;o.pbrMetallicRoughness.baseColorTexture&&hp(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&hp(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&hp(o.normalTexture,e),o.occlusionTexture&&hp(o.occlusionTexture,e,n),o.emissionTexture&&hp(o.emissionTexture,e)}function Ax(t,e,n){if(t.meshes)for(let o of t.meshes)WL(o,e,n);if(t.children)for(let o of t.children)Ax(o,e,n)}function F_(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)F_(e)}function Px(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)Px(n)}class ZL{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class QL{constructor(){this.tasks={},this.taskQueue=[],Qd(["process"],this),this.invoker=new ZL(this.process),this.nextId=0}add(e,n){let o=this.nextId++,c=function({type:u,isSymbolTile:p,zoom:_}){return _=_||0,u==="message"?0:u!=="maybePrepare"||p?u!=="parseTile"||p?u==="parseTile"&&p?300-_:u==="maybePrepare"&&p?400-_:500:200-_:100-_}(n);if(c===0){Ko();try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:n,priority:c,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){Ko();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){let u=this.tasks[this.taskQueue[c]];u.priority<n&&(n=u.priority,e=c)}if(e===null)return null;let o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class gD{constructor(e,n,o){this.target=e,this.parent=n,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Qd(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new QL}send(e,n,o,c,u=!1,p){let _=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=p,this.callbacks[_]=o);let x=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!o,targetMapId:c,mustQueue:u,sourceMapId:this.mapId,data:jc(n,x)},x),{cancel:()=>{o&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){let n=e.data,o=n.id;if(o&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let c=this.cancelCallbacks[o];delete this.cancelCallbacks[o],c&&c.cancel()}else if(n.mustQueue||Ko()){let c=this.callbacks[o],u=this.scheduler.add(()=>this.processTask(o,n),c&&c.metadata||{type:"message"});u&&(this.cancelCallbacks[o]=u)}else this.processTask(o,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let o=this.callbacks[e];delete this.callbacks[e],o&&(n.error?o(h(n.error)):o(null,h(n.data)))}else{let o=new Set,c=n.hasCallback?(p,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?jc(p):null,data:jc(_,o)},o)}:p=>{},u=h(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,u,c);else if(this.parent.getWorkerSource){let p=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,p[0],u.source,u.scope)[p[1]](u,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let Rx=(()=>{class t{constructor(n,o){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=yn();let c=this.workerPool.acquire(this.id);for(let u=0;u<c.length;u++){let p=new t.Actor(c[u],o,this.id);p.name=`Worker ${u}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,c){Wd(this.actors,(u,p)=>{u.send(n,o,p)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=gD,t})();var dp={workerUrl:"",workerClass:null,workerParams:void 0};function YL(){return dp.workerClass!=null?new dp.workerClass:new self.Worker(dp.workerUrl,dp.workerParams)}let Ox="mapboxgl_preloaded_worker_pool";class fp{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<fp.workerCount;)this.workers.push(new YL);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ox]}numActive(){return Object.keys(this.active).length}}let pp;function N_(){return pp||(pp=new fp),pp}fp.workerCount=2;let z_,Lx,as,Uh,kx,$h=null;function _D(){return Ko()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Lx||B.DRACO_URL}function yD(){if(Ko()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Uh)return Uh;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Uh=WebAssembly.validate(t)?B.MESHOPT_SIMD_URL:B.MESHOPT_URL,Uh}let B_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},XL={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},mp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function vD(t,e,n){let o=n.json.bufferViews.length,c=n.buffers.length;e.bufferView=o,n.json.bufferViews[o]={buffer:c,byteLength:t.byteLength},n.buffers[c]=t}let Fx="KHR_draco_mesh_compression";function KL(t,e){let n=t.extensions&&t.extensions[Fx];if(!n)return;let o=new as.Decoder,c=TD(e,n.bufferView),u=new as.Mesh;if(!o.DecodeArrayToMesh(c,c.byteLength,u))throw new Error("Failed to decode Draco mesh");let p=e.json.accessors[t.indices],_=B_[p.componentType],x=p.count*_.BYTES_PER_ELEMENT,w=as._malloc(x);_===Uint16Array?o.GetTrianglesUInt16Array(u,x,w):o.GetTrianglesUInt32Array(u,x,w),vD(as.memory.buffer.slice(w,w+x),p,e),as._free(w);for(let E of Object.keys(n.attributes)){let I=o.GetAttributeByUniqueId(u,n.attributes[E]),S=e.json.accessors[t.attributes[E]],A=XL[S.componentType],R=S.count*mp[S.type]*B_[S.componentType].BYTES_PER_ELEMENT,k=as._malloc(R);o.GetAttributeDataArrayForAllPoints(u,I,as[A],R,k),vD(as.memory.buffer.slice(k,k+R),S,e),as._free(k)}o.destroy(),u.destroy(),delete t.extensions[Fx]}let j_="EXT_meshopt_compression";function JL(t,e){if(!t.extensions||!t.extensions[j_])return;let n=t.extensions[j_],o=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),c=new Uint8Array(n.count*n.byteStride);kx.decodeGltfBuffer(c,n.count,n.byteStride,o,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=c.buffer,delete t.extensions[j_]}let xD=1179937895,bD=new TextDecoder("utf8");function wD(t,e){return new URL(t,e).href}function ek(t,e,n,o){return fetch(wD(t.uri,o)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[n]=c})}function TD(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function tk(t,e,n,o){if(t.uri){let c=wD(t.uri,o);return fetch(c).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[n]=u})}if(t.bufferView!==void 0){let c=TD(e,t.bufferView),u=new Blob([c],{type:t.mimeType});return createImageBitmap(u).then(p=>{e.images[n]=p})}}function ED(t,e=0,n){let o={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===xD){let E=new Uint32Array(t,e),I=2,S=(E[I++]>>2)-3,A=E[I++]>>2;if(I++,o.json=JSON.parse(bD.decode(E.subarray(I,I+A))),I+=A,I<S){let R=E[I++];I++;let k=e+(I<<2);o.buffers[0]=t.slice(k,k+R)}}else o.json=JSON.parse(bD.decode(new Uint8Array(t,e)));let{buffers:c,images:u,meshes:p,extensionsUsed:_,bufferViews:x}=o.json,w=Promise.resolve();if(c){let E=[];for(let I=0;I<c.length;I++){let S=c[I];S.uri?E.push(ek(S,o,I,n)):o.buffers[I]||(o.buffers[I]=null)}w=Promise.all(E)}return w.then(()=>{let E=[],I=_&&_.includes(Fx),S=_&&_.includes(j_);if(I&&E.push(function(){if(!as)return z_||(z_=function(A){let R,k=null;function z(){R=new Uint8Array(k.buffer)}function j(){throw new Error("Unexpected Draco error.")}let W={a:{a:j,d:function(X,Q,oe){return R.copyWithin(X,Q,Q+oe)},c:function(X){let Q=R.length,oe=Math.max(X>>>0,Math.ceil(1.2*Q)),J=Math.ceil((oe-Q)/65536);try{return k.grow(J),z(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(A,W):A.then(X=>X.arrayBuffer()).then(X=>WebAssembly.instantiate(X,W))).then(X=>{let{Rb:Q,Qb:oe,P:J,T:le,X:ue,Ja:_e,La:Ie,Qa:ve,Va:Se,Wa:Me,eb:De,jb:Fe,f:Le,e:Ve,yb:Be,zb:Ce,Ab:ht,Bb:st,Db:$e,Gb:Et}=X.instance.exports;k=Ve;let gt=(()=>{let dt=0,Ge=0,xt=0,Vt=0;return St=>{xt&&(Q(Vt),Q(dt),Ge+=xt,xt=dt=0),dt||(Ge+=128,dt=oe(Ge));let Ht=St.length+7&-8,Ut=dt;Ht>=Ge&&(xt=Ht,Ut=Vt=oe(Ht));for(let Jt=0;Jt<St.length;Jt++)R[Ut+Jt]=St[Jt];return Ut}})();return z(),Le(),{memory:Ve,_free:Q,_malloc:oe,Mesh:class{constructor(){this.ptr=J()}destroy(){le(this.ptr)}},Decoder:class{constructor(){this.ptr=_e()}destroy(){Fe(this.ptr)}DecodeArrayToMesh(dt,Ge,xt){let Vt=gt(dt),St=Ie(this.ptr,Vt,Ge,xt.ptr);return!!ue(St)}GetAttributeByUniqueId(dt,Ge){return{ptr:ve(this.ptr,dt.ptr,Ge)}}GetTrianglesUInt16Array(dt,Ge,xt){Se(this.ptr,dt.ptr,Ge,xt)}GetTrianglesUInt32Array(dt,Ge,xt){Me(this.ptr,dt.ptr,Ge,xt)}GetAttributeDataArrayForAllPoints(dt,Ge,xt,Vt,St){De(this.ptr,dt.ptr,Ge.ptr,xt,Vt,St)}},DT_INT8:Be(),DT_UINT8:Ce(),DT_INT16:ht(),DT_UINT16:st(),DT_UINT32:$e(),DT_FLOAT32:Et()}})}(fetch(_D())),z_.then(A=>{as=A,z_=void 0}))}()),S&&E.push(function(){if(kx)return;let A=function(R){let k,z=WebAssembly.instantiateStreaming(R,{}).then(X=>{k=X.instance,k.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},W={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:z,supported:!0,decodeGltfBuffer(X,Q,oe,J,le,ue){(function(_e,Ie,ve,Se,Me,De,Fe){let Le=_e.exports.sbrk,Ve=Se+3&-4,Be=Le(Ve*Me),Ce=Le(De.length),ht=new Uint8Array(_e.exports.memory.buffer);ht.set(De,Ce);let st=Ie(Be,Se,Me,Ce,De.length);if(st===0&&Fe&&Fe(Be,Ve,Me),ve.set(ht.subarray(Be,Be+Se*Me)),Le(Be-Le(0)),st!==0)throw new Error(`Malformed buffer data: ${st}`)})(k,k.exports[W[le]],X,Q,oe,J,k.exports[j[ue]])}}}(fetch(yD()));return A.ready.then(()=>{kx=A})}()),u)for(let A=0;A<u.length;A++)E.push(tk(u[A],o,A,n));return(E.length?Promise.all(E):Promise.resolve()).then(()=>{if(I&&p)for(let{primitives:A}of p)for(let R of A)KL(R,o);if(S&&p&&x)for(let A of x)JL(A,o);return o})})}class ID{constructor(e,n,o,c){if(this.triangleCount=n.length/3,this.min=new Je(0,0),this.max=new Je(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[u,p]=[e[0].clone(),e[0].clone()];for(let I=1;I<e.length;++I){let S=e[I];u.x=Math.min(u.x,S.x),u.y=Math.min(u.y,S.y),p.x=Math.max(p.x,S.x),p.y=Math.max(p.y,S.y)}if(c){let I=Math.ceil(Math.max(p.x-u.x,p.y-u.y)/c);o=Math.max(o,I)}if(o===0)return;this.min=u,this.max=p;let _=this.max.sub(this.min);_.x=Math.max(_.x,1),_.y=Math.max(_.y,1);let x=Math.max(_.x,_.y)/o;this.cellsX=Math.max(1,Math.ceil(_.x/x)),this.cellsY=Math.max(1,Math.ceil(_.y/x)),this.xScale=1/x,this.yScale=1/x;let w=[];for(let I=0;I<this.triangleCount;I++){let S=e[n[3*I+0]].sub(this.min),A=e[n[3*I+1]].sub(this.min),R=e[n[3*I+2]].sub(this.min),k=Sl(Math.floor(Math.min(S.x,A.x,R.x)),this.xScale,this.cellsX),z=Sl(Math.floor(Math.max(S.x,A.x,R.x)),this.xScale,this.cellsX),j=Sl(Math.floor(Math.min(S.y,A.y,R.y)),this.yScale,this.cellsY),W=Sl(Math.floor(Math.max(S.y,A.y,R.y)),this.yScale,this.cellsY),X=new Je(0,0),Q=new Je(0,0),oe=new Je(0,0),J=new Je(0,0);for(let le=j;le<=W;++le){X.y=Q.y=le*x,oe.y=J.y=(le+1)*x;for(let ue=k;ue<=z;++ue)X.x=oe.x=ue*x,Q.x=J.x=(ue+1)*x,(Hv(S,A,R,X,Q,J)||Hv(S,A,R,X,J,oe))&&w.push({cellIdx:le*this.cellsX+ue,triIdx:I})}}if(w.length===0)return;w.sort((I,S)=>I.cellIdx-S.cellIdx||I.triIdx-S.triIdx);let E=0;for(;E<w.length;){let I=w[E].cellIdx,S={start:this.payload.length,len:0};for(;E<w.length&&w[E].cellIdx===I;)++S.len,this.payload.push(w[E++].triIdx);this.cells[I]=S}}query(e,n,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let x=0;x<this.lookup.length;x++)this.lookup[x]=0;let c=Sl(e.x-this.min.x,this.xScale,this.cellsX),u=Sl(n.x-this.min.x,this.xScale,this.cellsX),p=Sl(e.y-this.min.y,this.yScale,this.cellsY),_=Sl(n.y-this.min.y,this.yScale,this.cellsY);for(let x=p;x<=_;x++)for(let w=c;w<=u;w++){let E=this.cells[x*this.cellsX+w];if(E)for(let I=0;I<E.len;I++){let S=this.payload[E.start+I],A=Math.floor(S/8),R=1<<S%8;if(!(this.lookup[A]&R)&&(this.lookup[A]|=R,o.push(S),o.length===this.triangleCount))return}}}}function Sl(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}function Jc(t,e){let n=t.json.bufferViews[e.bufferView],o=B_[e.componentType];return new o(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==mp[e.type]*o.BYTES_PER_ELEMENT?n.byteStride/o.BYTES_PER_ELEMENT:mp[e.type]))}function Nx(t,e,n,o){let c=B_[e.componentType],u=function(E){switch(E){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),p=t.json.bufferViews[e.bufferView],_=p.byteStride?p.byteStride/c.BYTES_PER_ELEMENT:mp[e.type],x=n.float32,w=x.length/n.capacity;for(let E=0,I=0;E<e.count*_;E+=_,I+=w)for(let S=0;S<w;S++)x[I+S]=o[E+S]*u;n._trim()}function nk(t,e,n){let o=t.indices,c=t.attributes,u={};u.indexArray=new kr;let p=e.json.accessors[o],_=p.count/3;u.indexArray.reserve(_);let x=Jc(e,p);for(let S=0;S<_;S++)u.indexArray.emplaceBack(x[3*S],x[3*S+1],x[3*S+2]);u.indexArray._trim(),u.vertexArray=new Hc;let w=e.json.accessors[c.POSITION];u.vertexArray.reserve(w.count);let E=Jc(e,w);for(let S=0;S<w.count;S++)u.vertexArray.emplaceBack(E[3*S],E[3*S+1],E[3*S+2]);if(u.vertexArray._trim(),u.aabb=new tr(w.min,w.max),u.centroid=function(S,A){let R=[0,0,0],k=S.length;if(k>0){for(let z=0;z<k;z++){let j=3*S[z];R[0]+=A[j],R[1]+=A[j+1],R[2]+=A[j+2]}R[0]/=k,R[1]/=k,R[2]/=k}return R}(x,E),c.COLOR_0!==void 0){let S=e.json.accessors[c.COLOR_0],A=mp[S.type],R=Jc(e,S);u.colorArray=A===3?new Hc:new Lr,u.colorArray.resize(S.count),Nx(e,S,u.colorArray,R)}if(c.NORMAL!==void 0){u.normalArray=new Hc;let S=e.json.accessors[c.NORMAL];u.normalArray.resize(S.count);let A=Jc(e,S);Nx(e,S,u.normalArray,A)}if(c.TEXCOORD_0!==void 0&&n.length>0){u.texcoordArray=new Ur;let S=e.json.accessors[c.TEXCOORD_0];u.texcoordArray.resize(S.count);let A=Jc(e,S);Nx(e,S,u.texcoordArray,A)}if(c._FEATURE_ID_RGBA4444!==void 0){let S=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=Jc(e,S))}c._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(Jc(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));let I=t.material;return u.material=function(S,A){let{emissiveFactor:R=[0,0,0],alphaMode:k="OPAQUE",alphaCutoff:z=.5,normalTexture:j,occlusionTexture:W,emissiveTexture:X,doubleSided:Q}=S,{baseColorFactor:oe=[1,1,1,1],metallicFactor:J=1,roughnessFactor:le=1,baseColorTexture:ue,metallicRoughnessTexture:_e}=S.pbrMetallicRoughness||{},Ie=W?A[W.index]:void 0;if(W&&W.extensions&&W.extensions.KHR_texture_transform&&Ie){let ve=W.extensions.KHR_texture_transform;Ie.offsetScale=[ve.offset[0],ve.offset[1],ve.scale[0],ve.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Sn(...oe),metallicFactor:J,roughnessFactor:le,baseColorTexture:ue?A[ue.index]:void 0,metallicRoughnessTexture:_e?A[_e.index]:void 0},doubleSided:Q,emissiveFactor:R,alphaMode:k,alphaCutoff:z,normalTexture:j?A[j.index]:void 0,occlusionTexture:Ie,emissionTexture:X?A[X.index]:void 0,defined:S.defined===void 0}}(I!==void 0?e.json.materials[I]:{defined:!1},n),u}function DD(t,e,n){let{matrix:o,rotation:c,translation:u,scale:p,mesh:_,extras:x,children:w}=t,E={};if(E.matrix=o||i.a9.fromRotationTranslationScale([],c||[0,0,0,1],u||[0,0,0],p||[1,1,1]),_!==void 0){E.meshes=n[_];let I=E.anchor=[0,0];for(let S of E.meshes){let{min:A,max:R}=S.aabb;I[0]+=A[0]+R[0],I[1]+=A[1]+R[1]}I[0]=Math.floor(I[0]/E.meshes.length/2),I[1]=Math.floor(I[1]/E.meshes.length/2)}if(x&&(x.id&&(E.id=x.id),x.lights&&(E.lights=function(I){if(!I.length)return[];let S=function(j){let W=atob(j),X=new Uint8Array(W.length);for(let Q=0;Q<W.length;Q++)X[Q]=W.codePointAt(Q);return X}(I),A=[],R=S.length/24,k=new Uint16Array(S.buffer),z=new Float32Array(S.buffer);for(let j=0;j<R;j++){let W=k[2*j*6]/30,X=k[2*j*6+1]/30,Q=k[2*j*6+10]/100,oe=z[6*j+1],J=z[6*j+2],le=z[6*j+3],ue=z[6*j+4],_e=le-oe,Ie=ue-J,ve=Math.hypot(_e,Ie);A.push({pos:[oe+.5*_e,J+.5*Ie,X],normal:[Ie/ve,-_e/ve,0],width:ve,height:W,depth:Q,points:[oe,J,le,ue]})}return A}(x.lights))),w){let I=[];for(let S of w)I.push(DD(e.json.nodes[S],e,n));E.children=I}return E}function rk(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new ID(t.vertices,t.indices,8,256),[n,o]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:n,max:o}}function ik(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let o=[];for(let p of n){if(!Array.isArray(p)||p.length!==2)continue;let _=p[0],x=p[1];typeof _=="number"&&typeof x=="number"&&o.push(new Je(_,x))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let c=0;for(let p=0;p<o.length;p++){let _=o[p],x=o[(p+1)%o.length],w=o[(p+2)%o.length];c+=(_.x-x.x)*(w.y-x.y)-(w.x-x.x)*(_.y-x.y)}c>0&&o.reverse();let u=s_(o.flatMap(p=>[p.x,p.y]),[]);return u.length===0?null:{vertices:o,indices:u}}function ok(t,e){let n=[],o=[],c=0,u=[];for(let p of t){c=n.length;let _=p.vertexArray.float32,x=p.indexArray.uint16;for(let w=0;w<p.vertexArray.length;w++)u[0]=_[3*w+0],u[1]=_[3*w+1],u[2]=_[3*w+2],i.Q.transformMat4(u,u,e),n.push(new Je(u[0],u[1]));for(let w=0;w<3*p.indexArray.length;w++)o.push(x[w]+c)}if(o.length%3!=0)return null;for(let p=0;p<o.length;p+=3){let _=n[o[p+0]],x=n[o[p+1]],w=n[o[p+2]];(_.x-x.x)*(w.y-x.y)-(w.x-x.x)*(_.y-x.y)>0&&([o[p+1],o[p+2]]=[o[p+2],o[p+1]])}return{vertices:n,indices:o}}function MD(t){let e=function(x,w){let E=[],I=WebGL2RenderingContext;if(x.json.textures)for(let S of x.json.textures){let A={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};S.sampler!==void 0&&Object.assign(A,x.json.samplers[S.sampler]),E.push({image:w[S.source],sampler:A,uploaded:!1})}return E}(t,t.images),n=function(x,w){let E=[];for(let I of x.json.meshes){let S=[];for(let A of I.primitives)S.push(nk(A,x,w));E.push(S)}return E}(t,e),{scenes:o,scene:c,nodes:u}=t.json,p=o?o[c||0].nodes:u,_=[];for(let x of p)_.push(DD(u[x],t,n));return function(x,w,E){let I={},S=new Set;for(let A=0;A<x.length;A++){let R=E[w[A]];if(!R.extras)continue;let k=R.extras["mapbox:footprint:version"],z=R.extras["mapbox:footprint:id"];(k||z)&&S.add(A),k==="1.0.0"&&z&&(I[z]=A)}for(let A=0;A<x.length;A++){if(S.has(A))continue;let R=x[A],k=E[w[A]];if(!k.extras)continue;let z=null;R.id in I&&(z=ok(x[I[R.id]].meshes,R.matrix)),z||(z=ik(k)),z&&(R.footprint=rk(z))}if(S.size>0){let A=Array.from(S.values()).sort((R,k)=>R-k);for(let R=A.length-1;R>=0;R--)x.splice(A[R],1)}}(_,p,t.json.nodes),_}function sk(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,o=t.aabb.min[1]-1,c=Kc/(t.aabb.max[0]-n+2),u=Kc/(t.aabb.max[1]-o+2);for(let p=0;p<e.length;p+=3){let _=e[p+2],x=(e[p+0]-n)*c|0,w=(e[p+1]-o)*u|0;_>t.heightmap[w*Kc+x]&&(t.heightmap[w*Kc+x]=_)}}function ak(t,e){let n={};n.indexArray=new kr,n.indexArray.reserve(4*t.length),n.vertexArray=new Hc,n.vertexArray.reserve(10*t.length),n.colorArray=new Lr,n.vertexArray.reserve(10*t.length);let o=0;for(let p of t){let _=Math.min(10,Math.max(4,1.3*p.height))*e,x=[-p.normal[1],p.normal[0],0],w=Math.min(.29,.1*p.width/p.depth),E=p.width-2*p.depth*e*(w+.01),I=i.Q.scaleAndAdd([],p.pos,x,E/2),S=i.Q.scaleAndAdd([],p.pos,x,-E/2),A=[I[0],I[1],I[2]+p.height],R=[S[0],S[1],S[2]+p.height],k=i.Q.scaleAndAdd([],p.normal,x,w);i.Q.scale(k,k,_);let z=i.Q.scaleAndAdd([],p.normal,x,-w);i.Q.scale(z,z,_),i.Q.add(k,I,k),i.Q.add(z,S,z),I[2]+=.1,S[2]+=.1,n.vertexArray.emplaceBack(k[0],k[1],k[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(k[0],k[1],k[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]);let j=E/_/2;n.colorArray.emplaceBack(-j-w,-1,j,.8),n.colorArray.emplaceBack(j+w,-1,j,.8),n.colorArray.emplaceBack(-j,0,j,1.3),n.colorArray.emplaceBack(j,0,j,1.3),n.colorArray.emplaceBack(j+w,-.8,j,.7),n.colorArray.emplaceBack(j+w,-.8,j,.7),n.colorArray.emplaceBack(0,0,j,1.3),n.colorArray.emplaceBack(0,0,j,1.3),n.colorArray.emplaceBack(j+w,-1.2,j,.8),n.colorArray.emplaceBack(j+w,-1.2,j,.8),n.indexArray.emplaceBack(6+o,4+o,8+o),n.indexArray.emplaceBack(7+o,9+o,5+o),n.indexArray.emplaceBack(0+o,1+o,2+o),n.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}let c={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=Sn.white,c.pbrMetallicRoughness=u,n.material=c,n.aabb=new tr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}lt(ID,"TriangleGridIndex");class SD{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let lk=["tile","layer","source","sourceLayer","state"];class CD{constructor(e,n,o,c,u){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=o,this._y=c,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let n of lk)this[n]!==void 0&&(e[n]=this[n]);return e}}class AD{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new dl(et,16,0),this.featureIndexArray=new HT,this.promoteId=n,this.is3DTile=!1}insert(e,n,o,c,u,p=0,_=0){let x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,u,p);let w=this.grid;for(let E=0;E<n.length;E++){let I=n[E],S=[1/0,1/0,-1/0,-1/0];for(let A=0;A<I.length;A++){let R=I[A];S[0]=Math.min(S[0],R.x),S[1]=Math.min(S[1],R.y),S[2]=Math.max(S[2],R.x),S[3]=Math.max(S[3],R.y)}_!==0&&(S[0]-=_,S[1]-=_,S[2]+=_,S[3]+=_),S[0]<et&&S[1]<et&&S[2]>=0&&S[3]>=0&&w.insert(x,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new cx(new Fh(this.rawTileData)).layers,this.sourceLayerCoder=new SD(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,o,c){this.loadVTLayers();let u=e.params||{},p=rt(u.filter),_=e.tileResult,x=e.transform,w=_.bufferedTilespaceBounds,E=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(R,k,z,j)=>cE(_.bufferedTilespaceGeometry,R,k,z,j));E.sort(ck);let I=null;x.elevation&&E.length>0&&(I=Ph.create(x.elevation,this.tileID));let S={},A;for(let R=0;R<E.length;R++){let k=E[R];if(k===A)continue;A=k;let z=this.featureIndexArray.get(k),j=null;if(this.is3DTile){let W=this.bucketLayerIDs[0][0],X=n[W];if(X.type!=="model")continue;let{queryFeature:Q,intersectionZ:oe}=X.queryIntersectsMatchingFeature(_,z.featureIndex,p,x);Q&&this.appendToResult(S,W,z.featureIndex,Q,oe)}else this.loadMatchingFeature(S,z,p,u.layers,u.availableImages,n,o,c,(W,X,Q,oe=0)=>(j||(j=va(W,this.tileID.canonical,e.tileTransform)),X.queryIntersectsFeature(_,W,Q,j,this.z,e.transform,e.pixelPosMatrix,I,oe)))}return S}loadMatchingFeature(e,n,o,c,u,p,_,x,w){let{featureIndex:E,bucketIndex:I,sourceLayerIndex:S,layoutVertexArrayOffset:A}=n,R=this.bucketLayerIDs[I];if(c&&!function(W,X){for(let Q=0;Q<W.length;Q++)if(X.indexOf(W[Q])>=0)return!0;return!1}(c,R))return;let k=this.sourceLayerCoder.decode(S),z=this.vtLayers[k].feature(E);if(o.needGeometry){let W=vl(z,!0);if(!o.filter(new H(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!o.filter(new H(this.tileID.overscaledZ),z))return;let j=this.getId(z,k);for(let W=0;W<R.length;W++){let X=R[W];if(c&&c.indexOf(X)<0)continue;let Q=p[X];if(!Q)continue;let oe={};j!==void 0&&x&&(oe=x.getState(Q.sourceLayer||"_geojsonTileLayer",j));let J=!w||w(z,Q,oe,A);if(!J)continue;let le=new CD(z,this.z,this.x,this.y,j),ue=Xi({},_[X]);ue.paint=PD(ue.paint,Q.paint,z,oe,u),ue.layout=PD(ue.layout,Q.layout,z,oe,u),le.layer=ue,this.appendToResult(e,X,E,le,J)}}appendToResult(e,n,o,c,u){let p=e[n];p===void 0&&(p=e[n]=[]),p.push({featureIndex:o,feature:c,intersectionZ:u})}lookupSymbolFeatures(e,n,o,c,u,p,_,x){let w={};this.loadVTLayers();let E=rt(u);for(let I of e)this.loadMatchingFeature(w,{bucketIndex:o,sourceLayerIndex:c,featureIndex:I,layoutVertexArrayOffset:0},E,p,_,x,n);return w}loadFeature(e){let{featureIndex:n,sourceLayerIndex:o}=e;this.loadVTLayers();let c=this.sourceLayerCoder.decode(o),u=this.vtFeatures[c];if(u[n])return u[n];let p=this.vtLayers[c].feature(n);return u[n]=p,p}hasLayer(e){for(let n of this.bucketLayerIDs)for(let o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;if(this.promoteId){let c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];c!=null&&(o=e.properties[c]),typeof o=="boolean"&&(o=Number(o))}return o}}function PD(t,e,n,o,c){return Ga(t,(u,p)=>{let _=e instanceof Ee?e.get(p):null;return _&&_.evaluate?_.evaluate(n,o,c):_})}function ck(t,e){return e-t}lt(AD,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let zx=new Float32Array(262144),eu=new Uint8Array(262144);function RD(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,RD(n));return e}function OD(t,e,n){if(t.meshes)for(let o of t.meshes)o.aabb.min[0]!==1/0&&n.insert(e,o.aabb.min[0],o.aabb.min[1],o.aabb.max[0],o.aabb.max[1]);if(t.children)for(let o of t.children)OD(o,e,n)}let LD=["","wall","door","roof","window","lamp","logo"];class kD{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:RD(e)}}}getLocalBounds(){if(!this.node.meshes)return new tr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new tr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let o of this.node.meshes)this.node.lightMeshIndex!==e&&n.encapsulate(o.aabb),e++;this.aabb=tr.applyTransform(n,this.node.matrix)}return this.aabb}}class V_{constructor(e,n,o,c,u,p){this.id=n,this.modelTraits|=Vh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=Vh.HasMapboxMeshFeatures),c&&(this.modelTraits|=Vh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=u,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let _ of e)this.nodesInfo.push(new kD(_)),OD(_,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let o of n){let c=o.node;this.uploaded?this.updatePbrBuffer(c):Ax(c,e,!0)}for(let o of n)F_(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),n=!0);return n}needsReEvaluation(e,n,o){let c=e.transform.projectionOptions,u=e.style.getBrightness(),p=this.brightness!==u;return!!(!this.uploaded||this.dirty||c.name!==this.projection.name||gp(o.paint.get("model-color").value,p)||gp(o.paint.get("model-color-mix-intensity").value,p)||gp(o.paint.get("model-roughness").value,p)||gp(o.paint.get("model-emissive-strength").value,p)||gp(o.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=c,this.brightness=u,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let o=this.getNodesInfo(),c=this.id.canonical;for(let u of o){let p=u.feature;u.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},c)}}evaluate(e){let n=this.getNodesInfo();for(let o of n){if(!o.node.meshes)continue;let c=o.feature,u=o.node.meshes&&o.node.meshes[0].featureData,p=o.evaluatedColor[2],_=o.evaluatedRMEA[2],x=this.id.canonical;if(o.hasTranslucentParts=!1,u){for(let w=0;w<LD.length;w++){let E=LD[w];E.length&&(c.properties.part=E);let I=e.paint.get("model-color").evaluate(c,{},x),S=e.paint.get("model-color-mix-intensity").evaluate(c,{},x);o.evaluatedColor[w]=[I.r,I.g,I.b,S],o.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(c,{},x),o.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(c,{},x),o.evaluatedRMEA[w][3]=I.a,o.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,{},x),!o.hasTranslucentParts&&I.a<1&&(o.hasTranslucentParts=!0)}delete c.properties.part,hk(o,p!==o.evaluatedColor[2]||_!==o.evaluatedRMEA[2],this.modelTraits)}else o.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,{},x);o.evaluatedScale=e.paint.get("model-scale").evaluate(c,{},x),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,o,c){let u=e.findDEMTileFor(o);if(u&&(u.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;let p=Ph.create(e,o,u);if(!p)return;this.modelTraits&Vh.HasMapboxMeshFeatures&&this.updateDEM(e,p,o,c);for(let _ of this.getNodesInfo()){let x=_.node;if(!x.footprint||!x.footprint.vertices||!x.footprint.vertices.length)continue;let w=x.footprint.vertices,E=p.getElevationAt(w[0].x,w[0].y,!0,!0);for(let I=1;I<w.length;I++)E=Math.min(E,p.getElevationAt(w[I].x,w[I].y,!0,!0));x.elevation=E}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,o,c){let u=n._dem._modifiedForSources[c];if(u===void 0&&(n._dem._modifiedForSources[c]=[],u=n._dem._modifiedForSources[c]),u.includes(o.canonical))return;let p=n._dem.dim;u.push(o.canonical);let _=!1;for(let x of this.getNodesInfo()){let w=x.node;if(!w.footprint||!w.footprint.grid)continue;let E=w.footprint.grid,I=n.tileCoordToPixel(E.min.x,E.min.y),S=n.tileCoordToPixel(E.max.x,E.max.y),A=Math.min(Math.min(p-S.y,I.x),Math.min(I.y,p-S.x));if(A<0)continue;let R=tn(A,2,5),k=Math.max(0,I.x-R),z=Math.max(0,I.y-R),j=Math.min(S.x+R,p-1),W=Math.min(S.y+R,p-1);for(let J=z;J<=W;++J)for(let le=k;le<=j;++le)eu[J*p+le]=255;let X=0,Q=0;for(let J=0;J<E.cellsY;++J)for(let le=0;le<E.cellsX;++le){if(!E.cells[J*E.cellsX+le])continue;let ue=n.tileCoordToPixel(E.min.x+le/E.xScale,E.min.y+J/E.yScale),_e=n.tileCoordToPixel(E.min.x+(le+1)/E.xScale,E.min.y+(J+1)/E.yScale);for(let Ie=ue.y;Ie<=Math.min(_e.y+1,p-1);++Ie)for(let ve=ue.x;ve<=Math.min(_e.x+1,p-1);++ve)eu[Ie*p+ve]===255&&(eu[Ie*p+ve]=0,X+=n.getElevationAtPixel(ve,Ie),Q++)}let oe=X/Q;k=Math.max(1,I.x-R),z=Math.max(1,I.y-R),j=Math.min(S.x+R,p-2),W=Math.min(S.y+R,p-2),_=!0;for(let J=z;J<=W;++J)for(let le=k;le<=j;++le)eu[J*p+le]===0&&(zx[J*p+le]=n._dem.set(le,J,oe));for(let J=1;J<R;++J){k=Math.max(1,I.x-J),z=Math.max(1,I.y-J),j=Math.min(S.x+J,p-2),W=Math.min(S.y+J,p-2);for(let le=z;le<=W;++le)for(let ue=k;ue<=j;++ue){let _e=le*p+ue;if(eu[_e]===255){let Ie=0,ve=0,Se=-1,Me=-1;for(let De=-1;De<=1;++De)for(let Fe=-1;Fe<=1;++Fe){let Le=(le+De)*p+ue+Fe;if(eu[Le]>=J)continue;let Ve=zx[Le],Be=Math.abs(Ve);Be>ve&&(Ie=Ve,ve=Be,Se=Fe,Me=De)}if(ve>.1){let De=1-(J+.5*Math.abs(Se*Me))/R,Fe=n._dem.get(ue,le)+Ie*De,Le=n._dem.get(ue+Se,le+Me),Ve=n._dem.get(ue-Se,le-Me,!0);(Fe-Le)*(Fe-Ve)>0&&(Fe=(Le+Ve)/2),zx[_e]=n._dem.set(ue,le,Fe),eu[_e]=J}}}}}_&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Ro.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)F_(n.node),Px(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let o=n.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){let p=c[u].node;c[u].hiddenByReplacement=!!p.footprint&&!o.find(_=>_.footprint===p.footprint)}}getHeightAtTileCoord(e,n){let o=this.getNodesInfo(),c=[],u=[0,0,0];for(let p=0;p<this.nodesInfo.length;p++){let _=o[p],x=_.node.meshes[0],w=tr.applyTransform(x.aabb,_.node.matrix);if(e<w.min[0]||n<w.min[1]||e>w.max[0]||n>w.max[1])continue;let E=(e-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*Kc|0,I=Math.min(63,(n-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*Kc|0)*Kc+Math.min(63,E);if(u[2]=x.heightmap[I],i.Q.transformMat4(u,u,_.node.matrix),!(x.heightmap[I]<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:u[2],maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new Je(e,n),new Je(e,n),c),c.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function gp(t,e){return!t.isLightConstant&&e}function uk(t,e,n,o,c,u,p,_){let x=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,E=240&e|(240&e)>>4;n[3]>0&&(x=Zt(x,255*n[0],n[3]),w=Zt(w,255*n[1],n[3]),E=Zt(E,255*n[2],n[3]));let I=x<<8|w,S=E<<8|Math.floor(255*o[3]),A=function(J){let le=tn(J,0,2);return Math.min(Math.round(.5*le*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],R=tn(c[0],0,1),k=tn(c[1],0,1),z=tn(c[2],0,1),j=tn(c[3],0,1),W,X,Q,oe;if(R!==k&&p!==u&&k!==R){let J=p-u;X=1/(J*(k-R)),Q=-(u+J*R)/(J*(k-R));let le=tn(c[4],-1,1);oe=Math.pow(10,le),W=255*z<<8|255*j}else W=65535,X=0,Q=1,oe=1;if(t.emplaceBack(I,S,A,W,X,Q,oe),_){let J=_.length;_.clear();for(let le=0;le<J;le++)_.emplaceBack(I,S,A,W,X,Q,oe)}}function hk(t,e,n){let o=t.node,c=0,u=n&Vh.HasMeshoptCompression;for(let p of o.meshes){if(o.lights&&o.lightMeshIndex===c||!p.featureData)continue;p.featureArray=new Gg,p.featureArray.reserve(p.featureData.length);let _=e;for(let x of p.featureData){let w=u?65535&x:x>>16&65535,E=u?x>>16&65535:65535&x,I=(15&E)<8?15&E:0,S=t.evaluatedRMEA[I],A=t.evaluatedColor[I],R=t.emissionHeightBasedParams[I],k;if(_&&I===2&&o.lights&&(k=new Gg,k.resize(10*o.lights.length)),uk(p.featureArray,w,A,S,R,p.aabb.min[2],p.aabb.max[2],k),k&&_){_=!1;let z=o.meshes[o.lightMeshIndex];z.featureArray=k,z.featureArray._trim()}}p.featureArray._trim(),c++}}function FD(t,e,n,o){let c=1<<t.z;e.lat=Kr((o/et+t.y)/c),e.lng=eo((n/et+t.x)/c)}lt(V_,"Tiled3dModelBucket",{omit:["layers"]}),lt(kD,"Tiled3dModelFeature");let dk={circle:class extends qt{constructor(t,e,n){super(t,xR,e,n)}createBucket(t){return new Vv(t)}queryRadius(t){let e=t;return Sh("circle-radius",this,e)+Sh("circle-stroke-width",this,e)+Yg(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,o,c,u,p,_){let x=hE(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return IE(t,o,u,p,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){let n=EE(this);return{config:new qc(this,e),defines:n,overrideFog:!1}}},heatmap:class extends qt{createBucket(t){return new ME(t)}constructor(t,e,n){super(t,RR,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Qf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Sh("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,o,c,u,p,_){let x=this.paint.get("heatmap-radius").evaluate(e,n);return IE(t,o,u,p,_,!0,!0,new Je(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new qc(this,e),overrideFog:!1}:{}}},hillshade:class extends qt{constructor(t,e,n){super(t,LR,e,n)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends qt{constructor(t,e,n){super(t,ZR,e,n)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e){return{config:new qc(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new lx(t)}queryRadius(){return Yg(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,o,c,u){return!t.queryGeometry.isAboveHorizon&&sE(uE(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends qt{constructor(t,e,n){super(t,wO,e,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new f_(t)}queryRadius(){return Yg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,o,c,u,p,_,x){let w=hE(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,n),I=this.paint.get("fill-extrusion-base").evaluate(e,n),S=[0,0],A=_&&u.elevation,R=u.elevation?u.elevation.exaggeration():1,k=t.tile.getBucket(this);if(A&&k instanceof f_){let Q=k.centroidVertexArray,oe=x+1;oe<Q.length&&(S[0]=Q.geta_centroid_pos0(oe),S[1]=Q.geta_centroid_pos1(oe))}if(S[0]===0&&S[1]===1)return!1;u.projection.name==="globe"&&(o=lI([o],[new Je(0,0),new Je(et,et)],t.tileID.canonical).map(Q=>Q.polygon).flat());let z=A?_:null,[j,W]=function(Q,oe,J,le,ue,_e,Ie,ve,Se,Me,De){return Q.projection.name==="globe"?function(Fe,Le,Ve,Be,Ce,ht,st,$e,Et,gt,dt){let Ge=[],xt=[],Vt=Fe.projection.upVectorScale(dt,Fe.center.lat,Fe.worldSize).metersToTile,St=[0,0,0,1],Ht=[0,0,0,1],Ut=(Dt,Nn,Rn,gn)=>{Dt[0]=Nn,Dt[1]=Rn,Dt[2]=gn,Dt[3]=1},Jt=aI();Ve>0&&(Ve+=Jt),Be+=Jt;for(let Dt of Le){let Nn=[],Rn=[];for(let gn of Dt){let un=gn.x+Ce.x,_n=gn.y+Ce.y,Qn=Fe.projection.projectTilePoint(un,_n,dt),Gn=Fe.projection.upVector(dt,gn.x,gn.y),fr=Ve,ar=Be;if(st){let li=uI(un,_n,Ve,Be,st,$e,Et,gt);fr+=li.base,ar+=li.top}Ve!==0?Ut(St,Qn.x+Gn[0]*Vt*fr,Qn.y+Gn[1]*Vt*fr,Qn.z+Gn[2]*Vt*fr):Ut(St,Qn.x,Qn.y,Qn.z),Ut(Ht,Qn.x+Gn[0]*Vt*ar,Qn.y+Gn[1]*Vt*ar,Qn.z+Gn[2]*Vt*ar),i.Q.transformMat4(St,St,ht),i.Q.transformMat4(Ht,Ht,ht),Nn.push(new Rh(St[0],St[1],St[2])),Rn.push(new Rh(Ht[0],Ht[1],Ht[2]))}Ge.push(Nn),xt.push(Rn)}return[Ge,xt]}(Q,oe,J,le,ue,_e,Ie,ve,Se,Me,De):Ie?function(Fe,Le,Ve,Be,Ce,ht,st,$e,Et){let gt=[],dt=[],Ge=[0,0,0,1];for(let xt of Fe){let Vt=[],St=[];for(let Ht of xt){let Ut=Ht.x+Be.x,Jt=Ht.y+Be.y,Dt=uI(Ut,Jt,Le,Ve,ht,st,$e,Et);Ge[0]=Ut,Ge[1]=Jt,Ge[2]=Dt.base,Ge[3]=1,i.aa.transformMat4(Ge,Ge,Ce),Ge[3]=Math.max(Ge[3],1e-5);let Nn=new Rh(Ge[0]/Ge[3],Ge[1]/Ge[3],Ge[2]/Ge[3]);Ge[0]=Ut,Ge[1]=Jt,Ge[2]=Dt.top,Ge[3]=1,i.aa.transformMat4(Ge,Ge,Ce),Ge[3]=Math.max(Ge[3],1e-5);let Rn=new Rh(Ge[0]/Ge[3],Ge[1]/Ge[3],Ge[2]/Ge[3]);Vt.push(Nn),St.push(Rn)}gt.push(Vt),dt.push(St)}return[gt,dt]}(oe,J,le,ue,_e,Ie,ve,Se,Me):function(Fe,Le,Ve,Be,Ce){let ht=[],st=[],$e=Ce[8]*Le,Et=Ce[9]*Le,gt=Ce[10]*Le,dt=Ce[11]*Le,Ge=Ce[8]*Ve,xt=Ce[9]*Ve,Vt=Ce[10]*Ve,St=Ce[11]*Ve;for(let Ht of Fe){let Ut=[],Jt=[];for(let Dt of Ht){let Nn=Dt.x+Be.x,Rn=Dt.y+Be.y,gn=Ce[0]*Nn+Ce[4]*Rn+Ce[12],un=Ce[1]*Nn+Ce[5]*Rn+Ce[13],_n=Ce[2]*Nn+Ce[6]*Rn+Ce[14],Qn=Ce[3]*Nn+Ce[7]*Rn+Ce[15],Gn=gn+$e,fr=un+Et,ar=_n+gt,li=Math.max(Qn+dt,1e-5),gr=gn+Ge,rr=un+xt,Cr=_n+Vt,Gr=Math.max(Qn+St,1e-5);Ut.push(new Rh(Gn/li,fr/li,ar/li)),Jt.push(new Rh(gr/Gr,rr/Gr,Cr/Gr))}ht.push(Ut),st.push(Jt)}return[ht,st]}(oe,J,le,ue,_e)}(u,o,I,E,w,p,z,S,R,u.center.lat,t.tileID.canonical),X=t.queryGeometry;return function(Q,oe,J){let le=1/0;sE(J,oe)&&(le=cI(J,oe[0]));for(let ue=0;ue<oe.length;ue++){let _e=oe[ue],Ie=Q[ue];for(let ve=0;ve<_e.length-1;ve++){let Se=_e[ve],Me=[Se,_e[ve+1],Ie[ve+1],Ie[ve],Se];Uv(J,Me)&&(le=Math.min(le,cI(J,Me)))}}return le!==1/0&&le}(j,W,X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends qt{constructor(t,e,n){super(t,dI,e,n),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Pc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=yI.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new hx(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){let n=gI(this);return{config:new qc(this,e),defines:n,overrideFog:!1}}queryRadius(t){let e=t,n=vI(Sh("line-width",this,e),Sh("line-gap-width",this,e)),o=Sh("line-offset",this,e);return n/2+Math.abs(o)+Yg(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,o,c,u){if(t.queryGeometry.isAboveHorizon)return!1;let p=uE(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),_=t.pixelToTileUnitsFactor/2*vI(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),x=this.paint.get("line-offset").evaluate(e,n);return x&&(o=function(w,E){let I=[],S=new Je(0,0);for(let A=0;A<w.length;A++){let R=w[A],k=[];for(let z=0;z<R.length;z++){let j=R[z],W=R[z+1],X=z===0?S:j.sub(R[z-1])._unit()._perp(),Q=z===R.length-1?S:W.sub(j)._unit()._perp(),oe=X._add(Q)._unit();oe._mult(1/(oe.x*Q.x+oe.y*Q.y)),k.push(oe._mult(E)._add(j))}I.push(k)}return I}(o,x*t.pixelToTileUnitsFactor)),function(w,E,I){for(let S=0;S<E.length;S++){let A=E[S];if(w.length>=3){for(let R=0;R<A.length;R++)if(Yc(w,A[R]))return!0}if(gR(w,A,I))return!0}return!1}(p,o,_)}isTileClipped(){return!0}},symbol:C_,background:class extends qt{constructor(t,e,n){super(t,SL,e,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:iD,"raster-particle":oD,sky:class extends qt{constructor(t,e,n){super(t,FL,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Qf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let o=this.paint.get("sky-atmosphere-sun"),c=!o,u=t.style.light,p=u.properties.get("position");return c&&u.properties.get("anchor")==="viewport"&&dr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?Mx(p.azimuthal,90-p.polar,e):Mx(o[0],90-o[1],e)}let n=this.paint.get("sky-gradient-center");return Mx(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends qt{constructor(t,e,n){super(t,NL,e)}},model:class extends qt{constructor(t,e,n){super(t,qL,e,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Cx(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof V_?et-1:0}queryIntersectsFeature(t,e,n,o,c,u){if(!this.modelManager)return!1;let p=this.modelManager,_=t.tile.getBucket(this);if(!(_&&_ instanceof Cx))return!1;let x=_;for(let w in x.instancesPerModel){let E=x.instancesPerModel[w],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(E.idToFeaturesIndex.hasOwnProperty(I)){let S=E.features[E.idToFeaturesIndex[I]],A=p.getModel(w,this.scope);if(!A)return!1;let R=i.a9.create(),k=new mn(0,0),z=x.canonical,j=Number.MAX_VALUE;for(let W=0;W<S.instancedDataCount;++W){let X=16*(S.instancedDataOffset+W),Q=E.instancedDataArray.float32,oe=[Q[X+4],Q[X+5],Q[X+6]];FD(z,k,Q[X],0|Q[X+1]),mD(R,A,u,k,S.rotation,S.scale,oe,!1,!1,!1),u.projection.name==="globe"&&(R=Sx(R,u));let J=i.a9.multiply([],u.projMatrix,R),le=t.queryGeometry,ue=hD(le.isPointQuery()?le.screenBounds:le.screenGeometry,u,J,A.aabb);ue!=null&&(j=Math.min(ue,j))}return j!==Number.MAX_VALUE&&j}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof zc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,o){let c=t.tile,u=c.getBucket(this),p=null,_=Number.MAX_VALUE;if(!(u&&u instanceof V_))return{queryFeature:p,intersectionZ:_};let x=u.getNodesInfo()[e];if(x.hiddenByReplacement||!x.node.meshes||!n.filter(new H(c.tileID.overscaledZ),x.feature,c.tileID.canonical))return{queryFeature:p,intersectionZ:_};let w=x.node,E=o.calculatePosMatrix(c.tileID.toUnwrapped(),o.worldSize),I=x.evaluatedScale,S=0;o.elevation&&w.elevation&&(S=w.elevation*o.elevation.exaggeration()),i.a9.translate(E,E,[(w.anchor?w.anchor[0]:0)*(I[0]-1),(w.anchor?w.anchor[1]:0)*(I[1]-1),S]),i.a9.scale(E,E,I),i.a9.multiply(E,E,w.matrix);let A=t.queryGeometry,R=A.isPointQuery()?A.screenBounds:A.screenGeometry,k=function(j){let W=i.a9.multiply([],E,j.matrix),X=i.a9.multiply(W,o.expandedFarZProjMatrix,W);for(let Q=0;Q<j.meshes.length;++Q){let oe=j.meshes[Q];if(Q===j.lightMeshIndex)continue;let J=hD(R,o,X,oe.aabb);J!=null&&(_=Math.min(J,_))}if(j.children)for(let Q of j.children)k(Q)};if(k(w),_===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:_};let z=new mn(0,0);return FD(c.tileID.canonical,z,x.node.anchor[0],x.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[z.lng,z.lat]},properties:x.feature.properties,id:x.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:_}}}},zt={read:function(t,e){return t.readFields(zt._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,n){t===1?e.header_length=n.readFixed32():t===2?e.x=n.readVarint():t===3?e.y=n.readVarint():t===4?e.z=n.readVarint():t===5&&e.layers.push(zt.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};zt.Filter.read=function(t,e){return t.readFields(zt.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},zt.Filter._readField=function(t,e,n){t===1?(e.delta_filter=zt.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=zt.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=zt.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=zt.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},zt.Filter.Delta={},zt.Filter.Delta.read=function(t,e){return t.readFields(zt.Filter.Delta._readField,{block_size:0},e)},zt.Filter.Delta._readField=function(t,e,n){t===1&&(e.block_size=n.readVarint())},zt.Filter.Zigzag={},zt.Filter.Zigzag.read=function(t,e){return t.readFields(zt.Filter.Zigzag._readField,{},e)},zt.Filter.Zigzag._readField=function(t,e,n){},zt.Filter.BitShuffle={},zt.Filter.BitShuffle.read=function(t,e){return t.readFields(zt.Filter.BitShuffle._readField,{},e)},zt.Filter.BitShuffle._readField=function(t,e,n){},zt.Filter.ByteShuffle={},zt.Filter.ByteShuffle.read=function(t,e){return t.readFields(zt.Filter.ByteShuffle._readField,{},e)},zt.Filter.ByteShuffle._readField=function(t,e,n){},zt.Codec={},zt.Codec.read=function(t,e){return t.readFields(zt.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},zt.Codec._readField=function(t,e,n){t===1?(e.gzip_data=zt.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=zt.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):t===3?(e.webp_image=zt.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):t===4&&(e.png_image=zt.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},zt.Codec.GzipData={},zt.Codec.GzipData.read=function(t,e){return t.readFields(zt.Codec.GzipData._readField,{},e)},zt.Codec.GzipData._readField=function(t,e,n){},zt.Codec.JpegImage={},zt.Codec.JpegImage.read=function(t,e){return t.readFields(zt.Codec.JpegImage._readField,{},e)},zt.Codec.JpegImage._readField=function(t,e,n){},zt.Codec.WebpImage={},zt.Codec.WebpImage.read=function(t,e){return t.readFields(zt.Codec.WebpImage._readField,{},e)},zt.Codec.WebpImage._readField=function(t,e,n){},zt.Codec.PngImage={},zt.Codec.PngImage.read=function(t,e){return t.readFields(zt.Codec.PngImage._readField,{},e)},zt.Codec.PngImage._readField=function(t,e,n){},zt.DataIndexEntry={},zt.DataIndexEntry.read=function(t,e){return t.readFields(zt.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},zt.DataIndexEntry._readField=function(t,e,n){t===1?e.first_byte=n.readFixed64():t===2?e.last_byte=n.readFixed64():t===3?e.filters.push(zt.Filter.read(n,n.readVarint()+n.pos)):t===4?e.codec=zt.Codec.read(n,n.readVarint()+n.pos):t===5?e.offset=n.readFloat():t===6?e.scale=n.readFloat():t===7&&e.bands.push(n.readString())},zt.Layer={},zt.Layer.read=function(t,e){return t.readFields(zt.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},zt.Layer._readField=function(t,e,n){t===1?e.version=n.readVarint():t===2?e.name=n.readString():t===3?e.units=n.readString():t===4?e.tilesize=n.readVarint():t===5?e.buffer=n.readVarint():t===6?e.pixel_format=n.readVarint():t===7&&e.data_index.push(zt.DataIndexEntry.read(n,n.readVarint()+n.pos))};let ls={read:function(t,e){return t.readFields(ls._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,n){t===2?(e.uint32_values=ls.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=ls.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};ls.Uint32Values.read=function(t,e){return t.readFields(ls.Uint32Values._readField,{values:[]},e)},ls.Uint32Values._readField=function(t,e,n){t===1&&(e.readValuesInto=function(o){if(o.type!==2)throw new Error(`Unsupported pbf type "${o.type}"`);let c=function(p){return p.type===2?p.readVarint()+p.pos:p.pos+1}(o),u=o.pos;return o.pos=c,function(p){o.pos=u;let _=0;for(;o.pos<c;){let x=o.readVarint();p[_++]=x}return p}}(n))},ls.Fixed32Values={},ls.Fixed32Values.read=function(t,e){return t.readFields(ls.Fixed32Values._readField,{values:[]},e)},ls.Fixed32Values._readField=function(t,e,n){throw new Error("Not implemented")};class fk{constructor(e=0,n=0,o=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=o,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let o=this.items[e];this.ttl>0&&o.expiry<=Date.now()?this.delete(e):(n=o.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,o=!1,c=this.resetTtl){let u;if(o||this.has(e)){if(u=this.items[e],u.value=n,o===!1&&c&&(u.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==u){let p=this.last,_=u.next,x=u.prev;this.first===u&&(this.first=u.next),u.next=null,u.prev=this.last,p.next=u,x!==null&&(x.next=_),_!==null&&(_.prev=x)}}else this.max>0&&this.size===this.max&&this.evict(!0),u=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=u:this.last.next=u;return this.last=u,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function pk(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let o=2;o>=1;o--){let c=o===1?1:0,u=o===2?1:0;for(let p=0;p<e[0];p++){let _=e[1]*p;for(let x=c;x<e[1];x++){let w=e[2]*(x+_);for(let E=u;E<e[2];E++){let I=e[3]*(E+w);for(let S=0;S<e[3];S++){let A=I+S;t[A]+=t[A-n]}}}}n*=e[o]}return t}function mk(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function gk(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){let o=t[n],c=t[n+1];t[n]=(240&o)>>4|(61440&o)>>8|(240&c)<<4|61440&c,t[n+1]=15&o|(3840&o)>>4|(15&c)<<8|(3840&c)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){let o=t[n],c=t[n+1],u=t[n+2],p=t[n+3];t[n+0]=(192&o)>>6|(192&c)>>4|(192&u)>>2|192&p,t[n+1]=(48&o)>>4|(48&c)>>2|48&u|(48&p)<<2,t[n+2]=(12&o)>>2|12&c|(12&u)<<2|(12&p)<<4,t[n+3]=3&o|(3&c)<<2|(3&u)<<4|(3&p)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Cl extends Error{constructor(e){super(e),this.name="MRTError"}}var wo=Uint8Array,Gh=Uint16Array,_k=Int32Array,ND=new wo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),zD=new wo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yk=new wo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),BD=function(t,e){for(var n=new Gh(31),o=0;o<31;++o)n[o]=e+=1<<t[o-1];var c=new _k(n[30]);for(o=1;o<30;++o)for(var u=n[o];u<n[o+1];++u)c[u]=u-n[o]<<5|o;return{b:n,r:c}},jD=BD(ND,2),VD=jD.b,vk=jD.r;VD[28]=258,vk[258]=28;for(var xk=BD(zD,0).b,Bx=new Gh(32768),Er=0;Er<32768;++Er){var Hh=(43690&Er)>>1|(21845&Er)<<1;Bx[Er]=((65280&(Hh=(61680&(Hh=(52428&Hh)>>2|(13107&Hh)<<2))>>4|(3855&Hh)<<4))>>8|(255&Hh)<<8)>>1}var _p=function(t,e,n){for(var o=t.length,c=0,u=new Gh(e);c<o;++c)t[c]&&++u[t[c]-1];var p,_=new Gh(e);for(c=1;c<e;++c)_[c]=_[c-1]+u[c-1]<<1;if(n){p=new Gh(1<<e);var x=15-e;for(c=0;c<o;++c)if(t[c])for(var w=c<<4|t[c],E=e-t[c],I=_[t[c]-1]++<<E,S=I|(1<<E)-1;I<=S;++I)p[Bx[I]>>x]=w}else for(p=new Gh(o),c=0;c<o;++c)t[c]&&(p[c]=Bx[_[t[c]-1]++]>>15-t[c]);return p},yp=new wo(288);for(Er=0;Er<144;++Er)yp[Er]=8;for(Er=144;Er<256;++Er)yp[Er]=9;for(Er=256;Er<280;++Er)yp[Er]=7;for(Er=280;Er<288;++Er)yp[Er]=8;var UD=new wo(32);for(Er=0;Er<32;++Er)UD[Er]=5;var bk=_p(yp,9,1),wk=_p(UD,5,1),jx=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},cs=function(t,e,n){var o=e/8|0;return(t[o]|t[o+1]<<8)>>(7&e)&n},Vx=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},Tk=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],us=function(t,e,n){var o=new Error(e||Tk[t]);if(o.code=t,Error.captureStackTrace&&Error.captureStackTrace(o,us),!n)throw o;return o},Ek=new wo(0),Ik=typeof TextDecoder<"u"&&new TextDecoder;try{Ik.decode(Ek,{stream:!0})}catch{}let Dk={gzip_data:"gzip"},Mk={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Sk={uint32:1,uint16:2,uint8:4},Ck={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class $D{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),o=new DataView(e);if(n[0]!==13)throw new Cl("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),o=this.getHeaderLength(e);if(n.length<o)throw new Cl(`Expected header with length >= ${o} but got buffer of length ${n.length}`);let c=new Fh(n.subarray(0,o)),u=zt.read(c);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new Cl(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(let p of u.layers)this.layers[p.name]=new Ak(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],o=this.getLayer(e.layerName);for(let c=0;c<o.dataIndex.length;c++){let u=o.dataIndex[c],p=u.first_byte-e.firstByte,_=u.last_byte+1-e.firstByte;if(c<e.firstBlock||c>e.lastBlock||o._blocksInProgress.has(c))continue;let x={layerName:o.name,firstByte:p,lastByte:_,pixelFormat:o.pixelFormat,blockIndex:c,blockShape:[u.bands.length].concat(o.bandShape),buffer:o.buffer,codec:u.codec.codec,filters:u.filters.map(w=>w.filter)};o._blocksInProgress.add(c),n.push(x)}return new GD(n,()=>{n.forEach(c=>o._blocksInProgress.delete(c.blockIndex))},(c,u)=>{if(n.forEach(p=>o._blocksInProgress.delete(p.blockIndex)),c)throw c;u.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class Ak{constructor({version:e,name:n,units:o,tilesize:c,pixel_format:u,buffer:p,data_index:_},x){if(this.version=e,this.version!==1)throw new Cl(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=o,this.tileSize=c,this.buffer=p,this.pixelFormat=Mk[u],this.dataIndex=_,this.bandShape=[c+2*p,c+2*p,Sk[this.pixelFormat]],this._decodedBlocks=function(w=1e3,E=0,I=!1){if(isNaN(w)||w<0)throw new TypeError("Invalid max value");if(isNaN(E)||E<0)throw new TypeError("Invalid ttl value");if(typeof I!="boolean")throw new TypeError("Invalid resetTtl value");return new fk(w,E,I)}(x?x.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[o,c]of this.dataIndex.entries()){for(let[u,p]of c.bands.entries())if(p===e)return{bandIndex:n+u,blockIndex:o,blockBandIndex:u};n+=c.bands.length}break;case"number":for(let[o,c]of this.dataIndex.entries()){if(e>=n&&e<n+c.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-n};n+=c.bands.length}break;default:throw new Cl(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Cl(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,o=-1/0,c=1/0,u=-1/0;for(let p of e){let{blockIndex:_}=this.getBlockForBand(p);if(_<0)throw new Cl(`Invalid band: ${JSON.stringify(p)}`);let x=this.dataIndex[_];c=Math.min(c,_),u=Math.max(u,_),n=Math.min(n,x.first_byte),o=Math.max(o,x.last_byte)}return{layerName:this.name,firstByte:n,lastByte:o,firstBlock:c,lastBlock:u}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:o}=this.getBlockForBand(e),c=this._decodedBlocks.get(n.toString());if(!c)throw new Cl(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let u=this.dataIndex[n],p=this.bandShape.reduce((w,E)=>w*E,1),_=o*p,x=c.subarray(_,_+p);return{data:x,bytes:new Uint8Array(x.buffer).subarray(x.byteOffset,x.byteOffset+x.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:u.offset,scale:u.scale}}}class GD{constructor(e,n,o){this.tasks=e,this._onCancel=n,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}$D.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{let{layerName:o,firstByte:c,lastByte:u,pixelFormat:p,blockShape:_,blockIndex:x,filters:w,codec:E}=n,I=new Uint8Array(t).subarray(c,u+1),S=new Uint32Array(_[0]*_[1]*_[2]),A;if(E!=="gzip_data")throw new Error(`Unhandled codec: ${E}`);return A=function(R,k){if(!globalThis.DecompressionStream&&k==="gzip_data")return Promise.resolve(((X=function(J){J[0]==31&&J[1]==139&&J[2]==8||us(6,"invalid gzip data");var le=J[3],ue=10;4&le&&(ue+=2+(J[10]|J[11]<<8));for(var _e=(le>>3&1)+(le>>4&1);_e>0;_e-=!J[ue++]);return ue+(2&le)}(W=R))+8>W.length&&us(6,"invalid gzip data"),function(J,le,ue,_e){var Ie=J.length;if(!Ie||le.f&&!le.l)return ue||new wo(0);var ve=!ue,Se=ve||le.i!=2,Me=le.i;ve&&(ue=new wo(3*Ie));var De,Fe,Le=function(Al){var Pl=ue.length;if(Al>Pl){var tu=new wo(Math.max(2*Pl,Al));tu.set(ue),ue=tu}},Ve=le.f||0,Be=le.p||0,Ce=le.b||0,ht=le.l,st=le.d,$e=le.m,Et=le.n,gt=8*Ie;do{if(!ht){Ve=cs(J,Be,1);var dt=cs(J,Be+1,3);if(Be+=3,!dt){var Ge=J[(un=4+((Be+7)/8|0))-4]|J[un-3]<<8,xt=un+Ge;if(xt>Ie){Me&&us(0);break}Se&&Le(Ce+Ge),ue.set(J.subarray(un,xt),Ce),le.b=Ce+=Ge,le.p=Be=8*xt,le.f=Ve;continue}if(dt==1)ht=bk,st=wk,$e=9,Et=5;else if(dt==2){var Vt=cs(J,Be,31)+257,St=cs(J,Be+10,15)+4,Ht=Vt+cs(J,Be+5,31)+1;Be+=14;for(var Ut=new wo(Ht),Jt=new wo(19),Dt=0;Dt<St;++Dt)Jt[yk[Dt]]=cs(J,Be+3*Dt,7);Be+=3*St;var Nn=jx(Jt),Rn=(1<<Nn)-1,gn=_p(Jt,Nn,1);for(Dt=0;Dt<Ht;){var un,_n=gn[cs(J,Be,Rn)];if(Be+=15&_n,(un=_n>>4)<16)Ut[Dt++]=un;else{var Qn=0,Gn=0;for(un==16?(Gn=3+cs(J,Be,3),Be+=2,Qn=Ut[Dt-1]):un==17?(Gn=3+cs(J,Be,7),Be+=3):un==18&&(Gn=11+cs(J,Be,127),Be+=7);Gn--;)Ut[Dt++]=Qn}}var fr=Ut.subarray(0,Vt),ar=Ut.subarray(Vt);$e=jx(fr),Et=jx(ar),ht=_p(fr,$e,1),st=_p(ar,Et,1)}else us(1);if(Be>gt){Me&&us(0);break}}Se&&Le(Ce+131072);for(var li=(1<<$e)-1,gr=(1<<Et)-1,rr=Be;;rr=Be){var Cr=(Qn=ht[Vx(J,Be)&li])>>4;if((Be+=15&Qn)>gt){Me&&us(0);break}if(Qn||us(2),Cr<256)ue[Ce++]=Cr;else{if(Cr==256){rr=Be,ht=null;break}var Gr=Cr-254;Cr>264&&(Gr=cs(J,Be,(1<<(Ri=ND[Dt=Cr-257]))-1)+VD[Dt],Be+=Ri);var Hr=st[Vx(J,Be)&gr],Hn=Hr>>4;if(Hr||us(3),Be+=15&Hr,ar=xk[Hn],Hn>3){var Ri=zD[Hn];ar+=Vx(J,Be)&(1<<Ri)-1,Be+=Ri}if(Be>gt){Me&&us(0);break}Se&&Le(Ce+131072);var Ta=Ce+Gr;if(Ce<ar){var Vo=0-ar,hs=Math.min(ar,Ta);for(Vo+Ce<0&&us(3);Ce<hs;++Ce)ue[Ce]=(void 0)[Vo+Ce]}for(;Ce<Ta;++Ce)ue[Ce]=ue[Ce-ar]}}le.l=ht,le.p=rr,le.b=Ce,le.f=Ve,ht&&(Ve=1,le.m=$e,le.d=st,le.n=Et)}while(!Ve);return Ce!=ue.length&&ve?(De=ue,((Fe=Ce)==null||Fe>De.length)&&(Fe=De.length),new wo(De.subarray(0,Fe))):ue.subarray(0,Ce)}(W.subarray(X,-8),{i:2},new wo(((z=W)[(j=z.length)-4]|z[j-3]<<8|z[j-2]<<16|z[j-1]<<24)>>>0))));var z,j,W,X;let Q=Dk[k];if(!Q)throw new Error(`Unhandled codec: ${k}`);let oe=new globalThis.DecompressionStream(Q);return new Response(new Blob([R]).stream().pipeThrough(oe)).arrayBuffer().then(J=>new Uint8Array(J))}(I,E).then(R=>{let k=ls.read(new Fh(R));if(k.values==="uint32_values")return k.uint32_values.readValuesInto(S),new Ck[p](S.buffer);throw new Error(`Unhandled numeric data "${k.values}"`)}),A.then(R=>{for(let k=w.length-1;k>=0;k--)switch(w[k]){case"delta_filter":pk(R,_);break;case"zigzag_filter":mk(R);break;case"bitshuffle_filter":gk(R,p);break;default:throw new Error(`Unhandled filter "${w[k]}"`)}return{layerName:o,blockIndex:x,data:R}}).catch(R=>{throw R})}))},lt(GD,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let HD=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ux{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);let u=HD[15&o];if(!u)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new Ux(_,p,u,e)}constructor(e,n=64,o=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let u=HD.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+_+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return $x(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:p,nodeSize:_}=this,x=[0,u.length-1,0],w=[];for(;x.length;){let E=x.pop()||0,I=x.pop()||0,S=x.pop()||0;if(I-S<=_){for(let z=S;z<=I;z++){let j=p[2*z],W=p[2*z+1];j>=e&&j<=o&&W>=n&&W<=c&&w.push(u[z])}continue}let A=S+I>>1,R=p[2*A],k=p[2*A+1];R>=e&&R<=o&&k>=n&&k<=c&&w.push(u[A]),(E===0?e<=R:n<=k)&&(x.push(S),x.push(A-1),x.push(1-E)),(E===0?o>=R:c>=k)&&(x.push(A+1),x.push(I),x.push(1-E))}return w}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:c,coords:u,nodeSize:p}=this,_=[0,c.length-1,0],x=[],w=o*o;for(;_.length;){let E=_.pop()||0,I=_.pop()||0,S=_.pop()||0;if(I-S<=p){for(let z=S;z<=I;z++)WD(u[2*z],u[2*z+1],e,n)<=w&&x.push(c[z]);continue}let A=S+I>>1,R=u[2*A],k=u[2*A+1];WD(R,k,e,n)<=w&&x.push(c[A]),(E===0?e-o<=R:n-o<=k)&&(_.push(S),_.push(A-1),_.push(1-E)),(E===0?e+o>=R:n+o>=k)&&(_.push(A+1),_.push(I),_.push(1-E))}return x}}function $x(t,e,n,o,c,u){if(c-o<=n)return;let p=o+c>>1;qD(t,e,p,o,c,u),$x(t,e,n,o,p-1,1-u),$x(t,e,n,p+1,c,1-u)}function qD(t,e,n,o,c,u){for(;c>o;){if(c-o>600){let w=c-o+1,E=n-o+1,I=Math.log(w),S=.5*Math.exp(2*I/3),A=.5*Math.sqrt(I*S*(w-S)/w)*(E-w/2<0?-1:1);qD(t,e,n,Math.max(o,Math.floor(n-E*S/w+A)),Math.min(c,Math.floor(n+(w-E)*S/w+A)),u)}let p=e[2*n+u],_=o,x=c;for(vp(t,e,o,n),e[2*c+u]>p&&vp(t,e,o,c);_<x;){for(vp(t,e,_,x),_++,x--;e[2*_+u]<p;)_++;for(;e[2*x+u]>p;)x--}e[2*o+u]===p?vp(t,e,o,x):(x++,vp(t,e,x,c)),x<=n&&(o=x+1),n<=x&&(c=x-1)}}function vp(t,e,n,o){Gx(t,n,o),Gx(e,2*n,2*o),Gx(e,2*n+1,2*o+1)}function Gx(t,e,n){let o=t[e];t[e]=t[n],t[n]=o}function WD(t,e,n,o){let c=t-n,u=e-o;return c*c+u*u}i.$=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,o]){let c=oc([1,n,o]);return{x:c.x,y:c.y,z:c.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Zt(t.x,e.x,n),y:Zt(t.y,e.y,n),z:Zt(t.z,e.z,n)}}},i.A=Ae,i.B=jf,i.C=Si,i.D=Fg,i.E=oa,i.F=function(t){let e=t.value,n=[];if(!e)return n;let o=Cs(e);return o!=="string"?(n=n.concat([new k_(t.key,e,`string expected, "${o}" found`)]),n):(dD(e,!0)||(n=n.concat([new k_(t.key,e,`invalid url "${e}"`)])),n)},i.G=ne,i.H=me,i.I=_x,i.J=he,i.K=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return oc(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Zt(t.x,e.x,n),y:Zt(t.y,e.y,n),z:Zt(t.z,e.z,n),azimuthal:Zt(t.azimuthal,e.azimuthal,n),polar:Zt(t.polar,e.polar,n)}}},i.L=ae,i.M=class{constructor(t,e,n,o){this.id=t,this.position=e!=null?new mn(e[0],e[1]):new mn(0,0),this.orientation=n??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new tr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(i.a9.multiply(t.matrix,e,t.matrix),t.meshes)for(let n of t.meshes){let o=tr.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(o)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=i.a9.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,o,c,u,p=!1){mD(this.matrix,this,t.transform,this.position,e,n,o,c,u,p)}upload(t){if(!this.uploaded){for(let e of this.nodes)Ax(e,t);for(let e of this.nodes)F_(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)Px(t)}},i.N=H,i.O=ai,i.P=Je,i.R=Vu,i.S=nc,i.T=Dx,i.U=Ee,i.V=k_,i.W=xl,i.X=Zt,i.Y=et,i.Z=zc,i._=gc,i.a=Yu,i.a$=Qd,i.a0=function(t,e,n=0,o=!0){let c=new Je(n,n),u=t.sub(c),p=e.add(c),_=[u,new Je(p.x,u.y),p,new Je(u.x,p.y)];return o&&_.push(u.clone()),_},i.a1=function(t,e){let n=[];for(let o=0;o<t.length;o++){let c=Yo(o-1,-1,t.length-1),u=Yo(o+1,-1,t.length-1),p=t[o],_=t[u],x=t[c].sub(p).unit(),w=_.sub(p).unit(),E=w.angleWithSep(x.x,x.y),I=x.add(w).unit().mult(-1*e/Math.sin(E/2));n.push(p.add(I))}return n},i.a2=QI,i.a3=cE,i.a4=function(t,e,n=0){return i.Q.fromValues(((e.x-n)*t.scale-t.x)*et,(e.y*t.scale-t.y)*et,tE(e.z,e.y))},i.a5=qv,i.a6=fI,i.a7=function(t){let e=1/0,n=1/0,o=-1/0,c=-1/0;for(let u of t)e=Math.min(e,u.x),n=Math.min(n,u.y),o=Math.max(o,u.x),c=Math.max(c,u.y);return{min:new Je(e,n),max:new Je(o,c)}},i.a8=yl,i.aA=Sn,i.aB=Bt,i.aC=Pg,i.aD=Sv,i.aE=br,i.aF=yn,i.aG=NT,i.aH=S_,i.aI=function(){re.isLoading()||re.isLoaded()||te()!=="deferred"||ee()},i.aJ=rt,i.aK=vl,i.aL=CD,i.aM=Bi,i.aN=hx,i.aO=lx,i.aP=va,i.aQ=Yr,i.aR=Dv,i.aS=mE,i.aT=s_,i.aU=Ix,i.aV=function(t,e){let n=xl(e.zoom);if(n===0)return Fs(t);let o=Jg(t),c=Yv(o),u=yl(o.getWest())*e.worldSize,p=yl(o.getEast())*e.worldSize,_=ya(o.getNorth())*e.worldSize,x=ya(o.getSouth())*e.worldSize,w=[u,_,0],E=[p,_,0],I=[u,x,0],S=[p,x,0],A=i.a9.invert([],e.globeMatrix);return i.Q.transformMat4(w,w,A),i.Q.transformMat4(E,E,A),i.Q.transformMat4(I,I,A),i.Q.transformMat4(S,S,A),c[0]=xa(c[0],I,n),c[1]=xa(c[1],S,n),c[2]=xa(c[2],E,n),c[3]=xa(c[3],w,n),tr.fromPoints(c)},i.aW=t_,i.aX=Zf,i.aY=xa,i.aZ=Or,i.a_=wR,i.ab=Yc,i.ac=iE,i.ad=tn,i.ae=Ai,i.af=function(t,e){let n={};for(let o=0;o<e.length;o++){let c=e[o];c in t&&(n[c]=t[c])}return n},i.ag=_l,i.ah=ya,i.ai=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,o){let c=this.entries[t]=this.entries[t]||{callbacks:[]};if(c.result){let[u,p]=c.result;return this.scheduler?this.scheduler.add(()=>{o(u,p)},e):o(u,p),()=>{}}return c.callbacks.push(o),c.cancel||(c.cancel=n((u,p)=>{c.result=[u,p];for(let _ of c.callbacks)this.scheduler?this.scheduler.add(()=>{_(u,p)},e):_(u,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(u=>u!==o),c.callbacks.length||(c.cancel(),delete this.entries[t]))}}},i.aj=Un,i.ak=function(t,e,n){let o=JSON.stringify(t.request);return t.data&&(this.deduped.entries[o]={result:[null,t.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{let u=cc(t.request,(p,_,x,w)=>{p?c(p):_&&c(null,{vectorTile:n?void 0:new cx(new Fh(_)),rawData:_,cacheControl:x,expires:w})});return()=>{u.cancel(),c()}},e)},i.al=function(t){ef++,ef>tg&&(t.getActor().send("enforceCacheSizeLimit",Bu),ef=0)},i.am=Di,i.an=Fu,i.ao=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},i.ap=si,i.aq=iD,i.ar=oD,i.as=rD,i.at=function(t,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let o=0;o<t.length;o++){let c=document.createElement("source");nf(t[o])||(n.crossOrigin="Anonymous"),c.src=t[o],n.appendChild(c)}return{cancel:()=>{}}},i.au=A_,i.av=sp,i.aw=eo,i.ax=Kr,i.ay=Xr,i.az=kr,i.b=Ms,i.b$=zh,i.b0=$D,i.b1=cc,i.b2=function(t){let e=[];for(let n in t)e.push(t[n]);return e},i.b3=function(t,e){let n=[];for(let o in t)o in e||n.push(o);return n},i.b4=Wd,i.b5=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.b6=function(t,e){let{x:n,y:o}=t.point,c=bE(n,o,t.worldSize/t._pixelsPerMercatorPixel,0,0);return i.a9.multiply(c,c,Xv(Fs(e)))},i.b8=Oh,i.b9=bo,i.bA=KT,i.bB=function(t){let e=i.a9.identity(new Float64Array(16));i.a9.multiply(e,t.pixelMatrix,t.globeMatrix);let n=[0,Bo,0],o=[0,jo,0];return i.Q.transformMat4(n,n,e),i.Q.transformMat4(o,o,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Jv(t,new mn(t.center.lat,90)),o[0]>0&&o[0]<=t.width&&o[1]>0&&o[1]<=t.height&&!Jv(t,new mn(t.center.lat,-90))]},i.bC=function(t,e){let{scale:n}=t.tileTransform,o=n*et/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return i.b7.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},i.bD=O_,i.bE=sD,i.bF=function(t){let e=sD(t,!0);return i.b7.invert([],[e[0],e[1],e[4],e[5]])},i.bG=Wv,i.bH=function(t){let{x:e,y:n}=t.point,{lng:o,lat:c}=t._center;return bE(e,n,t.worldSize,o,c)},i.bI=yi,i.bJ=Lv,i.bK=function(t){let e=Math.round((t+45+360)%360/90)%4;return Ym[e]},i.bL=45,i.bM=Nv,i.bN=Gf,i.bO=pl,i.bP=Pv,i.bQ=Ci,i.bR=qg,i.bS=QT,i.bT=function(t,e,n){let o=Math.sqrt(t*t+e*e+n*n),c=o>0?Math.acos(n/o)*qd:0,u=t!==0||e!==0?Math.atan2(-e,-t)*qd+90:0;return u<0&&(u+=360),[o,u,c]},i.bU=Wg,i.bV=tr,i.bW=oc,i.bX=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},i.bY=function(t){return t({pluginStatus:U,pluginURL:V}),Z.on("pluginStateChange",t),t},i.bZ=Rx,i.b_=N_,i.ba=p_,i.bb=function(t,e,n,o,c){let u=5*e+2;t.float32[u+0]=n,t.float32[u+1]=o,t.float32[u+2]=c},i.bc=M_,i.bd=zI,i.be=Uv,i.bf=Jr,i.bg=xx,i.bh=HI,i.bi=gx,i.bj=Ux,i.bk=Yo,i.bm=hn,i.bn=na,i.bo=Pi,i.bp=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},i.bq=mn,i.br=eD,i.bs=eE,i.bt=Zv,i.bu=aD,i.bv=Zc,i.bw=yE,i.bx=function(t,e,n,o,c,u,p,_,x){if(x.name==="globe")return yE(t,e,new Zc(n,o,c),!1);let w=sp({z:n,x:o,y:c},x);return new tr([(u+w.x/w.scale)*e,e*(w.y/w.scale),p],[(u+w.x2/w.scale)*e,e*(w.y2/w.scale),_])},i.by=function(t,e,n){let o=0;for(let c=0;c<2;++c)t[c]>0&&(o+=(t[c]-0)*(t[c]-0)),e[c]<0&&(o+=(0-e[c])*(0-e[c]));return o},i.bz=wr,i.c=MD,i.c$=[1,1,1],i.c0=yx,i.c1=Qa,i.c2=$,i.c3=se,i.c4=zu,i.c5=fc,i.c6=Xo,i.c7=function(t,e,n){return t.type==="custom"?new LL(t,e):new dk[t.type](t,e,n)},i.c8=function(t){let e=t.indexOf(xr);return e>=0?t.slice(0,e):t},i.c9=function(t){return t.indexOf(xr)>=0},i.cA=t=>({u_matrix:new Gf(t),u_pixels_to_tile_units:new Rv(t),u_device_pixel_ratio:new Ci(t),u_units_to_pixels:new pl(t),u_dash_image:new qg(t),u_gradient_image:new qg(t),u_image_height:new Ci(t),u_texsize:new pl(t),u_tile_units_to_pixels:new Ci(t),u_alpha_discard_threshold:new Ci(t),u_trim_offset:new pl(t),u_emissive_strength:new Ci(t)}),i.cB=t=>({u_matrix:new Gf(t),u_texsize:new pl(t),u_pixels_to_tile_units:new Rv(t),u_device_pixel_ratio:new Ci(t),u_image:new qg(t),u_units_to_pixels:new pl(t),u_tile_units_to_pixels:new Ci(t),u_alpha_discard_threshold:new Ci(t),u_trim_offset:new pl(t)}),i.cC=Uc,i.cD=jO,i.cE=VO,i.cF=EE,i.cG=(t,e,n,o,c,u)=>{let p=t.transform,_=p.projection.name==="globe",x;if(u.paint.get("circle-pitch-alignment")==="map")if(_){let E=xE(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;x=Float32Array.from([E,0,0,E])}else x=p.calculatePixelsToTileUnitsMatrix(n);else x=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);let w={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(p.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ro.devicePixelRatio,u_extrude_scale:x,u_inv_rot_matrix:MR,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(_){w.u_inv_rot_matrix=o,w.u_merc_center=c,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=xl(p.zoom);let E=c[0]*et,I=c[1]*et;w.u_up_dir=p.projection.upVector(new Zc(0,0,0),E,I)}return w},i.cH=gI,i.cI=(t,e,n,o,c,u)=>{let p=t.transform;return{u_matrix:mI(t,e,n,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_image:0,u_tile_units_to_pixels:pI(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:u}},i.cJ=(t,e,n,o,c,u,p)=>{let _=t.transform,x=_.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:mI(t,e,n,o),u_pixels_to_tile_units:x,u_device_pixel_ratio:u,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:_I(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:pI(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_emissive_strength:n.paint.get("line-emissive-strength")}},i.cK=Zd,i.cL=Qf,i.cM=aI,i.cN=uR,i.cO=f_,i.cP=Tl,i.cQ=450,i.cR=7,i.cS=PL,i.cT=256,i.cU=Xv,i.cV=Hc,i.cW=Gc,i.cX=Ev,i.cY=function(t,e,n,o,c){return tn((t-e)/(n-e)*(c-o)+o,o,c)},i.cZ=Qc,i.c_=Sx,i.ca=function(t){let e=t.indexOf(xr);return e>=0?t.slice(e+1):""},i.cb=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},i.cc=rc,i.cd=Z,i.ce=lc,i.cf=YT,i.cg=class extends ga{constructor(t){super(t),this.current=nR}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let o=0;o<9;o++)if(n[o]!==this.current[o]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},i.ch=Au,i.ci=function(t,e,n){let o=xl(n.zoom),c=t.style.map._antialias,u=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return o===0&&!c&&!u},i.cj=function(t){let e=t.pixelsPerMeter,n=e/Pi(1,t.center.lat),o=i.a9.identity(new Float64Array(16));return i.a9.translate(o,o,[t.point.x,t.point.y,0]),i.a9.scale(o,o,[n,n,e]),Float32Array.from(o)},i.ck=Jg,i.cl=function(t){let e=wr-5;t=tn(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(hn(t))),3);return Math.round(n*(kv.length-1))},i.cm=function(t,e,n,o){let c=e.getNorth(),u=e.getSouth(),p=e.getWest(),_=e.getEast(),x=1<<t.z,w=_-p,E=c-u,I=w/Eh,S=-E/kv[n],A=[0,I,0,S,0,0,c,p,0];if(t.z>0){let R=180/o;i.ct.multiply(A,A,[R/w+1,0,0,0,R/E+1,0,-.5*R/I,.5*R/S,1])}return A[2]=x,A[5]=t.x,A[8]=t.y,A},i.cn=Fs,i.co=function(t,e,n){let o=i.a9.identity(new Float64Array(16)),c=(e/(1<<t)-.5)*Math.PI*2;return i.a9.rotateY(o,n.globeMatrix,c),Float32Array.from(o)},i.cp=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,o=1<<n,c=Math.floor(t.x),u=Math.floor((t.x-c)*o),p=Math.floor(t.y*o),_=this.findDEMTileFor(new si(n,c,n,u,p));return!(!_||!_.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let o=this._source();if(!o||t.y<0||t.y>1)return e;let c=o.getSource().maxzoom,u=1<<c,p=Math.floor(t.x),_=t.x-p,x=new si(c,p,c,Math.floor(_*u),Math.floor(t.y*u)),w=this.findDEMTileFor(x);if(!w||!w.dem)return e;let E=w.dem,I=1<<w.tileID.canonical.z,S=(_*I-w.tileID.canonical.x)*E.dim,A=(t.y*I-w.tileID.canonical.y)*E.dim,R=Math.floor(S),k=Math.floor(A);return(n?this.exaggeration():1)*Zt(Zt(E.get(R,k),E.get(R,k+1),A-k),Zt(E.get(R+1,k),E.get(R+1,k+1),A-k),S-R)}getAtTileOffset(t,e,n){let o=1<<t.canonical.z;return this.getAtPointOrZero(new ai(t.wrap+(t.canonical.x+e/et)/o,(t.canonical.y+n/et)/o))}getAtTileOffsetFunc(t,e,n,o){return c=>{let u=this.getAtTileOffset(t,c.x,c.y),p=o.upVector(t.canonical,c.x,c.y),_=o.upVectorScale(t.canonical,e,n).metersToTile;return i.Q.scale(p,p,u*_),p}}getForTilePoints(t,e,n,o){if(this.isUsingMockSource())return!1;let c=Ph.create(this,t,o);return!!c&&(e.forEach(u=>{u[2]=this.exaggeration()*c.getElevationAt(u[0],u[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,o=e.tileID,c=1<<t.canonical.z-o.canonical.z,u=t.canonical.x/c-o.canonical.x,p=t.canonical.y/c-o.canonical.y,_=0;for(let x=0;x<t.canonical.z-o.canonical.z&&!n.leaves[_];x++){u*=2,p*=2;let w=2*Math.floor(p)+Math.floor(u);_=n.childOffsets[_]+w,u%=1,p%=1}return{min:this.exaggeration()*n.minimums[_],max:this.exaggeration()*n.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,o=Number.MIN_VALUE;for(let c of t){let u=this.getMinMaxForTile(c.tileID);u&&(n=Math.min(n,u.min),o=Math.max(o,u.max),e=!0)}return e?{min:n,max:o}:null}},i.cq=Kg,i.cr=AE,i.cs=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},i.cu=xE,i.cv=eg,i.cw=fo,i.cx=256,i.cy=function(t,e){let n=[0,0,0],o=t_(Fs(e.canonical));return i.Q.transformMat4(n,n,o),i.Q.transformMat4(n,n,t),n},i.cz=t=>({u_camera_to_center_distance:new Ci(t),u_extrude_scale:new Rv(t),u_device_pixel_ratio:new Ci(t),u_matrix:new Gf(t),u_inv_rot_matrix:new Gf(t),u_merc_center:new pl(t),u_tile_id:new Pv(t),u_zoom_transition:new Ci(t),u_up_dir:new Pv(t),u_emissive_strength:new Ci(t)}),i.d=rf,i.d$=gD,i.d0=Ph,i.d1=Vh,i.d2=Ji,i.d3=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){let e=jE(new Je(0,0),new Je(et,et),t),n=[];for(let o of this._activeRegions){if(o.hiddenByOverlap||!BE(e,o))continue;let c=lO(o.min,o.max,t);n.push({min:c.min,max:c.max,sourceId:this._sourceIds[o.priority],footprint:o.footprint,footprintTileId:o.tileId})}return n}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let o of e.cache.getVisibleCoordinates()){let c=e.cache.getTile(o).buckets[e.layer];if(c)for(let u of c.getNodesInfo()){let p=u.node;p.footprint&&n.push({footprint:p.footprint,id:o.toUnwrapped()})}}return n}})))}_addSource(t){let e=t.getFootprints();if(e.length!==0){for(let n of e){if(!n.footprint)continue;let o=jE(n.footprint.min,n.footprint.max,n.id);this._activeRegions.push({min:o.min,max:o.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:n.id,footprint:n.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||u_(e.min,n.min)||u_(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,n=0;for(;!t&&e!==this._activeRegions.length;){let o=this._activeRegions[e],c=this._prevRegions[n];t=o.priority!==c.priority||!zE(o,c),++e,++n}}if(t){++this._updateTime;let e=n=>{let o=this._activeRegions;if(n>=o.length)return n;let c=o[n].priority;for(;n<o.length&&o[n].priority===c;)++n;return n};if(this._sourceIds.length>1){let n=0,o=e(n);for(;n!==o;){let c=n,u=n;for(;c!==o;){let p=this._activeRegions[c];p.hiddenByOverlap=!1;for(let _=0;_<u;_++){let x=this._activeRegions[_];if(!x.hiddenByOverlap&&BE(p,x)&&(p.hiddenByOverlap=UE(p.footprint,p.tileId,x.footprint,x.tileId),p.hiddenByOverlap))break}++c}n=o,o=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},i.d4=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let n=new Yr,o=new kr,c=[],u=t+1+2,p=e[0]+1,_=e[0]+1+(1+e.length),x=(w,E,I)=>{let S=w===u-1?w-2:w===0?w:w-1;return S+=I?24575:0,[S,E]};for(let w=0;w<u;++w)n.emplaceBack(...x(w,0,!0));for(let w=0;w<p;++w)for(let E=0;E<u;++E)n.emplaceBack(...x(E,w,(E===0||E===u-1)&&!0));for(let w=0;w<e.length;++w){let E=e[w];for(let I=0;I<u;++I)n.emplaceBack(...x(I,E,!0))}for(let w=0;w<e.length;++w){let E=o.length,I=e[w]+1+2,S=new kr;for(let k=0;k<I-1;k++){let z=k===I-2,j=z?u*(_-e.length+w-k):u;for(let W=0;W<u-1;W++){let X=k*u+W;k===0||z||W===0||W===u-2?(S.emplaceBack(X+1,X,X+j),S.emplaceBack(X+j,X+j+1,X+1)):(o.emplaceBack(X+1,X,X+j),o.emplaceBack(X+j,X+j+1,X+1))}}let A=br.simpleSegment(0,E,n.length,o.length-E);for(let k=0;k<S.uint16.length;k+=3)o.emplaceBack(S.uint16[k],S.uint16[k+1],S.uint16[k+2]);let R=br.simpleSegment(0,E,n.length,o.length-E);c.push({withoutSkirts:A,withSkirts:R})}return{vertices:n,indices:o,segments:c}}_createGrid(t){let e=this._fillGridMeshWithLods(Eh,kv);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,mE.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new kr;for(let p=0;p<=Eh;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new Gc,o=new Gc,c=new Gc,u=new Gc;this._poleSegments=[];for(let p=0,_=0;p<Lv;p++){let x=360/(1<<p);n.emplaceBack(0,-Ai,0,.5,0),o.emplaceBack(0,-Ai,0,.5,1),c.emplaceBack(0,-Ai,0,.5,.5),u.emplaceBack(0,-Ai,0,.5,.5);for(let w=0;w<=Eh;w++){let E=w/Eh,I=0,S=Zt(0,x,E),[A,R,k]=Ih(IR,DR,S,Ai);n.emplaceBack(A,R,k,E,I),o.emplaceBack(A,R,k,E,1-I);let z=hn(S);E=.5+.5*Math.sin(z),I=.5+.5*Math.cos(z),c.emplaceBack(A,R,k,E,I),u.emplaceBack(A,R,k,E,1-I)}this._poleSegments.push(br.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,Xg,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(o,Xg,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(c,Xg,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(u,Xg,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},i.d5=function(t){return Zu.has(t)},i.d6=Xm,i.d7=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.d8=ho,i.d9=rE,i.dA=fp,i.dB=function(t){let e=Jd();if(!e)return;let n=e.delete(qa);t&&n.catch(t).then(()=>t())},i.dC=dp,i.dD=_D,i.dE=function(t){Lx=Ro.resolveURL(t),$h||($h=new Rx(N_(),new oa)),$h.broadcast("setDracoUrl",Lx)},i.dF=yD,i.dG=function(t){Uh=Ro.resolveURL(t),$h||($h=new Rx(N_(),new oa)),$h.broadcast("setMeshoptUrl",Uh)},i.dH=lt,i.dI=bl,i.dJ=ss,i.dK=SD,i.dL=AD,i.dM=hI,i.dN=Ga,i.dO=jI,i.dP=function(t,e,n,o,c,u,p,_,x,w,E){t.createArrays(),t.tilePixelRatio=et/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let I=t.layers[0].layout,S=t.layers[0]._unevaluatedLayout._values,A={};if(t.textSizeData.kind==="composite"){let{minZoom:j,maxZoom:W}=t.textSizeData;A.compositeTextSizes=[S["text-size"].possiblyEvaluate(new H(j),_),S["text-size"].possiblyEvaluate(new H(W),_)]}if(t.iconSizeData.kind==="composite"){let{minZoom:j,maxZoom:W}=t.iconSizeData;A.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new H(j),_),S["icon-size"].possiblyEvaluate(new H(W),_)]}A.layoutTextSize=S["text-size"].possiblyEvaluate(new H(x+1),_),A.layoutIconSize=S["icon-size"].possiblyEvaluate(new H(x+1),_),A.textMaxSize=S["text-size"].possiblyEvaluate(new H(18),_);let R=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",k=I.get("text-size"),z=!1;for(let j of t.features)if(j.icon&&j.icon.nameSecondary){z=!0;break}for(let j of t.features){let W=I.get("text-font").evaluate(j,{},_).join(","),X=k.evaluate(j,{},_),Q=A.layoutTextSize.evaluate(j,{},_),oe=(A.layoutIconSize.evaluate(j,{},_),{horizontal:{},vertical:void 0}),J=j.text,le,ue=[0,0];if(J){let ve=J.toString(),Se=I.get("text-letter-spacing").evaluate(j,{},_)*Jr,Me=I.get("text-line-height").evaluate(j,{},_)*Jr,De=f(ve)?Se:0,Fe=I.get("text-anchor").evaluate(j,{},_),Le=I.get("text-variable-anchor");if(!Le){let st=I.get("text-radial-offset").evaluate(j,{},_);ue=st?HI(Fe,[st*Jr,vx]):I.get("text-offset").evaluate(j,{},_).map($e=>$e*Jr)}let Ve=R?"center":I.get("text-justify").evaluate(j,{},_),Be=I.get("symbol-placement")==="point",Ce=Be?I.get("text-max-width").evaluate(j,{},_)*Jr:1/0,ht=st=>{t.allowVerticalPlacement&&l(ve)&&(oe.vertical=mx(J,e,n,c,W,Ce,Me,Fe,st,De,ue,bo.vertical,!0,Q,X))};if(!R&&Le){let st=Ve==="auto"?Le.map(Et=>xx(Et)):[Ve],$e=!1;for(let Et=0;Et<st.length;Et++){let gt=st[Et];if(!oe.horizontal[gt])if($e)oe.horizontal[gt]=oe.horizontal[0];else{let dt=mx(J,e,n,c,W,Ce,Me,"center",gt,De,ue,bo.horizontal,!1,Q,X);dt&&(oe.horizontal[gt]=dt,$e=dt.positionedLines.length===1)}}ht("left")}else{if(Ve==="auto"&&(Ve=xx(Fe)),Be||I.get("text-writing-mode").indexOf("horizontal")>=0||!l(ve)){let st=mx(J,e,n,c,W,Ce,Me,Fe,Ve,De,ue,bo.horizontal,!1,Q,X);st&&(oe.horizontal[Ve]=st)}ht(Be?"left":Ve)}}let _e=!1;if(j.icon&&j.icon.namePrimary){let ve=o[j.icon.namePrimary];ve&&(le=sL(c[j.icon.namePrimary],j.icon.nameSecondary?c[j.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(j,{},_),I.get("icon-anchor").evaluate(j,{},_)),_e=ve.sdf,t.sdfIcons===void 0?t.sdfIcons=ve.sdf:t.sdfIcons!==ve.sdf&&dr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ve.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Ie=WI(oe.horizontal)||oe.vertical;t.iconsInText||(t.iconsInText=!!Ie&&Ie.iconsInText),(Ie||le)&&fL(t,j,oe,le,o,A,Q,0,ue,_e,p,_,w,E,z)}u&&t.generateCollisionDebugBuffers(x,t.collisionBoxArray)},i.dQ=cx,i.dR=Fh,i.dS=h_,i.dT=l_,i.dU=a_,i.dV=Cu,i.dW=bI,i.dX=Rt,i.dY=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==xD){let n=new Uint32Array(t,0,7),[,,o,c,u,p]=n;e=n.byteLength+c+u+p+u,(o!==t.byteLength||e>=t.byteLength)&&dr("Invalid b3dm header information.")}return ED(t,e)},i.dZ=function(t,e){let n=MD(t);for(let o of n){for(let c of o.meshes)sk(c);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(ak(o.lights,e)))}return n},i.d_=V_,i.da=Wc,i.db=function([t,e,n]){let o=Math.hypot(t,e,n),c=Math.atan2(t,n),u=.5*Math.PI-Math.acos(-e/o);return new mn(yi(c),yi(u))},i.dc=Dh,i.dd=B,i.de=Jv,i.df=wE,i.dg=function(t){let e=[0,0,0],n=i.a9.identity(new Float64Array(16));return i.a9.multiply(n,t.pixelMatrix,t.globeMatrix),i.Q.transformMat4(e,e,n),new Je(e[0],e[1])},i.dh=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(ku==null){let o=n.navigator?n.navigator.userAgent:null;ku=!!n.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return ku}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.di=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",hc,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!se(t))return t;let n=po(t);return n.params.push(`sdk=js-${M}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!se(t))return t;let n=po(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!se(t))return t;let n=po(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,o){if(!se(t))return t;let c=po(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),n&&c.params.push(`language=${n}`),o&&c.params.push(`worldview=${o}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,o){let c=po(t);return se(t)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||o)):(c.path+=`${e}${n}`,Ya(c))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!se(t))return t;let o=po(t);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&o.authority!=="raster"&&n===512?"@2x":""}${ia.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${B.RASTER_URL_PREFIX}${o.path}`:o.authority==="rasterarrays"?o.path=`/${B.RASTERARRAYS_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${B.TILE_URL_VERSION}${o.path}`);let c=this._customAccessToken||function(u){for(let p of u){let _=p.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(o.params)||B.ACCESS_TOKEN;return B.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,c)}canonicalizeTileURL(t,e){let n=po(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let o="mapbox://";n.path.match(/^\/raster\/v1\//)?o+=`raster/${n.path.replace(`/${B.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?o+=`rasterarrays/${n.path.replace(`/${B.RASTERARRAYS_URL_PREFIX}/`,"")}`:o+=`tiles/${n.path.replace(`/${B.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(u=>!u.match(/^access_token=/))),c.length&&(o+=`?${c.join("&")}`),o}canonicalizeTileset(t,e){let n=!!e&&se(e),o=[];for(let c of t.tiles||[])q(c)?o.push(this.canonicalizeTileURL(c,n)):o.push(c);return o}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",o=po(B.API_URL);if(t.protocol=o.protocol,t.authority=o.authority,t.protocol==="http"){let c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(o.path!=="/"&&(t.path=`${o.path}${t.path}`),!B.REQUIRE_ACCESS_TOKEN)return Ya(t);if(e=e||B.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Ya(t)}},i.dj=function(t,e){e?Zu.add(t):Zu.delete(t)},i.dk=ia,i.dl=qu,i.dm=af,i.dn=Gu,i.dp=Mi,i.dq=ov,i.dr=function(t){Zu.delete(t)},i.ds=Wu,i.dt=Ds,i.du=M,i.dv=function(t,e){Bu=t,tg=e},i.dw=function(t,e,n=!1){if(U===P||U===O||U===F)throw new Error("setRTLTextPlugin cannot be called multiple times.");V=Ro.resolveURL(t),U=P,N=e,G(),n||ee()},i.dx=te,i.dy=function(){N_().acquire(Ox)},i.dz=function(){let t=pp;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(Ox),pp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.e=Xi,i.e0=re,i.e1=function(t){Wa(),Jo&&Jo.then(e=>{e.keys().then(n=>{for(let o=0;o<n.length-t;o++)e.delete(n[o])})})},i.f=Ro,i.g=function(t,e){return lc(Xi(t,{type:"json"}),e)},i.h=xo,i.i=class extends k_{},i.j=Cs,i.k=Ju,i.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>ED(e,0,t))},i.m=yh,i.n=Ng,i.o=xh,i.p=BI,i.q=Te,i.r=jg,i.s=ul,i.t=hl,i.u=be,i.v=Sc,i.w=dr,i.x=Ac,i.y=Rs}),d(["./shared"],function(i){"use strict";function M(He){let K=He?He.url.toString():void 0;return K?performance.getEntriesByName(K):[]}function L(He){if(typeof He=="number"||typeof He=="boolean"||typeof He=="string"||He==null)return JSON.stringify(He);if(Array.isArray(He)){let ie="[";for(let pe of He)ie+=`${L(pe)},`;return`${ie}]`}let K="{";for(let ie of Object.keys(He).sort())K+=`${ie}:${L(He[ie])},`;return`${K}}`}function B(He){let K="";for(let ie of i.b5)K+=`/${L(He[ie])}`;return K}class q{constructor(K){this.keyCache={},this._layers={},this._layerConfigs={},K&&this.replace(K)}replace(K,ie){this._layerConfigs={},this._layers={},this.update(K,[],ie)}update(K,ie,pe){this._options=pe;for(let je of K)this._layerConfigs[je.id]=je,(this._layers[je.id]=i.c7(je,this.scope,this._options)).compileFilter(),this.keyCache[je.id]&&delete this.keyCache[je.id];for(let je of ie)delete this.keyCache[je],delete this._layerConfigs[je],delete this._layers[je];this.familiesBySource={};let Ne=function(je,qe){let mt={};for(let ct=0;ct<je.length;ct++){let ft=qe&&qe[je[ct].id]||B(je[ct]);qe&&(qe[je[ct].id]=ft);let vt=mt[ft];vt||(vt=mt[ft]=[]),vt.push(je[ct])}let ke=[];for(let ct in mt)ke.push(mt[ct]);return ke}(i.b2(this._layerConfigs),this.keyCache);for(let je of Ne){let qe=je.map(it=>this._layers[it.id]),mt=qe[0];if(mt.visibility==="none")continue;let ke=mt.source||"",ct=this.familiesBySource[ke];ct||(ct=this.familiesBySource[ke]={});let ft=mt.sourceLayer||"_geojsonTileLayer",vt=ct[ft];vt||(vt=ct[ft]=[]),vt.push(qe)}}}let se=1*i.dJ;class ge{constructor(K){let ie={},pe=[];for(let mt in K){let ke=K[mt],ct=ie[mt]={};for(let ft in ke.glyphs){let vt=ke.glyphs[+ft];if(!vt||vt.bitmap.width===0||vt.bitmap.height===0)continue;let it=vt.metrics.localGlyph?se:1,Bn={x:0,y:0,w:vt.bitmap.width+2*it,h:vt.bitmap.height+2*it};pe.push(Bn),ct[ft]=Bn}}let{w:Ne,h:je}=i.p(pe),qe=new i.dI({width:Ne||1,height:je||1});for(let mt in K){let ke=K[mt];for(let ct in ke.glyphs){let ft=ke.glyphs[+ct];if(!ft||ft.bitmap.width===0||ft.bitmap.height===0)continue;let vt=ie[mt][ct],it=ft.metrics.localGlyph?se:1;i.dI.copy(ft.bitmap,qe,{x:0,y:0},{x:vt.x+it,y:vt.y+it},ft.bitmap)}}this.image=qe,this.positions=ie}}i.dH(ge,"GlyphAtlas");class Pe{constructor(K){this.tileID=new i.ap(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.tileZoom=K.tileZoom,this.uid=K.uid,this.zoom=K.zoom,this.canonical=K.tileID.canonical,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.scope=K.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.collectResourceTiming,this.promoteId=K.promoteId,this.isSymbolTile=K.isSymbolTile,this.tileTransform=i.av(K.tileID.canonical,K.projection),this.projection=K.projection,this.brightness=K.brightness,this.extraShadowCaster=!!K.extraShadowCaster}parse(K,ie,pe,Ne,je){this.status="parsing",this.data=K,this.collisionBoxArray=new i.aG;let qe=new i.dK(Object.keys(K.layers).sort()),mt=new i.dL(this.tileID,this.promoteId);mt.bucketLayerIDs=[];let ke={},ct=new i.dM(256,256),ft={featureIndex:mt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:ct,availableImages:pe,brightness:this.brightness},vt=ie.familiesBySource[this.source];for(let jn in vt){let sr=K.layers[jn];if(!sr)continue;let zr=!1,Kn=!1,mi=!1;for(let Dr of vt[jn])Dr[0].type==="symbol"?zr=!0:Kn=!0,Dr[0].is3D()&&Dr[0].type!=="model"&&(mi=!0);if(this.extraShadowCaster&&!mi||this.isSymbolTile===!0&&!zr||this.isSymbolTile===!1&&!Kn)continue;sr.version===1&&i.w(`Vector tile source "${this.source}" layer "${jn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let ii=qe.encode(jn),lo=[];for(let Dr=0;Dr<sr.length;Dr++){let cr=sr.feature(Dr),Re=mt.getId(cr,jn);lo.push({feature:cr,id:Re,index:Dr,sourceLayerIndex:ii})}for(let Dr of vt[jn]){let cr=Dr[0];(!this.extraShadowCaster||cr.is3D()&&cr.type!=="model")&&(this.isSymbolTile!==void 0&&cr.type==="symbol"!==this.isSymbolTile||cr.minzoom&&this.zoom<Math.floor(cr.minzoom)||cr.maxzoom&&this.zoom>=cr.maxzoom||cr.visibility!=="none"&&(Ke(Dr,this.zoom,ft.brightness,pe),(ke[cr.id]=cr.createBucket({index:mt.bucketLayerIDs.length,layers:Dr,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ii,sourceID:this.source,projection:this.projection.spec})).populate(lo,ft,this.tileID.canonical,this.tileTransform),mt.bucketLayerIDs.push(Dr.map(Re=>Re.id))))}}let it,Bn,In,Fn;ct.trim();let Dn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Mn=()=>{if(it)return this.status="done",je(it);if(this.extraShadowCaster)this.status="done",je(null,{buckets:i.b2(ke).filter(jn=>!jn.isEmpty()),featureIndex:mt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ft.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Bn&&In&&Fn){let jn=new ge(Bn),sr=new i.dO(In,Fn);for(let zr in ke){let Kn=ke[zr];Kn instanceof i.aH?(Ke(Kn.layers,this.zoom,ft.brightness,pe),i.dP(Kn,Bn,jn.positions,In,sr.iconPositions,this.showCollisionBoxes,pe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Kn.hasPattern&&(Kn instanceof i.aN||Kn instanceof i.aO||Kn instanceof i.cO)&&(Ke(Kn.layers,this.zoom,ft.brightness,pe),Kn.addFeatures(ft,this.tileID.canonical,sr.patternPositions,pe,this.tileTransform,this.brightness))}this.status="done",je(null,{buckets:i.b2(ke).filter(zr=>!zr.isEmpty()),featureIndex:mt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:jn.image,lineAtlas:ct,imageAtlas:sr,brightness:ft.brightness})}};if(!this.extraShadowCaster){let jn=i.dN(ft.glyphDependencies,Kn=>Object.keys(Kn).map(Number));Object.keys(jn).length?Ne.send("getGlyphs",{uid:this.uid,stacks:jn,scope:this.scope},(Kn,mi)=>{it||(it=Kn,Bn=mi,Mn())},void 0,!1,Dn):Bn={};let sr=Object.keys(ft.iconDependencies);sr.length?Ne.send("getImages",{icons:sr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Kn,mi)=>{it||(it=Kn,In=mi,Mn())},void 0,!1,Dn):In={};let zr=Object.keys(ft.patternDependencies);zr.length?Ne.send("getImages",{icons:zr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Kn,mi)=>{it||(it=Kn,Fn=mi,Mn())},void 0,!1,Dn):Fn={}}Mn()}}function Ke(He,K,ie,pe){let Ne=new i.N(K,{brightness:ie});for(let je of He)je.recalculate(Ne,pe)}class Nt extends i.E{constructor(K,ie,pe,Ne,je,qe){super(),this.actor=K,this.layerIndex=ie,this.availableImages=pe,this.loadVectorData=je||i.ak,this.loading={},this.loaded={},this.deduped=new i.ai(K.scheduler),this.isSpriteLoaded=Ne,this.scheduler=K.scheduler,this.brightness=qe}loadTile(K,ie){let pe=K.uid,Ne=K&&K.request,je=Ne&&Ne.collectResourceTiming,qe=this.loading[pe]=new Pe(K);qe.abort=this.loadVectorData(K,(mt,ke)=>{let ct=!this.loading[pe];if(delete this.loading[pe],ct||mt||!ke)return qe.status="done",ct||(this.loaded[pe]=qe),ie(mt);let ft=ke.rawData,vt={};ke.expires&&(vt.expires=ke.expires),ke.cacheControl&&(vt.cacheControl=ke.cacheControl),qe.vectorTile=ke.vectorTile||new i.dQ(new i.dR(ft));let it=()=>{qe.parse(qe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Bn,In)=>{if(Bn||!In)return ie(Bn);let Fn={};if(je){let Dn=M(Ne);Dn.length>0&&(Fn.resourceTiming=JSON.parse(JSON.stringify(Dn)))}ie(null,i.e({rawTileData:ft.slice(0)},In,vt,Fn))})};this.isSpriteLoaded?it():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(it,{type:"parseTile",isSymbolTile:K.isSymbolTile,zoom:K.tileZoom}):it()}),this.loaded=this.loaded||{},this.loaded[pe]=qe})}reloadTile(K,ie){let pe=this.loaded,Ne=K.uid,je=this;if(pe&&pe[Ne]){let qe=pe[Ne];qe.showCollisionBoxes=K.showCollisionBoxes,qe.projection=K.projection,qe.brightness=K.brightness,qe.tileTransform=i.av(K.tileID.canonical,K.projection),qe.extraShadowCaster=K.extraShadowCaster;let mt=(ke,ct)=>{let ft=qe.reloadCallback;ft&&(delete qe.reloadCallback,qe.parse(qe.vectorTile,je.layerIndex,this.availableImages,je.actor,ft)),ie(ke,ct)};qe.status==="parsing"?qe.reloadCallback=mt:qe.status==="done"&&(qe.vectorTile?qe.parse(qe.vectorTile,this.layerIndex,this.availableImages,this.actor,mt):mt())}else ie(null,void 0)}abortTile(K,ie){let pe=K.uid,Ne=this.loading[pe];Ne&&(Ne.abort&&Ne.abort(),delete this.loading[pe]),ie()}removeTile(K,ie){let pe=this.loaded,Ne=K.uid;pe&&pe[Ne]&&delete pe[Ne],ie()}}class sn{loadTile(K,ie){let{uid:pe,encoding:Ne,rawImageData:je,padding:qe}=K,mt=ImageBitmap&&je instanceof ImageBitmap?this.getImageData(je,qe):je;ie(null,new i.dS(pe,mt,Ne,qe<1))}getImageData(K,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(K.width,K.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=K.width,this.offscreenCanvas.height=K.height,this.offscreenCanvasContext.drawImage(K,0,0,K.width,K.height);let pe=this.offscreenCanvasContext.getImageData(-ie,-ie,K.width+2*ie,K.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),pe}}class Rt{decodeRasterArray({task:K,buffer:ie},pe){i.b0.performDecoding(ie,K).then(Ne=>{pe(null,Ne)},Ne=>{pe(Ne)})}}let bt=i.dT.prototype.toGeoJSON,an=class{constructor(He){this._feature=He,this.extent=i.Y,this.type=He.type,this.properties=He.tags,"id"in He&&!isNaN(He.id)&&(this.id=parseInt(He.id,10))}loadGeometry(){if(this._feature.type===1){let He=[];for(let K of this._feature.geometry)He.push([new i.P(K[0],K[1])]);return He}{let He=[];for(let K of this._feature.geometry){let ie=[];for(let pe of K)ie.push(new i.P(pe[0],pe[1]));He.push(ie)}return He}}toGeoJSON(He,K,ie){return bt.call(this,He,K,ie)}},or=class{constructor(He){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.Y,this.length=He.length,this._features=He}feature(He){return new an(this._features[He])}};var kn={exports:{}},fi=i.dV,jr=i.dU.VectorTileFeature,wn=Ao;function Ao(He,K){this.options=K||{},this.features=He,this.length=He.length}function pi(He,K){this.id=typeof He.id=="number"?He.id:void 0,this.type=He.type,this.rawGeometry=He.type===1?[He.geometry]:He.geometry,this.properties=He.tags,this.extent=K||4096}Ao.prototype.feature=function(He){return new pi(this.features[He],this.options.extent)},pi.prototype.loadGeometry=function(){var He=this.rawGeometry;this.geometry=[];for(var K=0;K<He.length;K++){for(var ie=He[K],pe=[],Ne=0;Ne<ie.length;Ne++)pe.push(new fi(ie[Ne][0],ie[Ne][1]));this.geometry.push(pe)}return this.geometry},pi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var He=this.geometry,K=1/0,ie=-1/0,pe=1/0,Ne=-1/0,je=0;je<He.length;je++)for(var qe=He[je],mt=0;mt<qe.length;mt++){var ke=qe[mt];K=Math.min(K,ke.x),ie=Math.max(ie,ke.x),pe=Math.min(pe,ke.y),Ne=Math.max(Ne,ke.y)}return[K,pe,ie,Ne]},pi.prototype.toGeoJSON=jr.prototype.toGeoJSON;var Na=i.dW,Xl=wn;function Wr(He){var K=new Na;return function(ie,pe){for(var Ne in ie.layers)pe.writeMessage(3,Wn,ie.layers[Ne])}(He,K),K.finish()}function Wn(He,K){var ie;K.writeVarintField(15,He.version||1),K.writeStringField(1,He.name||""),K.writeVarintField(5,He.extent||4096);var pe={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<He.length;ie++)pe.feature=He.feature(ie),K.writeMessage(2,za,pe);var Ne=pe.keys;for(ie=0;ie<Ne.length;ie++)K.writeStringField(3,Ne[ie]);var je=pe.values;for(ie=0;ie<je.length;ie++)K.writeMessage(4,Tn,je[ie])}function za(He,K){var ie=He.feature;ie.id!==void 0&&K.writeVarintField(1,ie.id),K.writeMessage(2,Ni,He),K.writeVarintField(3,ie.type),K.writeMessage(4,Qs,ie)}function Ni(He,K){var ie=He.feature,pe=He.keys,Ne=He.values,je=He.keycache,qe=He.valuecache;for(var mt in ie.properties){var ke=ie.properties[mt],ct=je[mt];if(ke!==null){ct===void 0&&(pe.push(mt),je[mt]=ct=pe.length-1),K.writeVarint(ct);var ft=typeof ke;ft!=="string"&&ft!=="boolean"&&ft!=="number"&&(ke=JSON.stringify(ke));var vt=ft+":"+ke,it=qe[vt];it===void 0&&(Ne.push(ke),qe[vt]=it=Ne.length-1),K.writeVarint(it)}}}function Zi(He,K){return(K<<3)+(7&He)}function Ba(He){return He<<1^He>>31}function Qs(He,K){for(var ie=He.loadGeometry(),pe=He.type,Ne=0,je=0,qe=ie.length,mt=0;mt<qe;mt++){var ke=ie[mt],ct=1;pe===1&&(ct=ke.length),K.writeVarint(Zi(1,ct));for(var ft=pe===3?ke.length-1:ke.length,vt=0;vt<ft;vt++){vt===1&&pe!==1&&K.writeVarint(Zi(2,ft-1));var it=ke[vt].x-Ne,Bn=ke[vt].y-je;K.writeVarint(Ba(it)),K.writeVarint(Ba(Bn)),Ne+=it,je+=Bn}pe===3&&K.writeVarint(Zi(7,1))}}function Tn(He,K){var ie=typeof He;ie==="string"?K.writeStringField(1,He):ie==="boolean"?K.writeBooleanField(7,He):ie==="number"&&(He%1!=0?K.writeDoubleField(3,He):He<0?K.writeSVarintField(6,He):K.writeVarintField(5,He))}kn.exports=Wr,kn.exports.fromVectorTileJs=Wr,kn.exports.fromGeojsonVt=function(He,K){K=K||{};var ie={};for(var pe in He)ie[pe]=new Xl(He[pe].features,K),ie[pe].name=pe,ie[pe].version=K.version,ie[pe].extent=K.extent;return Wr({layers:ie})},kn.exports.GeoJSONWrapper=Xl;var ja=i.dX(kn.exports);let ri={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:He=>He},Va=Math.fround||(Ys=new Float32Array(1),He=>(Ys[0]=+He,Ys[0]));var Ys;let Qi=3,It=5,Xs=6;class Jn{constructor(K){this.options=Object.assign(Object.create(ri),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){let{log:ie,minZoom:pe,maxZoom:Ne}=this.options;ie&&console.time("total time");let je=`prepare ${K.length} points`;ie&&console.time(je),this.points=K;let qe=[];for(let ke=0;ke<K.length;ke++){let ct=K[ke];if(!ct.geometry)continue;let[ft,vt]=ct.geometry.coordinates,it=Va(ws(ft)),Bn=Va(Ts(vt));qe.push(it,Bn,1/0,ke,-1,1),this.options.reduce&&qe.push(0)}let mt=this.trees[Ne+1]=this._createTree(qe);ie&&console.timeEnd(je);for(let ke=Ne;ke>=pe;ke--){let ct=+Date.now();mt=this.trees[ke]=this._createTree(this._cluster(mt,ke)),ie&&console.log("z%d: %d clusters in %dms",ke,mt.numItems,+Date.now()-ct)}return ie&&console.timeEnd("total time"),this}getClusters(K,ie){let pe=((K[0]+180)%360+360)%360-180,Ne=Math.max(-90,Math.min(90,K[1])),je=K[2]===180?180:((K[2]+180)%360+360)%360-180,qe=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)pe=-180,je=180;else if(pe>je){let vt=this.getClusters([pe,Ne,180,qe],ie),it=this.getClusters([-180,Ne,je,qe],ie);return vt.concat(it)}let mt=this.trees[this._limitZoom(ie)],ke=mt.range(ws(pe),Ts(qe),ws(je),Ts(Ne)),ct=mt.data,ft=[];for(let vt of ke){let it=this.stride*vt;ft.push(ct[it+It]>1?Kl(ct,it,this.clusterProps):this.points[ct[it+Qi]])}return ft}getChildren(K){let ie=this._getOriginId(K),pe=this._getOriginZoom(K),Ne="No cluster with the specified id.",je=this.trees[pe];if(!je)throw new Error(Ne);let qe=je.data;if(ie*this.stride>=qe.length)throw new Error(Ne);let mt=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),ke=je.within(qe[ie*this.stride],qe[ie*this.stride+1],mt),ct=[];for(let ft of ke){let vt=ft*this.stride;qe[vt+4]===K&&ct.push(qe[vt+It]>1?Kl(qe,vt,this.clusterProps):this.points[qe[vt+Qi]])}if(ct.length===0)throw new Error(Ne);return ct}getLeaves(K,ie,pe){let Ne=[];return this._appendLeaves(Ne,K,ie=ie||10,pe=pe||0,0),Ne}getTile(K,ie,pe){let Ne=this.trees[this._limitZoom(K)],je=Math.pow(2,K),{extent:qe,radius:mt}=this.options,ke=mt/qe,ct=(pe-ke)/je,ft=(pe+1+ke)/je,vt={features:[]};return this._addTileFeatures(Ne.range((ie-ke)/je,ct,(ie+1+ke)/je,ft),Ne.data,ie,pe,je,vt),ie===0&&this._addTileFeatures(Ne.range(1-ke/je,ct,1,ft),Ne.data,je,pe,je,vt),ie===je-1&&this._addTileFeatures(Ne.range(0,ct,ke/je,ft),Ne.data,-1,pe,je,vt),vt.features.length?vt:null}getClusterExpansionZoom(K){let ie=this._getOriginZoom(K)-1;for(;ie<=this.options.maxZoom;){let pe=this.getChildren(K);if(ie++,pe.length!==1)break;K=pe[0].properties.cluster_id}return ie}_appendLeaves(K,ie,pe,Ne,je){let qe=this.getChildren(ie);for(let mt of qe){let ke=mt.properties;if(ke&&ke.cluster?je+ke.point_count<=Ne?je+=ke.point_count:je=this._appendLeaves(K,ke.cluster_id,pe,Ne,je):je<Ne?je++:K.push(mt),K.length===pe)break}return je}_createTree(K){let ie=new i.bj(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let pe=0;pe<K.length;pe+=this.stride)ie.add(K[pe],K[pe+1]);return ie.finish(),ie.data=K,ie}_addTileFeatures(K,ie,pe,Ne,je,qe){for(let mt of K){let ke=mt*this.stride,ct=ie[ke+It]>1,ft,vt,it;if(ct)ft=Ua(ie,ke,this.clusterProps),vt=ie[ke],it=ie[ke+1];else{let Fn=this.points[ie[ke+Qi]];ft=Fn.properties;let[Dn,Mn]=Fn.geometry.coordinates;vt=ws(Dn),it=Ts(Mn)}let Bn={type:1,geometry:[[Math.round(this.options.extent*(vt*je-pe)),Math.round(this.options.extent*(it*je-Ne))]],tags:ft},In;In=ct||this.options.generateId?ie[ke+Qi]:this.points[ie[ke+Qi]].id,In!==void 0&&(Bn.id=In),qe.features.push(Bn)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,ie){let{radius:pe,extent:Ne,reduce:je,minPoints:qe}=this.options,mt=pe/(Ne*Math.pow(2,ie)),ke=K.data,ct=[],ft=this.stride;for(let vt=0;vt<ke.length;vt+=ft){if(ke[vt+2]<=ie)continue;ke[vt+2]=ie;let it=ke[vt],Bn=ke[vt+1],In=K.within(ke[vt],ke[vt+1],mt),Fn=ke[vt+It],Dn=Fn;for(let Mn of In){let jn=Mn*ft;ke[jn+2]>ie&&(Dn+=ke[jn+It])}if(Dn>Fn&&Dn>=qe){let Mn,jn=it*Fn,sr=Bn*Fn,zr=-1,Kn=(vt/ft<<5)+(ie+1)+this.points.length;for(let mi of In){let ii=mi*ft;if(ke[ii+2]<=ie)continue;ke[ii+2]=ie;let lo=ke[ii+It];jn+=ke[ii]*lo,sr+=ke[ii+1]*lo,ke[ii+4]=Kn,je&&(Mn||(Mn=this._map(ke,vt,!0),zr=this.clusterProps.length,this.clusterProps.push(Mn)),je(Mn,this._map(ke,ii)))}ke[vt+4]=Kn,ct.push(jn/Dn,sr/Dn,1/0,Kn,-1,Dn),je&&ct.push(zr)}else{for(let Mn=0;Mn<ft;Mn++)ct.push(ke[vt+Mn]);if(Dn>1)for(let Mn of In){let jn=Mn*ft;if(!(ke[jn+2]<=ie)){ke[jn+2]=ie;for(let sr=0;sr<ft;sr++)ct.push(ke[jn+sr])}}}}return ct}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,ie,pe){if(K[ie+It]>1){let qe=this.clusterProps[K[ie+Xs]];return pe?Object.assign({},qe):qe}let Ne=this.points[K[ie+Qi]].properties,je=this.options.map(Ne);return pe&&je===Ne?Object.assign({},je):je}}function Kl(He,K,ie){return{type:"Feature",id:He[K+Qi],properties:Ua(He,K,ie),geometry:{type:"Point",coordinates:[(pe=He[K],360*(pe-.5)),Jl(He[K+1])]}};var pe}function Ua(He,K,ie){let pe=He[K+It],Ne=pe>=1e4?`${Math.round(pe/1e3)}k`:pe>=1e3?Math.round(pe/100)/10+"k":pe,je=He[K+Xs],qe=je===-1?{}:Object.assign({},ie[je]);return Object.assign(qe,{cluster:!0,cluster_id:He[K+Qi],point_count:pe,point_count_abbreviated:Ne})}function ws(He){return He/360+.5}function Ts(He){let K=Math.sin(He*Math.PI/180),ie=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return ie<0?0:ie>1?1:ie}function Jl(He){let K=(180-360*He)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}var $a={exports:{}};$a.exports=function(){function He(Re,Oe,Ue,Ze){for(var We,tt=Ze,nt=Ue-Oe>>1,Qe=Ue-Oe,ot=Re[Oe],Ye=Re[Oe+1],Ot=Re[Ue],ln=Re[Ue+1],_t=Oe+3;_t<Ue;_t+=3){var Vn=K(Re[_t],Re[_t+1],ot,Ye,Ot,ln);if(Vn>tt)We=_t,tt=Vn;else if(Vn===tt){var ur=Math.abs(_t-nt);ur<Qe&&(We=_t,Qe=ur)}}tt>Ze&&(We-Oe>3&&He(Re,Oe,We,Ze),Re[We+2]=tt,Ue-We>3&&He(Re,We,Ue,Ze))}function K(Re,Oe,Ue,Ze,We,tt){var nt=We-Ue,Qe=tt-Ze;if(nt!==0||Qe!==0){var ot=((Re-Ue)*nt+(Oe-Ze)*Qe)/(nt*nt+Qe*Qe);ot>1?(Ue=We,Ze=tt):ot>0&&(Ue+=nt*ot,Ze+=Qe*ot)}return(nt=Re-Ue)*nt+(Qe=Oe-Ze)*Qe}function ie(Re,Oe,Ue,Ze){var We={id:Re===void 0?null:Re,type:Oe,geometry:Ue,tags:Ze,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(tt){var nt=tt.geometry,Qe=tt.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")pe(tt,nt);else if(Qe==="Polygon"||Qe==="MultiLineString")for(var ot=0;ot<nt.length;ot++)pe(tt,nt[ot]);else if(Qe==="MultiPolygon")for(ot=0;ot<nt.length;ot++)for(var Ye=0;Ye<nt[ot].length;Ye++)pe(tt,nt[ot][Ye])}(We),We}function pe(Re,Oe){for(var Ue=0;Ue<Oe.length;Ue+=3)Re.minX=Math.min(Re.minX,Oe[Ue]),Re.minY=Math.min(Re.minY,Oe[Ue+1]),Re.maxX=Math.max(Re.maxX,Oe[Ue]),Re.maxY=Math.max(Re.maxY,Oe[Ue+1])}function Ne(Re,Oe,Ue,Ze){if(Oe.geometry){var We=Oe.geometry.coordinates,tt=Oe.geometry.type,nt=Math.pow(Ue.tolerance/((1<<Ue.maxZoom)*Ue.extent),2),Qe=[],ot=Oe.id;if(Ue.promoteId?ot=Oe.properties[Ue.promoteId]:Ue.generateId&&(ot=Ze||0),tt==="Point")je(We,Qe);else if(tt==="MultiPoint")for(var Ye=0;Ye<We.length;Ye++)je(We[Ye],Qe);else if(tt==="LineString")qe(We,Qe,nt,!1);else if(tt==="MultiLineString"){if(Ue.lineMetrics){for(Ye=0;Ye<We.length;Ye++)qe(We[Ye],Qe=[],nt,!1),Re.push(ie(ot,"LineString",Qe,Oe.properties));return}mt(We,Qe,nt,!1)}else if(tt==="Polygon")mt(We,Qe,nt,!0);else{if(tt!=="MultiPolygon"){if(tt==="GeometryCollection"){for(Ye=0;Ye<Oe.geometry.geometries.length;Ye++)Ne(Re,{id:ot,geometry:Oe.geometry.geometries[Ye],properties:Oe.properties},Ue,Ze);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ye=0;Ye<We.length;Ye++){var Ot=[];mt(We[Ye],Ot,nt,!0),Qe.push(Ot)}}Re.push(ie(ot,tt,Qe,Oe.properties))}}function je(Re,Oe){Oe.push(ke(Re[0])),Oe.push(ct(Re[1])),Oe.push(0)}function qe(Re,Oe,Ue,Ze){for(var We,tt,nt=0,Qe=0;Qe<Re.length;Qe++){var ot=ke(Re[Qe][0]),Ye=ct(Re[Qe][1]);Oe.push(ot),Oe.push(Ye),Oe.push(0),Qe>0&&(nt+=Ze?(We*Ye-ot*tt)/2:Math.sqrt(Math.pow(ot-We,2)+Math.pow(Ye-tt,2))),We=ot,tt=Ye}var Ot=Oe.length-3;Oe[2]=1,He(Oe,0,Ot,Ue),Oe[Ot+2]=1,Oe.size=Math.abs(nt),Oe.start=0,Oe.end=Oe.size}function mt(Re,Oe,Ue,Ze){for(var We=0;We<Re.length;We++){var tt=[];qe(Re[We],tt,Ue,Ze),Oe.push(tt)}}function ke(Re){return Re/360+.5}function ct(Re){var Oe=Math.sin(Re*Math.PI/180),Ue=.5-.25*Math.log((1+Oe)/(1-Oe))/Math.PI;return Ue<0?0:Ue>1?1:Ue}function ft(Re,Oe,Ue,Ze,We,tt,nt,Qe){if(Ze/=Oe,tt>=(Ue/=Oe)&&nt<Ze)return Re;if(nt<Ue||tt>=Ze)return null;for(var ot=[],Ye=0;Ye<Re.length;Ye++){var Ot=Re[Ye],ln=Ot.geometry,_t=Ot.type,Vn=We===0?Ot.minX:Ot.minY,ur=We===0?Ot.maxX:Ot.maxY;if(Vn>=Ue&&ur<Ze)ot.push(Ot);else if(!(ur<Ue||Vn>=Ze)){var hr=[];if(_t==="Point"||_t==="MultiPoint")vt(ln,hr,Ue,Ze,We);else if(_t==="LineString")it(ln,hr,Ue,Ze,We,!1,Qe.lineMetrics);else if(_t==="MultiLineString")In(ln,hr,Ue,Ze,We,!1);else if(_t==="Polygon")In(ln,hr,Ue,Ze,We,!0);else if(_t==="MultiPolygon")for(var vr=0;vr<ln.length;vr++){var pr=[];In(ln[vr],pr,Ue,Ze,We,!0),pr.length&&hr.push(pr)}if(hr.length){if(Qe.lineMetrics&&_t==="LineString"){for(vr=0;vr<hr.length;vr++)ot.push(ie(Ot.id,_t,hr[vr],Ot.tags));continue}_t!=="LineString"&&_t!=="MultiLineString"||(hr.length===1?(_t="LineString",hr=hr[0]):_t="MultiLineString"),_t!=="Point"&&_t!=="MultiPoint"||(_t=hr.length===3?"Point":"MultiPoint"),ot.push(ie(Ot.id,_t,hr,Ot.tags))}}}return ot.length?ot:null}function vt(Re,Oe,Ue,Ze,We){for(var tt=0;tt<Re.length;tt+=3){var nt=Re[tt+We];nt>=Ue&&nt<=Ze&&(Oe.push(Re[tt]),Oe.push(Re[tt+1]),Oe.push(Re[tt+2]))}}function it(Re,Oe,Ue,Ze,We,tt,nt){for(var Qe,ot,Ye=Bn(Re),Ot=We===0?Dn:Mn,ln=Re.start,_t=0;_t<Re.length-3;_t+=3){var Vn=Re[_t],ur=Re[_t+1],hr=Re[_t+2],vr=Re[_t+3],pr=Re[_t+4],pn=We===0?Vn:ur,zi=We===0?vr:pr,co=!1;nt&&(Qe=Math.sqrt(Math.pow(Vn-vr,2)+Math.pow(ur-pr,2))),pn<Ue?zi>Ue&&(ot=Ot(Ye,Vn,ur,vr,pr,Ue),nt&&(Ye.start=ln+Qe*ot)):pn>Ze?zi<Ze&&(ot=Ot(Ye,Vn,ur,vr,pr,Ze),nt&&(Ye.start=ln+Qe*ot)):Fn(Ye,Vn,ur,hr),zi<Ue&&pn>=Ue&&(ot=Ot(Ye,Vn,ur,vr,pr,Ue),co=!0),zi>Ze&&pn<=Ze&&(ot=Ot(Ye,Vn,ur,vr,pr,Ze),co=!0),!tt&&co&&(nt&&(Ye.end=ln+Qe*ot),Oe.push(Ye),Ye=Bn(Re)),nt&&(ln+=Qe)}var Vr=Re.length-3;Vn=Re[Vr],ur=Re[Vr+1],hr=Re[Vr+2],(pn=We===0?Vn:ur)>=Ue&&pn<=Ze&&Fn(Ye,Vn,ur,hr),Vr=Ye.length-3,tt&&Vr>=3&&(Ye[Vr]!==Ye[0]||Ye[Vr+1]!==Ye[1])&&Fn(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&Oe.push(Ye)}function Bn(Re){var Oe=[];return Oe.size=Re.size,Oe.start=Re.start,Oe.end=Re.end,Oe}function In(Re,Oe,Ue,Ze,We,tt){for(var nt=0;nt<Re.length;nt++)it(Re[nt],Oe,Ue,Ze,We,tt,!1)}function Fn(Re,Oe,Ue,Ze){Re.push(Oe),Re.push(Ue),Re.push(Ze)}function Dn(Re,Oe,Ue,Ze,We,tt){var nt=(tt-Oe)/(Ze-Oe);return Re.push(tt),Re.push(Ue+(We-Ue)*nt),Re.push(1),nt}function Mn(Re,Oe,Ue,Ze,We,tt){var nt=(tt-Ue)/(We-Ue);return Re.push(Oe+(Ze-Oe)*nt),Re.push(tt),Re.push(1),nt}function jn(Re,Oe){for(var Ue=[],Ze=0;Ze<Re.length;Ze++){var We,tt=Re[Ze],nt=tt.type;if(nt==="Point"||nt==="MultiPoint"||nt==="LineString")We=sr(tt.geometry,Oe);else if(nt==="MultiLineString"||nt==="Polygon"){We=[];for(var Qe=0;Qe<tt.geometry.length;Qe++)We.push(sr(tt.geometry[Qe],Oe))}else if(nt==="MultiPolygon")for(We=[],Qe=0;Qe<tt.geometry.length;Qe++){for(var ot=[],Ye=0;Ye<tt.geometry[Qe].length;Ye++)ot.push(sr(tt.geometry[Qe][Ye],Oe));We.push(ot)}Ue.push(ie(tt.id,nt,We,tt.tags))}return Ue}function sr(Re,Oe){var Ue=[];Ue.size=Re.size,Re.start!==void 0&&(Ue.start=Re.start,Ue.end=Re.end);for(var Ze=0;Ze<Re.length;Ze+=3)Ue.push(Re[Ze]+Oe,Re[Ze+1],Re[Ze+2]);return Ue}function zr(Re,Oe){if(Re.transformed)return Re;var Ue,Ze,We,tt=1<<Re.z,nt=Re.x,Qe=Re.y;for(Ue=0;Ue<Re.features.length;Ue++){var ot=Re.features[Ue],Ye=ot.geometry,Ot=ot.type;if(ot.geometry=[],Ot===1)for(Ze=0;Ze<Ye.length;Ze+=2)ot.geometry.push(Kn(Ye[Ze],Ye[Ze+1],Oe,tt,nt,Qe));else for(Ze=0;Ze<Ye.length;Ze++){var ln=[];for(We=0;We<Ye[Ze].length;We+=2)ln.push(Kn(Ye[Ze][We],Ye[Ze][We+1],Oe,tt,nt,Qe));ot.geometry.push(ln)}}return Re.transformed=!0,Re}function Kn(Re,Oe,Ue,Ze,We,tt){return[Math.round(Ue*(Re*Ze-We)),Math.round(Ue*(Oe*Ze-tt))]}function mi(Re,Oe,Ue,Ze,We){for(var tt=Oe===We.maxZoom?0:We.tolerance/((1<<Oe)*We.extent),nt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ue,y:Ze,z:Oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Qe=0;Qe<Re.length;Qe++){nt.numFeatures++,ii(nt,Re[Qe],tt,We);var ot=Re[Qe].minX,Ye=Re[Qe].minY,Ot=Re[Qe].maxX,ln=Re[Qe].maxY;ot<nt.minX&&(nt.minX=ot),Ye<nt.minY&&(nt.minY=Ye),Ot>nt.maxX&&(nt.maxX=Ot),ln>nt.maxY&&(nt.maxY=ln)}return nt}function ii(Re,Oe,Ue,Ze){var We=Oe.geometry,tt=Oe.type,nt=[];if(tt==="Point"||tt==="MultiPoint")for(var Qe=0;Qe<We.length;Qe+=3)nt.push(We[Qe]),nt.push(We[Qe+1]),Re.numPoints++,Re.numSimplified++;else if(tt==="LineString")lo(nt,We,Re,Ue,!1,!1);else if(tt==="MultiLineString"||tt==="Polygon")for(Qe=0;Qe<We.length;Qe++)lo(nt,We[Qe],Re,Ue,tt==="Polygon",Qe===0);else if(tt==="MultiPolygon")for(var ot=0;ot<We.length;ot++){var Ye=We[ot];for(Qe=0;Qe<Ye.length;Qe++)lo(nt,Ye[Qe],Re,Ue,!0,Qe===0)}if(nt.length){var Ot=Oe.tags||null;if(tt==="LineString"&&Ze.lineMetrics){for(var ln in Ot={},Oe.tags)Ot[ln]=Oe.tags[ln];Ot.mapbox_clip_start=We.start/We.size,Ot.mapbox_clip_end=We.end/We.size}var _t={geometry:nt,type:tt==="Polygon"||tt==="MultiPolygon"?3:tt==="LineString"||tt==="MultiLineString"?2:1,tags:Ot};Oe.id!==null&&(_t.id=Oe.id),Re.features.push(_t)}}function lo(Re,Oe,Ue,Ze,We,tt){var nt=Ze*Ze;if(Ze>0&&Oe.size<(We?nt:Ze))Ue.numPoints+=Oe.length/3;else{for(var Qe=[],ot=0;ot<Oe.length;ot+=3)(Ze===0||Oe[ot+2]>nt)&&(Ue.numSimplified++,Qe.push(Oe[ot]),Qe.push(Oe[ot+1])),Ue.numPoints++;We&&function(Ye,Ot){for(var ln=0,_t=0,Vn=Ye.length,ur=Vn-2;_t<Vn;ur=_t,_t+=2)ln+=(Ye[_t]-Ye[ur])*(Ye[_t+1]+Ye[ur+1]);if(ln>0===Ot)for(_t=0,Vn=Ye.length;_t<Vn/2;_t+=2){var hr=Ye[_t],vr=Ye[_t+1];Ye[_t]=Ye[Vn-2-_t],Ye[_t+1]=Ye[Vn-1-_t],Ye[Vn-2-_t]=hr,Ye[Vn-1-_t]=vr}}(Qe,tt),Re.push(Qe)}}function Dr(Re,Oe){var Ue=(Oe=this.options=function(We,tt){for(var nt in tt)We[nt]=tt[nt];return We}(Object.create(this.options),Oe)).debug;if(Ue&&console.time("preprocess data"),Oe.maxZoom<0||Oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Oe.promoteId&&Oe.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ze=function(We,tt){var nt=[];if(We.type==="FeatureCollection")for(var Qe=0;Qe<We.features.length;Qe++)Ne(nt,We.features[Qe],tt,Qe);else Ne(nt,We.type==="Feature"?We:{geometry:We},tt);return nt}(Re,Oe);this.tiles={},this.tileCoords=[],Ue&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Oe.indexMaxZoom,Oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ze=function(We,tt){var nt=tt.buffer/tt.extent,Qe=We,ot=ft(We,1,-1-nt,nt,0,-1,2,tt),Ye=ft(We,1,1-nt,2+nt,0,-1,2,tt);return(ot||Ye)&&(Qe=ft(We,1,-nt,1+nt,0,-1,2,tt)||[],ot&&(Qe=jn(ot,1).concat(Qe)),Ye&&(Qe=Qe.concat(jn(Ye,-1)))),Qe}(Ze,Oe)).length&&this.splitTile(Ze,0,0,0),Ue&&(Ze.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function cr(Re,Oe,Ue){return 32*((1<<Re)*Ue+Oe)+Re}return Dr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Dr.prototype.splitTile=function(Re,Oe,Ue,Ze,We,tt,nt){for(var Qe=[Re,Oe,Ue,Ze],ot=this.options,Ye=ot.debug;Qe.length;){Ze=Qe.pop(),Ue=Qe.pop(),Oe=Qe.pop(),Re=Qe.pop();var Ot=1<<Oe,ln=cr(Oe,Ue,Ze),_t=this.tiles[ln];if(!_t&&(Ye>1&&console.time("creation"),_t=this.tiles[ln]=mi(Re,Oe,Ue,Ze,ot),this.tileCoords.push({z:Oe,x:Ue,y:Ze}),Ye)){Ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Oe,Ue,Ze,_t.numFeatures,_t.numPoints,_t.numSimplified),console.timeEnd("creation"));var Vn="z"+Oe;this.stats[Vn]=(this.stats[Vn]||0)+1,this.total++}if(_t.source=Re,We){if(Oe===ot.maxZoom||Oe===We)continue;var ur=1<<We-Oe;if(Ue!==Math.floor(tt/ur)||Ze!==Math.floor(nt/ur))continue}else if(Oe===ot.indexMaxZoom||_t.numPoints<=ot.indexMaxPoints)continue;if(_t.source=null,Re.length!==0){Ye>1&&console.time("clipping");var hr,vr,pr,pn,zi,co,Vr=.5*ot.buffer/ot.extent,Ks=.5-Vr,tc=.5+Vr,gi=1+Vr;hr=vr=pr=pn=null,zi=ft(Re,Ot,Ue-Vr,Ue+tc,0,_t.minX,_t.maxX,ot),co=ft(Re,Ot,Ue+Ks,Ue+gi,0,_t.minX,_t.maxX,ot),Re=null,zi&&(hr=ft(zi,Ot,Ze-Vr,Ze+tc,1,_t.minY,_t.maxY,ot),vr=ft(zi,Ot,Ze+Ks,Ze+gi,1,_t.minY,_t.maxY,ot),zi=null),co&&(pr=ft(co,Ot,Ze-Vr,Ze+tc,1,_t.minY,_t.maxY,ot),pn=ft(co,Ot,Ze+Ks,Ze+gi,1,_t.minY,_t.maxY,ot),co=null),Ye>1&&console.timeEnd("clipping"),Qe.push(hr||[],Oe+1,2*Ue,2*Ze),Qe.push(vr||[],Oe+1,2*Ue,2*Ze+1),Qe.push(pr||[],Oe+1,2*Ue+1,2*Ze),Qe.push(pn||[],Oe+1,2*Ue+1,2*Ze+1)}}},Dr.prototype.getTile=function(Re,Oe,Ue){var Ze=this.options,We=Ze.extent,tt=Ze.debug;if(Re<0||Re>24)return null;var nt=1<<Re,Qe=cr(Re,Oe=(Oe%nt+nt)%nt,Ue);if(this.tiles[Qe])return zr(this.tiles[Qe],We);tt>1&&console.log("drilling down to z%d-%d-%d",Re,Oe,Ue);for(var ot,Ye=Re,Ot=Oe,ln=Ue;!ot&&Ye>0;)Ye--,Ot=Math.floor(Ot/2),ln=Math.floor(ln/2),ot=this.tiles[cr(Ye,Ot,ln)];return ot&&ot.source?(tt>1&&console.log("found parent tile z%d-%d-%d",Ye,Ot,ln),tt>1&&console.time("drilling down"),this.splitTile(ot.source,Ye,Ot,ln,Re,Oe,Ue),tt>1&&console.timeEnd("drilling down"),this.tiles[Qe]?zr(this.tiles[Qe],We):null):null},function(Re,Oe){return new Dr(Re,Oe)}}();var Ir=i.dX($a.exports);function Eu(He,K){let ie=He.tileID.canonical;if(!this._geoJSONIndex)return K(null,null);let pe=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!pe)return K(null,null);let Ne=new or(pe.features),je=ja(Ne);je.byteOffset===0&&je.byteLength===je.buffer.byteLength||(je=new Uint8Array(je)),K(null,{vectorTile:Ne,rawData:je.buffer})}class Pt extends Nt{constructor(K,ie,pe,Ne,je,qe){super(K,ie,pe,Ne,Eu,qe),je&&(this.loadGeoJSON=je),this._featureMap=new Map}loadData(K,ie){let pe=K&&K.request,Ne=pe&&pe.collectResourceTiming;this.loadGeoJSON(K,(je,qe)=>{if(je||!qe)return ie(je);if(typeof qe!="object")return ie(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));{try{if(K.filter){let ke=i.t(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ke.result==="error")throw new Error(ke.value.map(ct=>`${ct.key}: ${ct.message}`).join(", "));qe.features=qe.features.filter(ct=>ke.value.evaluate({zoom:0},ct))}if(K.dynamic){qe.type==="Feature"&&(qe={type:"FeatureCollection",features:[qe]}),K.append||this._featureMap.clear();for(let ke of qe.features||[]){let ct=ke.id;ct!==void 0&&(ke.geometry?this._featureMap.set(ct,ke):this._featureMap.delete(ct))}qe.features=[...this._featureMap.values()]}this._geoJSONIndex=K.cluster?new Jn(function({superclusterOptions:ke,clusterProperties:ct}){if(!ct||!ke)return ke;let ft={},vt={},it={accumulated:null,zoom:0},Bn={properties:null},In=Object.keys(ct);for(let Fn of In){let[Dn,Mn]=ct[Fn],jn=i.t(Mn),sr=i.t(typeof Dn=="string"?[Dn,["accumulated"],["get",Fn]]:Dn);ft[Fn]=jn.value,vt[Fn]=sr.value}return ke.map=Fn=>{Bn.properties=Fn;let Dn={};for(let Mn of In)Dn[Mn]=ft[Mn].evaluate(it,Bn);return Dn},ke.reduce=(Fn,Dn)=>{Bn.properties=Dn;for(let Mn of In)it.accumulated=Fn[Mn],Fn[Mn]=vt[Mn].evaluate(it,Bn)},ke}(K)).load(qe.features):Ir(qe,K.geojsonVtOptions)}catch(ke){return ie(ke)}this.loaded={};let mt={};if(Ne){let ke=M(pe);ke&&(mt.resourceTiming={},mt.resourceTiming[K.source]=JSON.parse(JSON.stringify(ke)))}ie(null,mt)}})}reloadTile(K,ie){let pe=this.loaded;return pe&&pe[K.uid]?super.reloadTile(K,ie):this.loadTile(K,ie)}loadGeoJSON(K,ie){if(K.request)i.g(K.request,ie);else{if(typeof K.data!="string")return ie(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(K.data))}catch{return ie(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(K,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(K.clusterId))}catch(pe){ie(pe)}}getClusterChildren(K,ie){try{ie(null,this._geoJSONIndex.getChildren(K.clusterId))}catch(pe){ie(pe)}}getClusterLeaves(K,ie){try{ie(null,this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset))}catch(pe){ie(pe)}}}class Mt{constructor(K,ie){this.tileID=new i.ap(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.tileZoom=K.tileZoom,this.uid=K.uid,this.zoom=K.zoom,this.canonical=K.tileID.canonical,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=K.projection,this.brightness=ie}parse(K,ie,pe,Ne){this.status="parsing";let je=new i.ap(pe.tileID.overscaledZ,pe.tileID.wrap,pe.tileID.canonical.z,pe.tileID.canonical.x,pe.tileID.canonical.y),qe={},mt=ie.familiesBySource[pe.source],ke=new i.dL(je,pe.promoteId);return ke.bucketLayerIDs=[],ke.is3DTile=!0,i.dY(K).then(ct=>{if(!ct)return Ne(new Error("Could not parse tile"));let ft=i.dZ(ct,1/i.bU(pe.tileID.canonical)),vt=ct.json.extensionsUsed&&ct.json.extensionsUsed.includes("MAPBOX_mesh_features")||ct.json.asset.extras&&ct.json.asset.extras.MAPBOX_mesh_features,it=ct.json.extensionsUsed&&ct.json.extensionsUsed.includes("EXT_meshopt_compression"),Bn=new i.N(this.zoom,{brightness:this.brightness});for(let In in mt)for(let Fn of mt[In]){let Dn=Fn[0];ke.bucketLayerIDs.push(Fn.map(jn=>jn.id)),Dn.recalculate(Bn,[]);let Mn=new i.d_(ft,je,vt,it,this.brightness,ke);vt||(Mn.needsUpload=!0),qe[Dn.fqid]=Mn,Mn.evaluate(Dn)}this.status="done",Ne(null,{buckets:qe,featureIndex:ke})}).catch(ct=>Ne(new Error(ct.message)))}}class ec{constructor(K,ie,pe,Ne,je,qe){this.actor=K,this.layerIndex=ie,this.brightness=qe,this.loading={},this.loaded={}}loadTile(K,ie){let pe=K.uid,Ne=this.loading[pe]=new Mt(K,this.brightness);i.b1(K.request,(je,qe)=>{let mt=!this.loading[pe];return delete this.loading[pe],mt||je?(Ne.status="done",mt||(this.loaded[pe]=Ne),ie(je)):qe&&qe.byteLength!==0?void Ne.parse(qe,this.layerIndex,K,(ke,ct)=>{Ne.status="done",this.loaded=this.loaded||{},this.loaded[pe]=Ne,ke||!ct?ie(ke):ie(null,ct)}):(Ne.status="done",this.loaded[pe]=Ne,ie())})}reloadTile(K,ie){let pe=this.loaded,Ne=K.uid;if(pe&&pe[Ne]){let je=pe[Ne];je.projection=K.projection,je.brightness=K.brightness;let qe=(mt,ke)=>{je.reloadCallback&&(delete je.reloadCallback,this.loadTile(K,ie)),ie(mt,ke)};je.status==="parsing"?je.reloadCallback=qe:je.status==="done"&&this.loadTile(K,ie)}}abortTile(K,ie){let pe=K.uid;this.loading[pe]&&delete this.loading[pe],ie()}removeTile(K,ie){let pe=this.loaded,Ne=K.uid;pe&&pe[Ne]&&delete pe[Ne],ie()}}class Yi{constructor(K){this.self=K,this.actor=new i.d$(K,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=i.br({name:"mercator"}),this.workerSourceTypes={vector:Nt,geojson:Pt,"batched-model":ec},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ie,pe)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=pe},this.self.registerRTLTextPlugin=ie=>{if(i.e0.isParsed())throw new Error("RTL text plugin already registered.");i.e0.applyArabicShaping=ie.applyArabicShaping,i.e0.processBidirectionalText=ie.processBidirectionalText,i.e0.processStyledBidirectionalText=ie.processStyledBidirectionalText}}clearCaches(K,ie,pe){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K],delete this.rasterArrayWorkerSource,pe()}checkIfReady(K,ie,pe){pe()}setReferrer(K,ie){this.referrer=ie}spriteLoaded(K,{scope:ie,isLoaded:pe}){if(this.isSpriteLoaded[K]||(this.isSpriteLoaded[K]={}),this.isSpriteLoaded[K][ie]=pe,this.workerSources[K]&&this.workerSources[K][ie])for(let Ne in this.workerSources[K][ie]){let je=this.workerSources[K][ie][Ne];for(let qe in je)je[qe]instanceof Nt&&(je[qe].isSpriteLoaded=pe,je[qe].fire(new i.b("isSpriteLoaded")))}}setImages(K,{scope:ie,images:pe},Ne){if(this.availableImages[K]||(this.availableImages[K]={}),this.availableImages[K][ie]=pe,this.workerSources[K]&&this.workerSources[K][ie]){for(let je in this.workerSources[K][ie]){let qe=this.workerSources[K][ie][je];for(let mt in qe)qe[mt].availableImages=pe}Ne()}else Ne()}setProjection(K,ie){this.projections[K]=i.br(ie)}setBrightness(K,ie,pe){this.brightness=ie,pe()}setLayers(K,ie,pe){this.getLayerIndex(K,ie.scope).replace(ie.layers,ie.options),pe()}updateLayers(K,ie,pe){this.getLayerIndex(K,ie.scope).update(ie.layers,ie.removedIds,ie.options),pe()}loadTile(K,ie,pe){ie.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,ie.type,ie.source,ie.scope).loadTile(ie,pe)}loadDEMTile(K,ie,pe){this.getDEMWorkerSource(K,ie.source,ie.scope).loadTile(ie,pe)}decodeRasterArray(K,ie,pe){this.getRasterArrayWorkerSource().decodeRasterArray(ie,pe)}reloadTile(K,ie,pe){ie.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,ie.type,ie.source,ie.scope).reloadTile(ie,pe)}abortTile(K,ie,pe){this.getWorkerSource(K,ie.type,ie.source,ie.scope).abortTile(ie,pe)}removeTile(K,ie,pe){this.getWorkerSource(K,ie.type,ie.source,ie.scope).removeTile(ie,pe)}removeSource(K,ie,pe){if(!(this.workerSources[K]&&this.workerSources[K][ie.scope]&&this.workerSources[K][ie.scope][ie.type]&&this.workerSources[K][ie.scope][ie.type][ie.source]))return;let Ne=this.workerSources[K][ie.scope][ie.type][ie.source];delete this.workerSources[K][ie.scope][ie.type][ie.source],Ne.removeSource!==void 0?Ne.removeSource(ie,pe):pe()}loadWorkerSource(K,ie,pe){try{this.self.importScripts(ie.url),pe()}catch(Ne){pe(Ne.toString())}}syncRTLPluginState(K,ie,pe){try{i.e0.setState(ie);let Ne=i.e0.getPluginURL();if(i.e0.isLoaded()&&!i.e0.isParsed()&&Ne!=null){this.self.importScripts(Ne);let je=i.e0.isParsed();pe(je?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ne}`),je)}}catch(Ne){pe(Ne.toString())}}setDracoUrl(K,ie){this.dracoUrl=ie}getAvailableImages(K,ie){this.availableImages[K]||(this.availableImages[K]={});let pe=this.availableImages[K][ie];return pe||(pe=[]),pe}getLayerIndex(K,ie){this.layerIndexes[K]||(this.layerIndexes[K]={});let pe=this.layerIndexes[K][ie];return pe||(pe=this.layerIndexes[K][ie]=new q,pe.scope=ie),pe}getWorkerSource(K,ie,pe,Ne){if(this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][Ne]||(this.workerSources[K][Ne]={}),this.workerSources[K][Ne][ie]||(this.workerSources[K][Ne][ie]={}),this.isSpriteLoaded[K]||(this.isSpriteLoaded[K]={}),!this.workerSources[K][Ne][ie][pe]){let je={send:(qe,mt,ke,ct,ft,vt)=>{this.actor.send(qe,mt,ke,K,ft,vt)},scheduler:this.actor.scheduler};this.workerSources[K][Ne][ie][pe]=new this.workerSourceTypes[ie](je,this.getLayerIndex(K,Ne),this.getAvailableImages(K,Ne),this.isSpriteLoaded[K][Ne],void 0,this.brightness)}return this.workerSources[K][Ne][ie][pe]}getDEMWorkerSource(K,ie,pe){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][pe]||(this.demWorkerSources[K][pe]={}),this.demWorkerSources[K][pe][ie]||(this.demWorkerSources[K][pe][ie]=new sn),this.demWorkerSources[K][pe][ie]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Rt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(K,ie){i.e1(ie)}getWorkerPerformanceMetrics(K,ie,pe){pe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Yi(self)),Yi}),d(["./shared"],function(i){"use strict";function M(h,r){if(Array.isArray(h)){if(!Array.isArray(r)||h.length!==r.length)return!1;for(let l=0;l<h.length;l++)if(!M(h[l],r[l]))return!1;return!0}if(typeof h=="object"&&h!==null&&r!==null){if(typeof r!="object"||Object.keys(h).length!==Object.keys(r).length)return!1;for(let l in h)if(!M(h[l],r[l]))return!1;return!0}return h===r}var L=B;function B(h){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,g,v=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(v);try{g=new Worker(b),f=!0}catch{f=!1}return g&&g.terminate(),URL.revokeObjectURL(b),f}()?function(){var f=document.createElement("canvas");f.width=f.height=1;var g=f.getContext("2d");if(!g)return!1;var v=g.getImageData(0,0,1,1);return v&&v.width===f.width}()?(q[l=r&&r.failIfMajorPerformanceCaveat]===void 0&&(q[l]=function(f){var g,v=function(b){var T=document.createElement("canvas"),D=Object.create(B.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=b,T.getContext("webgl2",D)}(f);if(!v)return!1;try{g=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!g||v.isContextLost())&&(v.shaderSource(g,"void main() {}"),v.compileShader(g),v.getShaderParameter(g,v.COMPILE_STATUS)===!0)}(l)),q[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var l}(h)}var q={};function se(h,r,l){let f=document.createElement(h);return r!=null&&(f.className=r),l&&l.appendChild(f),f}function ge(h,r,l){let f=document.createElementNS("http://www.w3.org/2000/svg",h);for(let g of Object.keys(r))f.setAttributeNS(null,g,String(r[g]));return l&&l.appendChild(f),f}B.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let Pe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ke=Pe&&Pe.userSelect!==void 0?"userSelect":"WebkitUserSelect",Nt;function sn(){Pe&&Ke&&(Nt=Pe[Ke],Pe[Ke]="none")}function Rt(){Pe&&Ke&&(Pe[Ke]=Nt)}function bt(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",bt,!0)}function an(){window.addEventListener("click",bt,!0),window.setTimeout(()=>{window.removeEventListener("click",bt,!0)},0)}function or(h,r){let l=h.getBoundingClientRect();return jr(h,l,r)}function kn(h,r){let l=h.getBoundingClientRect(),f=[];for(let g=0;g<r.length;g++)f.push(jr(h,l,r[g]));return f}function fi(h){return window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function jr(h,r,l){let f=h.offsetWidth===r.width?1:h.offsetWidth/r.width;return new i.P((l.clientX-r.left)*f,(l.clientY-r.top)*f)}class wn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,l){this._updatedSourceCaches[r]=l,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){let l=r.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(r.id),this.setDirty()}removeLayer(r){let l=r.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][r.id]=r,this._updatedLayers[l].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){let r={};for(let l in this._updatedLayers)r[l]=r[l]||{},r[l].updatedIds=Array.from(this._updatedLayers[l].values());for(let l in this._removedLayers)r[l]=r[l]||{},r[l].removedIds=Object.keys(this._removedLayers[l]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(r){this._updatedImages.add(r),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class Ao extends i.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.numModelsLoading={}}loadModel(r,l){return i.l(this.requestManager.transformRequest(l,i.R.Model).url).then(f=>{if(!f)return;let g=i.c(f),v=new i.M(r,void 0,void 0,g);return v.computeBoundsAndApplyParent(),v}).catch(f=>{if(f&&f.status===404)return null;this.fire(new i.a(new Error(`Could not load model ${r} from ${l}: ${f.message}`)))})}load(r,l){this.models[l]||(this.models[l]={});let f=Object.keys(r);this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+f.length;let g=[];for(let v of f)g.push(this.loadModel(v,r[v]));Promise.allSettled(g).then(v=>{for(let b=0;b<v.length;b++){let{status:T,value:D}=v[b];T==="fulfilled"&&D&&(this.models[l][f[b]]={model:D,numReferences:1})}this.numModelsLoading[l]-=f.length,this.fire(new i.b("data",{dataType:"style"}))}).catch(v=>{this.fire(new i.a(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(let r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,l){return!!this.getModel(r,l)}getModel(r,l){return this.models[l]||(this.models[l]={}),this.models[l][r]?this.models[l][r].model:void 0}addModel(r,l,f){this.models[f]||(this.models[f]={}),this.hasModel(r,f)&&this.models[f][r].numReferences++,this.load({[r]:this.requestManager.normalizeModelURL(l)},f)}addModels(r,l){this.models[l]||(this.models[l]={});let f={};for(let g in r)this.models[l][g]={},f[g]=this.requestManager.normalizeModelURL(r[g]);this.load(f,l)}addModelsFromBucket(r,l){this.models[l]||(this.models[l]={});let f={};for(let g of r)this.hasModel(g,l)?this.models[l][g].numReferences++:f[g]=this.requestManager.normalizeModelURL(g);this.load(f,l)}removeModel(r,l){if(this.models[l]&&this.models[l][r]&&(this.models[l][r].numReferences--,this.models[l][r].numReferences===0)){let f=this.models[l][r].model;delete this.models[l][r],f.destroy()}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,l){this.models[l]||(this.models[l]={});for(let f in this.models[l])this.models[l][f].model&&this.models[l][f].model.upload(r.context)}}class pi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,f){let g=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][g]=this.stateChanges[r][g]||{},i.e(this.stateChanges[r][g],f),this.deletedStates[r]===null){this.deletedStates[r]={};for(let v in this.state[r])v!==g&&(this.deletedStates[r][v]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][g]===null){this.deletedStates[r][g]={};for(let v in this.state[r][g])f[v]||(this.deletedStates[r][g][v]=null)}else for(let v in f)this.deletedStates[r]&&this.deletedStates[r][g]&&this.deletedStates[r][g][v]===null&&delete this.deletedStates[r][g][v]}removeFeatureState(r,l,f){if(this.deletedStates[r]===null)return;let g=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},f&&l!==void 0)this.deletedStates[r][g]!==null&&(this.deletedStates[r][g]=this.deletedStates[r][g]||{},this.deletedStates[r][g][f]=null);else if(l!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][g])for(f in this.deletedStates[r][g]={},this.stateChanges[r][g])this.deletedStates[r][g][f]=null;else this.deletedStates[r][g]=null;else this.deletedStates[r]=null}getState(r,l){let f=String(l),g=i.e({},(this.state[r]||{})[f],(this.stateChanges[r]||{})[f]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){let v=this.deletedStates[r][l];if(v===null)return{};for(let b in v)delete g[b]}return g}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){let f={};for(let g in this.stateChanges){this.state[g]=this.state[g]||{};let v={};for(let b in this.stateChanges[g])this.state[g][b]||(this.state[g][b]={}),i.e(this.state[g][b],this.stateChanges[g][b]),v[b]=this.state[g][b];f[g]=v}for(let g in this.deletedStates){this.state[g]=this.state[g]||{};let v={};if(this.deletedStates[g]===null)for(let b in this.state[g])v[b]={},this.state[g][b]={};else for(let b in this.deletedStates[g]){if(this.deletedStates[g][b]===null)this.state[g][b]={};else if(this.state[g][b])for(let T of Object.keys(this.deletedStates[g][b]))delete this.state[g][b][T];v[b]=this.state[g][b]}f[g]=f[g]||{},i.e(f[g],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(let g in r)r[g].setFeatureState(f,l)}}function Na(h){let{userImage:r}=h;return!!(r&&r.render&&r.render())&&(h.data.replace(new Uint8Array(r.data.buffer)),!0)}class Xl extends i.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(r){this.images[r]={},this.loaded[r]=!1,this.updatedImages[r]={},this.patterns[r]={},this.callbackDispatchedThisFrame[r]={},this.atlasImage[r]=new i.h({width:1,height:1})}isLoaded(){for(let r in this.loaded)if(!this.loaded[r])return!1;return!0}setLoaded(r,l){if(this.loaded[l]!==r&&(this.loaded[l]=r,r)){for(let{ids:f,callback:g}of this.requestors)this._notify(f,l,g);this.requestors=[]}}hasImage(r,l){return!!this.getImage(r,l)}getImage(r,l){return this.images[l][r]}addImage(r,l,f){this._validate(r,f)&&(this.images[l][r]=f)}_validate(r,l){let f=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new i.a(new Error(`Image "${r}" has invalid "stretchX" value`))),f=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new i.a(new Error(`Image "${r}" has invalid "stretchY" value`))),f=!1),this._validateContent(l.content,l)||(this.fire(new i.a(new Error(`Image "${r}" has invalid "content" value`))),f=!1),f}_validateStretch(r,l){if(!r)return!0;let f=0;for(let g of r){if(g[0]<f||g[1]<g[0]||l<g[1])return!1;f=g[1]}return!0}_validateContent(r,l){return!(r&&(r.length!==4||r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,l,f){f.version=this.images[l][r].version+1,this.images[l][r]=f,this.updatedImages[l][r]=!0}removeImage(r,l){let f=this.images[l][r];delete this.images[l][r],delete this.patterns[l][r],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(r){return Object.keys(this.images[r])}getImages(r,l,f){let g=!0,v=!!this.loaded[l];if(!v)for(let b of r)this.images[l][b]||(g=!1);v||g?this._notify(r,l,f):this.requestors.push({ids:r,scope:l,callback:f})}getUpdatedImages(r){return this.updatedImages[r]}_notify(r,l,f){let g={};for(let v of r){this.images[l][v]||this.fire(new i.b("styleimagemissing",{id:v}));let b=this.images[l][v];b?g[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:i.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,g)}getPixelSize(r){let{width:l,height:f}=this.atlasImage[r];return{width:l,height:f}}getPattern(r,l){let f=this.patterns[l][r],g=this.getImage(r,l);if(!g)return null;if(f&&f.position.version===g.version)return f.position;if(f)f.position.version=g.version;else{let v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},b=new i.I(v,g);this.patterns[l][r]={bin:v,position:b}}return this._updatePatternAtlas(l),this.patterns[l][r].position}bind(r,l){let f=r.gl,g=this.atlasTexture[l];g?this.dirty&&(g.update(this.atlasImage[l]),this.dirty=!1):(g=new i.T(r,this.atlasImage[l],f.RGBA),this.atlasTexture[l]=g),g.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(r){let l=[];for(let b in this.patterns[r])l.push(this.patterns[r][b].bin);let{w:f,h:g}=i.p(l),v=this.atlasImage[r];v.resize({width:f||1,height:g||1});for(let b in this.patterns[r]){let{bin:T}=this.patterns[r][b],D=T.x+1,C=T.y+1,P=this.images[r][b].data,O=P.width,F=P.height;i.h.copy(P,v,{x:0,y:0},{x:D,y:C},{width:O,height:F}),i.h.copy(P,v,{x:0,y:F-1},{x:D,y:C-1},{width:O,height:1}),i.h.copy(P,v,{x:0,y:0},{x:D,y:C+F},{width:O,height:1}),i.h.copy(P,v,{x:O-1,y:0},{x:D-1,y:C},{width:1,height:F}),i.h.copy(P,v,{x:0,y:0},{x:D+O,y:C},{width:1,height:F})}this.dirty=!0}beginFrame(){for(let r in this.images)this.callbackDispatchedThisFrame[r]={}}dispatchRenderCallbacks(r,l){for(let f of r){if(this.callbackDispatchedThisFrame[l][f])continue;this.callbackDispatchedThisFrame[l][f]=!0;let g=this.images[l][f];Na(g)&&this.updateImage(f,l,g)}}}function Wr(h){let r=h.key,l=h.value,f=h.valueSpec||{},g=h.objectElementValidators||{},v=h.style,b=h.styleSpec,T=[],D=i.j(l);if(D!=="object")return[new i.V(r,l,`object expected, ${D} found`)];for(let C in l){let P=C.split(".")[0],O;g[P]?O=g[P]:f[P]?O=Ir:g["*"]?O=g["*"]:f["*"]&&(O=Ir),O?T=T.concat(O({key:(r&&`${r}.`)+C,value:l[C],valueSpec:f[P]||f["*"],style:v,styleSpec:b,object:l,objectKey:C},l)):T.push(new i.i(r,l[C],`unknown property "${C}"`))}for(let C in f)g[C]||f[C].required&&f[C].default===void 0&&l[C]===void 0&&T.push(new i.V(r,l,`missing required property "${C}"`));return T}function Wn(h){let r=h.value,l=h.valueSpec,f=h.style,g=h.styleSpec,v=h.key,b=h.arrayElementValidator||Ir;if(i.j(r)!=="array")return[new i.V(v,r,`array expected, ${i.j(r)} found`)];if(l.length&&r.length!==l.length)return[new i.V(v,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new i.V(v,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let T={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};g.$version<7&&(T.function=l.function),i.j(l.value)==="object"&&(T=l.value);let D=[];for(let C=0;C<r.length;C++)D=D.concat(b({array:r,arrayIndex:C,value:r[C],valueSpec:T,style:f,styleSpec:g,key:`${v}[${C}]`},!0));return D}function za(h){let r=h.key,l=h.value,f=h.valueSpec,g=i.j(l);if(g==="number"&&l!=l&&(g="NaN"),g!=="number")return[new i.V(r,l,`number expected, ${g} found`)];if("minimum"in f){let v=f.minimum;if(i.j(f.minimum)==="array"&&(v=f.minimum[h.arrayIndex]),l<v)return[new i.V(r,l,`${l} is less than the minimum value ${v}`)]}if("maximum"in f){let v=f.maximum;if(i.j(f.maximum)==="array"&&(v=f.maximum[h.arrayIndex]),l>v)return[new i.V(r,l,`${l} is greater than the maximum value ${v}`)]}return[]}function Ni(h){let r=h.valueSpec,l=i.u(h.value.type),f,g,v,b={},T=l!=="categorical"&&h.value.property===void 0,D=!T,C=i.j(h.value.stops)==="array"&&i.j(h.value.stops[0])==="array"&&i.j(h.value.stops[0][0])==="object",P=Wr({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(N){if(l==="identity")return[new i.V(N.key,N.value,'identity function may not have a "stops" property')];let U=[],V=N.value;return U=U.concat(Wn({key:N.key,value:V,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:O})),i.j(V)==="array"&&V.length===0&&U.push(new i.V(N.key,V,"array must have at least one stop")),U},default:function(N){return Ir({key:N.key,value:N.value,valueSpec:r,style:N.style,styleSpec:N.styleSpec})}}});return l==="identity"&&T&&P.push(new i.V(h.key,h.value,'missing required property "property"')),l==="identity"||h.value.stops||P.push(new i.V(h.key,h.value,'missing required property "stops"')),l==="exponential"&&h.valueSpec.expression&&!i.s(h.valueSpec)&&P.push(new i.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(D&&!i.m(h.valueSpec)?P.push(new i.V(h.key,h.value,"property functions not supported")):T&&!i.n(h.valueSpec)&&P.push(new i.V(h.key,h.value,"zoom functions not supported"))),l!=="categorical"&&!C||h.value.property!==void 0||P.push(new i.V(h.key,h.value,'"property" property is required')),P;function O(N){let U=[],V=N.value,$=N.key;if(i.j(V)!=="array")return[new i.V($,V,`array expected, ${i.j(V)} found`)];if(V.length!==2)return[new i.V($,V,`array length 2 expected, length ${V.length} found`)];if(C){if(i.j(V[0])!=="object")return[new i.V($,V,`object expected, ${i.j(V[0])} found`)];if(V[0].zoom===void 0)return[new i.V($,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new i.V($,V,"object stop key must have value")];let G=i.u(V[0].zoom);if(typeof G!="number")return[new i.V($,V[0].zoom,"stop zoom values must be numbers")];if(v&&v>G)return[new i.V($,V[0].zoom,"stop zoom values must appear in ascending order")];G!==v&&(v=G,g=void 0,b={}),U=U.concat(Wr({key:`${$}[0]`,value:V[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:za,value:F}}))}else U=U.concat(F({key:`${$}[0]`,value:V[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},V));return i.o(i.q(V[1]))?U.concat([new i.V(`${$}[1]`,V[1],"expressions are not allowed in function stops.")]):U.concat(Ir({key:`${$}[1]`,value:V[1],valueSpec:r,style:N.style,styleSpec:N.styleSpec}))}function F(N,U){let V=i.j(N.value),$=i.u(N.value),G=N.value!==null?N.value:U;if(f){if(V!==f)return[new i.V(N.key,G,`${V} stop domain type must match previous stop domain type ${f}`)]}else f=V;if(V!=="number"&&V!=="string"&&V!=="boolean"&&typeof $!="number"&&typeof $!="string"&&typeof $!="boolean")return[new i.V(N.key,G,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&l!=="categorical"){let Z=`number expected, ${V} found`;return i.m(r)&&l===void 0&&(Z+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(N.key,G,Z)]}return l!=="categorical"||V!=="number"||typeof $=="number"&&isFinite($)&&Math.floor($)===$?l!=="categorical"&&V==="number"&&typeof $=="number"&&typeof g=="number"&&g!==void 0&&$<g?[new i.V(N.key,G,"stop domain values must appear in ascending order")]:(g=$,l==="categorical"&&$ in b?[new i.V(N.key,G,"stop domain values must be unique")]:(b[$]=!0,[])):[new i.V(N.key,G,`integer expected, found ${String($)}`)]}}function Zi(h){let r=(h.expressionContext==="property"?i.r:i.t)(i.q(h.value),h.valueSpec);if(r.result==="error")return r.value.map(f=>new i.V(`${h.key}${f.key}`,h.value,f.message));let l=r.value.expression||r.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!l.outputDefined())return[new i.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!i.v(l))return[new i.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return Ba(l,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!i.x(l,["zoom","feature-state"]))return[new i.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!i.y(l))return[new i.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ba(h,r){let l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(let g of r.valueSpec.expression.parameters)l.delete(g);if(l.size===0)return[];let f=[];return h instanceof i.C&&l.has(h.name)?[new i.V(r.key,r.value,`["${h.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(h.eachChild(g=>{f.push(...Ba(g,r))}),f)}function Qs(h){let r=h.key,l=h.value,f=h.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(i.u(l))===-1&&g.push(new i.V(r,l,`expected one of [${f.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(f.values).indexOf(i.u(l))===-1&&g.push(new i.V(r,l,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function Tn(h){return i.A(i.q(h.value))?Zi(i.k({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):ja(h)}function ja(h){let r=h.value,l=h.key;if(i.j(r)!=="array")return[new i.V(l,r,`array expected, ${i.j(r)} found`)];let f=h.styleSpec,g,v=[];if(r.length<1)return[new i.V(l,r,"filter array must have at least 1 element")];switch(v=v.concat(Qs({key:`${l}[0]`,value:r[0],valueSpec:f.filter_operator,style:h.style,styleSpec:h.styleSpec})),i.u(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&i.u(r[1])==="$type"&&v.push(new i.V(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&v.push(new i.V(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=i.j(r[1]),g!=="string"&&v.push(new i.V(`${l}[1]`,r[1],`string expected, ${g} found`)));for(let b=2;b<r.length;b++)g=i.j(r[b]),i.u(r[1])==="$type"?v=v.concat(Qs({key:`${l}[${b}]`,value:r[b],valueSpec:f.geometry_type,style:h.style,styleSpec:h.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new i.V(`${l}[${b}]`,r[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<r.length;b++)v=v.concat(ja({key:`${l}[${b}]`,value:r[b],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":g=i.j(r[1]),r.length!==2?v.push(new i.V(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new i.V(`${l}[1]`,r[1],`string expected, ${g} found`))}return v}function ri(h,r){let l=h.key,f=h.style,g=h.layer,v=h.styleSpec,b=h.value,T=h.objectKey,D=v[`${r}_${h.layerType}`];if(!D)return[];let C=T.match(/^(.*)-transition$/);if(r==="paint"&&C&&D[C[1]]&&D[C[1]].transition)return Ir({key:l,value:b,valueSpec:v.transition,style:f,styleSpec:v});let P=h.valueSpec||D[T];if(!P)return[new i.i(l,b,`unknown property "${T}"`)];let O;if(i.j(b)==="string"&&i.m(P)&&!P.tokens&&(O=/^{([^}]+)}$/.exec(b))){let N=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new i.V(l,b,`"${T}" does not support interpolation syntax
Use an identity property function instead: ${N}.`)]}let F=[];if(h.layerType==="symbol")T!=="text-field"||!f||f.glyphs||f.imports||F.push(new i.V(l,b,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&i.B(i.q(b))&&i.u(b.type)==="identity"&&F.push(new i.V(l,b,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&r==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&i.m(P)&&(i.D(P)||i.n(P))){let N=i.r(i.q(b),P),U=N.value.expression||N.value._styleExpression.expression;U&&!i.x(U,["measure-light"])&&(T==="model-emissive-strength"&&i.y(U)&&i.v(U)||F.push(new i.V(l,b,`${T} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return F.concat(Ir({key:h.key,value:b,valueSpec:P,style:f,styleSpec:v,expressionContext:"property",propertyType:r,propertyKey:T}))}function Va(h){return ri(h,"paint")}function Ys(h){return ri(h,"layout")}function Qi(h){let r=[],l=h.value,f=h.key,g=h.style,v=h.styleSpec;l.type||l.ref||r.push(new i.V(f,l,'either "type" or "ref" is required'));let b=i.u(l.type),T=i.u(l.ref);if(l.id){let D=i.u(l.id);for(let C=0;C<h.arrayIndex;C++){let P=g.layers[C];i.u(P.id)===D&&r.push(new i.V(f,l.id,`duplicate layer id "${l.id}", previously used at line ${P.id.__line__}`))}}if("ref"in l){let D;["type","source","source-layer","filter","layout"].forEach(C=>{C in l&&r.push(new i.V(f,l[C],`"${C}" is prohibited for ref layers`))}),g.layers.forEach(C=>{i.u(C.id)===T&&(D=C)}),D?D.ref?r.push(new i.V(f,l.ref,"ref cannot reference another ref layer")):b=i.u(D.type):typeof T=="string"&&r.push(new i.V(f,l.ref,`ref layer "${T}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(l.source){let D=g.sources&&g.sources[l.source],C=D&&i.u(D.type);D?C==="vector"&&b==="raster"?r.push(new i.V(f,l.source,`layer "${l.id}" requires a raster source`)):C==="raster"&&b!=="raster"?r.push(new i.V(f,l.source,`layer "${l.id}" requires a vector source`)):C!=="vector"||l["source-layer"]?C==="raster-dem"&&b!=="hillshade"?r.push(new i.V(f,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="raster-array"||["raster","raster-particle"].includes(b)?b!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||C==="geojson"&&D.lineMetrics?b==="raster-particle"&&C!=="raster-array"&&r.push(new i.V(f,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):r.push(new i.V(f,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new i.V(f,l.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new i.V(f,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new i.V(f,l.source,`source "${l.source}" not found`))}else r.push(new i.V(f,l,'missing required property "source"'));return r=r.concat(Wr({key:f,value:l,valueSpec:v.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ir({key:`${f}.type`,value:l.type,valueSpec:v.layer.type,style:h.style,styleSpec:h.styleSpec,object:l,objectKey:"type"}),filter:D=>Tn(i.k({layerType:b},D)),layout:D=>Wr({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":C=>Ys(i.k({layerType:b},C))}}),paint:D=>Wr({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":C=>Va(i.k({layerType:b,layer:l},C))}})}})),r}function It(h){let r=h.value,l=h.key,f=i.j(r);return f!=="string"?[new i.V(l,r,`string expected, ${f} found`)]:[]}let Xs={promoteId:function({key:h,value:r}){if(i.j(r)==="string")return It({key:h,value:r});{let l=[];for(let f in r)l.push(...It({key:`${h}.${f}`,value:r[f]}));return l}}};function Jn(h){let r=h.value,l=h.key,f=h.styleSpec,g=h.style;if(!r.type)return[new i.V(l,r,'"type" is required')];let v=i.u(r.type),b=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(r.url||r.tiles||b.push(new i.i(l,r,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(Wr({key:l,value:r,valueSpec:f[`source_${v.replace("-","_")}`],style:h.style,styleSpec:f,objectElementValidators:Xs})),b;case"geojson":if(b=Wr({key:l,value:r,valueSpec:f.source_geojson,style:g,styleSpec:f,objectElementValidators:Xs}),r.cluster)for(let T in r.clusterProperties){let[D,C]=r.clusterProperties[T],P=typeof D=="string"?[D,["accumulated"],["get",T]]:D;b.push(...Zi({key:`${l}.${T}.map`,value:C,expressionContext:"cluster-map"})),b.push(...Zi({key:`${l}.${T}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return b;case"video":return Wr({key:l,value:r,valueSpec:f.source_video,style:g,styleSpec:f});case"image":return Wr({key:l,value:r,valueSpec:f.source_image,style:g,styleSpec:f});case"canvas":return[new i.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qs({key:`${l}.type`,value:r.type,valueSpec:{values:Kl(f)},style:g,styleSpec:f})}}function Kl(h){return h.source.reduce((r,l)=>{let f=h[l];return f.type.type==="enum"&&(r=r.concat(Object.keys(f.type.values))),r},[])}function Ua(h){let r=h.value,l=h.styleSpec,f=l.light,g=h.style,v=[],b=i.j(r);if(r===void 0)return v;if(b!=="object")return v=v.concat([new i.V("light",r,`object expected, ${b} found`)]),v;for(let T in r){let D=T.match(/^(.*)-transition$/);v=v.concat(D&&f[D[1]]&&f[D[1]].transition?Ir({key:T,value:r[T],valueSpec:l.transition,style:g,styleSpec:l}):f[T]?Ir({key:T,value:r[T],valueSpec:f[T],style:g,styleSpec:l}):[new i.V(T,r[T],`unknown property "${T}"`)])}return v}function ws(h){let r=h.value,l=[];if(!r)return l;let f=i.j(r);if(f!=="object")return l=l.concat([new i.V("light-3d",r,`object expected, ${f} found`)]),l;let g=h.styleSpec,v=g["light-3d"],b=h.key,T=h.style,D=h.style.lights;for(let O of["type","id"])if(!(O in r))return l=l.concat([new i.V("light-3d",r,`missing property ${O} on light`)]),l;if(r.type&&D)for(let O=0;O<h.arrayIndex;O++){let F=i.u(r.type),N=D[O];i.u(N.type)===F&&l.push(new i.V(b,r.id,`duplicate light type "${r.type}", previously defined at line ${N.id.__line__}`))}let C=`properties_light_${r.type}`;if(!(C in g))return l=l.concat([new i.V("light-3d",r,`Invalid light type ${r.type}`)]),l;let P=g[C];for(let O in r)if(O==="properties"){let F=r[O],N=i.j(F);if(N!=="object")return l=l.concat([new i.V("properties",F,`object expected, ${N} found`)]),l;for(let U in F)l=l.concat(P[U]?Ir({key:U,value:F[U],valueSpec:P[U],style:T,styleSpec:g}):[new i.i(h.key,F[U],`unknown property "${U}"`)])}else{let F=O.match(/^(.*)-transition$/);l=l.concat(F&&v[F[1]]&&v[F[1]].transition?Ir({key:O,value:r[O],valueSpec:g.transition,style:T,styleSpec:g}):v[O]?Ir({key:O,value:r[O],valueSpec:v[O],style:T,styleSpec:g}):[new i.i(O,r[O],`unknown property "${O}"`)])}return l}function Ts(h){let r=h.value,l=h.key,f=h.style,g=h.styleSpec,v=g.terrain,b=[],T=i.j(r);if(r===void 0||T==="null")return b;if(T!=="object")return b=b.concat([new i.V("terrain",r,`object expected, ${T} found`)]),b;for(let D in r){let C=D.match(/^(.*)-transition$/);b=b.concat(C&&v[C[1]]&&v[C[1]].transition?Ir({key:D,value:r[D],valueSpec:g.transition,style:f,styleSpec:g}):v[D]?Ir({key:D,value:r[D],valueSpec:v[D],style:f,styleSpec:g}):[new i.i(D,r[D],`unknown property "${D}"`)])}if(r.source){let D=f.sources&&f.sources[r.source],C=D&&i.u(D.type);D?C!=="raster-dem"&&b.push(new i.V(l,r.source,`terrain cannot be used with a source of type ${String(C)}, it only be used with a "raster-dem" source type`)):b.push(new i.V(l,r.source,`source "${r.source}" not found`))}else b.push(new i.V(l,r,'terrain is missing required property "source"'));return b}function Jl(h){let r=h.value,l=h.style,f=h.styleSpec,g=f.fog,v=[],b=i.j(r);if(r===void 0)return v;if(b!=="object")return v=v.concat([new i.V("fog",r,`object expected, ${b} found`)]),v;for(let T in r){let D=T.match(/^(.*)-transition$/);v=v.concat(D&&g[D[1]]&&g[D[1]].transition?Ir({key:T,value:r[T],valueSpec:f.transition,style:l,styleSpec:f}):g[T]?Ir({key:T,value:r[T],valueSpec:g[T],style:l,styleSpec:f}):[new i.i(T,r[T],`unknown property "${T}"`)])}return v}let $a={"*":()=>[],array:Wn,boolean:function(h){let r=h.value,l=h.key,f=i.j(r);return f!=="boolean"?[new i.V(l,r,`boolean expected, ${f} found`)]:[]},number:za,color:function(h){let r=h.key,l=h.value,f=i.j(l);return f!=="string"?[new i.V(r,l,`color expected, ${f} found`)]:i.z(l)===null?[new i.V(r,l,`color expected, "${l}" found`)]:[]},enum:Qs,filter:Tn,function:Ni,layer:Qi,object:Wr,source:Jn,model:i.F,light:Ua,"light-3d":ws,terrain:Ts,fog:Jl,string:It,formatted:function(h){return It(h).length===0?[]:Zi(h)},resolvedImage:function(h){return It(h).length===0?[]:Zi(h)},projection:function(h){let r=h.value,l=h.styleSpec,f=l.projection,g=h.style,v=[],b=i.j(r);if(b==="object")for(let T in r)v=v.concat(Ir({key:T,value:r[T],valueSpec:f[T],style:g,styleSpec:l}));else b!=="string"&&(v=v.concat([new i.V("projection",r,`object or string expected, ${b} found`)]));return v},import:function(h){let{value:r,styleSpec:l}=h,b=r,{data:f}=b,g=$_(b,["data"]);Object.defineProperty(g,"__line__",{value:r.__line__,enumerable:!1});let v=Wr(i.k({},h,{value:g,valueSpec:l.import}));return i.u(g.id)===""&&v.push(new i.V(`${h.key}.id`,g,"import id can't be an empty string")),f&&(v=v.concat(Pt(f,l,{key:`${h.key}.data`}))),v}};function Ir(h,r=!1){let l=h.value,f=h.valueSpec,g=h.styleSpec;if(f.expression&&i.B(i.u(l)))return Ni(h);if(f.expression&&i.o(i.q(l)))return Zi(h);if(f.type&&$a[f.type]){let v=$a[f.type](h);return r===!0&&v.length>0&&i.j(h.value)==="array"?Zi(h):v}return Wr(i.k({},h,{valueSpec:f.type?g[f.type]:f}))}function Eu(h){let r=h.value,l=h.key,f=It(h);return f.length||(r.indexOf("{fontstack}")===-1&&f.push(new i.V(l,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&f.push(new i.V(l,r,'"glyphs" url must include a "{range}" token'))),f}function Pt(h,r=i.G,l={}){return Ir({key:l.key||"",value:h,valueSpec:r.$root,styleSpec:r,style:h,objectElementValidators:{glyphs:Eu,"*":()=>[]}})}function Mt(h,r=i.G){return ke(Pt(h,r))}let ec=h=>ke(Jn(h)),Yi=h=>ke(Ua(h)),He=h=>ke(ws(h)),K=h=>ke(Ts(h)),ie=h=>ke(Jl(h)),pe=h=>ke(Qi(h)),Ne=h=>ke(Tn(h)),je=h=>ke(Va(h)),qe=h=>ke(Ys(h)),mt=h=>ke(i.F(h));function ke(h){return h.slice().sort((r,l)=>r.line&&l.line?r.line-l.line:0)}function ct(h,r){let l=!1;if(r&&r.length)for(let f of r)f instanceof i.i?i.w(f.message):(h.fire(new i.a(new Error(f.message))),l=!0);return l}let ft=new i.H({anchor:new i.J(i.G.light.anchor),position:new i.K(i.G.light.position),color:new i.J(i.G.light.color),intensity:new i.J(i.G.light.intensity)});class vt extends i.E{constructor(r,l="flat"){super(),this._transitionable=new i.L(ft),this.setLight(r,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l,f={}){this._validate(Yi,r,f)||(this._transitionable.setTransitionOrValue(r),this.id=l)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,f){return(!f||f.validate!==!1)&&ct(this,r.call(Mt,i.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:i.G})))}}let it=new i.H({source:new i.J(i.G.terrain.source),exaggeration:new i.J(i.G.terrain.exaggeration)}),Bn=class extends i.E{constructor(h,r,l,f){super(),this.scope=l,this._transitionable=new i.L(it,l,f),this._transitionable.setTransitionOrValue(h,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(h,r){this._transitionable.setTransitionOrValue(h,r)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new i.N(h)).get("exaggeration")}isZoomDependent(){let h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof i.Z}},In=45,Fn=65,Dn=.05;function Mn(h,r,l,f){let g=i.S(In,Fn,l),[v,b]=jn(h,f),T=1-Math.min(1,Math.exp((r-v)/(b-v)*-6));return T*=T*T,T=Math.min(1,1.00747*T),T*g*h.alpha}function jn(h,r){let l=.5/Math.tan(.5*r);return[h.range[0]+l,h.range[1]+l]}function sr(h,r,l,f,g){let v=i.Q.transformMat4([],[r,l,f],g.mercatorFogMatrix);return Mn(h,i.Q.length(v),g.pitch,g._fov)}function zr(h,r,l,f,g,v,b){let T=[[l,f,0],[g,f,0],[g,v,0],[l,v,0]],D=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let P of T){let O=i.Q.transformMat4([],P,r),F=i.Q.length(O);D=Math.min(D,F),C=Math.max(C,F)}return[Mn(h,D,b.pitch,b._fov),Mn(h,C,b.pitch,b._fov)]}let Kn=new i.H({range:new i.J(i.G.fog.range),color:new i.J(i.G.fog.color),"high-color":new i.J(i.G.fog["high-color"]),"space-color":new i.J(i.G.fog["space-color"]),"horizon-blend":new i.J(i.G.fog["horizon-blend"]),"star-intensity":new i.J(i.G.fog["star-intensity"]),"vertical-range":new i.J(i.G.fog["vertical-range"])});class mi extends i.E{constructor(r,l,f,g){super(),this._transitionable=new i.L(Kn,f,new Map(g)),this.set(r,g),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new i.U(Kn)}get state(){let r=this._transform,l=r.projection.name==="globe",f=i.W(r.zoom),g=this.properties.get("range"),v=[.5,3];return{range:l?[i.X(v[0],g[0],f),i.X(v[1],g[1],f)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l,f={}){if(this._validate(ie,r,f))return;let g=i.e({},r);for(let v of Object.keys(i.G.fog))g[v]===void 0&&(g[v]=i.G.fog[v].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;let l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.S(In,Fn,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(f,g,v){let b=i.O.fromLngLat(g),T=v.elevation?v.elevation.getAtPointOrZero(b):0;return sr(f,b.x,b.y,T,v)}(this.state,r,l):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];let l=this._transform.calculateFogTileMatrix(r.toUnwrapped());return zr(this.state,l,0,0,i.Y,i.Y,this._transform)}getOpacityForBounds(r,l,f,g,v){return this._transform.projection.supportsFog?zr(this.state,r,l,f,g,v,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?jn(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;let l=[4,5,6,7];for(let f of l){let g=r.points[f],v;if(g[2]>=0)v=g;else{let b=r.points[f-4];v=i._(b,g,b[2]/(b[2]-g[2]))}if(sr(this.state,v[0],v[1],0,this._transform)>=Dn)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,f){return(!f||f.validate!==!1)&&ct(this,r.call(Mt,i.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:i.G})))}}class ii extends i.E{constructor(r,l,f,g){super(),this.scope=f,this._options=r,this.properties=new i.U(l),this._transitionable=new i.L(l,f,new Map(g)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,l){this._options=r,this._transitionable.setTransitionOrValue(r.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let lo=new i.H({color:new i.J(i.G.properties_light_ambient.color),intensity:new i.J(i.G.properties_light_ambient.intensity)}),Dr=new i.H({direction:new i.$(i.G.properties_light_directional.direction),color:new i.J(i.G.properties_light_directional.color),intensity:new i.J(i.G.properties_light_directional.intensity),"cast-shadows":new i.J(i.G.properties_light_directional["cast-shadows"]),"shadow-intensity":new i.J(i.G.properties_light_directional["shadow-intensity"])});class cr{constructor(r,l,f,g){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(r,l){let f,g;if(r instanceof i.P||typeof r[0]=="number"){let v=i.P.convert(r);f=[v],g=l.isPointAboveHorizon(v)}else{let v=i.P.convert(r[0]),b=i.P.convert(r[1]);f=[v,b],g=i.a0(v,b).every(T=>l.isPointAboveHorizon(T))}return new cr(f,l.getCameraPoint(),g,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return i.a0(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){let l=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],g=i.a0(l,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<f.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?g[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(g[3]=this.cameraPoint)),i.a1(g,r)}bufferedCameraGeometryGlobe(r){let l=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],g=i.a0(l,f,r),v=this.cameraPoint.clone();switch(3*((v.y>l.y)+(v.y>f.y))+((v.x>l.x)+(v.x>f.x))){case 0:g[0]=v,g[4]=v.clone();break;case 1:g.splice(1,0,v);break;case 2:g[1]=v;break;case 3:g.splice(4,0,v);break;case 5:g.splice(2,0,v);break;case 6:g[3]=v;break;case 7:g.splice(3,0,v);break;case 8:g[2]=v}return g}containsTile(r,l,f,g=0){let v=r.queryPadding/l._pixelsPerMercatorPixel+1,b=f?this._bufferedCameraMercator(v,l):this._bufferedScreenMercator(v,l),T=r.tileID.wrap+(b.unwrapped?g:0),D=b.polygon.map($=>i.a2(r.tileTransform,$,T));if(!i.a3(D,0,0,i.Y,i.Y))return;T=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);let C=this.screenGeometryMercator.polygon.map($=>i.a4(r.tileTransform,$,T)),P=C.map($=>new i.P($[0],$[1])),O=l.getFreeCameraOptions().position||new i.O(0,0,0),F=i.a4(r.tileTransform,O,T),N=C.map($=>{let G=i.Q.sub($,$,F);return i.Q.normalize(G,G),new i.a5(F,G)}),U=i.a6(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:N,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(V=i.a7(D),V.min.x=i.ad(V.min.x,0,i.Y),V.min.y=i.ad(V.min.y,0,i.Y),V.max.x=i.ad(V.max.x,0,i.Y),V.max.y=i.ad(V.max.y,0,i.Y),V),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:U};var V}_bufferedScreenMercator(r,l){let f=Ue(r);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let g;return g=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[f]=g,g}}_bufferedCameraMercator(r,l){let f=Ue(r);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let g;return g=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[f]=g,g}}_projectAndResample(r,l){let f=function(v,b){let T=i.a9.multiply([],b.pixelMatrix,b.globeMatrix),D=[0,-i.ae,0,1],C=[0,i.ae,0,1],P=[0,0,0,1];i.aa.transformMat4(D,D,T),i.aa.transformMat4(C,C,T),i.aa.transformMat4(P,P,T);let O=new i.P(D[0]/D[3],D[1]/D[3]),F=new i.P(C[0]/C[3],C[1]/C[3]),N=i.ab(v,O)&&D[3]<P[3],U=i.ab(v,F)&&C[3]<P[3];if(!N&&!U)return null;let V=function(Y,ce,ae){for(let fe=1;fe<Y.length;fe++){let we=Oe(ce.pointCoordinate3D(Y[fe-1]).x),de=Oe(ce.pointCoordinate3D(Y[fe]).x);if(ae<0){if(we<de)return{idx:fe,t:-we/(de-1-we)}}else if(de<we)return{idx:fe,t:(1-we)/(de+1-we)}}return null}(v,b,N?-1:1);if(!V)return null;let{idx:$,t:G}=V,Z=$>1?Re(v.slice(0,$),b):[],te=$<v.length?Re(v.slice($),b):[];Z=Z.map(Y=>new i.P(Oe(Y.x),Y.y)),te=te.map(Y=>new i.P(Oe(Y.x),Y.y));let ee=[...Z];ee.length===0&&ee.push(te[te.length-1]);let re=i.X(ee[ee.length-1].y,(te.length===0?Z[0]:te[0]).y,G),H;return H=N?[new i.P(0,re),new i.P(0,0),new i.P(1,0),new i.P(1,re)]:[new i.P(1,re),new i.P(1,1),new i.P(0,1),new i.P(0,re)],ee.push(...H),te.length===0?ee.push(Z[0]):ee.push(...te),{polygon:ee.map(Y=>new i.O(Y.x,Y.y)),unwrapped:!1}}(r,l);if(f)return f;let g=function(v,b){let T=!1,D=-1/0,C=0;for(let O=0;O<v.length-1;O++)v[O].x>D&&(D=v[O].x,C=O);for(let O=0;O<v.length-1;O++){let F=(C+O)%(v.length-1),N=v[F],U=v[F+1];Math.abs(N.x-U.x)>.5&&(N.x<U.x?(N.x+=1,F===0&&(v[v.length-1].x+=1)):(U.x+=1,F+1===v.length-1&&(v[0].x+=1)),T=!0)}let P=i.a8(b.center.lng);return T&&P<Math.abs(P-1)&&v.forEach(O=>{O.x-=1}),{polygon:v,unwrapped:T}}(Re(r,l).map(v=>new i.P(Oe(v.x),v.y)),l);return{polygon:g.polygon.map(v=>new i.O(v.x,v.y)),unwrapped:g.unwrapped}}}function Re(h,r){return i.ac(h,l=>{let f=r.pointCoordinate3D(l);l.x=f.x,l.y=f.y},1/256)}function Oe(h){return h<0?1+h%1:h%1}function Ue(h){return 100*h|0}function Ze(h,r,l,f,g){let v=function(b,T){if(b)return g(b);if(T){h.url&&T.tiles&&h.tiles&&delete h.tiles;let D=i.af(i.e(T,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(D.vectorLayers=T.vector_layers,D.vectorLayerIds=D.vectorLayers.map(C=>C.id)),T.raster_layers&&(D.rasterLayers=T.raster_layers,D.rasterLayerIds=D.rasterLayers.map(C=>C.id)),D.tiles=r.canonicalizeTileset(D,h.url),g(null,D)}};return h.url?i.g(r.transformRequest(r.normalizeSourceURL(h.url,null,l,f),i.R.Source),v):i.f.frame(()=>v(null,h))}class We{constructor(r,l,f){this.bounds=i.ag.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=f||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){let l=Math.pow(2,r.z),f=Math.floor(i.a8(this.bounds.getWest())*l),g=Math.floor(i.ah(this.bounds.getNorth())*l),v=Math.ceil(i.a8(this.bounds.getEast())*l),b=Math.ceil(i.ah(this.bounds.getSouth())*l);return r.x>=f&&r.x<v&&r.y>=g&&r.y<b}}class tt extends i.E{constructor(r,l,f,g){if(super(),this.id=r,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.e(this,i.af(l,["url","scheme","tileSize","promoteId"])),this._options=i.e({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new i.ai}load(r){this._loaded=!1,this.fire(new i.b("dataloading",{dataType:"source"}));let l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=Ze(this._options,this.map._requestManager,l,f,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new i.a(g))):v&&(i.e(this,v),v.bounds&&(this.tileBounds=new We(v.bounds,this.minzoom,this.maxzoom)),i.am(v.tiles,this.map._requestManager._customAccessToken),this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))),r&&r(g)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();let r=i.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.e({},this._options)}loadTile(r,l){let f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(f,i.R.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster};if(g.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=l:r.request=r.actor.send("reloadTile",g,v.bind(this));else if(r.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",g,v.bind(this),void 0,!0);else{let b=i.ak.call({deduped:this._deduped},g,(T,D)=>{T||!D?v.call(this,T):(g.data={cacheControl:D.cacheControl,expires:D.expires,rawData:D.rawData.slice(0)},r.actor&&r.actor.send("loadTile",g,v.bind(this),void 0,!0))},!0);r.request={cancel:b}}function v(b,T){return delete r.request,r.aborted?l(null):b&&b.status!==404?l(b):(T&&T.resourceTiming&&(r.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&r.setExpiryData(T),r.loadVectorData(T,this.map.painter),i.al(this.dispatcher),l(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class nt extends i.E{constructor(r,l,f,g){super(),this.id=r,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.e({type:"raster"},l),i.e(this,i.af(l,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new i.b("dataloading",{dataType:"source"})),this._tileJSONRequest=Ze(this._options,this.map._requestManager,null,null,(l,f)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new i.a(l)):f&&(i.e(this,f),f.bounds&&(this.tileBounds=new We(f.bounds,this.minzoom,this.maxzoom)),i.am(f.tiles),this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))),r&&r(l)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();let r=i.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){let f=i.f.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);r.request=i.d(this.map._requestManager.transformRequest(g,i.R.Tile),(v,b,T,D)=>(delete r.request,r.aborted?(r.state="unloaded",l(null)):v?(r.state="errored",l(v)):b?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:T,expires:D}),r.setTexture(b,this.map.painter),r.state="loaded",i.al(this.dispatcher),void l(null)):l(null)))}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&r.texture instanceof i.T?(r.destroy(!0),r.texture&&r.texture instanceof i.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Qe extends nt{constructor(r,l,f,g){super(r,l,f,g),this.type="raster-array",this.maxzoom=22,this._options=i.e({type:"raster-array"},l)}triggerRepaint(r){let l=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);l&&l.enabled&&f&&l._clearRenderCacheForTile(f.id,r.tileID),this.map.triggerRepaint()}loadTile(r,l){let f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(f,i.R.Tile);r.requestParams=g,r.actor||(r.actor=this.dispatcher.getActor()),r.request=r.fetchHeader(void 0,(v,b,T,D)=>{if(delete r.request,r.aborted)return r.state="unloaded",l(null);if(v)return v.code===20?void 0:(r.state="errored",l(v));this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:T,expires:D}),r.state="empty",l(null)})}unloadTile(r){let l=r.texture;l&&l instanceof i.T?(r.destroy(!0),this.map.painter.saveTileTexture(l)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,l,f){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(l,f,(g,v)=>{if(g)return r.state="errored",this.fire(new i.a(g)),void this.triggerRepaint(r);v&&(r.setTexture(v,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;let l=this.rasterLayers.find(({id:v})=>v===r),f=l&&l.fields,g=f&&f.bands&&f.bands;return g?g[0]:0}getTextureDescriptor(r,l,f){if(!r)return;let g=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let v=null;l instanceof i.aq?v=l.paint.get("raster-array-band"):l instanceof i.ar&&(v=l.paint.get("raster-particle-array-band"));let b=v||this.getInitialBand(g);if(b!=null)if(r.textureDescriptor){if(!r.updateNeeded(g,b)||f)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,g,b)}}let ot=32,Ye=33,Ot=new Uint16Array(8184);for(let h=0;h<2046;h++){let r=h+2,l=0,f=0,g=0,v=0,b=0,T=0;for(1&r?g=v=b=ot:l=f=T=ot;(r>>=1)>1;){let C=l+g>>1,P=f+v>>1;1&r?(g=l,v=f,l=b,f=T):(l=g,f=v,g=b,v=T),b=C,T=P}let D=4*h;Ot[D+0]=l,Ot[D+1]=f,Ot[D+2]=g,Ot[D+3]=v}let ln=new Uint16Array(2178),_t=new Uint8Array(1089),Vn=new Uint16Array(1089);function ur(h){return h===0?-.03125:h===32?.03125:0}let hr=(()=>{class h{constructor(l,f,g,v){this.id=h.uniqueIdxCounter,h.uniqueIdxCounter++,this.context=l;let b=l.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||v||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){this.id=h.uniqueIdxCounter,h.uniqueIdxCounter++;let f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return h.uniqueIdxCounter=0,h})(),vr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pr{constructor(r,l,f,g,v,b){this.length=l.length,this.attributes=f,this.itemSize=l.bytesPerElement,this.dynamicDraw=g,this.instanceCount=b,this.context=r;let T=r.gl;this.buffer=T.createBuffer(),r.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||v||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){let l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let f=0;f<this.attributes.length;f++){let g=l.attributes[this.attributes[f].name];g!==void 0&&r.enableVertexAttribArray(g)}}setVertexAttribPointers(r,l,f){for(let g=0;g<this.attributes.length;g++){let v=this.attributes[g],b=l.attributes[v.name];b!==void 0&&r.vertexAttribPointer(b,v.components,r[vr[v.type]],!1,this.itemSize,v.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(r,l,f){for(let g=0;g<this.attributes.length;g++){let v=l.attributes[this.attributes[g].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(v,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class pn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class zi extends pn{getDefault(){return i.aA.transparent}set(r){let l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class co extends pn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Vr extends pn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Ks extends pn{getDefault(){return[!0,!0,!0,!0]}set(r){let l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class tc extends pn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class gi extends pn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class J0 extends pn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){let l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class en extends pn{getDefault(){let r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){let l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Bd extends pn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class _i extends pn{getDefault(){return[0,1]}set(r){let l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Qo extends pn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class Lm extends pn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class km extends pn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class jd extends pn{getDefault(){let r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){let l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Fm extends pn{getDefault(){return i.aA.transparent}set(r){let l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Nm extends pn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class zm extends pn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class Bm extends pn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class jm extends pn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Iu=class extends pn{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class $t extends pn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Vd extends pn{getDefault(){let r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){let l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Js extends pn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Vm extends pn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Um extends pn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class $m extends pn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Gm extends pn{getDefault(){return null}set(r){let l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Hm extends pn{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class qm extends pn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Wm extends pn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Zm extends pn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Du extends pn{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class ev extends Du{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Mu extends Du{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class tv extends Du{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class nv extends Mu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class rv{constructor(r,l,f,g,v){this.context=r,this.width=l,this.height=f;let b=this.framebuffer=r.gl.createFramebuffer();g&&(this.colorAttachment=new ev(r,b)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new Mu(r,b):new tv(r,b))}destroy(){let r=this.context.gl;if(this.colorAttachment){let l=this.colorAttachment.get();l&&r.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let l=this.depthAttachment.get();l&&r.deleteRenderbuffer(l)}else{let l=this.depthAttachment.get();l&&r.deleteTexture(l)}r.deleteFramebuffer(this.framebuffer)}}class Tt{constructor(r,l,f){this.func=r,this.mask=l,this.range=f}}Tt.ReadOnly=!1,Tt.ReadWrite=!0,Tt.disabled=new Tt(519,Tt.ReadOnly,[0,1]);let Ud=7680;class Ft{constructor(r,l,f,g,v,b){this.test=r,this.ref=l,this.mask=f,this.fail=g,this.depthFail=v,this.pass=b}}Ft.disabled=new Ft({func:519,mask:0},0,0,Ud,Ud,Ud);let Su=771;class Qt{constructor(r,l,f,g){this.blendFunction=r,this.blendColor=l,this.mask=f,this.blendEquation=g}}Qt.Replace=[1,0,1,0],Qt.disabled=new Qt(Qt.Replace,i.aA.transparent,[!1,!1,!1,!1]),Qt.unblended=new Qt(Qt.Replace,i.aA.transparent,[!0,!0,!0,!0]),Qt.alphaBlended=new Qt([1,Su,1,Su],i.aA.transparent,[!0,!0,!0,!0]),Qt.multiply=new Qt([774,0,774,0],i.aA.transparent,[!0,!0,!0,!0]);let $d=1029,Gd=2305;class At{constructor(r,l,f){this.enable=r,this.mode=l,this.frontFace=f}}At.disabled=new At(!1,$d,Gd),At.backCCW=new At(!0,$d,Gd),At.backCW=new At(!0,$d,2304),At.frontCW=new At(!0,1028,2304),At.frontCCW=new At(!0,1028,Gd);class Po{constructor(r,l){this.gl=r,this.clearColor=new zi(this),this.clearDepth=new co(this),this.clearStencil=new Vr(this),this.colorMask=new Ks(this),this.depthMask=new tc(this),this.stencilMask=new gi(this),this.stencilFunc=new J0(this),this.stencilOp=new en(this),this.stencilTest=new Bd(this),this.depthRange=new _i(this),this.depthTest=new Qo(this),this.depthFunc=new Lm(this),this.blend=new km(this),this.blendFunc=new jd(this),this.blendColor=new Fm(this),this.blendEquation=new Nm(this),this.cullFace=new zm(this),this.cullFaceSide=new Bm(this),this.frontFace=new jm(this),this.program=new Iu(this),this.activeTexture=new $t(this),this.viewport=new Vd(this),this.bindFramebuffer=new Js(this),this.bindRenderbuffer=new Vm(this),this.bindTexture=new Um(this),this.bindVertexBuffer=new $m(this),this.bindElementBuffer=new Gm(this),this.bindVertexArrayOES=new Hm(this),this.pixelStoreUnpack=new qm(this),this.pixelStoreUnpackPremultiplyAlpha=new Wm(this),this.pixelStoreUnpackFlipY=new Zm(this),this.options=l?Ct({},l):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l,f){return new hr(this,r,l,f)}createVertexBuffer(r,l,f,g,v){return new pr(this,r,l,f,g,v)}createRenderbuffer(r,l,f){let g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,r,l,f),this.bindRenderbuffer.set(null),v}createFramebuffer(r,l,f,g){return new rv(this,r,l,f,g)}clear({color:r,depth:l,stencil:f,colorMask:g}){let v=this.gl,b=0;r&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set(g||[!0,!0,!0,!0])),l!==void 0&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),f!==void 0&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),v.clear(b)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){M(r.blendFunction,Qt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var iv=i.aB([{name:"a_index",type:"Int16",components:1}]);let ea=.15000000000000002;class Qm{constructor(r,l,f,g){let v={width:f[0],height:f[1],data:null},b=r.gl;this.targetColorTexture=new i.T(r,v,b.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new i.T(r,v,b.RGBA,{useMipmap:!1}),this.context=r,this.setParticleTextureDimension(l,g),this.lastInvalidatedAt=0}setParticleTextureDimension(r,l){if(this.particleTextureDimension===l)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let f=this.context.gl,g=l*l,v=new Uint8Array(4*g),b=.7692307692307692,T=i.aC(r.key);for(let P=0;P<v.length;P+=4){let O=b*(T()+ea),F=b*(T()+ea),N=255*O%1,U=255*F%1,V=N,$=F-U/255,G=U;v[P+0]=Math.floor(255*(O-N/255)),v[P+1]=Math.floor(255*V),v[P+2]=Math.floor(255*$),v[P+3]=Math.floor(255*G)}let D=new i.h({width:l,height:l},v);this.particleTexture0=new i.T(this.context,D,f.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,D,f.RGBA,{premultiply:!1,useMipmap:!1});let C=new i.aD;C.reserve(g);for(let P=0;P<g;P++)C.emplaceBack(P);this.particleIndexBuffer=this.context.createVertexBuffer(C,iv.members,!0),this.particleSegment=i.aE.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=i.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}let Cu={type:2,extent:i.Y,loadGeometry:()=>[[new i.P(0,0),new i.P(i.Y+1,0),new i.P(i.Y+1,i.Y+1),new i.P(0,i.Y+1),new i.P(0,0)]]};class uo{constructor(r,l,f,g,v){this.tileID=r,this.uid=i.aF(),this.uses=0,this.tileSize=l,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(r){let l=r+this.timeAdded;l<i.f.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.av(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,l,f){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(g,v){let b={};if(!v)return b;for(let T of g){let D=T.layerIds.map(C=>v.getLayer(C)).filter(Boolean);if(D.length!==0){T.layers=D,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(C=>D.filter(P=>P.id===C)[0]));for(let C of D)b[C.fqid]=T}}return b}(r.buckets,l.style),this.hasSymbolBuckets=!1;for(let g in this.buckets){let v=this.buckets[g];if(v instanceof i.aH){if(this.hasSymbolBuckets=!0,!f)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let g in this.buckets){let v=this.buckets[g];if(v instanceof i.aH&&v.hasRTLText){this.hasRTLText=!0,i.aI();break}}this.queryPadding=0;for(let g in this.buckets){let v=this.buckets[g],b=l.style.getOwnLayer(g);if(!b)continue;let T=b.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,T)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new i.aG}unloadVectorData(){if(this.hasData()){for(let r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.fqid]}upload(r){for(let g in this.buckets){let v=this.buckets[g];v.uploadPending()&&v.upload(r)}let l=r.gl,f=this.imageAtlas;if(f&&!f.uploaded){let g=!!Object.keys(f.patternPositions).length;this.imageAtlasTexture=new i.T(r,f.image,l.RGBA,{useMipmap:g}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(r,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(r,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(r,l,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,f),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let g=l.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this._lastUpdatedBrightness=g,this.updateBuckets(void 0,l)))}queryRenderedFeatures(r,l,f,g,v,b,T,D){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:g,pixelPosMatrix:T,transform:b,params:v,tileTransform:this.tileTransform},r,l,f):{}}querySourceFeatures(r,l){let f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;let g=f.loadVTLayers(),v=l?l.sourceLayer:"",b=g._geojsonTileLayer||g[v];if(!b)return;let T=i.aJ(l&&l.filter),{z:D,x:C,y:P}=this.tileID.canonical,O={z:D,x:C,y:P};for(let F=0;F<b.length;F++){let N=b.feature(F);if(T.needGeometry){let $=i.aK(N,!0);if(!T.filter(new i.N(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!T.filter(new i.N(this.tileID.overscaledZ),N))continue;let U=f.getId(N,v),V=new i.aL(N,D,C,P,U);V.tile=O,r.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let r in this.buckets)if(this.buckets[r].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){let l=this.expirationTime;if(r.cacheControl){let f=i.aM(r.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){let f=Date.now(),g=!1;if(this.expirationTime>f)g=!1;else if(l)if(this.expirationTime<l)g=!0;else{let v=this.expirationTime-l;v?this.expirationTime=f+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(r).length!==0&&l&&this.updateBuckets(r,l)}updateBuckets(r,l){if(!this.latestFeatureIndex)return;let f=this.latestFeatureIndex.loadVTLayers(),g=l.style.listImages(),v=l.style.getBrightness();for(let b in this.buckets){if(!l.style.hasLayer(b))continue;let T=this.buckets[b],D=T.layers[0].sourceLayer||"_geojsonTileLayer",C=f[D],P={};if(r&&(P=r[D],!C||!P||Object.keys(P).length===0))continue;if(T.update(P,C,g,this.imageAtlas&&this.imageAtlas.patternPositions||{},v),T instanceof i.aN||T instanceof i.aO){let F=l.style.getOwnSourceCache(T.layers[0].source);l._terrain&&l._terrain.enabled&&F&&T.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(F.id,this.tileID)}let O=l&&l.style&&l.style.getOwnLayer(b);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=i.f.now()+r}setTexture(r,l){let f=l.context,g=f.gl;this.texture=this.texture||l.getTileTexture(r.width),this.texture&&this.texture instanceof i.T?this.texture.update(r,{useMipmap:!0}):(this.texture=new i.T(f,r,g.RGBA,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(r,l){let f={};for(let g of l)f[g]=!0;this.dependencies[r]=f}hasDependency(r,l){for(let f of r){let g=this.dependencies[f];if(g){for(let v of l)if(g[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;let f=i.aP(Cu,this.tileID.canonical,this.tileTransform)[0],g=new i.aQ,v=new i.aR;for(let b=0;b<f.length;b++){let{x:T,y:D}=f[b];g.emplaceBack(T,D),v.emplaceBack(b)}v.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(v),this._tileDebugBuffer=r.createVertexBuffer(g,i.aS.members),this._tileDebugSegments=i.aE.simpleSegment(0,0,g.length,v.length)}_makeTileBoundsBuffers(r,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;let f=i.aP(Cu,this.tileID.canonical,this.tileTransform)[0],g,v;if(this.isRaster){let b=function(T,D){let C=i.av(T,D),P=Math.pow(2,T.z);for(let $=0;$<Ye;$++)for(let G=0;G<Ye;G++){let Z=i.aw((T.x+(G+ur(G))/ot)/P),te=i.ax((T.y+($+ur($))/ot)/P),ee=D.project(Z,te),re=$*Ye+G;ln[2*re+0]=Math.round((ee.x*C.scale-C.x)*i.Y),ln[2*re+1]=Math.round((ee.y*C.scale-C.y)*i.Y)}_t.fill(0),Vn.fill(0);for(let $=2045;$>=0;$--){let G=4*$,Z=Ot[G+0],te=Ot[G+1],ee=Ot[G+2],re=Ot[G+3],H=Z+ee>>1,Y=te+re>>1,ce=H+Y-te,ae=Y+Z-H,fe=te*Ye+Z,we=re*Ye+ee,de=Y*Ye+H,xe=Math.hypot((ln[2*fe+0]+ln[2*we+0])/2-ln[2*de+0],(ln[2*fe+1]+ln[2*we+1])/2-ln[2*de+1])>=16;_t[de]=_t[de]||(xe?1:0),$<1022&&(_t[de]=_t[de]||_t[(te+ae>>1)*Ye+(Z+ce>>1)]||_t[(re+ae>>1)*Ye+(ee+ce>>1)])}let O=new i.ay,F=new i.az,N=0;function U($,G){let Z=G*Ye+$;return Vn[Z]===0&&(O.emplaceBack(ln[2*Z+0],ln[2*Z+1],$*i.Y/ot,G*i.Y/ot),Vn[Z]=++N),Vn[Z]-1}function V($,G,Z,te,ee,re){let H=$+Z>>1,Y=G+te>>1;if(Math.abs($-ee)+Math.abs(G-re)>1&&_t[Y*Ye+H])V(ee,re,$,G,H,Y),V(Z,te,ee,re,H,Y);else{let ce=U($,G),ae=U(Z,te),fe=U(ee,re);F.emplaceBack(ce,ae,fe)}}return V(0,0,ot,ot,ot,0),V(ot,ot,0,0,0,ot),{vertices:O,indices:F}}(this.tileID.canonical,l);g=b.vertices,v=b.indices}else{g=new i.ay,v=new i.az;for(let{x:T,y:D}of f)g.emplaceBack(T,D,0,0);let b=i.aT(g.int16,void 0,4);for(let T=0;T<b.length;T+=3)v.emplaceBack(b[T],b[T+1],b[T+2])}this._tileBoundsBuffer=r.createVertexBuffer(g,i.aU.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(v),this._tileBoundsSegments=i.aE.simpleSegment(0,0,g.length,v.length)}_makeGlobeTileDebugBuffers(r,l){let f=l.projection;if(!f||f.name!=="globe"||l.freezeTileCoverage)return;let g=this.tileID.canonical,v=i.aV(g,l),b=i.aW(v),T=i.W(l.zoom),D;T>0&&(D=i.a9.invert(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,g,l,b,D,T),this._makeGlobeTileDebugTextBuffer(r,g,l,b,D,T)}_globePoint(r,l,f,g,v,b,T){let D=i.aX(r,l,f);if(b){let C=1<<f.z,P=i.a8(g.center.lng),O=i.ah(g.center.lat),F=(f.x+.5)/C-P,N=0;F>.5?N=-1:F<-.5&&(N=1);let U=(r/i.Y+f.x)/C+N,V=(l/i.Y+f.y)/C;U=(U-P)*g._pixelsPerMercatorPixel+P,V=(V-O)*g._pixelsPerMercatorPixel+O;let $=[U*g.worldSize,V*g.worldSize,0];i.Q.transformMat4($,$,b),D=i.aY(D,$,T)}return i.Q.transformMat4(D,D,v)}_makeGlobeTileDebugBorderBuffer(r,l,f,g,v,b){let T=new i.aQ,D=new i.aR,C=new i.aZ,P=(F,N,U,V,$)=>{let G=(U-F)/($-1),Z=(V-N)/($-1),te=T.length;for(let ee=0;ee<$;ee++){let re=F+ee*G,H=N+ee*Z;T.emplaceBack(re,H);let Y=this._globePoint(re,H,l,f,g,v,b);C.emplaceBack(Y[0],Y[1],Y[2]),D.emplaceBack(te+ee)}},O=i.Y;P(0,0,O,0,16),P(O,0,O,O,16),P(O,O,0,O,16),P(0,O,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(D),this._tileDebugBuffer=r.createVertexBuffer(T,i.aS.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(C,i.a_.members),this._tileDebugSegments=i.aE.simpleSegment(0,0,T.length,D.length)}_makeGlobeTileDebugTextBuffer(r,l,f,g,v,b){let T=i.Y/4,D=new i.aQ,C=new i.az,P=new i.aZ,O=25;C.reserve(32),D.reserve(O),P.reserve(O);let F=(N,U)=>O*N+U;for(let N=0;N<O;N++){let U=N*T;for(let V=0;V<O;V++){let $=V*T;D.emplaceBack($,U);let G=this._globePoint($,U,l,f,g,v,b);P.emplaceBack(G[0],G[1],G[2])}}for(let N=0;N<4;N++)for(let U=0;U<4;U++){let V=F(N,U),$=F(N,U+1),G=F(N+1,U),Z=F(N+1,U+1);C.emplaceBack(V,$,G),C.emplaceBack(G,$,Z)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(C),this._tileDebugTextBuffer=r.createVertexBuffer(D,i.aS.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(P,i.a_.members),this._tileDebugTextSegments=i.aE.simpleSegment(0,0,O,32)}destroy(r=!1){for(let l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let Je={vector:tt,raster:nt,"raster-dem":class extends nt{constructor(h,r,l,f){super(h,r,l,f),this.type="raster-dem",this.maxzoom=22,this._options=i.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(h,r){let l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(g,v){g&&(h.state="errored",r(g)),v&&(h.dem=v,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",r(null))}h.request=i.d(this.map._requestManager.transformRequest(l,i.R.Tile),(function(g,v,b,T){if(delete h.request,h.aborted)h.state="unloaded",r(null);else if(g)h.state="errored",r(g);else if(v){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:b,expires:T});let D=ImageBitmap&&v instanceof ImageBitmap&&i.an(),C=1-(v.width-i.ao(v.width))/2;C<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));let P=D?v:i.f.getImageData(v,C),O={uid:h.uid,coord:h.tileID,source:this.id,scope:this.scope,rawImageData:P,encoding:this.encoding,padding:C};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",O,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){let r=h.canonical,l=Math.pow(2,r.z),f=(r.x-1+l)%l,g=r.x===0?h.wrap-1:h.wrap,v=(r.x+1+l)%l,b=r.x+1===l?h.wrap+1:h.wrap,T={};return T[new i.ap(h.overscaledZ,g,r.z,f,r.y).key]={backfilled:!1},T[new i.ap(h.overscaledZ,b,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(T[new i.ap(h.overscaledZ,g,r.z,f,r.y-1).key]={backfilled:!1},T[new i.ap(h.overscaledZ,h.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},T[new i.ap(h.overscaledZ,b,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<l&&(T[new i.ap(h.overscaledZ,g,r.z,f,r.y+1).key]={backfilled:!1},T[new i.ap(h.overscaledZ,h.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},T[new i.ap(h.overscaledZ,b,r.z,v,r.y+1).key]={backfilled:!1}),T}},"raster-array":Qe,geojson:class extends i.E{constructor(h,r,l,f){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(f),this._data=r.data,this._options=i.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;let g=i.Y/this.tileSize;this.workerOptions=i.e({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*g,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*g,extent:i.Y,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:i.Y,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*g,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){return this._options.dynamic?(this._data=h,this._updateWorkerData(!0),this):this.fire(new i.a(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(h,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},r),this}getClusterChildren(h,r){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},r),this}getClusterLeaves(h,r,l,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:r,offset:l},f),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.b("dataloading",{dataType:"source"})),this._loaded=!1;let r=i.e({append:h},this.workerOptions);r.scope=this.scope;let l=this._data;typeof l=="string"?(r.request=this.map._requestManager.transformRequest(i.f.resolveURL(l),i.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(f,g)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new i.a(f));else{let v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),this.fire(new i.b("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,r){let l=h.actor?"reloadTile":"loadTile";h.actor=this.actor;let f={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:i.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};h.request=this.actor.send(l,f,(g,v)=>(delete h.request,h.destroy(),h.aborted?r(null):g?r(g):(h.loadVectorData(v,this.map.painter,l==="reloadTile"),r(null))),void 0,l==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.as{constructor(h,r,l,f){super(h,r,l,f),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;let h=this.options;this.urls=[];for(let r of h.urls)this.urls.push(this.map._requestManager.transformRequest(r,i.R.Source).url);i.at(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new i.a(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){let r=this.video.seekable;h<r.start(0)||h>r.end(0)?this.fire(new i.a(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let h=this.map.painter.context,r=h.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(h,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.as,model:class extends i.E{constructor(h,r,l,f){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){let h=[];for(let r in this._options.models){let l=this._options.models[r],f=i.l(this.map._requestManager.transformRequest(l.uri,i.R.Model).url).then(g=>{if(!g)return;let v=i.c(g),b=new i.M(r,l.position,l.orientation,v);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(g=>{this.fire(new i.a(new Error(`Could not load model ${r} from ${l.uri}: ${g.message}`)))});h.push(f)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this.fire(new i.a(new Error(`Could not load models: ${r.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,r){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(h,r,l,f){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(h){this.map=h,this.load()}load(h){this._loaded=!1,this.fire(new i.b("dataloading",{dataType:"source"}));let r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=Ze(this._options,this.map._requestManager,r,l,(f,g)=>{this._tileJSONRequest=null,this._loaded=!0,f?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new i.a(f))):g&&(i.e(this,g),g.bounds&&(this.tileBounds=new We(g.bounds,this.minzoom,this.maxzoom)),i.am(g.tiles,this.map._requestManager._customAccessToken),this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))),h&&h(f)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,r){let l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(l,i.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=r;else{if(h.buckets){let v=Object.values(h.buckets);for(let b of v)b.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",f,g.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",f,g.bind(this),void 0,!0);function g(v,b){return h.aborted?r(null):v&&v.status!==404?r(v):(b&&(b.resourceTiming&&(h.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&h.setExpiryData(b),h.buckets=Ct(Ct({},h.buckets),b.buckets),b.featureIndex&&(h.latestFeatureIndex=b.featureIndex)),h.state="loaded",void r(null))}}serialize(){return i.e({},this._options)}},canvas:class extends i.as{constructor(h,r,l,f){super(h,r,l,f),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(v=>typeof v!="number"))||this.fire(new i.a(new i.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.a(new i.V(`sources.${h}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new i.a(new i.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new i.a(new i.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.a(new i.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let r=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof i.au||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends i.E{constructor(h,r,l,f){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new We(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),i.e(this,i.af(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.af(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new i.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){let{x:r,y:l,z:f}=h.canonical;return this._implementation.hasTile({x:r,y:l,z:f})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,r){let{x:l,y:f,z:g}=h.tileID.canonical,v=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:l,y:f,z:g},{signal:v.signal})).then((function(b){return delete h.request,h.aborted?(h.state="unloaded",r(null)):b===void 0?(h.state="errored",r(null)):b===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",r(null)):function(T){return T instanceof ImageData||T instanceof HTMLCanvasElement||T instanceof ImageBitmap||T instanceof HTMLImageElement}(b)?(this.loadTileData(h,b),h.state="loaded",void r(null)):(h.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.code!==20&&(h.state="errored",r(b))}),h.request.cancel=()=>v.abort()}loadTileData(h,r){h.setTexture(r,this._map.painter)}unloadTile(h,r){if(h.texture&&h.texture instanceof i.T?(h.destroy(!0),h.texture&&h.texture instanceof i.T&&this._map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){let{x:l,y:f,z:g}=h.tileID.canonical;this._implementation.unloadTile({x:l,y:f,z:g})}r()}abortTile(h,r){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){let h=i.aj(this.id,this.scope);this._map.style.clearSource(h)}_update(){this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))}}},Hd=function(h,r,l,f){let g=new Je[r.type](h,r,l,f);if(g.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${g.id}`);return i.a$(["load","abort","unload","serialize","prepare"],g),g};function qd(h,r){let l=i.a9.identity([]);return i.a9.scale(l,l,[.5*h.width,.5*-h.height,1]),i.a9.translate(l,l,[1,-1,0]),i.a9.multiply(l,l,h.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(l)}function hn(h,r,l,f,g,v,b,T=!1){let D=h.tilesIn(f,b,T);D.sort(Ym);let C=[];for(let O of D)C.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(r,l,h._state,O,g,v,qd(h.transform,O.tile.tileID),T)});let P=function(O){let F={},N={};for(let U of O){let V=U.queryResults,$=U.wrappedTileID,G=N[$]=N[$]||{};for(let Z in V){let te=V[Z],ee=G[Z]=G[Z]||{},re=F[Z]=F[Z]||[];for(let H of te)ee[H.featureIndex]||(ee[H.featureIndex]=!0,re.push(H))}}return F}(C);for(let O in P)P[O].forEach(F=>{let N=F.feature,U=N.layer;U&&U.type!=="background"&&U.type!=="sky"&&U.type!=="slot"&&(N.source=U.source,U["source-layer"]&&(N.sourceLayer=U["source-layer"]),N.state=N.id!==void 0?h.getFeatureState(U["source-layer"],N.id):{})});return P}function yi(h,r){let l=h.getRenderableIds().map(v=>h.getTileByID(v)),f=[],g={};for(let v=0;v<l.length;v++){let b=l[v],T=b.tileID.canonical.key;g[T]||(g[T]=!0,b.querySourceFeatures(f,r))}return f}function Ym(h,r){let l=h.tileID,f=r.tileID;return l.overscaledZ-f.overscaledZ||l.canonical.y-f.canonical.y||l.wrap-f.wrap||l.canonical.x-f.canonical.x}class Au extends uo{constructor(r,l,f,g,v){super(r,l,f,g,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(r,l){let f=l.context,g=f.gl;this.texture=this.texture||l.getTileTexture(r.width),this.texture&&this.texture instanceof i.T?this.texture.update(r,{useMipmap:!1,premultiply:!1}):this.texture=new i.T(f,r,g.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(r=16384,l){let f=this._mrt=new i.b0(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=i.b1(g,(v,b,T,D)=>{if(v)l(v);else try{let C=f.getHeaderLength(b);if(C>r)return void(this.request=this.fetchHeader(C,l));f.parseHeader(b),this._isHeaderLoaded=!0;let P=0;for(let O of Object.values(f.layers))P=Math.max(P,O.dataIndex[O.dataIndex.length-1].last_byte);b.byteLength>=P&&(this.entireBuffer=b),l(null,this.entireBuffer||b,T,D)}catch(C){l(C)}}),this.request}fetchBand(r,l,f){let g=this._mrt;if(!this._isHeaderLoaded||!g)return void f(new Error("Tile header is not ready"));let v=this.actor;if(!v)return void f(new Error("Can't fetch tile band without an actor"));let b,T=(O,F)=>{b.complete(O,F),O?f(O):(this.updateTextureDescriptor(r,l),f(null,this.textureDescriptor&&this.textureDescriptor.img))},D=(O,F)=>{if(O)return f(O);let N=v.send("decodeRasterArray",{buffer:F,task:b},T,void 0,!0);this._workQueue.push(()=>{N&&N.cancel(),b.cancel()})},C=g.getLayer(r);if(!C)return void f(new Error(`Unknown sourceLayer "${r}"`));if(C.hasDataForBand(l))return this.updateTextureDescriptor(r,l),void f(null,this.textureDescriptor?this.textureDescriptor.img:null);let P=C.getDataRange([l]);if(b=g.createDecodingTask(P),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)D(null,this.entireBuffer.slice(P.firstByte,P.lastByte+1));else{let O=Object.assign({},this.requestParams,{headers:{Range:`bytes=${P.firstByte}-${P.lastByte}`}}),F=i.b1(O,D);this._fetchQueue.push(()=>{F.cancel(),b.cancel()})}else f(null)}updateNeeded(r,l){return(!this.textureDescriptor||this.textureDescriptor.band!==l||this.textureDescriptor.layer!==r)&&this.state!=="errored"}updateTextureDescriptor(r,l){if(!this._mrt)return;let f=this._mrt.getLayer(r);if(!f||!f.hasBand(l)||!f.hasDataForBand(l))return;let{bytes:g,tileSize:v,buffer:b,offset:T,scale:D}=f.getBandView(l),C=v+2*b,P={data:g,width:C,height:C},O=this.texture;O&&O instanceof i.T&&O.update(P,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:r,band:l,img:P,buffer:b,offset:T,tileSize:v,format:f.pixelFormat,mix:[D,256*D,65536*D,16777216*D]}}}class Xm{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(let r in this.data)for(let l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,f){let g=r.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);let v={value:l,timeout:void 0};if(f!==void 0&&(v.timeout=setTimeout(()=>{this.remove(r,v)},f)),this.data[g].push(v),this.order.push(g),this.order.length>this.max){let b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){let l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){let l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;let f=r.wrapped().key,g=l===void 0?0:this.data[f].indexOf(l),v=this.data[f][g];return this.data[f].splice(g,1),v.timeout&&clearTimeout(v.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(v.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){let l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){let l=[];for(let f in this.data)for(let g of this.data[f])r(g.value)||l.push(g);for(let f of l)this.remove(f.value.tileID,f)}}class ho extends i.E{constructor(r,l,f){super(),this.id=r,this._onlySymbols=f,l.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new Xm(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new pi,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let r in this._tiles){let l=this._tiles[r];if(l.state!=="errored"&&(l.state!=="loaded"||!l.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let l in this._tiles){let f=this._tiles[l];f.upload(r),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return i.b2(this._tiles).map(r=>r.tileID).sort(tn).map(r=>r.key)}getRenderableIds(r,l){let f=[];for(let g in this._tiles)this._isIdRenderable(+g,r,l)&&f.push(this._tiles[g]);return r?f.sort((g,v)=>{let b=g.tileID,T=v.tileID,D=new i.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),C=new i.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-T.overscaledZ||C.y-D.y||C.x-D.x}).map(g=>g.tileID.key):f.map(g=>g.tileID).sort(tn).map(g=>g.key)}hasRenderableParent(r){let l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l,f){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())&&(f||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){let f=this._tiles[r];f&&(f.state!=="loading"&&(f.state=l),this._loadTile(f,this._tileLoaded.bind(this,f,r,l)))}_tileLoaded(r,l,f,g){if(g)if(r.state="errored",g.status!==404)this._source.fire(new i.a(g,{tile:r}));else{if(!(r.tileID.key in this._loadedParentTiles))return void this._source.fire(new i.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=i.f.now(),f==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new i.b("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){let l=this.getRenderableIds();for(let g=0;g<l.length;g++){let v=l[g];if(r.neighboringTiles&&r.neighboringTiles[v]){let b=this.getTileByID(v);f(r,b),f(b,r)}}function f(g,v){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let b=v.tileID.canonical.x-g.tileID.canonical.x,T=v.tileID.canonical.y-g.tileID.canonical.y,D=Math.pow(2,g.tileID.canonical.z),C=v.tileID.key;b===0&&T===0||Math.abs(T)>1||(Math.abs(b)>1&&(Math.abs(b+D)===1?b+=D:Math.abs(b-D)===1&&(b-=D)),v.dem&&g.dem&&(g.dem.backfillBorder(v.dem,b,T),g.neighboringTiles&&g.neighboringTiles[C]&&(g.neighboringTiles[C].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,f,g){for(let v in this._tiles){let b=this._tiles[v];if(g[v]||!b.hasData()||b.tileID.overscaledZ<=l||b.tileID.overscaledZ>f)continue;let T=b.tileID;for(;b&&b.tileID.overscaledZ>l+1;){let C=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[C.key],b&&b.hasData()&&(T=C)}let D=T;for(;D.overscaledZ>l;)if(D=D.scaledTo(D.overscaledZ-1),r[D.key]){g[T.key]=T;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){let f=this._loadedParentTiles[r.key];return f&&f.tileID.overscaledZ>=l?f:null}for(let f=r.overscaledZ-1;f>=l;f--){let g=r.scaledTo(f),v=this._getLoadedTile(g);if(v)return v}}_getLoadedTile(r){let l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;let f=Math.ceil(r.width/l)+1,g=Math.ceil(r.height/l)+1,v=Math.floor(f*g*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(T)}handleWrapJump(r){let l=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,l){let f={};for(let g in this._tiles){let v=this._tiles[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+l),f[v.tileID.key]=v}this._tiles=f;for(let g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(let g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(r,l,f,g){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;let v;if(this.updateCacheSize(r,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)v=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new i.ap(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y));else if(this.tileCoverLift!==0){let D=r.clone();D.tileCoverLift=this.tileCoverLift,v=D.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&r.projection.name==="globe"&&(v.push(new i.ap(1,0,1,0,0)),v.push(new i.ap(1,0,1,1,0)),v.push(new i.ap(1,0,1,0,1)),v.push(new i.ap(1,0,1,1,1)))}else v=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(v=v.filter(D=>this._source.hasTile(D)));else v=[];if(v.length>0&&this.castsShadows&&g&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!nc(this._source.type)){let D=r.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),C=Math.min(D,this._source.maxzoom),P=r.extendTileCoverForShadows(v,g,C);for(let O of P)this._shadowCasterTiles[O.key]=!0,v.push(O)}let b=this._updateRetainedTiles(v);if(nc(this._source.type)&&v.length!==0){let D={},C={},P=Object.keys(b);for(let F of P){let N=b[F],U=this._tiles[F];if(!U||U.fadeEndTime&&U.fadeEndTime<=i.f.now())continue;let V=this.findLoadedParent(N,Math.max(N.overscaledZ-ho.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),D[V.tileID.key]=V.tileID),C[F]=N}let O=v[v.length-1].overscaledZ;for(let F in this._tiles){let N=this._tiles[F];if(b[F]||!N.hasData())continue;let U=N.tileID;for(;U.overscaledZ>O;){U=U.scaledTo(U.overscaledZ-1);let V=this._tiles[U.key];if(V&&V.hasData()&&C[U.key]){b[F]=N.tileID;break}}}for(let F in D)b[F]||(this._coveredTiles[F]=!0,b[F]=D[F])}for(let D in b)this._tiles[D].clearFadeHold();let T=i.b3(this._tiles,b);for(let D of T){let C=this._tiles[D];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+D)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){let l={};if(r.length===0)return l;let f={},g=r.reduce((C,P)=>Math.min(C,P.overscaledZ),1/0),v=r[0].overscaledZ,b=Math.max(v-ho.maxOverzooming,this._source.minzoom),T=Math.max(v+ho.maxUnderzooming,this._source.minzoom),D={};for(let C of r){let P=this._addTile(C);l[C.key]=C,P.hasData()||g<this._source.maxzoom&&(D[C.key]=C)}this._retainLoadedChildren(D,g,T,l);for(let C of r){let P=this._tiles[C.key];if(P.hasData())continue;if(C.canonical.z>=this._source.maxzoom){let F=C.children(this._source.maxzoom)[0],N=this.getTile(F);if(N&&N.hasData()){l[F.key]=F;continue}}else{let F=C.children(this._source.maxzoom);if(l[F[0].key]&&l[F[1].key]&&l[F[2].key]&&l[F[3].key])continue}let O=P.wasRequested();for(let F=C.overscaledZ-1;F>=b;--F){let N=C.scaledTo(F);if(f[N.key]||(f[N.key]=!0,P=this.getTile(N),!P&&O&&(P=this._addTile(N)),P&&(l[N.key]=N,O=P.wasRequested(),P.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let r in this._tiles){let l=[],f,g=this._tiles[r].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){f=this._loadedParentTiles[g.key];break}l.push(g.key);let v=g.scaledTo(g.overscaledZ-1);if(f=this._getLoadedTile(v),f)break;g=v}for(let v of l)this._loadedParentTiles[v]=f}}_addTile(r){let l=this._tiles[r.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));let f=!!l;if(!f){let g=this.map?this.map.painter:null,v=this._source.tileSize*r.overscaleFactor();l=this._source.type==="raster-array"?new Au(r,v,this.transform.tileZoom,g,this._isRaster):new uo(r,v,this.transform.tileZoom,g,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))}return l?(l.uses++,this._tiles[r.key]=l,f||this._source.fire(new i.b("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);let f=l.getExpiryTimeout();f&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},f))}_removeTile(r){let l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,l,f){let g=[],v=this.transform;if(!v)return g;let b=v.projection.name==="globe",T=i.a8(v.center.lng);for(let D in this._tiles){let C=this._tiles[D];if(f&&C.clearQueryDebugViz(),C.holdingForFade())continue;let P;if(b){let O=C.tileID.canonical;if(O.z===0){let F=[Math.abs(i.ad(T,...Yo(O,-1))-T),Math.abs(i.ad(T,...Yo(O,1))-T)];P=[0,2*F.indexOf(Math.min(...F))-1]}else{let F=[Math.abs(i.ad(T,...Yo(O,-1))-T),Math.abs(i.ad(T,...Yo(O,0))-T),Math.abs(i.ad(T,...Yo(O,1))-T)];P=[F.indexOf(Math.min(...F))-1]}}else P=[0];for(let O of P){let F=r.containsTile(C,v,l,O);F&&g.push(F)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,l){let f=this.getRenderableIds(r,l).map(v=>this._tiles[v].tileID),g=this.transform.projection.name==="globe";for(let v of f)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=g?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return f}sortCoordinatesByDistance(r){let l=r.slice(),f=this.transform._camera.position,g=this.transform._camera.forward(),v={};for(let b of l){let T=1/(1<<b.canonical.z);v[b.key]=((b.canonical.x+.5)*T+b.wrap-f[0])*g[0]+((b.canonical.y+.5)*T-f[1])*g[1]-f[2]*g[2]}return l.sort((b,T)=>v[b.key]-v[T.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(nc(this._source.type))for(let r in this._tiles){let l=this._tiles[r];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=i.f.now())return!0}return!1}setFeatureState(r,l,f){this._state.updateState(r=r||"_geojsonTileLayer",l,f)}removeFeatureState(r,l,f){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,f)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,f){let g=this._tiles[r];g&&g.setDependencies(l,f)}reloadTilesForDependencies(r,l){for(let f in this._tiles)this._tiles[f].hasDependency(r,l)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(r,l))}_preloadTiles(r,l){if(!this._sourceLoaded){let D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(r,l))};return void this._source.on("data",D)}let f=new Map,g=Array.isArray(r)?r:[r],v=this.map.painter.terrain,b=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(let D of g){let C=D.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let P of C)f.set(P.key,P);this.usedForTerrain&&D.updateElevation(!1)}let T=Array.from(f.values());i.b4(T,(D,C)=>{let P=new uo(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(P,O=>{this._source.type==="raster-dem"&&P.dem&&this._backfillDEM(P),C(O,P)})},l)}}function tn(h,r){let l=Math.abs(2*h.wrap)-+(h.wrap<0),f=Math.abs(2*r.wrap)-+(r.wrap<0);return h.overscaledZ-r.overscaledZ||f-l||r.canonical.y-h.canonical.y||r.canonical.x-h.canonical.x}function nc(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function Yo(h,r){let l=1<<h.z;return[h.x/l+r,(h.x+1)/l+r]}ho.maxOverzooming=10,ho.maxUnderzooming=3;class Wd{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let r=!1,l=!1;for(let f in this.style._mergedLayers){let g=this.style._mergedLayers[f];if(g.type==="fill-extrusion")this.layers.push({layer:g,visible:r,visibilityChanged:l});else if(g.type==="model"){let v=this.style.getLayerSource(g);v&&v.type==="batched-model"&&this.layers.push({layer:g,visible:r,visibilityChanged:l})}}}onNewFrame(r){this.layersGotHidden=!1;for(let l of this.layers){let f=l.layer,g=!1;f.type==="fill-extrusion"?g=!f.isHidden(r)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="model"&&(g=!f.isHidden(r)&&f.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!g&&l.visible,l.visible=g}}updateZOffset(r,l){this.currentBuildingBuckets=[];for(let g of this.layers){let v=g.layer,b=this.style.getLayerSourceCache(v),T=1;v.type==="fill-extrusion"&&(T=g.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let D=b?b.getTile(l):null;if(!D&&b&&l.canonical.z>b.getSource().minzoom){let C=l.scaledTo(Math.min(b.getSource().maxzoom,l.overscaledZ-1));for(;C.overscaledZ>=b.getSource().minzoom&&(D=b.getTile(C),!D&&C.overscaledZ!==0);)C=C.scaledTo(C.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:D?D.getBucket(v):null,tileID:D?D.tileID:l,verticalScale:T})}r.hasAnyZOffset=!1;let f=!1;for(let g=0;g<r.symbolInstances.length;g++){let v=r.symbolInstances.get(g),b=v.zOffset,T=this._getHeightAtTileOffset(l,v.tileAnchorX,v.tileAnchorY);v.zOffset=T!==Number.NEGATIVE_INFINITY?T:b,f||b===v.zOffset||(f=!0),r.hasAnyZOffset||v.zOffset===0||(r.hasAnyZOffset=!0)}f&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,l,f,g){let v=l,b=f;if(r.canonical.z!==g.canonical.z){let T=g.canonical,D=1/(1<<r.canonical.z-T.z);v=(l+r.canonical.x*i.Y)*D-T.x*i.Y|0,b=(f+r.canonical.y*i.Y)*D-T.y*i.Y|0}return{tileX:v,tileY:b}}_getHeightAtTileOffset(r,l,f){let g,v;for(let b=0;b<this.layers.length;++b){if(this.layers[b].layer.type!=="fill-extrusion")continue;let{bucket:T,tileID:D,verticalScale:C}=this.currentBuildingBuckets[b];if(!T)continue;let{tileX:P,tileY:O}=this._mapCoordToOverlappingTile(r,l,f,D),F=T.getHeightAtTileCoord(P,O);F&&F.height!==void 0&&(F.hidden?g=F.height:v=Math.max(F.height*C,v||0))}if(v!==void 0)return v;for(let b=0;b<this.layers.length;++b){let T=this.layers[b];if(T.layer.type!=="model"||!T.visible)continue;let{bucket:D,tileID:C}=this.currentBuildingBuckets[b];if(!D)continue;let{tileX:P,tileY:O}=this._mapCoordToOverlappingTile(r,l,f,C),F=D.getHeightAtTileCoord(P,O);if(F&&!F.hidden)return F.height===void 0&&g!==void 0?Math.min(F.maxHeight,g)*F.verticalScale:F.height?F.height*F.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Xi(h,r){let l={};for(let f in h)f!=="ref"&&(l[f]=h[f]);return i.b5.forEach(f=>{f in r&&(l[f]=r[f])}),l}function Km(h){h=h.slice();let r=Object.create(null);for(let l=0;l<h.length;l++)r[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=Xi(h[l],r[h[l].ref]));return h}let yn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Pu(h,r,l){l.push({command:yn.addSource,args:[h,r[h]]})}function Zd(h,r,l){r.push({command:yn.removeSource,args:[h]}),l[h]=!0}function Jm(h,r,l,f){Zd(h,l,f),Pu(h,r,l)}function Qd(h,r,l){let f;for(f in h[l])if(h[l].hasOwnProperty(f)&&f!=="data"&&!M(h[l][f],r[l][f]))return!1;for(f in r[l])if(r[l].hasOwnProperty(f)&&f!=="data"&&!M(h[l][f],r[l][f]))return!1;return!0}function ta(h,r,l,f,g,v){let b;for(b in r=r||{},h=h||{})h.hasOwnProperty(b)&&(M(h[b],r[b])||l.push({command:v,args:[f,b,r[b],g]}));for(b in r)r.hasOwnProperty(b)&&!h.hasOwnProperty(b)&&(M(h[b],r[b])||l.push({command:v,args:[f,b,r[b],g]}))}function Ga(h){return h.id}function rc(h,r){return h[r.id]=r,h}class Xo{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=i.ad(r,0,1);let l=1,f=this._distances[l],g=r*this.paddedLength+this.padding;for(;f<g&&l<this._distances.length;)f=this._distances[++l];let v=l-1,b=this._distances[v],T=f-b,D=T>0?(g-b)/T:0;return this.points[v].mult(1-D).add(this.points[l].mult(D))}}class Yd{constructor(r,l,f){let g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/f),this.yCellCount=Math.ceil(l/f);for(let b=0;b<this.xCellCount*this.yCellCount;b++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,f,g,v){this._forEachCell(l,f,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(r,l,f,g){this._forEachCell(l-g,f-g,l+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(f),this.circles.push(g)}_insertBoxCell(r,l,f,g,v,b){this.boxCells[v].push(b)}_insertCircleCell(r,l,f,g,v,b){this.circleCells[v].push(b)}_query(r,l,f,g,v,b){if(f<0||r>this.width||g<0||l>this.height)return!v&&[];let T=[];if(r<=0&&l<=0&&this.width<=f&&this.height<=g){if(v)return!0;for(let D=0;D<this.boxKeys.length;D++)T.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){let C=this.circles[3*D],P=this.circles[3*D+1],O=this.circles[3*D+2];T.push({key:this.circleKeys[D],x1:C-O,y1:P-O,x2:C+O,y2:P+O})}return b?T.filter(b):T}return this._forEachCell(r,l,f,g,this._queryCell,T,{hitTest:v,seenUids:{box:{},circle:{}}},b),v?T.length>0:T}_queryCircle(r,l,f,g,v){let b=r-f,T=r+f,D=l-f,C=l+f;if(T<0||b>this.width||C<0||D>this.height)return!g&&[];let P=[];return this._forEachCell(b,D,T,C,this._queryCellCircle,P,{hitTest:g,circle:{x:r,y:l,radius:f},seenUids:{box:{},circle:{}}},v),g?P.length>0:P}query(r,l,f,g,v){return this._query(r,l,f,g,!1,v)}hitTest(r,l,f,g,v){return this._query(r,l,f,g,!0,v)}hitTestCircle(r,l,f,g){return this._queryCircle(r,l,f,!0,g)}_queryCell(r,l,f,g,v,b,T,D){let C=T.seenUids,P=this.boxCells[v];if(P!==null){let F=this.bboxes;for(let N of P)if(!C.box[N]){C.box[N]=!0;let U=4*N;if(r<=F[U+2]&&l<=F[U+3]&&f>=F[U+0]&&g>=F[U+1]&&(!D||D(this.boxKeys[N]))){if(T.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[N],x1:F[U],y1:F[U+1],x2:F[U+2],y2:F[U+3]})}}}let O=this.circleCells[v];if(O!==null){let F=this.circles;for(let N of O)if(!C.circle[N]){C.circle[N]=!0;let U=3*N;if(this._circleAndRectCollide(F[U],F[U+1],F[U+2],r,l,f,g)&&(!D||D(this.circleKeys[N]))){if(T.hitTest)return b.push(!0),!0;{let V=F[U],$=F[U+1],G=F[U+2];b.push({key:this.circleKeys[N],x1:V-G,y1:$-G,x2:V+G,y2:$+G})}}}}}_queryCellCircle(r,l,f,g,v,b,T,D){let C=T.circle,P=T.seenUids,O=this.boxCells[v];if(O!==null){let N=this.bboxes;for(let U of O)if(!P.box[U]){P.box[U]=!0;let V=4*U;if(this._circleAndRectCollide(C.x,C.y,C.radius,N[V+0],N[V+1],N[V+2],N[V+3])&&(!D||D(this.boxKeys[U])))return b.push(!0),!0}}let F=this.circleCells[v];if(F!==null){let N=this.circles;for(let U of F)if(!P.circle[U]){P.circle[U]=!0;let V=3*U;if(this._circlesCollide(N[V],N[V+1],N[V+2],C.x,C.y,C.radius)&&(!D||D(this.circleKeys[U])))return b.push(!0),!0}}}_forEachCell(r,l,f,g,v,b,T,D){let C=this._convertToXCellCoord(r),P=this._convertToYCellCoord(l),O=this._convertToXCellCoord(f),F=this._convertToYCellCoord(g);for(let N=C;N<=O;N++)for(let U=P;U<=F;U++)if(v.call(this,r,l,f,g,this.xCellCount*U+N,b,T,D))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,f,g,v,b){let T=g-r,D=v-l,C=f+b;return C*C>T*T+D*D}_circleAndRectCollide(r,l,f,g,v,b,T){let D=(b-g)/2,C=Math.abs(r-(g+D));if(C>D+f)return!1;let P=(T-v)/2,O=Math.abs(l-(v+P));if(O>P+f)return!1;if(C<=D||O<=P)return!0;let F=C-D,N=O-P;return F*F+N*N<=f*f}}let dr={unknown:0,flipRequired:1,flipNotRequired:2},Es=Math.tan(85*Math.PI/180);function ic(h,r,l,f,g,v,b){let T=i.a9.create();if(l)if(v.name==="globe"){let D=i.b6(g,r);i.a9.multiply(T,T,D)}else{let D=i.b7.invert([],b);T[0]=D[0],T[1]=D[1],T[4]=D[2],T[5]=D[3],f||i.a9.rotateZ(T,T,g.angle)}else i.a9.multiply(T,g.labelPlaneMatrix,h);return T}function oc(h,r,l,f,g,v,b){let T=ic(h,r,l,f,g,v,b);return v.name==="globe"&&l||(T[2]=T[6]=T[10]=T[14]=0),T}function Ko(h,r,l,f,g,v,b){if(l){if(v.name==="globe"){let T=ic(h,r,l,f,g,v,b);return i.a9.invert(T,T),i.a9.multiply(T,h,T),T}{let T=i.a9.clone(h),D=i.a9.identity([]);return D[0]=b[0],D[1]=b[1],D[4]=b[2],D[5]=b[3],i.a9.multiply(T,T,D),f||i.a9.rotateZ(T,T,-g.angle),T}}return g.glCoordMatrix}function Bi(h,r,l,f){let g=[h,r,l,1];l?i.aa.transformMat4(g,g,f):Kd(g,g,f);let v=g[3];return g[0]/=v,g[1]/=v,g[2]/=v,g}function Ru(h,r){return Math.min(.5+h/r*.5,1.5)}function Ou(h,r){let l=h[0]/h[3],f=h[1]/h[3];return l>=-r[0]&&l<=r[0]&&f>=-r[1]&&f<=r[1]}function Lu(h,r,l,f,g,v,b,T,D,C){let P=l.transform,O=f?h.textSizeData:h.iconSizeData,F=i.b8(O,l.transform.zoom),N=P.projection.name==="globe",U=[256/l.width*2+1,256/l.height*2+1],V=f?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;V.clear();let $=null;N&&($=f?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);let G=h.lineVertexArray,Z=f?h.text.placedSymbolArray:h.icon.placedSymbolArray,te=l.transform.width/l.transform.height,ee,re=!1;for(let H=0;H<Z.length;H++){let Y=Z.get(H),{numGlyphs:ce,writingMode:ae}=Y;if(ae!==i.b9.vertical||re||ee===i.b9.horizontal||(re=!0),ee=ae,(Y.hidden||ae===i.b9.vertical)&&!re){ra(ce,V);continue}re=!1;let fe=new i.P(Y.tileAnchorX,Y.tileAnchorY),{x:we,y:de,z:xe}=P.projection.projectTilePoint(fe.x,fe.y,C.canonical);if(D){let[rt,ut,yt]=D(fe);we+=rt,de+=ut,xe+=yt}let Ee=[we,de,xe,1];if(i.aa.transformMat4(Ee,Ee,r),!Ou(Ee,U)){ra(ce,V);continue}let he=Ee[3],ye=Ru(l.transform.getCameraToCenterDistance(P.projection),he),ze=i.ba(O,F,Y),me=b?ze/ye:ze*ye,be=Bi(we,de,xe,g);if(be[3]<=0){ra(ce,V);continue}let Te={},ne=b?null:D,Ae=Ha(Y,me,!1,T,r,g,v,h.glyphOffsetArray,G,V,$,be,fe,Te,te,ne,P.projection,C,b);re=Ae.useVertical,ne&&Ae.needsFlipping&&(Te={}),(Ae.notEnoughRoom||re||Ae.needsFlipping&&Ha(Y,me,!0,T,r,g,v,h.glyphOffsetArray,G,V,$,be,fe,Te,te,ne,P.projection,C,b).notEnoughRoom)&&ra(ce,V)}f?(h.text.dynamicLayoutVertexBuffer.updateData(V),$&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData($)):(h.icon.dynamicLayoutVertexBuffer.updateData(V),$&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData($))}function sc(h,r,l,f,g,v,b,T,D,C,P,O,F,N,U,V){let{lineStartIndex:$,glyphStartIndex:G,segment:Z}=T,te=G+T.numGlyphs,ee=$+T.lineLength,re=r.getoffsetX(G),H=r.getoffsetX(te-1),Y=na(h*re,l,f,g,v,b,Z,$,ee,D,C,P,O,F,!0,N,U,V);if(!Y)return null;let ce=na(h*H,l,f,g,v,b,Z,$,ee,D,C,P,O,F,!0,N,U,V);return ce?{first:Y,last:ce}:null}function Is(h,r,l,f){return h===i.b9.horizontal&&Math.abs(f)>Math.abs(l)?{useVertical:!0}:h===i.b9.vertical?f>0?{needsFlipping:!0}:null:r!==dr.unknown&&function(g,v){return g===0||Math.abs(v/g)>Es}(l,f)?r===dr.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function Ha(h,r,l,f,g,v,b,T,D,C,P,O,F,N,U,V,$,G,Z){let te=r/24,ee=h.lineOffsetX*te,re=h.lineOffsetY*te,{lineStartIndex:H,glyphStartIndex:Y,numGlyphs:ce,segment:ae,writingMode:fe,flipState:we}=h,de=H+h.lineLength,xe=Ee=>{if(P){let[me,be,Te]=Ee.up,ne=C.length;i.bb(P,ne+0,me,be,Te),i.bb(P,ne+1,me,be,Te),i.bb(P,ne+2,me,be,Te),i.bb(P,ne+3,me,be,Te)}let[he,ye,ze]=Ee.point;i.bc(C,he,ye,ze,Ee.angle)};if(ce>1){let Ee=sc(te,T,ee,re,l,O,F,h,D,v,N,V,!1,$,G,Z);if(!Ee)return{notEnoughRoom:!0};if(f&&!l){let[he,ye,ze]=Ee.first.point,[me,be,Te]=Ee.last.point;[he,ye]=Bi(he,ye,ze,b),[me,be]=Bi(me,be,Te,b);let ne=Is(fe,we,(me-he)*U,be-ye);if(h.flipState=ne&&ne.needsFlipping?dr.flipRequired:dr.flipNotRequired,ne)return ne}xe(Ee.first);for(let he=Y+1;he<Y+ce-1;he++){let ye=na(te*T.getoffsetX(he),ee,re,l,O,F,ae,H,de,D,v,N,V,!1,!1,$,G,Z);if(!ye)return C.length-=4*(he-Y),{notEnoughRoom:!0};xe(ye)}xe(Ee.last)}else{if(f&&!l){let he=Bi(F.x,F.y,0,g),ye=H+ae+1,ze=new i.P(D.getx(ye),D.gety(ye)),me=Bi(ze.x,ze.y,0,g),be=me[3]>0?me:Xd(F,ze,he,1,g,void 0,$,G.canonical),Te=Is(fe,we,(be[0]-he[0])*U,be[1]-he[1]);if(h.flipState=Te&&Te.needsFlipping?dr.flipRequired:dr.flipNotRequired,Te)return Te}let Ee=na(te*T.getoffsetX(Y),ee,re,l,O,F,ae,H,de,D,v,N,V,!1,!1,$,G,Z);if(!Ee)return{notEnoughRoom:!0};xe(Ee)}return{}}function ku(h,r,l,f,g){let{x:v,y:b,z:T}=f.projectTilePoint(h.x,h.y,r);if(!g)return Bi(v,b,T,l);let[D,C,P]=g(h);return Bi(v+D,b+C,T+P,l)}function Xd(h,r,l,f,g,v,b,T){let D=ku(h.sub(r)._unit()._add(h),T,g,b,v);return i.Q.sub(D,l,D),i.Q.normalize(D,D),i.Q.scaleAndAdd(D,l,D,f)}function na(h,r,l,f,g,v,b,T,D,C,P,O,F,N,U,V,$,G){let Z=f?h-r:h+r,te=Z>0?1:-1,ee=0;f&&(te*=-1,ee=Math.PI),te<0&&(ee+=Math.PI);let re=T+b+(te>0?0:1)|0,H=g,Y=g,ce=0,ae=0,fe=Math.abs(Z),we=[],de=[],xe=v,Ee=xe,he=()=>Xd(Ee,xe,Y,fe-ce+1,P,F,V,$.canonical);for(;ce+ae<=fe;){if(re+=te,re<T||re>=D)return null;if(Y=H,Ee=xe,we.push(Y),N&&de.push(Ee),xe=new i.P(C.getx(re),C.gety(re)),H=O[re],!H){let ut=ku(xe,$.canonical,P,V,F);H=ut[3]>0?O[re]=ut:he()}ce+=ae,ae=i.Q.distance(Y,H)}U&&F&&(O[re]&&(H=he(),ae=i.Q.distance(Y,H)),O[re]=H);let ye=(fe-ce)/ae,ze=xe.sub(Ee)._mult(ye)._add(Ee),me=i.Q.sub([],H,Y),be=i.Q.scaleAndAdd([],Y,me,ye),Te=[0,0,1],ne=me[0],Ae=me[1];if(G&&(Te=V.upVector($.canonical,ze.x,ze.y),Te[0]!==0||Te[1]!==0||Te[2]!==1)){let ut=[Te[2],0,-Te[0]],yt=i.Q.cross([],Te,ut);i.Q.normalize(ut,ut),i.Q.normalize(yt,yt),ne=i.Q.dot(me,ut),Ae=i.Q.dot(me,yt)}if(l){let ut=i.Q.cross([],Te,me);i.Q.normalize(ut,ut),i.Q.scaleAndAdd(be,be,ut,l*te)}let rt=ee+Math.atan2(Ae,ne);return we.push(be),N&&de.push(ze),{point:be,angle:rt,path:we,tilePath:de,up:Te}}function ra(h,r){let l=r.length,f=l+4*h;r.resize(f),r.float32.fill(-1/0,4*l,4*f)}function Kd(h,r,l){let f=r[0],g=r[1];return h[0]=l[0]*f+l[4]*g+l[12],h[1]=l[1]*f+l[5]*g+l[13],h[3]=l[3]*f+l[7]*g+l[15],h}let fo=100;class eg{constructor(r,l,f=new Yd(r.width+200,r.height+200,25),g=new Yd(r.width+200,r.height+200,25)){this.transform=r,this.grid=f,this.ignoredGrid=g,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+fo,this.screenBottomBoundary=r.height+fo,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,f,g,v,b,T,D){let C=f.projectedAnchorX,P=f.projectedAnchorY,O=f.projectedAnchorZ,F=f.elevation,N=f.tileID,U=r.getProjection();if(F&&N){let[H,Y,ce]=U.upVector(N.canonical,f.tileAnchorX,f.tileAnchorY),ae=U.upVectorScale(N.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;C+=H*F*ae,P+=Y*F*ae,O+=ce*F*ae}let V=this.projectAndGetPerspectiveRatio(T,C,P,O,f.tileID,U.name==="globe"||!!F||this.transform.pitch>0,U),$=b*V.perspectiveRatio,G=(f.x1*l+g.x-f.padding)*$+V.point.x,Z=(f.y1*l+g.y-f.padding)*$+V.point.y,te=(f.x2*l+g.x+f.padding)*$+V.point.x,ee=(f.y2*l+g.y+f.padding)*$+V.point.y,re=V.perspectiveRatio<=.55||V.occluded;return!this.isInsideGrid(G,Z,te,ee)||!v&&this.grid.hitTest(G,Z,te,ee,D)||re?{box:[],offscreen:!1,occluded:V.occluded}:{box:[G,Z,te,ee],offscreen:this.isOffscreen(G,Z,te,ee),occluded:!1}}placeCollisionCircles(r,l,f,g,v,b,T,D,C,P,O,F,N,U,V){let $=[],G=this.transform.elevation,Z=r.getProjection(),te=G?G.getAtTileOffsetFunc(V,this.transform.center.lat,this.transform.worldSize,Z):null,ee=new i.P(f.tileAnchorX,f.tileAnchorY),{x:re,y:H,z:Y}=Z.projectTilePoint(ee.x,ee.y,V.canonical);if(te){let[ze,me,be]=te(ee);re+=ze,H+=me,Y+=be}let ce=Z.name==="globe",ae=this.projectAndGetPerspectiveRatio(T,re,H,Y,V,ce||!!G||this.transform.pitch>0,Z),{perspectiveRatio:fe}=ae,we=(O?b/fe:b*fe)/i.bf,de=Bi(re,H,Y,D),xe=ae.signedDistanceFromCamera>0?sc(we,v,f.lineOffsetX*we,f.lineOffsetY*we,!1,de,ee,f,g,D,{},G&&!O?te:null,O&&!!G,Z,V,O):null,Ee=!1,he=!1,ye=!0;if(xe&&!ae.occluded){let ze=.5*N*fe+U,me=new i.P(-100,-100),be=new i.P(this.screenRightBoundary,this.screenBottomBoundary),Te=new Xo,{first:ne,last:Ae}=xe,rt=ne.path.length,ut=[];for(let wt=rt-1;wt>=1;wt--)ut.push(ne.path[wt]);for(let wt=1;wt<Ae.path.length;wt++)ut.push(Ae.path[wt]);let yt=2.5*ze;C&&(ut=ut.map(([wt,nn,Lt],cn)=>(te&&!ce&&(Lt=te(cn<rt-1?ne.tilePath[rt-1-cn]:Ae.tilePath[cn-rt+2])[2]),Bi(wt,nn,Lt,C))),ut.some(wt=>wt[3]<=0)&&(ut=[]));let pt=[];if(ut.length>0){let wt=1/0,nn=-1/0,Lt=1/0,cn=-1/0;for(let rn of ut)wt=Math.min(wt,rn[0]),Lt=Math.min(Lt,rn[1]),nn=Math.max(nn,rn[0]),cn=Math.max(cn,rn[1]);nn>=me.x&&wt<=be.x&&cn>=me.y&&Lt<=be.y&&(pt=[ut.map(rn=>new i.P(rn[0],rn[1]))],(wt<me.x||nn>be.x||Lt<me.y||cn>be.y)&&(pt=i.bd(pt,me.x,me.y,be.x,be.y)))}for(let wt of pt){Te.reset(wt,.25*ze);let nn=0;nn=Te.length<=.5*ze?1:Math.ceil(Te.paddedLength/yt)+1;for(let Lt=0;Lt<nn;Lt++){let cn=Lt/Math.max(nn-1,1),rn=Te.lerp(cn),er=rn.x+fo,Cn=rn.y+fo;$.push(er,Cn,ze,0);let Sr=er-ze,xr=Cn-ze,Un=er+ze,Pn=Cn+ze;if(ye=ye&&this.isOffscreen(Sr,xr,Un,Pn),he=he||this.isInsideGrid(Sr,xr,Un,Pn),!l&&this.grid.hitTestCircle(er,Cn,ze,F)&&(Ee=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Ee,occluded:!1}}}}return{circles:!P&&Ee||!he?[]:$,offscreen:ye,collisionDetected:Ee,occluded:ae.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let l=[],f=1/0,g=1/0,v=-1/0,b=-1/0;for(let P of r){let O=new i.P(P.x+fo,P.y+fo);f=Math.min(f,O.x),g=Math.min(g,O.y),v=Math.max(v,O.x),b=Math.max(b,O.y),l.push(O)}let T=this.grid.query(f,g,v,b).concat(this.ignoredGrid.query(f,g,v,b)),D={},C={};for(let P of T){let O=P.key;if(D[O.bucketInstanceId]===void 0&&(D[O.bucketInstanceId]={}),D[O.bucketInstanceId][O.featureIndex])continue;let F=[new i.P(P.x1,P.y1),new i.P(P.x2,P.y1),new i.P(P.x2,P.y2),new i.P(P.x1,P.y2)];i.be(l,F)&&(D[O.bucketInstanceId][O.featureIndex]=!0,C[O.bucketInstanceId]===void 0&&(C[O.bucketInstanceId]=[]),C[O.bucketInstanceId].push(O.featureIndex))}return C}insertCollisionBox(r,l,f,g,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:v},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,f,g,v){let b=l?this.ignoredGrid:this.grid,T={bucketInstanceId:f,featureIndex:g,collisionGroupID:v};for(let D=0;D<r.length;D+=4)b.insertCircle(T,r[D],r[D+1],r[D+2])}projectAndGetPerspectiveRatio(r,l,f,g,v,b,T){let D=[l,f,g,1],C=!1;g||this.transform.pitch>0?(i.aa.transformMat4(D,D,r),this.fogState&&v&&T.name!=="globe"&&(C=function(F,N,U,V,$,G){let Z=G.calculateFogTileMatrix($),te=[N,U,V];return i.Q.transformMat4(te,te,Z),Mn(F,i.Q.length(te),G.pitch,G._fov)}(this.fogState,l,f,g,v.toUnwrapped(),this.transform)>.9)):Kd(D,D,r);let P=D[3];return{point:new i.P((D[0]/P+1)/2*this.transform.width+fo,(-D[1]/P+1)/2*this.transform.height+fo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/P*.5,1.5),signedDistanceFromCamera:P,occluded:b&&D[2]>P||C}}isOffscreen(r,l,f,g){return f<fo||r>=this.screenRightBoundary||g<fo||l>this.screenBottomBoundary}isInsideGrid(r,l,f,g){return f>=0&&r<this.gridRightBoundary&&g>=0&&l<this.gridBottomBoundary}getViewportMatrix(){let r=i.a9.identity([]);return i.a9.translate(r,r,[-100,-100,0]),r}}function Fu(h,r,l){let f=r.createTileMatrix(h,h.worldSize,l.toUnwrapped());return i.a9.multiply(new Float32Array(16),h.projMatrix,f)}function Ro(h,r,l){if(r.projection.name===l.projection.name)return h.projMatrix;let f=l.clone();return f.setProjection(r.projection),Fu(f,r.getProjection(),h)}function Nu(h,r,l){return r.name===l.projection.name?h.projMatrix:Fu(l,r,h)}class zu{constructor(r,l,f,g){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class qa{constructor(r,l,f,g,v,b=!1){this.text=new zu(r?r.text:null,l,f,v),this.icon=new zu(r?r.icon:null,l,g,v),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Bu{constructor(r,l,f,g=!1){this.text=r,this.icon=l,this.skipFade=f,this.clipped=g}}class tg{constructor(){this.invProjMatrix=i.a9.create(),this.viewportMatrix=i.a9.create(),this.circles=[]}}class Jo{constructor(r,l,f,g,v){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=v}}class ju{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){let l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:f=>f.collisionGroupID===l}}return this.collisionGroups[r]}}function Jd(h,r,l,f,g){let{horizontalAlign:v,verticalAlign:b}=i.bi(h),T=-(v-.5)*r,D=-(b-.5)*l,C=i.bh(h,f);return new i.P(T+C[0]*g,D+C[1]*g)}function Wa(h,r,l,f,g){let v=new i.P(h,r);return l&&v._rotate(f?g:-g),v}class ef{constructor(r,l,f,g,v,b){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new eg(this.transform,v),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new ju(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,f,g){let v=f.getBucket(l),b=f.latestFeatureIndex;if(!v||!b||l.fqid!==v.layerIds[0])return;let T=v.layers[0].layout,D=f.collisionBoxArray,C=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),P=f.tileSize/i.Y,O=f.tileID.toUnwrapped();this.transform.setProjection(v.projection);let F=(N=f.tileID,U=v.getProjection(),V=this.transform,U.name===this.projection?V.calculateProjMatrix(N.toUnwrapped()):Fu(V,U,N));var N,U,V;let $=T.get("text-pitch-alignment")==="map",G=T.get("text-rotation-alignment")==="map";l.compileFilter();let Z=l.dynamicFilter(),te=l.dynamicFilterNeedsFeature(),ee=this.transform.calculatePixelsToTileUnitsMatrix(f),re=oc(F,f.tileID.canonical,$,G,this.transform,v.getProjection(),ee),H=null;if($){let ae=Ko(F,f.tileID.canonical,$,G,this.transform,v.getProjection(),ee);H=i.a9.multiply([],this.transform.labelPlaneMatrix,ae)}let Y=null;Z&&f.latestFeatureIndex&&(Y={unwrappedTileID:O,dynamicFilter:Z,dynamicFilterNeedsFeature:te,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new Jo(v.bucketInstanceId,b,v.sourceLayerIndex,v.index,f.tileID);let ce={bucket:v,layout:T,posMatrix:F,textLabelPlaneMatrix:re,labelToScreenMatrix:H,clippingData:Y,scale:C,textPixelRatio:P,holdingForFade:f.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:i.b8(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:i.b8(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(g)for(let ae of v.sortKeyRanges){let{sortKey:fe,symbolInstanceStart:we,symbolInstanceEnd:de}=ae;r.push({sortKey:fe,symbolInstanceStart:we,symbolInstanceEnd:de,parameters:ce})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ce})}attemptAnchorPlacement(r,l,f,g,v,b,T,D,C,P,O,F,N,U,V,$,G,Z){let{textOffset0:te,textOffset1:ee,crossTileID:re}=F,H=[te,ee],Y=Jd(r,f,g,H,v),ce=this.collisionIndex.placeCollisionBox(U,v,l,Wa(Y.x,Y.y,b,T,this.transform.angle),O,D,C,P.predicate);if($){let ae=U.getSymbolInstanceIconSize(Z,this.transform.zoom,F.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(U,ae,$,Wa(Y.x,Y.y,b,T,this.transform.angle),O,D,C,P.predicate).box.length===0)return}if(ce.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[re]&&this.prevPlacement.placements[re]&&this.prevPlacement.placements[re].text&&(ae=this.prevPlacement.variableOffsets[re].anchor),this.variableOffsets[re]={textOffset:H,width:f,height:g,anchor:r,textScale:v,prevAnchor:ae},this.markUsedJustification(U,r,F,V),U.allowVerticalPlacement&&(this.markUsedOrientation(U,V,F),this.placedOrientations[re]=V),{shift:Y,placedGlyphBoxes:ce}}}placeLayerBucketPart(r,l,f,g){let{bucket:v,layout:b,posMatrix:T,textLabelPlaneMatrix:D,labelToScreenMatrix:C,clippingData:P,textPixelRatio:O,holdingForFade:F,collisionBoxArray:N,partiallyEvaluatedTextSize:U,partiallyEvaluatedIconSize:V,collisionGroup:$}=r.parameters,G=b.get("text-optional"),Z=b.get("icon-optional"),te=b.get("text-allow-overlap"),ee=b.get("icon-allow-overlap"),re=b.get("text-rotation-alignment")==="map",H=b.get("text-pitch-alignment")==="map",Y=b.get("symbol-z-order")==="viewport-y",ce=b.get("symbol-z-elevate");this.transform.setProjection(v.projection);let ae=te&&(ee||!v.hasIconData()||Z),fe=ee&&(te||!v.hasTextData()||G);!v.collisionArrays&&N&&v.deserializeCollisionBoxes(N),f&&g&&v.updateCollisionDebugBuffers(this.transform.zoom,N);let we=(de,xe,Ee)=>{let{crossTileID:he,numVerticalGlyphVertices:ye}=de;if(P){let Un={zoom:this.transform.zoom,pitch:this.transform.pitch},Pn=null;if(P.dynamicFilterNeedsFeature){let Gt=this.retainedQueryData[v.bucketInstanceId];Pn=P.featureIndex.loadFeature({featureIndex:de.featureIndex,bucketIndex:Gt.bucketIndex,sourceLayerIndex:Gt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,P.dynamicFilter)(Un,Pn,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new i.P(de.tileAnchorX,de.tileAnchorY),this.transform.calculateDistanceTileData(P.unwrappedTileID)))return this.placements[he]=new Bu(!1,!1,!1,!0),void l.add(he)}if(l.has(he))return;if(F)return void(this.placements[he]=new Bu(!1,!1,!1));let ze=!1,me=!1,be=!0,Te=!1,ne=!1,Ae=null,rt={box:null,offscreen:null,occluded:null},ut={box:null,offscreen:null,occluded:null},yt=null,pt=null,wt=null,nn=0,Lt=0,cn=0;Ee.textFeatureIndex?nn=Ee.textFeatureIndex:de.useRuntimeCollisionCircles&&(nn=de.featureIndex),Ee.verticalTextFeatureIndex&&(Lt=Ee.verticalTextFeatureIndex);let rn=Un=>{Un.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;let Pn=this.transform.elevation;Un.elevation=de.zOffset+(Pn?Pn.getAtTileOffset(Un.tileID,Un.tileAnchorX,Un.tileAnchorY):0)},er=Ee.textBox;if(er){rn(er);let Un=Gt=>{let qt=i.b9.horizontal;if(v.allowVerticalPlacement&&!Gt&&this.prevPlacement){let Zn=this.prevPlacement.placedOrientations[he];Zn&&(this.placedOrientations[he]=Zn,qt=Zn,this.markUsedOrientation(v,qt,de))}return qt},Pn=(Gt,qt)=>{if(v.allowVerticalPlacement&&ye>0&&Ee.verticalTextBox){for(let Zn of v.writingModes)if(Zn===i.b9.vertical?(rt=qt(),ut=rt):rt=Gt(),rt&&rt.box&&rt.box.length)break}else rt=Gt()};if(b.get("text-variable-anchor")){let Gt=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[he]){let $n=this.prevPlacement.variableOffsets[he];Gt.indexOf($n.anchor)>0&&(Gt=Gt.filter(Kt=>Kt!==$n.anchor),Gt.unshift($n.anchor))}let qt=($n,Kt,Bt)=>{let vi=v.getSymbolInstanceTextSize(U,de,this.transform.zoom,xe),Yr=($n.x2-$n.x1)*vi+2*$n.padding,Or=($n.y2-$n.y1)*vi+2*$n.padding,Xr=de.hasIconTextFit&&!ee?Kt:null;Xr&&rn(Xr);let xi={box:[],offscreen:!1,occluded:!1},oi=te?2*Gt.length:Gt.length;for(let Lr=0;Lr<oi;++Lr){let Ur=this.attemptAnchorPlacement(Gt[Lr%Gt.length],$n,Yr,Or,vi,re,H,O,T,$,Lr>=Gt.length,de,xe,v,Bt,Xr,U,V);if(Ur&&(xi=Ur.placedGlyphBoxes,xi&&xi.box&&xi.box.length)){ze=!0,Ae=Ur.shift;break}}return xi};Pn(()=>qt(er,Ee.iconBox,i.b9.horizontal),()=>{let $n=Ee.verticalTextBox;return $n&&rn($n),v.allowVerticalPlacement&&!(rt&&rt.box&&rt.box.length)&&ye>0&&$n?qt($n,Ee.verticalIconBox,i.b9.vertical):{box:null,offscreen:null,occluded:null}}),rt&&(ze=rt.box,be=rt.offscreen,Te=rt.occluded);let Zn=Un(!(!rt||!rt.box));if(!ze&&this.prevPlacement){let $n=this.prevPlacement.variableOffsets[he];$n&&(this.variableOffsets[he]=$n,this.markUsedJustification(v,$n.anchor,de,Zn))}}else{let Gt=(qt,Zn)=>{let $n=v.getSymbolInstanceTextSize(U,de,this.transform.zoom,xe),Kt=this.collisionIndex.placeCollisionBox(v,$n,qt,new i.P(0,0),te,O,T,$.predicate);return Kt&&Kt.box&&Kt.box.length&&(this.markUsedOrientation(v,Zn,de),this.placedOrientations[he]=Zn),Kt};Pn(()=>Gt(er,i.b9.horizontal),()=>{let qt=Ee.verticalTextBox;return v.allowVerticalPlacement&&ye>0&&qt?(rn(qt),Gt(qt,i.b9.vertical)):{box:null,offscreen:null,occluded:null}}),Un(!!(rt&&rt.box&&rt.box.length))}}if(yt=rt,ze=yt&&yt.box&&yt.box.length>0,be=yt&&yt.offscreen,Te=yt&&yt.occluded,de.useRuntimeCollisionCircles){let Un=v.text.placedSymbolArray.get(de.centerJustifiedTextSymbolIndex>=0?de.centerJustifiedTextSymbolIndex:de.verticalPlacedTextSymbolIndex),Pn=i.ba(v.textSizeData,U,Un),Gt=b.get("text-padding");pt=this.collisionIndex.placeCollisionCircles(v,te,Un,v.lineVertexArray,v.glyphOffsetArray,Pn,T,D,C,f,H,$.predicate,de.collisionCircleDiameter*Pn/i.bf,Gt,this.retainedQueryData[v.bucketInstanceId].tileID),ze=te||pt.circles.length>0&&!pt.collisionDetected,be=be&&pt.offscreen,Te=pt.occluded}if(Ee.iconFeatureIndex&&(cn=Ee.iconFeatureIndex),Ee.iconBox){let Un=Pn=>{rn(Pn);let Gt=de.hasIconTextFit&&Ae?Wa(Ae.x,Ae.y,re,H,this.transform.angle):new i.P(0,0),qt=v.getSymbolInstanceIconSize(V,this.transform.zoom,de.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,qt,Pn,Gt,ee,O,T,$.predicate)};ut&&ut.box&&ut.box.length&&Ee.verticalIconBox?(wt=Un(Ee.verticalIconBox),me=wt.box.length>0):(wt=Un(Ee.iconBox),me=wt.box.length>0),be=be&&wt.offscreen,ne=wt.occluded}let Cn=G||de.numHorizontalGlyphVertices===0&&ye===0,Sr=Z||de.numIconVertices===0;if(Cn||Sr?Sr?Cn||(me=me&&ze):ze=me&&ze:me=ze=me&&ze,ze&&yt&&yt.box&&this.collisionIndex.insertCollisionBox(yt.box,b.get("text-ignore-placement"),v.bucketInstanceId,ut&&ut.box&&Lt?Lt:nn,$.ID),me&&wt&&this.collisionIndex.insertCollisionBox(wt.box,b.get("icon-ignore-placement"),v.bucketInstanceId,cn,$.ID),pt&&(ze&&this.collisionIndex.insertCollisionCircles(pt.circles,b.get("text-ignore-placement"),v.bucketInstanceId,nn,$.ID),f)){let Un=v.bucketInstanceId,Pn=this.collisionCircleArrays[Un];Pn===void 0&&(Pn=this.collisionCircleArrays[Un]=new tg);for(let Gt=0;Gt<pt.circles.length;Gt+=4)Pn.circles.push(pt.circles[Gt+0]),Pn.circles.push(pt.circles[Gt+1]),Pn.circles.push(pt.circles[Gt+2]),Pn.circles.push(pt.collisionDetected?1:0)}let xr=v.projection.name!=="globe";ae=ae&&(xr||!Te),fe=fe&&(xr||!ne),this.placements[he]=new Bu(ze||ae,me||fe,be||v.justReloaded),l.add(he)};if(ce&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,this.retainedQueryData[v.bucketInstanceId].tileID),v.updateZOffset()),Y){let de=v.getSortedSymbolIndexes(this.transform.angle);for(let xe=de.length-1;xe>=0;--xe){let Ee=de[xe];we(v.symbolInstances.get(Ee),Ee,v.collisionArrays[Ee])}v.hasAnyZOffset&&i.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){let de=v.getSortedIndexesByZOffset();for(let xe=0;xe<de.length;++xe){let Ee=de[xe];we(v.symbolInstances.get(Ee),Ee,v.collisionArrays[Ee])}}else for(let de=r.symbolInstanceStart;de<r.symbolInstanceEnd;de++)we(v.symbolInstances.get(de),de,v.collisionArrays[de]);if(f&&v.bucketInstanceId in this.collisionCircleArrays){let de=this.collisionCircleArrays[v.bucketInstanceId];i.a9.invert(de.invProjMatrix,T),de.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(r,l,f,g){let{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:D,crossTileID:C}=f,P=i.bg(l),O=g===i.b9.vertical?D:P==="left"?v:P==="center"?b:P==="right"?T:-1;v>=0&&(r.text.placedSymbolArray.get(v).crossTileID=O>=0&&v!==O?0:C),b>=0&&(r.text.placedSymbolArray.get(b).crossTileID=O>=0&&b!==O?0:C),T>=0&&(r.text.placedSymbolArray.get(T).crossTileID=O>=0&&T!==O?0:C),D>=0&&(r.text.placedSymbolArray.get(D).crossTileID=O>=0&&D!==O?0:C)}markUsedOrientation(r,l,f){let g=l===i.b9.horizontal||l===i.b9.horizontalOnly?l:0,v=l===i.b9.vertical?l:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:C}=f,P=r.text.placedSymbolArray;b>=0&&(P.get(b).placedOrientation=g),T>=0&&(P.get(T).placedOrientation=g),D>=0&&(P.get(D).placedOrientation=g),C>=0&&(P.get(C).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;let l=this.prevPlacement,f=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;let g=l?l.symbolFadeChange(r):1,v=l?l.opacities:{},b=l?l.variableOffsets:{},T=l?l.placedOrientations:{};for(let D in this.placements){let C=this.placements[D],P=v[D];P?(this.opacities[D]=new qa(P,g,C.text,C.icon,null,C.clipped),f=f||C.text!==P.text.placed||C.icon!==P.icon.placed):(this.opacities[D]=new qa(null,g,C.text,C.icon,C.skipFade,C.clipped),f=f||C.text||C.icon)}for(let D in v){let C=v[D];if(!this.opacities[D]){let P=new qa(C,g,!1,!1);P.isHidden()||(this.opacities[D]=P,f=f||C.text.placed||C.icon.placed)}}for(let D in b)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=b[D]);for(let D in T)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=T[D]);f?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){let f=new Set;for(let g of l){let v=g.getBucket(r);v&&g.latestFeatureIndex&&r.fqid===v.layerIds[0]&&(this.updateBucketOpacities(v,f,g.collisionBoxArray),v.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,g.tileID),v.updateZOffset()))}}updateBucketOpacities(r,l,f){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();let g=r.layers[0].layout,v=!!r.layers[0].dynamicFilter(),b=new qa(null,0,!1,!1,!0),T=g.get("text-allow-overlap"),D=g.get("icon-allow-overlap"),C=g.get("text-variable-anchor"),P=g.get("text-rotation-alignment")==="map",O=g.get("text-pitch-alignment")==="map",F=new qa(null,0,T&&(D||!r.hasIconData()||g.get("icon-optional")),D&&(T||!r.hasTextData()||g.get("text-optional")),!0);!r.collisionArrays&&f&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(f);let N=(V,$,G)=>{for(let Z=0;Z<$/4;Z++)V.opacityVertexArray.emplaceBack(G)},U=0;for(let V=0;V<r.symbolInstances.length;V++){let $=r.symbolInstances.get(V),{numHorizontalGlyphVertices:G,numVerticalGlyphVertices:Z,crossTileID:te,numIconVertices:ee}=$,re=l.has(te),H=this.opacities[te];re?H=b:H||(H=F,this.opacities[te]=H),l.add(te);let Y=G>0||Z>0,ce=ee>0,ae=this.placedOrientations[te],fe=ae===i.b9.vertical,we=ae===i.b9.horizontal||ae===i.b9.horizontalOnly;if(!Y&&!ce||H.isHidden()||U++,Y){let de=Uu(H.text);N(r.text,G,fe?Qa:de),N(r.text,Z,we?Qa:de);let xe=H.text.isHidden(),{leftJustifiedTextSymbolIndex:Ee,centerJustifiedTextSymbolIndex:he,rightJustifiedTextSymbolIndex:ye,verticalPlacedTextSymbolIndex:ze}=$,me=r.text.placedSymbolArray,be=xe||fe?1:0;Ee>=0&&(me.get(Ee).hidden=be),he>=0&&(me.get(he).hidden=be),ye>=0&&(me.get(ye).hidden=be),ze>=0&&(me.get(ze).hidden=xe||we?1:0);let Te=this.variableOffsets[te];Te&&this.markUsedJustification(r,Te.anchor,$,ae);let ne=this.placedOrientations[te];ne&&(this.markUsedJustification(r,"left",$,ne),this.markUsedOrientation(r,ne,$))}if(ce){let de=Uu(H.icon),{placedIconSymbolIndex:xe,verticalPlacedIconSymbolIndex:Ee}=$,he=r.icon.placedSymbolArray,ye=H.icon.isHidden()?1:0;xe>=0&&(N(r.icon,ee,fe?Qa:de),he.get(xe).hidden=ye),Ee>=0&&(N(r.icon,$.numVerticalIconVertices,we?Qa:de),he.get(Ee).hidden=ye)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){let de=r.collisionArrays[V];if(de){let xe=new i.P(0,0),Ee=!0;if(de.textBox||de.verticalTextBox){if(C){let ye=this.variableOffsets[te];ye?(xe=Jd(ye.anchor,ye.width,ye.height,ye.textOffset,ye.textScale),P&&xe._rotate(O?this.transform.angle:-this.transform.angle)):Ee=!1}v&&(Ee=!H.clipped),de.textBox&&ia(r.textCollisionBox.collisionVertexArray,H.text.placed,!Ee||fe,xe.x,xe.y),de.verticalTextBox&&ia(r.textCollisionBox.collisionVertexArray,H.text.placed,!Ee||we,xe.x,xe.y)}let he=Ee&&!!(!we&&de.verticalIconBox);de.iconBox&&ia(r.iconCollisionBox.collisionVertexArray,H.icon.placed,he,$.hasIconTextFit?xe.x:0,$.hasIconTextFit?xe.y:0),de.verticalIconBox&&ia(r.iconCollisionBox.collisionVertexArray,H.icon.placed,!he,$.hasIconTextFit?xe.x:0,$.hasIconTextFit?xe.y:0)}}}if(r.fullyClipped=U===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){let V=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=V.invProjMatrix,r.placementViewportMatrix=V.viewportMatrix,r.collisionCircleArray=V.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){let f=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*f>r}setStale(){this.stale=!0}}function ia(h,r,l,f,g){h.emplaceBack(r?1:0,l?1:0,f||0,g||0),h.emplaceBack(r?1:0,l?1:0,f||0,g||0),h.emplaceBack(r?1:0,l?1:0,f||0,g||0),h.emplaceBack(r?1:0,l?1:0,f||0,g||0)}let ac=Math.pow(2,25),Za=Math.pow(2,24),tf=Math.pow(2,17),ng=Math.pow(2,16),rg=Math.pow(2,9),ig=Math.pow(2,8),Vu=Math.pow(2,1);function Uu(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;let r=h.placed?1:0,l=Math.floor(127*h.opacity);return l*ac+r*Za+l*tf+r*ng+l*rg+r*ig+l*Vu+r}let Qa=0;class lc{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,l,f,g,v){let b=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(b,g,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((T,D)=>T.sortKey-D.sortKey));this._currentPartIndex<b.length;){let T=b[this._currentPartIndex];if(l.placeLayerBucketPart(T,this._seenCrossTileIDs,f,T.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class cc{constructor(r,l,f,g,v,b,T,D,C){this.placement=new ef(r,v,b,T,D,C),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(r,l,f,g){let v=i.f.now(),b=()=>{let T=i.f.now()-v;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){let T=l[r[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=D)&&(!T.maxzoom||T.maxzoom>D)){let C=T,P=C.layout.get("symbol-z-elevate"),O=this._inProgressLayer=this._inProgressLayer||new lc(C),F=i.aj(T.source,T.scope);if(O.continuePlacement(P?g[F]:f[F],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}let nf=512/i.Y/2;class og{constructor(r,l,f){this.tileID=r,this.bucketInstanceId=f,this.index=new i.bj(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let g=r.canonical.x*i.Y,v=r.canonical.y*i.Y;for(let b=0;b<l.length;b++){let{key:T,crossTileID:D,tileAnchorX:C,tileAnchorY:P}=l.get(b),O=Math.floor((g+C)*nf),F=Math.floor((v+P)*nf);this.index.add(O,F),this.keys.push(T),this.crossTileIDs.push(D)}this.index.finish()}findMatches(r,l,f){let g=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),v=nf/Math.pow(2,l.canonical.z-this.tileID.canonical.z),b=l.canonical.x*i.Y,T=l.canonical.y*i.Y;for(let D=0;D<r.length;D++){let C=r.get(D);if(C.crossTileID)continue;let{key:P,tileAnchorX:O,tileAnchorY:F}=C,N=Math.floor((b+O)*v),U=Math.floor((T+F)*v),V=this.index.range(N-g,U-g,N+g,U+g);for(let $ of V){let G=this.crossTileIDs[$];if(this.keys[$]===P&&!f.has(G)){f.add(G),C.crossTileID=G;break}}}}}class $u{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class uc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){let l=Math.round((r-this.lng)/360);if(l!==0)for(let f in this.indexes){let g=this.indexes[f],v={};for(let b in g){let T=g[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+l),v[T.tileID.key]=T}this.indexes[f]=v}this.lng=r}addBucket(r,l,f){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);let g=this.usedCrossTileIDs[r.overscaledZ];for(let v in this.indexes){let b=this.indexes[v];if(Number(v)>r.overscaledZ)for(let T in b){let D=b[T];D.tileID.isChildOf(r)&&D.findMatches(l.symbolInstances,r,g)}else{let T=b[r.scaledTo(Number(v)).key];T&&T.findMatches(l.symbolInstances,r,g)}}for(let v=0;v<l.symbolInstances.length;v++){let b=l.symbolInstances.get(v);b.crossTileID||(b.crossTileID=f.generate(),g.add(b.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new og(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(let f of l.crossTileIDs)this.usedCrossTileIDs[r].delete(f)}removeStaleBuckets(r){let l=!1;for(let f in this.indexes){let g=this.indexes[f];for(let v in g)r[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[v]),delete g[v],l=!0)}return l}}class rf{constructor(){this.layerIndexes={},this.crossTileIDs=new $u,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,f,g){let v=this.layerIndexes[r.fqid];v===void 0&&(v=this.layerIndexes[r.fqid]=new uc);let b=!1,T={};g.name!=="globe"&&v.handleWrapJump(f);for(let D of l){let C=D.getBucket(r);C&&r.fqid===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(D.tileID,C,this.crossTileIDs)&&(b=!0),T[C.bucketInstanceId]=!0)}return v.removeStaleBuckets(T)&&(b=!0),b}pruneUnusedLayers(r){let l={};r.forEach(f=>{l[f]=!0});for(let f in this.layerIndexes)l[f]||delete this.layerIndexes[f]}}class hc{constructor(r=0,l=0,f=0,g=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=f,this.right=g}interpolate(r,l,f){return l.top!=null&&r.top!=null&&(this.top=i.X(r.top,l.top,f)),l.bottom!=null&&r.bottom!=null&&(this.bottom=i.X(r.bottom,l.bottom,f)),l.left!=null&&r.left!=null&&(this.left=i.X(r.left,l.left,f)),l.right!=null&&r.right!=null&&(this.right=i.X(r.right,l.right,f)),this}getCenter(r,l){let f=i.ad((this.left+r-this.right)/2,0,r),g=i.ad((this.top+l-this.bottom)/2,0,l);return new i.P(f,g)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new hc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Gu(h,r){let l=i.bn(h,3);i.a9.fromQuat(h,r),i.bp(h,3,l)}function of(h,r){let l=i.bl.identity([]);return i.bl.rotateZ(l,l,-r),i.bl.rotateX(l,l,-h),l}function po(h,r){let l=[h[0],h[1],0],f=[r[0],r[1],0];if(i.Q.length(l)>=1e-15){let b=i.Q.normalize([],l);i.Q.scale(f,b,i.Q.dot(f,b)),r[0]=f[0],r[1]=f[1]}let g=i.Q.cross([],r,h);if(i.Q.len(g)<1e-15)return null;let v=Math.atan2(-g[1],g[0]);return of(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),v)}class Ya{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){let l=r instanceof i.O?r:new i.O(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=i.bk(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;let f=this.position,g=this._elevation?this._elevation.getAtPointOrZero(i.O.fromLngLat(r)):0,v=i.O.fromLngLat(r,g),b=[v.x-f.x,v.y-f.y,v.z-f.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=po(b,l)}setPitchBearing(r,l){this.orientation=of(i.bm(r),i.bm(-l))}}class dc{constructor(r,l){this._transform=i.a9.identity([]),this.orientation=l,this.position=r}get mercatorPosition(){let r=this.position;return new i.O(r[0],r[1],r[2])}get position(){let r=i.bn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&i.bp(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||i.bl.identity([]),r&&Gu(this._transform,this._orientation)}getPitchBearing(){let r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=of(r,l),Gu(this._transform,this._orientation)}forward(){let r=i.bn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){let r=i.bn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){let r=i.bn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){let f=new Float64Array(16);return i.a9.invert(f,this.getWorldToCamera(r,l)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,l,f){let g=this.position;i.Q.scale(g,g,-r);let v=new Float64Array(16);return i.a9.fromScaling(v,[f,f,f]),i.a9.translate(v,v,g),v[10]*=l,v}getWorldToCamera(r,l){let f=new Float64Array(16),g=new Float64Array(4),v=this.position;return i.bl.conjugate(g,this._orientation),i.Q.scale(v,v,-r),i.a9.fromQuat(f,g),i.a9.translate(f,f,v),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=l,f[9]*=l,f[10]*=l,f[11]*=l,f}getCameraToClipPerspective(r,l,f,g){let v=new Float64Array(16);return i.a9.perspective(v,r,l,f,g),v}getCameraToClipOrthographic(r,l,f,g,v,b){let T=new Float64Array(16);return i.a9.ortho(T,r,l,f,g,v,b),T}getDistanceToElevation(r,l=!1){let f=r===0?0:i.bo(r,l?i.ax(this.position[1]):this.position[1]),g=this.forward();return(f-this.position[2])/g[2]}clone(){return new dc([...this.position],[...this.orientation])}}let sf=(h,r,l)=>(1-l)*h+l*r,Xa=h=>h*h*h*h*h;class Hu{constructor(r,l,f,g,v,b,T){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=f??0,this._maxPitch=g??60,this.setProjection(b),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new i.bq(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new hc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new dc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let r=new Hu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,l=!1){let f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(r||f)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return i.af(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};let l=this.projection?this.getProjection():void 0;this.projection=i.br(this.projectionOptions);let f=!M(l,this.getProjection());return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){let r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.br({name:"mercator"});let l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){let r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.bo(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bk(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){let l=-r*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=i.b7.create(),i.b7.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){let l=i.ad(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=i.bm(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){let l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){let r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let f=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop(),g=0,v=0;for(let b=0;b<l.length;b++){let T=new i.P(l[b][0]*this.width,f+l[b][1]*(this.height-f)),D=r.pointCoordinate(T);if(!D)continue;let C=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);g+=D[3]*C,v+=C}return v===0?NaN:g/v}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*l,g=this._mercatorZfromZoom(r),v=this._mercatorZfromZoom(this._maxZoom),b=Math.max(g-f,v);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){let l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude())),f;f=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];let g=i.Q.length(i.Q.sub([],this._camera.position,f));return i.ad(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!i.bl.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){let f=[r.position.x,r.position.y,r.position.z];i.Q.exactEquals(f,this._camera.position)||(this._setCameraPosition(f),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let r=this._camera.position,l=new Ya;return l.position=new i.O(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!i.bl.length(r))return!1;i.bl.normalize(r,r);let l=i.Q.transformQuat([],[0,0,-1],r),f=i.Q.transformQuat([],[0,-1,0],r);if(f[2]<0)return!1;let g=po(l,f);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(r){let l=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;r[2]=i.ad(r[2],g/f,g/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,f){this._unmodified=!1,this._edgeInsets.interpolate(r,l,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){let l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){let l=[new i.bs(0,r)];if(this.renderWorldCopies){let f=this.pointCoordinate(new i.P(0,0)),g=this.pointCoordinate(new i.P(this.width,0)),v=this.pointCoordinate(new i.P(this.width,this.height)),b=this.pointCoordinate(new i.P(0,this.height)),T=Math.floor(Math.min(f.x,g.x,v.x,b.x)),D=Math.floor(Math.max(f.x,g.x,v.x,b.x)),C=1;for(let P=T-C;P<=D+C;P++)P!==0&&l.push(new i.bs(P,r))}return l}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(r,l,f){let g=[];if(l[0]===0&&l[1]===0)return g;for(let b of r){let T=b.canonical,D=b.overscaledZ,C=b.wrap,P=1<<T.z,O=T.x+1<P,F=T.x>0,N=T.y+1<P,U=T.y>0,V=b.wrap-(F?0:1),$=b.wrap+(O?0:1),G=F?T.x-1:P-1,Z=O?T.x+1:0;l[0]<0?(g.push(new i.ap(D,$,T.z,Z,T.y)),l[1]<0&&N&&(g.push(new i.ap(D,C,T.z,T.x,T.y+1)),g.push(new i.ap(D,$,T.z,Z,T.y+1))),l[1]>0&&U&&(g.push(new i.ap(D,C,T.z,T.x,T.y-1)),g.push(new i.ap(D,$,T.z,Z,T.y-1)))):l[0]>0?(g.push(new i.ap(D,V,T.z,G,T.y)),l[1]<0&&N&&(g.push(new i.ap(D,C,T.z,T.x,T.y+1)),g.push(new i.ap(D,V,T.z,G,T.y+1))),l[1]>0&&U&&(g.push(new i.ap(D,C,T.z,T.x,T.y-1)),g.push(new i.ap(D,V,T.z,G,T.y-1)))):l[1]<0&&N?g.push(new i.ap(D,C,T.z,T.x,T.y+1)):U&&g.push(new i.ap(D,C,T.z,T.x,T.y-1))}if(g.length>1){g.sort((D,C)=>D.overscaledZ-C.overscaledZ||D.wrap-C.wrap||D.canonical.z-C.canonical.z||D.canonical.x-C.canonical.x||D.canonical.y-C.canonical.y);let b=0,T=0;for(;T<g.length;)g[T].equals(g[b])?++T:g[++b]=g[T++];g.length=b+1}let v=[];for(let b of g)g.some(T=>b.isChildOf(T))||v.push(b);return g=v.filter(b=>!r.some(T=>!!(b.overscaledZ<f&&T.isChildOf(b))||b.equals(T)||b.isChildOf(T))),g}coveringTiles(r){let l=this.coveringZoomLevel(r),f=l,g=this.elevation&&this.elevation.exaggeration(),v=g&&!r.isTerrainDEM,b=this.projection.name==="mercator";if(r.minzoom!==void 0&&l<r.minzoom)return[];r.maxzoom!==void 0&&l>r.maxzoom&&(l=r.maxzoom);let T=this.locationCoordinate(this.center),D=this.center.lat,C=1<<l,P=[C*T.x,C*T.y,0],O=this.projection.name==="globe",F=!O,N=i.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,F),U=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=C*i.bo(1,this.center.lat),$=this._camera.position[2]/i.bo(1,this.center.lat),G=[C*U.x,C*U.y,$*(F?1:V)],Z=O||g,te=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ee=this.isLODDisabled(!0)?l:0,re;if(this._elevation&&r.isTerrainDEM)re=1e4*this._elevation.exaggeration();else if(this._elevation){let me=this._elevation.getMinMaxForVisibleTiles();re=me?me.max:this._centerAltitude}else re=this._centerAltitude;let H=r.isTerrainDEM?-re:this._elevation?this._elevation.getMinElevationBelowMSL():0,Y=this.projection.isReprojectedInTileSpace?i.bu(this):1,ce=me=>{let Te=new i.O(me.x+25e-6,me.y,me.z),ne=new i.O(me.x,me.y+25e-6,me.z),Ae=me.toLngLat(),rt=Te.toLngLat(),ut=ne.toLngLat(),yt=this.locationCoordinate(Ae),pt=this.locationCoordinate(rt),wt=this.locationCoordinate(ut),nn=Math.hypot(pt.x-yt.x,pt.y-yt.y),Lt=Math.hypot(wt.x-yt.x,wt.y-yt.y);return Math.sqrt(nn*Lt)*Y/25e-6},ae=me=>{let be=re,Te=H;return{aabb:i.bx(this,C,0,0,0,me,Te,be,this.projection),zoom:0,x:0,y:0,minZ:Te,maxZ:be,wrap:me,fullyVisible:!1}},fe=[],we=[],de=l,xe=r.reparseOverscaled?f:l,Ee=me=>me*me,he=Ee(($-this._centerAltitude)*V),ye=me=>{if(!this._elevation||!me.tileID||!b)return;let be=this._elevation.getMinMaxForTile(me.tileID),Te=me.aabb;be?(Te.min[2]=be.min,Te.max[2]=be.max,Te.center[2]=(Te.min[2]+Te.max[2])/2):(me.shouldSplit=ze(me),me.shouldSplit||(Te.min[2]=Te.max[2]=Te.center[2]=this._centerAltitude))},ze=me=>{if(me.zoom<ee)return!0;if(me.zoom===de)return!1;if(me.shouldSplit!=null)return me.shouldSplit;let be=me.aabb.distanceX(G),Te=me.aabb.distanceY(G),ne=he,Ae=1;if(O){ne=Ee(me.aabb.distanceZ(G));let yt=Math.pow(2,me.zoom),pt=i.ax((me.y+1)/yt),wt=i.ax(me.y/yt),nn=Math.min(Math.max(D,pt),wt),Lt=i.bM(nn)/i.bM(D);if(Ae=nn===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Lt/this._mercatorScaleRatio),this.zoom<=i.bJ&&me.zoom===de-1&&Lt>=.9)return!0}else if(v&&(ne=Ee(me.aabb.distanceZ(G)*V)),this.projection.isReprojectedInTileSpace&&f<=5){let yt=Math.pow(2,me.zoom),pt=ce(new i.O((me.x+.5)/yt,(me.y+.5)/yt));Ae=pt>.85?1:pt}let rt=be*be+Te*Te+ne,ut=Ee((1<<de-me.zoom)*te*Ae*((yt,pt)=>{if(pt*Ee(.707)<yt)return 1;let wt=Math.sqrt(pt/yt);return wt/(1.4144271570014144+(Math.pow(1.1,wt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ne,he),rt));return rt<ut};if(this.renderWorldCopies)for(let me=1;me<=3;me++)fe.push(ae(-me)),fe.push(ae(me));for(fe.push(ae(0));fe.length>0;){let me=fe.pop(),be=me.x,Te=me.y,ne=me.fullyVisible,Ae=()=>this.projection.name==="globe"&&(me.y===0||me.y===(1<<me.zoom)-1);if(!ne){let rt=Z?me.aabb.intersects(N):me.aabb.intersectsFlat(N);if(rt===0&&Ae()){let ut=new i.bv(me.zoom,be,Te);rt=i.bw(this,C,ut,!0).intersects(N)}if(rt===0)continue;ne=rt===2}if(me.zoom!==de&&ze(me))for(let rt=0;rt<4;rt++){let ut=(be<<1)+rt%2,yt=(Te<<1)+(rt>>1),pt={aabb:b?me.aabb.quadrant(rt):i.bx(this,C,me.zoom+1,ut,yt,me.wrap,me.minZ,me.maxZ,this.projection),zoom:me.zoom+1,x:ut,y:yt,wrap:me.wrap,fullyVisible:ne,tileID:void 0,shouldSplit:void 0,minZ:me.minZ,maxZ:me.maxZ};v&&!O&&(pt.tileID=new i.ap(me.zoom+1===de?xe:me.zoom+1,me.wrap,me.zoom+1,ut,yt),ye(pt)),fe.push(pt)}else{let rt=me.zoom===de?xe:me.zoom;if(r.minzoom&&r.minzoom>rt)continue;if(!ne){let wt=Z?me.aabb.intersectsPrecise(N):me.aabb.intersectsPreciseFlat(N);if(wt===0&&Ae()){let nn=new i.bv(me.zoom,be,Te);wt=i.bw(this,C,nn,!0).intersectsPrecise(N)}if(wt===0)continue}let ut=P[0]-(.5+be+(me.wrap<<me.zoom))*(1<<l-me.zoom),yt=P[1]-.5-Te,pt=me.tileID?me.tileID:new i.ap(rt,me.wrap,me.zoom,be,Te);we.push({tileID:pt,distanceSq:ut*ut+yt*yt})}}if(this.fogCullDistSq){let me=this.fogCullDistSq,be=this.horizonLineFromTop();we=we.filter(Te=>{let ne=[0,0,0,1],Ae=[i.Y,i.Y,0,1],rt=this.calculateFogTileMatrix(Te.tileID.toUnwrapped());i.aa.transformMat4(ne,ne,rt),i.aa.transformMat4(Ae,Ae,rt);let ut=i.aa.min([],ne,Ae),yt=i.aa.max([],ne,Ae),pt=i.by(ut,yt);if(pt===0)return!0;let wt=!1,nn=this._elevation;if(nn&&pt>me&&be!==0){let Lt=this.calculateProjMatrix(Te.tileID.toUnwrapped()),cn;r.isTerrainDEM||(cn=nn.getMinMaxForTile(Te.tileID)),cn||(cn={min:H,max:re});let rn=i.bK(this.rotation),er=[rn[0]*i.Y,rn[1]*i.Y,cn.max];i.Q.transformMat4(er,er,Lt),wt=(1-er[1])*this.height*.5<be}return pt<me||wt})}return we.sort((me,be)=>me.distanceSq-be.distanceSq).map(me=>me.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){let l=i.ad(r.lat,-i.bz,i.bz),f=this.projection.project(r.lng,l);return new i.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.bo(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,l){let f,g,v=this.centerPoint;if(this.projection.name==="globe"){let T=this.worldSize;f=(l.x-v.x)/T,g=(l.y-v.y)/T}else{let T=this.pointCoordinate(l),D=this.pointCoordinate(v);f=T.x-D.x,g=T.y-D.y}let b=this.locationCoordinate(r);this.setLocation(new i.O(b.x-f,b.y-g))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,l){let f=l?i.bo(l,r.lat):void 0,g=this.projection.project(r.lng,r.lat);return new i.O(g.x,g.y,f)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){let f=l??this._centerAltitude,g=[r.x,r.y,0,1],v=[r.x,r.y,1,1];i.aa.transformMat4(g,g,this.pixelMatrixInverse),i.aa.transformMat4(v,v,this.pixelMatrixInverse);let b=v[3];i.aa.scale(g,g,1/g[3]),i.aa.scale(v,v,1/b);let T=g[2],D=v[2];return{p0:g,p1:v,t:T===D?0:(f-T)/(D-T)}}screenPointToMercatorRay(r){let l=[r.x,r.y,0,1],f=[r.x,r.y,1,1];return i.aa.transformMat4(l,l,this.pixelMatrixInverse),i.aa.transformMat4(f,f,this.pixelMatrixInverse),i.aa.scale(l,l,1/l[3]),i.aa.scale(f,f,1/f[3]),l[2]=i.bo(l[2],this._center.lat)*this.worldSize,f[2]=i.bo(f[2],this._center.lat)*this.worldSize,i.aa.scale(l,l,1/this.worldSize),i.aa.scale(f,f,1/this.worldSize),new i.a5([l[0],l[1],l[2]],i.Q.normalize([],i.Q.sub([],f,l)))}rayIntersectionCoordinate(r){let{p0:l,p1:f,t:g}=r,v=i.bo(l[2],this._center.lat),b=i.bo(f[2],this._center.lat);return new i.O(i.X(l[0],f[0],g)/this.worldSize,i.X(l[1],f[1],g)/this.worldSize,i.X(v,b,g))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let l=this.projection.pointCoordinate3D(this,r.x,r.y);if(l)return new i.O(l[0],l[1],l[2]);let f=0,g=this.horizonLineFromTop();if(r.y>g)return this.pointCoordinate(r);let v=.02*g,b=r.clone();for(let T=0;T<10&&g-f>v;T++){b.y=i.X(f,g,.66);let D=this.projection.pointCoordinate3D(this,b.x,b.y);D?(g=b.y,l=D):f=b.y}return l?new i.O(l[0],l[1],l[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=i.bA)return!this.isPointAboveHorizon(r);let l=this.pointCoordinate(r);return l.y>=0&&l.y<=1}_coordinatePoint(r,l){let f=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,g=[r.x*this.worldSize,r.y*this.worldSize,f+r.toAltitude(),1];return i.aa.transformMat4(g,g,this.pixelMatrix),g[3]>0?new i.P(g[0]/g[3],g[1]/g[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:r,left:l}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,v=this.pointLocation3D(new i.P(l,r)),b=this.pointLocation3D(new i.P(g,r)),T=this.pointLocation3D(new i.P(g,f)),D=this.pointLocation3D(new i.P(l,f)),C=Math.min(v.lng,b.lng,T.lng,D.lng),P=Math.max(v.lng,b.lng,T.lng,D.lng),O=Math.min(v.lat,b.lat,T.lat,D.lat),F=Math.max(v.lat,b.lat,T.lat,D.lat),N=Math.pow(2,-this.zoom)/16*270,U=this.projection.name==="globe"?1:4,V=($,G,Z,te,ee)=>{let re=($+Z)/2,H=(G+te)/2,Y=new i.P(re,H),{lng:ce,lat:ae}=this.pointLocation3D(Y),fe=Math.max(0,C-ce,O-ae,ce-P,ae-F);C=Math.min(C,ce),P=Math.max(P,ce),O=Math.min(O,ae),F=Math.max(F,ae),(ee<U||fe>N)&&(V($,G,re,H,ee+1),V(re,H,Z,te,ee+1))};if(V(l,r,g,r,1),V(g,r,g,f,1),V(g,f,l,f,1),V(l,f,l,r,1),this.projection.name==="globe"){let[$,G]=i.bB(this);$?(F=90,P=180,C=-180):G&&(O=-90,P=180,C=-180)}return new i.ag(new i.bq(C,O),new i.bq(P,F))}_getBoundsRectangular(r,l){let{top:f,left:g}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,T=new i.P(g,f),D=new i.P(b,f),C=new i.P(b,v),P=new i.P(g,v),O=this.pointCoordinate(T,r),F=this.pointCoordinate(D,r),N=this.pointCoordinate(C,l),U=this.pointCoordinate(P,l),V=($,G)=>(G.y-$.y)/(G.x-$.x);return O.y>1&&F.y>=0?O=new i.O((1-U.y)/V(U,O)+U.x,1):O.y<0&&F.y<=1&&(O=new i.O(-U.y/V(U,O)+U.x,0)),F.y>1&&O.y>=0?F=new i.O((1-N.y)/V(N,F)+N.x,1):F.y<0&&O.y<=1&&(F=new i.O(-N.y/V(N,F)+N.x,0)),new i.ag().extend(this.coordinateLocation(O)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(N))}_getBoundsRectangularTerrain(){let r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);let l=r.visibleDemTiles.reduce((f,g)=>{if(g.dem){let v=g.dem.tree;f.min=Math.min(f.min,v.minimums[0]),f.max=Math.max(f.max,v.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){let l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-i.bz,this.maxLat=i.bz,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.a8(this.minLng)*this.tileSize,this.worldMaxX=i.a8(this.maxLng)*this.tileSize,this.worldMinY=i.ah(this.maxLat)*this.tileSize,this.worldMaxY=i.ah(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){let l=r.key,f=this._distanceTileDataCache;if(f[l])return f[l];let g=r.canonical,v=1/this.height,b=this.cameraWorldSize,T=b/this.zoomScale(g.z),D=(g.x+Math.pow(2,g.z)*r.wrap)*T,C=g.y*T,P=this.point;P.x*=b/this.worldSize,P.y*=b/this.worldSize;let O=this.angle,F=Math.sin(-O),N=-Math.cos(-O);return f[l]={bearing:[F,N],center:[(P.x-D)*v,(P.y-C)*v],scale:T/i.Y*v},f[l]}calculateFogTileMatrix(r){let l=r.key,f=this._fogTileMatrixCache;if(f[l])return f[l];let g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return i.a9.multiply(g,this.worldToFogMatrix,g),f[l]=new Float32Array(g),f[l]}calculateProjMatrix(r,l=!1,f=!1){let g=r.key,v;if(v=f?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,v[g])return v[g];let b=this.calculatePosMatrix(r,this.worldSize),T;return T=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,i.a9.multiply(b,T,b),v[g]=new Float32Array(b),v[g]}calculatePixelsToTileUnitsMatrix(r){let l=r.tileID.key,f=this._pixelsToTileUnitsCache;if(f[l])return f[l];let g=i.bC(r,this);return f[l]=g,f[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let r=1/this.worldSize,l=i.a9.fromScaling([],[r,r,r]);return i.a9.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let r=this._elevation;this._updateCameraState();let l=i.bo(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(l),g=this._camera.forward(),v=i.bo(1,this._center.lat);f[2]/=v,g[2]/=v,i.Q.normalize(g,g);let b=r.raycast(f,g,r.exaggeration());if(b){let T=i.Q.scaleAndAdd([],f,g,b),D=new i.O(T[0],T[1],i.bo(T[2],i.ax(T[1]))),C=(D.z+i.Q.length([D.x-f[0],D.y-f[1],D.z-f[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(C),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;let l=this._elevation,f=i.bo(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(f),v=l.getAtPointOrZero(new i.O(...g)),b=this.pixelsPerMeter/this.worldSize*v,T=this._minimumHeightOverTerrain(),D=g[2]-b;if(D<=T)if(D<0||r){let C=this.locationCoordinate(this._center,this._centerAltitude),P=[g[0],g[1],C.z-g[2]],O=i.Q.length(P);P[2]-=(T-D)/this._pixelsPerMercatorPixel;let F=i.Q.length(P);if(F===0)return;i.Q.scale(P,P,O/F*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],C.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){let F=this.center;return F.lat=i.ad(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(F.lng=i.ad(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}let l=this._unmodified,{x:f,y:g}=this.point,v=0,b=f,T=g,D=this.width/2,C=this.height/2,P=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(g-C<P&&(T=P+C),g+C>O&&(T=O-C),O-P<this.height&&(v=Math.max(v,this.height/(O-P)),T=(O+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let F=this.worldMinX*this.scale,N=this.worldMaxX*this.scale,U=this.worldSize/2-(F+N)/2;b=(f+U+this.worldSize)%this.worldSize-U,b-D<F&&(b=F+D),b+D>N&&(b=N-D),N-F<this.width&&(v=Math.max(v,this.width/(N-F)),b=(N+F)/2)}b===f&&T===g||(this.center=this.unproject(new i.P(b,T))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let r=this.centerOffset,l=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.bo(1,this.center.lat)/i.bo(1,i.bL));let g=i.bD(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let v=this.projection.zAxisUnit==="meters"?f:1,b=this._camera.getWorldToCamera(this.worldSize,v),T,D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-r.x/this.width,D[9]=2*r.y/this.height,this.isOrthographic){let ae=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),fe=ae*this.aspect,we=-fe,de=-ae;fe-=r.x,we-=r.x,ae+=r.y,de+=r.y,T=this._camera.getCameraToClipOrthographic(we,fe,de,ae,this._nearZ,this._farZ),((xe,Ee,he,ye)=>{for(let ze=0;ze<16;ze++)xe[ze]=sf(Ee[ze],he[ze],ye)})(T,T,D,Xa(this.pitch>=15?1:this.pitch/15))}else T=D;let C=i.a9.mul([],D,b),P=i.a9.mul([],T,b);if(this.projection.isReprojectedInTileSpace){let ae=this.locationCoordinate(this.center),fe=i.a9.identity([]);i.a9.translate(fe,fe,[ae.x*this.worldSize,ae.y*this.worldSize,0]),i.a9.multiply(fe,fe,i.bE(this)),i.a9.translate(fe,fe,[-ae.x*this.worldSize,-ae.y*this.worldSize,0]),i.a9.multiply(P,P,fe),i.a9.multiply(C,C,fe),this.inverseAdjustmentMatrix=i.bF(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.a9.scale([],P,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=P,this.invProjMatrix=i.a9.invert(new Float64Array(16),this.projMatrix),l){let ae=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ae[8]=2*-r.x/this.width,ae[9]=2*r.y/this.height,this.expandedFarZProjMatrix=i.a9.mul([],ae,b)}else this.expandedFarZProjMatrix=this.projMatrix;let O=i.a9.invert([],T);this.frustumCorners=i.bG.fromInvProjectionMatrix(O,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);let F=new Float32Array(16);i.a9.identity(F),i.a9.scale(F,F,[1,-1,1]),i.a9.rotateX(F,F,this._pitch),i.a9.rotateZ(F,F,this.angle);let N=i.a9.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.a9.clone(N);let U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-r.x/this.width,N[9]=2*(r.y+U)/this.height,this.skyboxMatrix=i.a9.multiply(F,N,F);let V=this.point,$=V.x,G=V.y,Z=this.width%2/2,te=this.height%2/2,ee=Math.cos(this.angle),re=Math.sin(this.angle),H=$-Math.round($)+ee*Z+re*te,Y=G-Math.round(G)+ee*te+re*Z,ce=new Float64Array(P);if(i.a9.translate(ce,ce,[H>.5?H-1:H,Y>.5?Y-1:Y,0]),this.alignedProjMatrix=ce,P=i.a9.create(),i.a9.scale(P,P,[this.width/2,-this.height/2,1]),i.a9.translate(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=i.a9.create(),i.a9.scale(P,P,[1,-1,1]),i.a9.translate(P,P,[-1,-1,0]),i.a9.scale(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=i.a9.multiply(new Float64Array(16),this.labelPlaneMatrix,C),this._calcFogMatrices(),this._distanceTileDataCache={},P=i.a9.invert(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.bH(this);let ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.Q.transformMat4(ae,ae,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let r=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,f=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,v=[r,r,l];i.Q.scale(v,v,g),i.Q.scale(f,f,-1),i.Q.multiply(f,f,v);let b=i.a9.create();i.a9.translate(b,b,f),i.a9.scale(b,b,v),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,g)}_computeCameraPosition(r){let l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),g=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-f[0]*v,g.y/this.worldSize-f[1]*v,r/this.worldSize*this._centerAltitude-f[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){let l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],g=r[2],v=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(v=Math.min((l-f)/g,1)),this._camera.position=i.Q.scaleAndAdd([],this._camera.position,r,v),this._updateStateFromCamera()}_updateStateFromCamera(){let r=this._camera.position,l=this._camera.forward(),{pitch:f,bearing:g}=this._camera.getPitchBearing(),v=i.bo(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.bm(this._maxPitch)),T=Math.max((r[2]-v)/Math.cos(f),b),D=this._zoomFromMercatorZ(T);i.Q.scaleAndAdd(r,r,l,T),this._pitch=i.ad(f,i.bm(this.minPitch),i.bm(this.maxPitch)),this.angle=i.bk(g,-Math.PI,Math.PI),this._setZoom(i.ad(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.O(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){let r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let l=0,f=i.bA,g=0,v=1/0;for(;f-l>1e-6&&f>l;){let b=l+.5*(f-l),T=this.tileSize*Math.pow(2,b),D=this.getCameraToCenterDistance(this.projection,b,T),C=this.scaleZoom(D/(r*this.tileSize)),P=Math.abs(b-C);P<v&&(v=P,g=b),b<C?l=b:f=b}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){let f=Math.min(r.x,l.x),g=Math.max(r.x,l.x),v=Math.min(r.y,l.y),b=Math.max(r.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let T=[new i.P(f,v),new i.P(g,b),new i.P(f,b),new i.P(g,v)],D=this.renderWorldCopies?-3:0,C=this.renderWorldCopies?4:1;for(let P of T){let O=this.pointRayIntersection(P);if(O.t<0)return!0;let F=this.rayIntersectionCoordinate(O);if(F.x<D||F.y<0||F.x>C||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.bI(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(r,l){let f=i.Q.length(i.Q.sub([],this._camera.position,r)),g=this._zoomFromMercatorZ(f)+l;return f-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){let r=function([l,f,g],v){let b=[l,f,g,1];i.aa.transformMat4(b,b,v);let T=b[3]=Math.max(b[3],1e-6);return b[0]/=T,b[1]/=T,b[2]/=T,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(r[0],r[1])}{let r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,r))}}getCameraToCenterDistance(r,l=this.zoom,f=this.worldSize){let g=i.bD(r,l,this.width,this.height,1024),v=r.pixelSpaceConversion(this.center.lat,f,g),b=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(b=sf(1,b,Xa(this.pitch>=15?1:this.pitch/15))),b}getWorldToCameraMatrix(){let r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.a9.multiply(r,r,this.globeMatrix),r}getFrustum(r){return i.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}let Di={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},Ds=(h,r)=>{if(r>0&&h.terrain&&i.w("Cutoff is currently disabled on terrain"),r<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let l=h.transform,f=Math.max(Math.abs(l._zoom-(h.minCutoffZoom-1)),1),g=l.isLODDisabled(!1)?i.S(60,45,l.pitch):i.S(30,15,l.pitch),v=l._farZ-l._nearZ,b=r*l.height,T=((1-(D=g))*l.cameraToCenterDistance+D*(l._farZ+b))*f;var D;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(T-l._nearZ)/v,(T-b-l._nearZ)/v]}}},Mi={cascadeCount:2,shadowMapResolution:2048};class sg{constructor(r,l){this.aabb=r,this.lastCascade=l}}class ov{add(r,l){let f=this.receivers[r.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],l.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],l.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],l.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],l.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],l.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],l.max[2])):this.receivers[r.key]=new sg(l,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,l,f){let g=i.bV.fromPoints(r.points),v=0;for(let b in this.receivers){let T=this.receivers[b];if(!T||!g.intersectsAabb(T.aabb))continue;T.aabb.min=g.closestPoint(T.aabb.min),T.aabb.max=g.closestPoint(T.aabb.max);let D=T.aabb.getCorners();for(let C=0;C<f.length;C++){let P=!0;for(let O of D){let F=[O[0]*l,O[1]*l,O[2]];if(i.Q.transformMat4(F,F,f[C].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){P=!1;break}}if(T.lastCascade=C,v=Math.max(v,C),P)break}}return v+1}}class ag{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ov,this._depthMode=new Tt(r.context.gl.LEQUAL,Tt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(Mi,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(Mi,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,l){let f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;let g=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||g<=0||(this._shadowLayerCount=f.style.order.reduce((U,V)=>{let $=f.style._mergedLayers[V];return U+($.hasShadowPass()&&!$.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let v=f.context,b=Mi.shadowMapResolution,T=Mi.shadowMapResolution;if(this._cascades.length===0||Mi.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let U=0;U<Mi.cascadeCount;++U){let V=f._shadowMapDebug,$=v.gl,G=v.createFramebuffer(b,T,V,"texture"),Z=new i.T(v,{width:b,height:T,data:null},$.DEPTH_COMPONENT);if(G.depthAttachment.set(Z.texture),V){let te=new i.T(v,{width:b,height:T,data:null},$.RGBA);G.colorAttachment.set(te.texture)}this._cascades.push({framebuffer:G,texture:Z,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.bt,scale:0})}}this.shadowDirection=Wu(l);let D=0;if(r.elevation){let U=r.elevation,V=[1e4,-1e4];U.visibleDemTiles.filter($=>$.dem).forEach($=>{let G=$.dem.tree;V[0]=Math.min(V[0],G.minimums[0]),V[1]=Math.max(V[1],G.maximums[0])}),V[0]!==1e4&&(D=(V[1]-V[0])*U.exaggeration())}let C=1.5*r.cameraToCenterDistance,P=3*C,O=new Float64Array(16);for(let U=0;U<this._cascades.length;++U){let V=this._cascades[U],$=r.height/50,G=1;Mi.cascadeCount===1?G=P:U===0?G=C:($=C,G=P);let[Z,te]=Zu(r,this.shadowDirection,$,G,Mi.shadowMapResolution,D);V.scale=r.scale,V.matrix=Z,V.boundingSphereRadius=te,i.a9.invert(O,V.matrix),V.frustum=i.bt.fromInvProjectionMatrix(O,1,0,!0),V.far=G}let F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Mi.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Mi.shadowMapResolution,this._uniformValues.u_shadowmap_0=Di.ShadowMap0,this._uniformValues.u_shadowmap_1=Di.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let N=f.transform.elevation;for(let U of this._groundShadowTiles){let V={min:0,max:0};if(N){let $=N.getMinMaxForTile(U);$&&(V=$)}this.addShadowReceiver(U.toUnwrapped(),V.min,V.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,l){if(!this.enabled)return;let f=this.painter,g=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),g.viewport.set([0,0,Mi.shadowMapResolution,Mi.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){f.currentShadowCascade=v,g.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),g.clear({color:i.aA.white,depth:1});for(let b of r.order){let T=r._mergedLayers[b];if(!T.hasShadowPass()||T.isHidden(f.transform.zoom))continue;let D=r.getLayerSourceCache(T),C=D?l[D.id]:void 0;(T.type==="model"||C&&C.length)&&f.renderLayer(f,D,T,C)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let r=this.painter,l=r.style,f=r.context,g=l.directionalLight,v=l.ambientLight;if(!g||!v)return;let b=[],T=Ds(r,r.longestCutoffRange);T.shouldRenderCutoff&&b.push("RENDER_CUTOFF");let D=af(g,v),C=new Tt(f.gl.LEQUAL,Tt.ReadOnly,r.depthRangeFor3D);for(let P of this._groundShadowTiles){let O=P.toUnwrapped(),F=r.isTileAffectedByFog(P),N=r.getOrCreateProgram("groundShadow",{defines:b,overrideFog:F});this.setupShadows(O,N),r.uploadCommonUniforms(f,N,O,null,T);let U={u_matrix:r.transform.calculateProjMatrix(O),u_ground_shadow_factor:D};N.draw(r,f.gl.TRIANGLES,C,Ft.disabled,Qt.multiply,At.disabled,U,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,{},r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Qt.unblended:Qt.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){let l=this.painter.transform,f=l.calculatePosMatrix(r,l.worldSize);return i.a9.multiply(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(r){return i.a9.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,l,f,g=0){if(!this.enabled)return;let v=this.painter.transform,b=this.painter.context,T=b.gl,D=this._uniformValues,C=new Float64Array(16),P=v.calculatePosMatrix(r,v.worldSize);for(let O=0;O<this._cascades.length;O++)i.a9.multiply(C,this._cascades[O].matrix,P),D[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),b.activeTexture.set(T.TEXTURE0+Di.ShadowMap0+O),this._cascades[O].texture.bind(T.NEAREST,T.CLAMP_TO_EDGE);if(this.useNormalOffset=!!f,this.useNormalOffset){let O=i.bU(r.canonical),F=2/v.tileSize*i.Y/Mi.shadowMapResolution,N=F*this._cascades[0].boundingSphereRadius,U=F*this._cascades[this._cascades.length-1].boundingSphereRadius,V=(f==="vector-tile"?1:3)/Math.pow(2,g-r.canonical.z-(1-v.zoom+Math.floor(v.zoom)));D.u_shadow_normal_offset=[O,N*V,U*V],D.u_shadow_bias=[6e-5,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(b,D)}setupShadowsFromMatrix(r,l,f=!1){if(!this.enabled)return;let g=this.painter.context,v=g.gl,b=this._uniformValues,T=new Float64Array(16);for(let D=0;D<Mi.cascadeCount;D++)i.a9.multiply(T,this._cascades[D].matrix,r),b[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),g.activeTexture.set(v.TEXTURE0+Di.ShadowMap0+D),this._cascades[D].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);this.useNormalOffset=f,f?(b.u_shadow_normal_offset=[1,5,5],b.u_shadow_bias=[6e-5,.0012,.012]):b.u_shadow_bias=[36e-5,.0012,.012],l.setShadowUniformValues(g,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,l,f,g){if(g[2]>=0)return{};let v=function(D,C,P){let O=P/(1<<D.canonical.z);return new i.bV([D.canonical.x*O+D.wrap*P,D.canonical.y*O+D.wrap*P,0],[(D.canonical.x+1)*O+D.wrap*P,(D.canonical.y+1)*O+D.wrap*P,C])}(r,l,f).getCorners(),b=l/-g[2];g[0]<0?(i.Q.add(v[0],v[0],[g[0]*b,0,0]),i.Q.add(v[3],v[3],[g[0]*b,0,0])):g[0]>0&&(i.Q.add(v[1],v[1],[g[0]*b,0,0]),i.Q.add(v[2],v[2],[g[0]*b,0,0])),g[1]<0?(i.Q.add(v[0],v[0],[0,g[1]*b,0]),i.Q.add(v[1],v[1],[0,g[1]*b,0])):g[1]>0&&(i.Q.add(v[2],v[2],[0,g[1]*b,0]),i.Q.add(v[3],v[3],[0,g[1]*b,0]));let T={};return T.vertices=v,T.planes=[qu(v[1],v[0],v[4]),qu(v[2],v[1],v[5]),qu(v[3],v[2],v[6]),qu(v[0],v[3],v[7])],T}addShadowReceiver(r,l,f){this._receivers.add(r,i.bV.fromTileIdAndHeight(r,l,f))}getMaxCascadeForTile(r){let l=this._receivers.get(r);return l&&l.lastCascade?l.lastCascade:0}}function qu(h,r,l){let f=i.Q.sub([],l,r),g=i.Q.sub([],h,r),v=i.Q.cross([],f,g),b=i.Q.length(v);return b===0?[0,0,1,0]:(i.Q.scale(v,v,1/b),[v[0],v[1],v[2],-i.Q.dot(v,r)])}function Wu(h){let r=h.properties.get("direction"),l=i.bT(r.x,r.y,r.z);l[2]=i.ad(l[2],0,75);let f=i.bW([l[0],l[1],l[2]]);return i.Q.fromValues(f.x,f.y,f.z)}function af(h,r){let l=h.properties.get("color"),f=h.properties.get("intensity"),g=h.properties.get("direction"),v=[g.x,g.y,g.z],b=r.properties.get("color"),T=r.properties.get("intensity"),D=Math.max(i.Q.dot([0,0,1],v),0),C=[0,0,0];i.Q.scale(C,b.toArray01Linear().slice(0,3),T);let P=[0,0,0];return i.Q.scale(P,l.toArray01Linear().slice(0,3),D*f),i.bX([C[0]>0?C[0]/(C[0]+P[0]):0,C[1]>0?C[1]/(C[1]+P[1]):0,C[2]>0?C[2]/(C[2]+P[2]):0])}function Zu(h,r,l,f,g,v){let b=h.zoom,T=h.scale,D=h.worldSize,C=1/D,P=h.aspect,O=Math.sqrt(1+P*P)*Math.tan(.5*h.fovX),F=O*O,N=f-l,U=f+l,V,$;F>N/U?(V=f,$=f*O):(V=.5*U*(1+F),$=.5*Math.sqrt(N*N+2*(f*f+l*l)*F+U*U*F*F));let G=h.projection.pixelsPerMeter(h.center.lat,D),Z=h._camera.getCameraToWorldMercator(),te=[0,0,-V*C];i.Q.transformMat4(te,te,Z);let ee=$*C,re=h._edgeInsets;if(!(re.left===0&&re.top===0&&re.right===0&&re.bottom===0||re.left===re.right&&re.top===re.bottom)){let ne=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?G:1),Ae=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,l,f);Ae[8]=2*-h.centerOffset.x/h.width,Ae[9]=2*h.centerOffset.y/h.height;let rt=new Float64Array(16);i.a9.mul(rt,Ae,ne);let ut=new Float64Array(16);i.a9.invert(ut,rt);let yt=i.bt.fromInvProjectionMatrix(ut,D,b,!0);for(let pt of yt.points){let wt=((H=pt)[0]/=T,H[1]/=T,H[2]=i.bo(H[2],h._center.lat),H);ee=Math.max(ee,i.Q.len(i.Q.subtract([],te,wt)))}}var H;ee*=g/(g-1);let Y=Math.acos(r[2]),ce=Math.atan2(-r[0],-r[1]),ae=new dc;ae.position=te,ae.setPitchBearing(Y,ce);let fe=ae.getWorldToCamera(D,G),we=ee*D,de=Math.min(h._mercatorZfromZoom(17)*D*-2,-2*we),xe=ae.getCameraToClipOrthographic(-we,we,-we,we,de,(we+v*G)/r[2]),Ee=new Float64Array(16);i.a9.multiply(Ee,xe,fe);let he=i.Q.fromValues(Math.floor(1e6*te[0])/1e6*D,Math.floor(1e6*te[1])/1e6*D,0),ye=.5*g,ze=[0,0,0];i.Q.transformMat4(ze,he,Ee),i.Q.scale(ze,ze,ye);let me=[Math.floor(ze[0]),Math.floor(ze[1]),Math.floor(ze[2])],be=[0,0,0];i.Q.sub(be,ze,me),i.Q.scale(be,be,-1/ye);let Te=new Float64Array(16);return i.a9.identity(Te),i.a9.translate(Te,Te,be),i.a9.multiply(Ee,Te,Ee),[Ee,we]}let Oo=(h,r)=>ct(h,r&&r.filter(l=>l.identifier!=="source.canvas")),lg=i.af(yn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),sv=i.af(yn,["setCenter","setZoom","setBearing","setPitch"]),lf={version:8,layers:[],sources:{}},cf={duration:300,delay:0};class mo extends i.E{constructor(r,l={}){super(),this.map=r,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=i.e({},cf),this._buildingIndex=new Wd(this),this.crossTileSymbolIndex=new rf,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new wn,this.dispatcher=l.dispatcher?l.dispatcher:new i.bZ(i.b_(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new Xl,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new i.b$(r._requestManager,l.localFontFamily?i.c0.all:l.localIdeographFontFamily?i.c0.ideographs:i.c0.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new Ao(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",i.c1());let f=this;this._rtlTextPluginCallback=mo.registerForPluginStateChange(g=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(v,b)=>{if(i.c2(v),b&&b.every(T=>T))for(let T in f._sourceCaches){let D=f._sourceCaches[T],C=D.getSource().type;C!=="vector"&&C!=="geojson"||D.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;let v=this.getOwnSource(g.sourceId);if(v&&v.vectorLayerIds)for(let b in this._layers){let T=this._layers[b];T.source===v.id&&this._validateLayer(T)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(i.c3(r))return r;let l=i.c4(r);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${i.c5(JSON.stringify(r))}`}_diffStyle(r,l,f){this.globalId=this._getGlobalId(r);let g=(v,b)=>{try{b(null,this.setState(v,f))}catch(T){b(T,!1)}};if(typeof r=="string"){let v=this.map._requestManager.normalizeStyleURL(r),b=this.map._requestManager.transformRequest(v,i.R.Style);i.g(b,(T,D)=>{T?this.fire(new i.a(T)):D&&g(D,l)})}else typeof r=="object"&&g(r,l)}loadURL(r,l={}){this.fire(new i.b("dataloading",{dataType:"style"}));let f=typeof l.validate=="boolean"?l.validate:!i.c3(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,l.accessToken),this.resolvedImports.add(r);let g=this.importsCache.get(r);if(g)return this._load(g,f);let v=this.map._requestManager.transformRequest(r,i.R.Style);this._request=i.g(v,(b,T)=>{if(this._request=null,b)this.fire(new i.a(b));else if(T)return this.importsCache.set(r,T),this._load(T,f)})}loadJSON(r,l={}){this.fire(new i.b("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=i.f.frame(()=>{this._request=null,this._load(r,l.validate!==!1)})}loadEmpty(){this.fire(new i.b("dataloading",{dataType:"style"})),this._load(lf,!1)}_loadImports(r,l,f){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let g=[];for(let v of r){let b=this._createFragmentStyle(v),T=new Promise(P=>{b.once("style.import.load",P),b.once("error",P)}).then(()=>this.mergeAll());if(g.push(T),this.resolvedImports.has(v.url)){b.loadEmpty();continue}let D=v.data||this.importsCache.get(v.url);D?(b.loadJSON(D,{validate:l}),this._isInternalStyle(D)&&(b.globalId=null)):v.url?b.loadURL(v.url,{validate:l}):b.loadEmpty();let C={style:b,id:v.id,config:v.config};if(f){let P=this.fragments.findIndex(({id:O})=>O===f);this.fragments=this.fragments.slice(0,P).concat(C).concat(this.fragments.slice(P))}else this.fragments.push(C)}return Promise.allSettled(g)}getImportGlobalIds(r=this,l=new Set){for(let f of r.fragments)f.style.globalId&&l.add(f.style.globalId),this.getImportGlobalIds(f.style,l);return[...l.values()]}_createFragmentStyle(r){let l=this.scope?i.aj(r.id,this.scope):r.id,f,g=this._initialConfig&&this._initialConfig[l];(r.config||g)&&(f=i.e({},r.config,g));let v=new mo(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,l){let f=r.schema;if(this._isInternalStyle(r)){let T=i.e({},lf,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(T,l)}if(this.updateConfig(this._config,f),l&&Oo(this,Mt(r)))return;this._loaded=!0,this.stylesheet=i.c6(r);for(let T in r.sources)this.addSource(T,r.sources[T],{validate:!1,isInitialLoad:!0});r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(r.glyphs,this.scope);let g=Km(this.stylesheet.layers);if(this._order=g.map(T=>T.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let T=this.stylesheet.lights[0];this.light=new vt(T.properties,T.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new vt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let T of g){let D=i.c7(T,this.scope,this.options);D.isConfigDependent&&this._configDependentLayers.add(D.fqid),D.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D,this._serializedLayers[D.id]=D.serialize();let C=this.getOwnLayerSourceCache(D),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&D.canCastShadows()&&P&&(C.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let v=this.stylesheet.terrain;v&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(v,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.b("data",{dataType:"style"}));let b=this.isRootStyle();r.imports?this._loadImports(r.imports,l).then(()=>{this._reloadImports(),this.fire(new i.b(b?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.b(b?"style.load":"style.import.load")))}isRootStyle(){return this.importDepth===0}mergeAll(){let r,l,f,g,v,b,T,D;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(C=>{if(C.stylesheet){if(C.light!=null&&(r=C.light),C.stylesheet.lights)for(let P of C.stylesheet.lights)P.type==="ambient"&&C.ambientLight!=null&&(l=C.ambientLight),P.type==="directional"&&C.directionalLight!=null&&(f=C.directionalLight);g=this._prioritizeTerrain(g,C.terrain,C.stylesheet.terrain),C.stylesheet.fog&&C.fog!=null&&(v=C.fog),C.stylesheet.camera!=null&&(D=C.stylesheet.camera),C.stylesheet.projection!=null&&(b=C.stylesheet.projection),C.stylesheet.transition!=null&&(T=C.stylesheet.transition)}}),this.light=r,this.ambientLight=l,this.directionalLight=f,this.fog=v,g===null?delete this.terrain:this.terrain=g,this.camera=D||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=i.e({},cf,T),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){let l=f=>{for(let g of f.fragments)l(g.style);r(f)};l(this)}_prioritizeTerrain(r,l,f){let g=r&&r.drapeRenderMode===0;return f===null?l&&l.drapeRenderMode===0?l:g?r:null:l!=null&&(!r||g||l&&l.drapeRenderMode===1)?l:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{r=this._prioritizeTerrain(r,l.terrain,l.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(r=l.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){let r={},l={},f={};this.forEachFragmentStyle(g=>{for(let v in g._sourceCaches){let b=i.aj(v,g.scope);r[b]=g._sourceCaches[v]}for(let v in g._otherSourceCaches){let b=i.aj(v,g.scope);l[b]=g._otherSourceCaches[v]}for(let v in g._symbolSourceCaches){let b=i.aj(v,g.scope);f[b]=g._symbolSourceCaches[v]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=f}mergeLayers(){let r={},l=[],f={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(let b of v._order){let T=v._layers[b];if(T.type==="slot"){let D=i.c8(b);if(r[D])continue;r[D]=[]}T.slot&&r[T.slot]?r[T.slot].push(T):l.push(T)}}),this._mergedOrder=[];let g=(v=[])=>{for(let b of v)if(b.type==="slot"){let T=i.c8(b.id);r[T]&&g(r[T])}else{let T=i.aj(b.id,b.scope);this._mergedOrder.push(T),f[T]=b,b.is3D()&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0)}};g(l),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=i.e({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(l,f,g){let v,b,T,D=i.f.devicePixelRatio>1?"@2x":"",C=i.g(f.transformRequest(f.normalizeSpriteURL(l,D,".json"),i.R.SpriteJSON),(F,N)=>{C=null,T||(T=F,v=N,O())}),P=i.d(f.transformRequest(f.normalizeSpriteURL(l,D,".png"),i.R.SpriteImage),(F,N)=>{P=null,T||(T=F,b=N,O())});function O(){if(T)g(T);else if(v&&b){let F=i.f.getImageData(b),N={};for(let U in v){let{width:V,height:$,x:G,y:Z,sdf:te,pixelRatio:ee,stretchX:re,stretchY:H,content:Y}=v[U],ce=new i.h({width:V,height:$});i.h.copy(F,ce,{x:G,y:Z},{x:0,y:0},{width:V,height:$}),N[U]={data:ce,pixelRatio:ee,sdf:te,stretchX:re,stretchY:H,content:Y}}g(null,N)}}return{cancel(){C&&(C.cancel(),C=null),P&&(P.cancel(),P=null)}}}(r,this.map._requestManager,(l,f)=>{if(this._spriteRequest=null,l)this.fire(new i.a(l));else if(f)for(let g in f)this.imageManager.addImage(g,this.scope,f[g]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.b("data",{dataType:"style"}))})}_validateLayer(r){let l=this.getOwnSource(r.source);if(!l)return;let f=r.sourceLayer;f&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(f)===-1)&&this.fire(new i.a(new Error(`Source layer "${f}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,l)=>{let f=this.fragments[l];return f&&f.style&&(r.data=f.style.serialize()),r})}_serializeSources(){let r={};for(let l in this._sourceCaches){let f=this._sourceCaches[l].getSource();r[f.id]||(r[f.id]=f.serialize())}return r}_serializeLayers(r){let l=[];for(let f of r){let g=this._layers[f];g&&g.type!=="custom"&&l.push(g.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(let r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){let l=this.getOwnLayer(r);if(l)return l;this.fire(new i.a(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){let l=this.getOwnSource(r);if(l)return l;this.fire(new i.a(new Error(`The source '${r}' does not exist in the map's style.`)))}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);let l=this.calculateLightsBrightness();r.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l));let f=this._changes.isDirty();if(this._changes.isDirty()){let v=this._changes.getLayerUpdatesByScope();for(let b in v){let{updatedIds:T,removedIds:D}=v[b];(T||D)&&this._updateWorkerLayers(b,T,D)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._changes.reset()}let g={};for(let v in this._mergedSourceCaches){let b=this._mergedSourceCaches[v];g[v]=b.used,b.used=!1,b.tileCoverLift=0}for(let v of this._mergedOrder){let b=this._mergedLayers[v];if(b.recalculate(r,this._availableImages),!b.isHidden(r.zoom)){let T=this.getLayerSourceCache(b);T&&(T.used=!0,T.tileCoverLift=Math.max(T.tileCoverLift,b.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let T=b.minzoom||0;T<(b.maxzoom||25.5);T++){let D=this.map.painter;if(D){let C=b.getProgramIds();if(!C)continue;for(let P of C){let O=b.getDefaultProgramParams(P,r.zoom);O&&(D.style=this,this.fog&&(D._fogVisible=!0,O.overrideFog=!0,D.getOrCreateProgram(P,O)),D._fogVisible=!1,O.overrideFog=!1,D.getOrCreateProgram(P,O),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(O.overrideRtt=!0,D.getOrCreateProgram(P,O)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let v in g){let b=this._mergedSourceCaches[v];g[v]!==b.used&&b.getSource().fire(new i.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new i.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){let r=this._changes.getUpdatedImages();if(r.length){for(let l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changes.resetUpdatedImages()}}_updateWorkerLayers(r,l,f){let g=this.getFragmentStyle(r);g&&this.dispatcher.broadcast("updateLayers",{layers:l?g._serializeLayers(l):[],scope:r,removedIds:f||[],options:g.options})}setState(r,l){if(this._checkLoaded(),Oo(this,Mt(r)))return!1;(r=i.c6(r)).layers=Km(r.layers);let f=function(b,T){if(!b)return[{command:yn.setStyle,args:[T]}];let D=[];try{if(!M(b.version,T.version))return[{command:yn.setStyle,args:[T]}];M(b.center,T.center)||D.push({command:yn.setCenter,args:[T.center]}),M(b.zoom,T.zoom)||D.push({command:yn.setZoom,args:[T.zoom]}),M(b.bearing,T.bearing)||D.push({command:yn.setBearing,args:[T.bearing]}),M(b.pitch,T.pitch)||D.push({command:yn.setPitch,args:[T.pitch]}),M(b.sprite,T.sprite)||D.push({command:yn.setSprite,args:[T.sprite]}),M(b.glyphs,T.glyphs)||D.push({command:yn.setGlyphs,args:[T.glyphs]}),M(b.imports,T.imports)||function(N=[],U=[],V){U=U||[];let $=(N=N||[]).map(Ga),G=U.map(Ga),Z=N.reduce(rc,{}),te=U.reduce(rc,{}),ee=$.slice(),re,H,Y,ce;for(re=0,H=0;re<$.length;re++)Y=$[re],te.hasOwnProperty(Y)?H++:(V.push({command:yn.removeImport,args:[Y]}),ee.splice(ee.indexOf(Y,H),1));for(re=0,H=0;re<G.length;re++)Y=G[G.length-1-re],ee[ee.length-1-re]!==Y&&(Z.hasOwnProperty(Y)?(V.push({command:yn.removeImport,args:[Y]}),ee.splice(ee.lastIndexOf(Y,ee.length-H),1)):H++,ce=ee[ee.length-re],V.push({command:yn.addImport,args:[te[Y],ce]}),ee.splice(ee.length-re,0,Y));for(let ae of U){let fe=Z[ae.id];fe&&!M(fe,ae)&&V.push({command:yn.updateImport,args:[ae.id,ae]})}}(b.imports,T.imports,D),M(b.transition,T.transition)||D.push({command:yn.setTransition,args:[T.transition]}),M(b.light,T.light)||D.push({command:yn.setLight,args:[T.light]}),M(b.fog,T.fog)||D.push({command:yn.setFog,args:[T.fog]}),M(b.projection,T.projection)||D.push({command:yn.setProjection,args:[T.projection]}),M(b.lights,T.lights)||D.push({command:yn.setLights,args:[T.lights]}),M(b.camera,T.camera)||D.push({command:yn.setCamera,args:[T.camera]});let C={},P=[];(function(N,U,V,$){let G;for(G in U=U||{},N=N||{})N.hasOwnProperty(G)&&(U.hasOwnProperty(G)||Zd(G,V,$));for(G in U){if(!U.hasOwnProperty(G))continue;let Z=U[G];N.hasOwnProperty(G)?M(N[G],Z)||(N[G].type==="geojson"&&Z.type==="geojson"&&Qd(N,U,G)?V.push({command:yn.setGeoJSONSourceData,args:[G,Z.data]}):Jm(G,U,V,$)):Pu(G,U,V)}})(b.sources,T.sources,P,C);let O=[];b.layers&&b.layers.forEach(N=>{N.source&&C[N.source]?D.push({command:yn.removeLayer,args:[N.id]}):O.push(N)});let F=b.terrain;F&&C[F.source]&&(D.push({command:yn.setTerrain,args:[void 0]}),F=void 0),D=D.concat(P),M(F,T.terrain)||D.push({command:yn.setTerrain,args:[T.terrain]}),function(N,U,V){U=U||[];let $=(N=N||[]).map(Ga),G=U.map(Ga),Z=N.reduce(rc,{}),te=U.reduce(rc,{}),ee=$.slice(),re=Object.create(null),H,Y,ce,ae,fe,we,de;for(H=0,Y=0;H<$.length;H++)ce=$[H],te.hasOwnProperty(ce)?Y++:(V.push({command:yn.removeLayer,args:[ce]}),ee.splice(ee.indexOf(ce,Y),1));for(H=0,Y=0;H<G.length;H++)ce=G[G.length-1-H],ee[ee.length-1-H]!==ce&&(Z.hasOwnProperty(ce)?(V.push({command:yn.removeLayer,args:[ce]}),ee.splice(ee.lastIndexOf(ce,ee.length-Y),1)):Y++,we=ee[ee.length-H],V.push({command:yn.addLayer,args:[te[ce],we]}),ee.splice(ee.length-H,0,ce),re[ce]=!0);for(H=0;H<G.length;H++)if(ce=G[H],ae=Z[ce],fe=te[ce],!re[ce]&&!M(ae,fe))if(M(ae.source,fe.source)&&M(ae["source-layer"],fe["source-layer"])&&M(ae.type,fe.type)){for(de in ta(ae.layout,fe.layout,V,ce,null,yn.setLayoutProperty),ta(ae.paint,fe.paint,V,ce,null,yn.setPaintProperty),M(ae.slot,fe.slot)||V.push({command:yn.setSlot,args:[ce,fe.slot]}),M(ae.filter,fe.filter)||V.push({command:yn.setFilter,args:[ce,fe.filter]}),M(ae.minzoom,fe.minzoom)&&M(ae.maxzoom,fe.maxzoom)||V.push({command:yn.setLayerZoomRange,args:[ce,fe.minzoom,fe.maxzoom]}),ae)ae.hasOwnProperty(de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&de!=="slot"&&(de.indexOf("paint.")===0?ta(ae[de],fe[de],V,ce,de.slice(6),yn.setPaintProperty):M(ae[de],fe[de])||V.push({command:yn.setLayerProperty,args:[ce,de,fe[de]]}));for(de in fe)fe.hasOwnProperty(de)&&!ae.hasOwnProperty(de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&de!=="slot"&&(de.indexOf("paint.")===0?ta(ae[de],fe[de],V,ce,de.slice(6),yn.setPaintProperty):M(ae[de],fe[de])||V.push({command:yn.setLayerProperty,args:[ce,de,fe[de]]}))}else V.push({command:yn.removeLayer,args:[ce]}),we=ee[ee.lastIndexOf(ce)+1],V.push({command:yn.addLayer,args:[fe,we]})}(O,T.layers,D)}catch(C){console.warn("Unable to compute style diff:",C),D=[{command:yn.setStyle,args:[T]}]}return D}(this.serialize(),r).filter(b=>!(b.command in sv));if(f.length===0)return!1;let g=f.filter(b=>!(b.command in lg));if(g.length>0)throw new Error(`Unimplemented: ${g.map(b=>b.command).join(", ")}.`);let v=[];return f.forEach(b=>{v.push(this[b.command].apply(this,b.args))}),l&&Promise.all(v).then(l),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(r,l){return this.getImage(r)?this.fire(new i.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,this.scope,l),this._afterImageUpdated(r),this)}updateImage(r,l){this.imageManager.updateImage(r,this.scope,l)}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._afterImageUpdated(r),this):this.fire(new i.a(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(r),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new i.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(r,l,f={}){return this._checkLoaded(),this._validate(mt,`models.${r}`,l,null,f)||(this.modelManager.addModel(r,l,this.scope),this._changes.setDirty()),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this):this.fire(new i.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,l,f={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(ec,`sources.${r}`,l,null,f))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);let g=Hd(r,l,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));let v=b=>{let T=(b?"symbol:":"other:")+g.id,D=i.aj(T,this.scope),C=this._sourceCaches[T]=new ho(D,g,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=C,C.onAdd(this.map)};v(!1),l.type!=="vector"&&l.type!=="geojson"||v(!0),g.onAdd&&g.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();let l=this.getOwnSource(r);if(!l)throw new Error("There is no source with this ID");for(let g in this._layers)if(this._layers[g].source===r)return this.fire(new i.a(new Error(`Source "${r}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new i.a(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));let f=this.getOwnSourceCaches(r);for(let g of f){let v=i.c8(g.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(g.id),g.fire(new i.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getOwnSource(r).setData(l),this._changes.setDirty()}getOwnSource(r){let l=this.getOwnSourceCache(r);return l&&l.getSource()}getOwnSources(){let r=[];for(let l in this._otherSourceCaches){let f=this.getOwnSourceCache(l);f&&r.push(f.getSource())}return r}areTilesLoaded(){let r=this._mergedSourceCaches;for(let l in r){let f=r[l]._tiles;for(let g in f){let v=f[g];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;let l=this._getTransitionParameters();for(let g of r){if(this._validate(He,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){let v=this.ambientLight;v.set(g),v.updateTransitions(l)}else this.ambientLight=new ii(g,lo,this.scope,this.options);break;case"directional":if(this.directionalLight){let v=this.directionalLight;v.set(g),v.updateTransitions(l)}else this.directionalLight=new ii(g,Dr,this.scope,this.options)}}let f=new i.N(this.z||0,l);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let r=this.directionalLight,l=this.ambientLight;if(!r||!l)return;let f=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),g=r.properties.get("color").toArray01(),v=r.properties.get("intensity"),b=r.properties.get("direction"),T=1-i.bT(b.x,b.y,b.z)[2]/90,D=f(g)*v*T,C=l.properties.get("color").toArray01(),P=l.properties.get("intensity");return(D+f(C)*P)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(!r)return this;if(i.c9(r)){let l=i.ca(r),f=this.fragments.find(({id:v})=>v===l);if(!f)throw new Error(`Style import not found: ${r}`);let g=i.c8(r);return f.style.getFragmentStyle(g)}{let l=this.fragments.find(({id:f})=>f===r);if(!l)throw new Error(`Style import not found: ${r}`);return l.style}}getConfigProperty(r,l){let f=this.getFragmentStyle(r);if(!f)return null;let g=i.aj(l,f.scope),v=f.options.get(g),b=v?v.value||v.default:null;return b?b.serialize():null}setConfigProperty(r,l,f){let g=this.getFragmentStyle(r);if(!g)return;let v=g.stylesheet.schema;if(!v||!v[l])return;let b=i.t(f);if(b.result!=="success")return void Oo(this,b.value);let T=b.value.expression,D=i.aj(l,g.scope),C=g.options.get(D);if(!C)return;let P,{minValue:O,maxValue:F,stepValue:N,type:U,values:V}=v[l],$=i.t(v[l].default);$.result==="success"&&(P=$.value.expression),P?(this.options.set(D,Fr(Ct({},C),{value:T,default:P,minValue:O,maxValue:F,stepValue:N,type:U,values:V})),this.updateConfigDependencies()):this.fire(new i.a(new Error(`No schema defined for the config option "${l}" in the "${r}" fragment.`)))}getConfig(r){let l=this.getFragmentStyle(r);if(!l)return null;let f=l.stylesheet.schema;if(!f)return null;let g={};for(let v in f){let b=i.aj(v,l.scope),T=l.options.get(b),D=T?T.value||T.default:null;g[v]=D?D.serialize():null}return g}setConfig(r,l){let f=this.getFragmentStyle(r);f&&(f.updateConfig(l,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){let l=this.getFragmentStyle(r);return l?l.stylesheet.schema:null}setSchema(r,l){let f=this.getFragmentStyle(r);f&&(f.stylesheet.schema=l,f.updateConfig(f._config,l),this.updateConfigDependencies())}updateConfig(r,l){if(this._config=r,r||l)if(l)for(let f in l){let g,v,b=i.t(l[f].default);if(b.result==="success"&&(g=b.value.expression),r&&r[f]!==void 0){let F=i.t(r[f]);F.result==="success"&&(v=F.value.expression)}let{minValue:T,maxValue:D,stepValue:C,type:P,values:O}=l[f];if(g){let F=i.aj(f,this.scope);this.options.set(F,{default:g,value:v,minValue:T,maxValue:D,stepValue:C,type:P,values:O})}else this.fire(new i.a(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new i.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let r of this._configDependentLayers){let l=this.getLayer(r);l&&(l.possiblyEvaluateVisibility(),this._updateLayer(l))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(r,l,f={}){this._checkLoaded();let g=r.id;if(this._layers[g])return void this.fire(new i.a(new Error(`Layer with id "${g}" already exists on this map`)));let v;if(r.type==="custom"){if(Oo(this,i.cb(r)))return;v=i.c7(r,this.scope,this.options)}else{if(typeof r.source=="object"&&(this.addSource(g,r.source),r=i.c6(r),r=i.e(r,{source:g})),this._validate(pe,`layers.${g}`,r,{arrayIndex:-1},f))return;v=i.c7(r,this.scope,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[v.id]=v.serialize()}v.isConfigDependent&&this._configDependentLayers.add(v.fqid);let b=this._order.length;if(l){let P=this._order.indexOf(l);if(P===-1)return void this.fire(new i.a(new Error(`Layer with id "${l}" does not exist on this map.`)));v.slot===this._layers[l].slot?b=P:i.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,g),this._layerOrderChanged=!0,this._layers[g]=v;let T=this.getOwnLayerSourceCache(v),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();T&&v.canCastShadows()&&D&&(T.castsShadows=!0);let C=this._changes.getRemovedLayer(v);if(C&&v.source&&T&&v.type!=="custom"){this._changes.discardLayerRemoval(v);let P=i.aj(v.source,v.scope);C.type!==v.type?this._changes.updateSourceCache(P,"clear"):(this._changes.updateSourceCache(P,"reload"),T.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(r,l){this._checkLoaded();let f=this._checkLayer(r);if(!f||r===l)return;let g=this._order.indexOf(r);this._order.splice(g,1);let v=this._order.length;if(l){let b=this._order.indexOf(l);if(b===-1)return void this.fire(new i.a(new Error(`Layer with id "${l}" does not exist on this map.`)));f.slot===this._layers[l].slot?v=b:i.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();let l=this._checkLayer(r);if(!l)return;l.setEventedParent(null);let f=this._order.indexOf(r);this._order.splice(f,1),delete this._layers[r],delete this._serializedLayers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);let g=this.getOwnLayerSourceCache(l);if(g&&g.castsShadows){let v=!1;for(let b in this._layers)if(this._layers[b].source===l.source&&this._layers[b].canCastShadows()){v=!0;break}g.castsShadows=v}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(let l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,f){this._checkLoaded();let g=this._checkLayer(r);g&&(g.minzoom===l&&g.maxzoom===f||(l!=null&&(g.minzoom=l),f!=null&&(g.maxzoom=f),this._updateLayer(g)))}setSlot(r,l){this._checkLoaded();let f=this._checkLayer(r);f&&f.slot!==l&&(f.slot=l,this._updateLayer(f))}setFilter(r,l,f={}){this._checkLoaded();let g=this._checkLayer(r);if(g&&!M(g.filter,l))return l==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(Ne,`layers.${g.id}.filter`,l,{layerType:g.type},f)||(g.filter=i.c6(l),this._updateLayer(g)))}getFilter(r){let l=this._checkLayer(r);if(l)return i.c6(l.filter)}setLayoutProperty(r,l,f,g={}){this._checkLoaded();let v=this._checkLayer(r);if(v&&!M(v.getLayoutProperty(l),f)){if(f!=null&&(!g||g.validate!==!1)&&Oo(v,qe.call(Mt,{key:`layers.${r}.layout.${l}`,layerType:v.type,objectKey:l,value:f,styleSpec:i.G,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(l,f),v.isConfigDependent&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(r,l){let f=this._checkLayer(r);if(f)return f.getLayoutProperty(l)}setPaintProperty(r,l,f,g={}){this._checkLoaded();let v=this._checkLayer(r);if(!v||M(v.getPaintProperty(l),f)||f!=null&&(!g||g.validate!==!1)&&Oo(v,je.call(Mt,{key:`layers.${r}.paint.${l}`,layerType:v.type,objectKey:l,value:f,styleSpec:i.G})))return;let b=v.setPaintProperty(l,f);v.isConfigDependent&&this._configDependentLayers.add(v.fqid),b&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(r,l){let f=this._checkLayer(r);if(f)return f.getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();let f=r.source,g=r.sourceLayer,v=this._checkSource(f);if(!v)return;let b=v.type;if(b==="geojson"&&g)return void this.fire(new i.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!g)return void this.fire(new i.a(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new i.a(new Error("The feature id parameter must be provided.")));let T=this.getOwnSourceCaches(f);for(let D of T)D.setFeatureState(g,r.id,l)}removeFeatureState(r,l){this._checkLoaded();let f=r.source,g=this._checkSource(f);if(!g)return;let v=g.type,b=v==="vector"?r.sourceLayer:void 0;if(v==="vector"&&!b)return void this.fire(new i.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new i.a(new Error("A feature id is required to remove its specific state property.")));let T=this.getOwnSourceCaches(f);for(let D of T)D.removeFeatureState(b,r.id,l)}getFeatureState(r){this._checkLoaded();let l=r.source,f=r.sourceLayer,g=this._checkSource(l);if(g){if(g.type!=="vector"||f)return r.id===void 0&&this.fire(new i.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(f,r.id);this.fire(new i.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=i.e({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return i.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();let r=this.getTerrain(),l=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return i.cc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateLayer(r){this._changes.updateLayer(r);let l=this.getLayerSourceCache(r),f=i.aj(r.source,r.scope),g=this._changes.getUpdatedSourceCaches();r.source&&!g[f]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),l.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){let l=T=>this._mergedLayers[T].type==="fill-extrusion"||this._mergedLayers[T].type==="model",f=this.order,g={},v=[];for(let T=f.length-1;T>=0;T--){let D=f[T];if(l(D)){g[D]=T;for(let C of r){let P=C[D];if(P)for(let O of P)v.push(O)}}}v.sort((T,D)=>D.intersectionZ-T.intersectionZ);let b=[];for(let T=f.length-1;T>=0;T--){let D=f[T];if(l(D))for(let C=v.length-1;C>=0;C--){let P=v[C].feature;if(g[P.layer.id]<T)break;b.push(P),v.pop()}else for(let C of r){let P=C[D];if(P)for(let O of P)b.push(O.feature)}}return b}queryRenderedFeatures(r,l,f){l&&l.filter&&this._validate(Ne,"queryRenderedFeatures.filter",l.filter,null,l),l.scope=this.scope,l.availableImages=this._availableImages,l.serializedLayers=this._serializedLayers;let g={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new i.a(new Error("parameters.layers must be an Array."))),[];for(let C of l.layers){let P=this._mergedLayers[C];if(!P)return this.fire(new i.a(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];g[P.source]=!0}}let v=[],b=l.serializedLayers||{},T=l&&l.layers?l.layers.some(C=>{let P=this.getLayer(C);return P&&P.is3D()}):this.has3DLayers(),D=cr.createFromScreenPoints(r,f);for(let C in this._mergedSourceCaches){let P=this._mergedSourceCaches[C].getSource();if(!P||P.scope!==l.scope)continue;let O=this._mergedSourceCaches[C].getSource().id;l.layers&&!g[O]||v.push(hn(this._mergedSourceCaches[C],this._mergedLayers,b,D,l,f,T,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(C,P,O,F,N,U,V){let $={},G=U.queryRenderedSymbols(F),Z=[];for(let te of Object.keys(G).map(Number))Z.push(V[te]);Z.sort(Ym);for(let te of Z){let ee=te.featureIndex.lookupSymbolFeatures(G[te.bucketInstanceId],P,te.bucketIndex,te.sourceLayerIndex,N.filter,N.layers,N.availableImages,C);for(let re in ee){let H=$[re]=$[re]||[],Y=ee[re];Y.sort((ce,ae)=>{let fe=te.featureSortOrder;if(fe){let we=fe.indexOf(ce.featureIndex);return fe.indexOf(ae.featureIndex)-we}return ae.featureIndex-ce.featureIndex});for(let ce of Y)H.push(ce)}}for(let te in $)$[te].forEach(ee=>{let re=ee.feature,H=O(C[te]);if(!H)return;let Y=H.getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=Y});return $}(this._mergedLayers,b,this.getLayerSourceCache.bind(this),D.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,l){l&&l.filter&&this._validate(Ne,"querySourceFeatures.filter",l.filter,null,l);let f=this.getOwnSourceCaches(r),g=[];for(let v of f)g=g.concat(yi(v,l));return g}addSourceType(r,l,f){return mo.getSourceType(r)?f(new Error(`A source type called "${r}" already exists.`)):(mo.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,l,f={}){this._checkLoaded();let g=this.light.getLight(),v=!1;for(let T in r)if(!M(r[T],g[T])){v=!0;break}if(!v)return;let b=this._getTransitionParameters();this.light.setLight(r,l,f),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,l=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()&&l!==0||delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let f=r,g=r.source==null;if(l===1){if(typeof f.source=="object"){let T="terrain-dem-src";this.addSource(T,f.source),f=i.c6(f),f=i.e(f,{source:T})}let v=i.e({},f),b={};if(this.terrain&&g){v.source=this.terrain.get().source;let T=this.terrain?this.getFragmentStyle(this.terrain.scope):null;T&&(b.style=T.serialize())}if(this._validate(K,"terrain",v,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&l!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,l),this.fire(new i.b("data",{dataType:"style"}))}else{let v=this.terrain,b=v.get();for(let T of Object.keys(i.G.terrain))!f.hasOwnProperty(T)&&i.G.terrain[T].default&&(f[T]=i.G.terrain[T].default);for(let T in r)if(!M(r[T],b[T])){v.set(r,this.options),this.stylesheet.terrain=r;let D=this._getTransitionParameters({duration:0});v.updateTransitions(D),this.fire(new i.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){let l=this.fog=new mi(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();let f=this._getTransitionParameters({duration:0});l.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let l=this.fog;if(!M(l.get(),r)){l.set(r,this.options),this.stylesheet.fog=l.get();let f=this._getTransitionParameters({duration:0});l.updateTransitions(f)}}else this._createFog(r);this._markersNeedUpdate=!0}_getTransitionParameters(r){return{now:i.f.now(),transition:i.e(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;let r=[],l=[];for(let f in this._mergedLayers)this.isLayerDraped(this._mergedLayers[f])?r.push(f):l.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){let f=this.terrain=new Bn(r,l,this.scope,this.options);l===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let g=this._getTransitionParameters({duration:0});f.updateTransitions(g)}_force3DLayerUpdate(){for(let r in this._layers){let l=this._layers[r];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(let r in this._layers){let l=this._layers[r];l.type==="symbol"&&this._updateLayer(l)}}_validate(r,l,f,g,v={}){if(v&&v.validate===!1)return!1;let b=i.e({},this.serialize());return Oo(this,r.call(Mt,i.e({key:l,style:b,value:f,styleSpec:i.G},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.cd.off("pluginStateChange",this._rtlTextPluginCallback);for(let r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(let r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(r){let l=this.getSourceCaches(r);for(let f of l)f.clearTiles()}clearSources(){for(let r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){let l=this.getSourceCaches(r);for(let f of l)f.resume(),f.reload()}reloadSources(){for(let r of this.getSources())r.reload&&r.reload()}updateSources(r){let l;this.directionalLight&&(l=Wu(this.directionalLight));for(let f in this._mergedSourceCaches)this._mergedSourceCaches[f].update(r,void 0,void 0,l)}_generateCollisionBoxes(){for(let r in this._sourceCaches){let l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,f,g,v=!1){let b=!1,T=!1,D={},C={};for(let P of this._mergedOrder){let O=this._mergedLayers[P];if(O.type!=="symbol")continue;let F=i.aj(O.source,O.scope),N=D[F];if(!N){let V=this.getLayerSourceCache(O);if(!V)continue;let $=V.getRenderableIds(!0).map(G=>V.getTileByID(G));C[F]=$.slice(),N=D[F]=$.sort((G,Z)=>Z.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(Z.tileID)?-1:1))}let U=this.crossTileSymbolIndex.addLayer(O,N,r.center.lng,r.projection);b=b||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),v=v||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new i.b("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.f.now(),r.zoom))&&(this.pauseablePlacement=new cc(r,this._mergedOrder,v,l,f,g,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,D,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.f.now()),T=!0),b&&this.pauseablePlacement.placement.setStale()),T||b){this._buildingIndex.onNewFrame(r.zoom);for(let P of this._mergedOrder){let O=this._mergedLayers[P];O.type==="symbol"&&this.placement.updateLayerOpacities(O,D[i.aj(O.source,O.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.f.now())}_releaseSymbolFadeTiles(){for(let r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,l){this._checkLoaded();let f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:v})=>v===r.id)!==-1)return void this.fire(new i.a(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!l)return f.push(r),this._loadImports([r],!0);let g=f.findIndex(({id:v})=>v===l);return g===-1&&this.fire(new i.a(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,g).concat(r).concat(f.slice(g)),this._loadImports([r],!0,l)}updateImport(r,l){this._checkLoaded();let f=this.stylesheet.imports||[],g=this.getImportIndex(r);return g===-1?this:typeof l=="string"?(this.setImportUrl(r,l),this):(l.url&&l.url!==f[g].url&&this.setImportUrl(r,l.url),M(l.config,f[g].config)||this.setImportConfig(r,l.config),M(l.data,f[g].data)||this.setImportData(r,l.data),this)}moveImport(r,l){this._checkLoaded();let f=this.stylesheet.imports||[],g=this.getImportIndex(r);if(g===-1)return this;let v=this.getImportIndex(l);if(v===-1)return this;let b=f[g],T=this.fragments[g];return f=f.filter(({id:D})=>D!==r),this.fragments=this.fragments.filter(({id:D})=>D!==r),this.stylesheet.imports=f.slice(0,v).concat(b).concat(f.slice(v)),this.fragments=this.fragments.slice(0,v).concat(T).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(r,l){this._checkLoaded();let f=this.stylesheet.imports||[],g=this.getImportIndex(r);if(g===-1)return this;f[g].url=l;let v=this.fragments[g];return v.style=this._createFragmentStyle(f[g]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(l),this}setImportData(r,l){this._checkLoaded();let f=this.getImportIndex(r),g=this.stylesheet.imports||[];return f===-1?this:l?(this.fragments[f].style.setState(l),this._reloadImports(),this):(delete g[f].data,this.setImportUrl(r,g[f].url))}setImportConfig(r,l){this._checkLoaded();let f=this.getImportIndex(r),g=this.stylesheet.imports||[];if(f===-1)return this;l?g[f].config=l:delete g[f].config;let v=this.fragments[f],b=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=l,v.style.updateConfig(l,b),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();let l=this.stylesheet.imports||[],f=this.getImportIndex(r);f!==-1&&(l.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(r){let l=(this.stylesheet.imports||[]).findIndex(f=>f.id===r);return l===-1&&this.fire(new i.a(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),l}getLayer(r){return this._mergedLayers[r]}getSources(){let r=[];for(let l in this._mergedOtherSourceCaches){let f=this._mergedOtherSourceCaches[l];f&&r.push(f.getSource())}return r}getSource(r,l){let f=this.getSourceCache(r,l);return f&&f.getSource()}getLayerSource(r){let l=this.getLayerSourceCache(r);return l&&l.getSource()}getSourceCache(r,l){let f=i.aj(r,l);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(r){let l=i.aj(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);let l=[];return this._mergedOtherSourceCaches[r]&&l.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&l.push(this._mergedSymbolSourceCaches[r]),l}updateSourceCaches(){let r=this._changes.getUpdatedSourceCaches();for(let l in r){let f=r[l];f==="reload"?this.reloadSource(l):f==="clear"&&this.clearSource(l)}}updateLayers(r){let l=this._changes.getUpdatedPaintProperties();for(let f of l){let g=this.getLayer(f);g&&g.updateTransitions(r)}}getImages(r,l,f){this.imageManager.getImages(l.icons,l.scope,f),this._updateTilesForChangedImages();let g=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};g(this._otherSourceCaches[l.source]),g(this._symbolSourceCaches[l.source])}getGlyphs(r,l,f){this.glyphManager.getGlyphs(l.stacks,l.scope,f)}getResource(r,l,f){return i.ce(l,f)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){let l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){let l=this.getOwnSourceCaches(r);return l.length===0?(this.fire(new i.a(new Error(`There is no source with ID '${r}'`))),!1):l.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}mo.getSourceType=function(h){return Je[h]},mo.setSourceType=function(h,r){Je[h]=r},mo.registerForPluginStateChange=i.bY;var fc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,uf=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,Qu=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Ms="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Yu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,oa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,hf=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,pc=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Xu=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,mc=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Ku=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Sn=[];Ss(fc,Sn),Ss(Qu,Sn),Ss(uf,Sn);let Zt={"_prelude_fog.vertex.glsl":oa,"_prelude_terrain.vertex.glsl":Yu,"_prelude_shadow.vertex.glsl":mc,"_prelude_fog.fragment.glsl":hf,"_prelude_shadow.fragment.glsl":Ku,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":pc,"_prelude_raster_particle.glsl":Xu},gc={};Yt("",Yu),Yt(hf,oa),Yt(Ku,mc),Yt(pc,""),Yt(Xu,"");let _c=Yt(uf,Qu),Ju=fc;var go={background:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Yt("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Yt(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Yt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Yt("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Yt("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Yt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Yt(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Yt(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Yt(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Yt(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform mediump float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size.x/aspect;float segment_phase=pattern_len-mod((v_linesofar-v_pattern_data.x),pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;
#ifdef LINE_JOIN_NONE
in vec2 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform mediump float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width+=ANTIALIASING;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5/u_tile_units_to_pixels;v_linesofar+=line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Yt("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Yt("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Yt(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Yt(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:Yt(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Yt(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Yt("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Yt(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ms),skyboxGradient:Yt(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ms),skyboxCapture:Yt(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Yt(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Yt(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Yt(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Ss(h,r){let l=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of l)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let g=f.split(" ");for(let v of g)r.includes(v)||r.push(v)}}function Yt(h,r){let l=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,g=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(C=>{let P=C.split(" ");return P[P.length-1]}),g=[...new Set(g)]);let v={},b=[],T=[];if(h=h.replace(l,(C,P)=>(T.push(P),"")),(r=r.replace(l,(C,P)=>(b.push(P),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...Sn];Ss(h,D),Ss(r,D);for(let C of[...b,...T])Zt[C]||console.error(`Undefined include: ${C}`),gc[C]||(gc[C]=[],Ss(Zt[C],gc[C])),D=[...D,...gc[C]];return{fragmentSource:h=h.replace(f,(C,P,O,F,N)=>(v[N]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${O} ${F} ${N};
#else
uniform ${O} ${F} u_${N};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${N}
    ${O} ${F} ${N} = u_${N};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${O} ${F} ${N};
#endif
`:P==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(f,(C,P,O,F,N)=>{let U=F==="float"?"vec2":F,V=N.match(/color/)?"color":U;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${N}
in ${O} ${F} a_${N};
#endif
`:v[N]?P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${O} ${U} a_${N};
out ${O} ${F} ${N};
#else
uniform ${O} ${F} u_${N};
#endif
`:P==="initialize"?V==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${O} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${V}(a_${N}, u_${N}_t);
#else
    ${O} ${F} ${N} = u_${N};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${O} ${F} a_${N};
    out ${O} ${F} ${N};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${N} = a_${N};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${O} ${U} a_${N};
#else
uniform ${O} ${F} u_${N};
#endif
`:P==="define-instanced"?V==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${N}0;
in vec4 a_${N}1;
in vec4 a_${N}2;
in vec4 a_${N}3;
#else
uniform ${O} ${F} u_${N};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${O} ${U} a_${N};
#else
uniform ${O} ${F} u_${N};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${O} ${F} ${N} = a_${N};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${O} ${F} ${N} = a_${N};
#else
    ${O} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${O} ${F} ${N} = unpack_mix_${V}(a_${N}, u_${N}_t);
#else
    ${O} ${F} ${N} = u_${N};
#endif
`}),staticAttributes:g,usedDefines:D,vertexIncludes:b,fragmentIncludes:T}}class at{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,f,g,v,b,T,D){this.context=r;let C=this.boundPaintVertexBuffers.length!==g.length;for(let O=0;!C&&O<g.length;O++)this.boundPaintVertexBuffers[O]!==g[O]&&(C=!0);let P=this.boundDynamicVertexBuffers.length!==T.length;for(let O=0;!P&&O<T.length;O++)this.boundDynamicVertexBuffers[O]!==T[O]&&(P=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==f||C||P||this.boundIndexBuffer!==v||this.boundVertexOffset!==b)this.freshBind(l,f,g,v,b,T,D);else{r.bindVertexArrayOES.set(this.vao);for(let O of T)O&&(O.bind(),D&&O.instanceCount&&O.setVertexAttribDivisor(r.gl,l,D));v&&v.dynamicDraw&&v.bind()}}freshBind(r,l,f,g,v,b,T){let D=r.numAttributes,C=this.context,P=C.gl;this.vao&&this.destroy(),this.vao=C.gl.createVertexArray(),C.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=b,l.enableAttributes(P,r),l.bind(),l.setVertexAttribPointers(P,r,v);for(let O of f)O.enableAttributes(P,r),O.bind(),O.setVertexAttribPointers(P,r,v);for(let O of b)O&&(O.enableAttributes(P,r),O.bind(),O.setVertexAttribPointers(P,r,v),T&&O.instanceCount&&O.setVertexAttribDivisor(P,r,T));g&&g.bind(),C.currentNumAttributes=D}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function vn(h,r){let l=Math.pow(2,r.canonical.z),f=r.canonical.y;return[new i.O(0,f/l).toLngLat().lat,new i.O(0,(f+1)/l).toLngLat().lat]}function xn(h,r,l,f,g,v,b){let T=h.context,D=T.gl,C=l.hillshadeFBO;if(!C)return;h.prepareDrawTile();let P=h.isTileAffectedByFog(r),O=h.getOrCreateProgram("hillshade",{overrideFog:P});T.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,C.colorAttachment.get());let F=(($,G,Z,te)=>{let ee=Z.paint.get("hillshade-shadow-color"),re=Z.paint.get("hillshade-highlight-color"),H=Z.paint.get("hillshade-accent-color"),Y=Z.paint.get("hillshade-emissive-strength"),ce=i.bm(Z.paint.get("hillshade-illumination-direction"));if(Z.paint.get("hillshade-illumination-anchor")==="viewport")ce-=$.transform.angle;else if($.style&&$.style.enable3dLights()&&$.style.directionalLight){let fe=$.style.directionalLight.properties.get("direction"),we=i.bT(fe.x,fe.y,fe.z);ce=i.bm(we[1])}let ae=!$.options.moving;return{u_matrix:te||$.transform.calculateProjMatrix(G.tileID.toUnwrapped(),ae),u_image:0,u_latrange:vn(0,G.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),ce],u_shadow:ee,u_highlight:re,u_emissive_strength:Y,u_accent:H}})(h,l,f,h.terrain?r.projMatrix:null);h.uploadCommonUniforms(T,O,r.toUnwrapped());let{tileBoundsBuffer:N,tileBoundsIndexBuffer:U,tileBoundsSegments:V}=h.getTileBoundsBuffers(l);O.draw(h,D.TRIANGLES,g,v,b,At.disabled,F,f.id,N,U,V)}function ji(h,r,l){if(!r.needsDEMTextureUpload)return;let f=h.context,g=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||h.getTileTexture(l.stride);let v=l.getPixels();r.demTexture?r.demTexture.update(v,{premultiply:!1}):r.demTexture=new i.T(f,v,g.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Ka(h,r,l){let f=h.context,g=f.gl;if(!r.dem)return;let v=r.dem;if(f.activeTexture.set(g.TEXTURE1),ji(h,r,v),!r.demTexture)return;r.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);let b=v.dim;f.activeTexture.set(g.TEXTURE0);let T=r.hillshadeFBO;if(!T){let F=new i.T(f,{width:b,height:b,data:null},g.RGBA);F.bind(g.LINEAR,g.CLAMP_TO_EDGE),T=r.hillshadeFBO=f.createFramebuffer(b,b,!0,"renderbuffer"),T.colorAttachment.set(F.texture)}f.bindFramebuffer.set(T.framebuffer),f.viewport.set([0,0,b,b]);let{tileBoundsBuffer:D,tileBoundsIndexBuffer:C,tileBoundsSegments:P}=h.getMercatorTileBoundsBuffers(),O=[];h.linearFloatFilteringSupported()&&O.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:O}).draw(h,g.TRIANGLES,Tt.disabled,Ft.disabled,Qt.unblended,At.disabled,((F,N)=>{let U=N.stride,V=i.a9.create();return i.a9.ortho(V,0,i.Y,-i.Y,0,0,1),i.a9.translate(V,V,[0,-i.Y,0]),{u_matrix:V,u_image:1,u_dimension:[U,U],u_zoom:F.overscaledZ}})(r.tileID,v),l.id,D,C,P),r.needsHillshadePrepare=!1}let dn=h=>({u_matrix:new i.bN(h),u_image0:new i.bR(h),u_skirt_height:new i.bQ(h),u_ground_shadow_factor:new i.bP(h)}),yc=(h,r,l)=>({u_matrix:h,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:l}),Ja=(h,r,l,f,g,v,b,T,D,C,P,O,F,N,U,V)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:l,u_zoom_transition:g,u_merc_center:v,u_image0:0,u_frustum_tl:b,u_frustum_tr:T,u_frustum_br:D,u_frustum_bl:C,u_globe_pos:P,u_globe_radius:O,u_viewport:F,u_grid_matrix:V?Float32Array.from(V):new Float32Array(9),u_skirt_height:N,u_far_z_cutoff:U});function el(h,r){return h!=null&&r!=null&&!(!h.hasData()||!r.hasData())&&h.demTexture!=null&&r.demTexture!=null&&h.tileID.key!==r.tileID.key}let Br=new class{constructor(){this.operations={}}newMorphing(h,r,l,f,g){if(h in this.operations){let v=this.operations[h];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[h]={startTime:f,phase:0,duration:g,from:r,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;let r=this.operations[h];return{from:r.from,to:r.to,phase:r.phase}}update(h){for(let r in this.operations){let l=this.operations[r];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[r];break}}}_nextOp(h,r){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=r,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},mr={0:null,1:"TERRAIN_VERTEX_MORPHING"};function cg(h,r,l){if(r===0)return 0;let f=r<1&&l===514?.25/r:1;return 6*Math.pow(1.5,22-h)*Math.max(r,1)*f}function vc(h,r){let l=1<<h.z;return!r&&(h.x===0||h.x===l-1)||h.y===0||h.y===l-1}let xc=h=>({u_matrix:h});function sa(h,r,l,f,g){if(g>0){let v=i.f.now(),b=(v-h.timeAdded)/g,T=r?(v-r.timeAdded)/g:-1,D=l.getSource(),C=f.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),P=!r||Math.abs(r.tileID.overscaledZ-C)>Math.abs(h.tileID.overscaledZ-C),O=P&&h.refreshedUponExpiration?1:i.ad(P?b:1-T,0,1);return h.refreshedUponExpiration&&b>=1&&(h.refreshedUponExpiration=!1),r?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class df extends ho{constructor(r){let l={type:"raster-dem",maxzoom:r.transform.maxZoom},f=new i.bZ(i.b_(),null),g=Hd("mock-dem",l,f,r.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class eh extends ho{constructor(r){let l=Hd("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new i.bZ(i.b_(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,f){if(r.freezeTileCoverage)return;this.transform=r;let g=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,b)=>{if(v[b.key]="",!this._tiles[b.key]){let T=new uo(b,this._source.tileSize*b.overscaleFactor(),r.tileZoom);T.state="loaded",this._tiles[b.key]=T}return v},{});for(let v in this._tiles)v in g||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(r){let l=this.proxyCachedFBO[r];if(l!==void 0){let f=Object.values(l);this.renderCachePool.push(...f),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Zr extends i.ap{constructor(r,l,f){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=f}}class Vi extends i.cp{constructor(r,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[f,g,v]=function(D){let C=new i.aQ,P=new i.az,O=131;C.reserve(17161),P.reserve(33800);let F=i.Y/128,N=i.Y+F/2,U=N+F;for(let $=-F;$<U;$+=F)for(let G=-F;G<U;G+=F){let Z=G<0||G>N||$<0||$>N?24575:0,te=i.ad(Math.round(G),0,i.Y),ee=i.ad(Math.round($),0,i.Y);C.emplaceBack(te+Z,ee)}let V=($,G)=>{let Z=G*O+$;P.emplaceBack(Z+1,Z,Z+O),P.emplaceBack(Z+O,Z+O+1,Z+1)};for(let $=1;$<129;$++)for(let G=1;G<129;G++)V(G,$);return[0,129].forEach($=>{for(let G=0;G<130;G++)V(G,$),V($,G)}),[C,P,32768]}(),b=r.context;this.gridBuffer=b.createVertexBuffer(f,i.aS.members),this.gridIndexBuffer=b.createIndexBuffer(g),this.gridSegments=i.aE.simpleSegment(0,0,f.length,g.length),this.gridNoSkirtSegments=i.aE.simpleSegment(0,0,f.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new eh(l.map),this.orthoMatrix=i.a9.create(),i.a9.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.Y,0,i.Y,0,1);let T=b.gl;this._overlapStencilMode=new Ft({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new df(l.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,l,f){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);let g=r.terrain.properties,v=r.terrain.drapeRenderMode===0,b=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.f.now();let T=r.terrain&&r.terrain.scope,D=g.get("source"),C=v?this._mockSourceCache:r.getSourceCache(D,T);if(!C)return void i.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=C,this._exaggeration=b?this.calculateExaggeration(l):g.get("exaggeration"),!l.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;let P=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let O=this.getScaledDemTileSize();this.sourceCache.update(l,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),l.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(r){let l=this._previousCameraAltitude,f=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=f;let g=l!=null?f-l:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;let v=r.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(v);let T=v-this._previousZoom,D=this._previousUpdateTimestamp,C=v;this._evaluationZoom!=null&&(C=this._evaluationZoom,Math.abs(v-C)>.5&&(T=.5*(v-C+T)),T*g<0&&(C+=T)),this._evaluationZoom=C;let P=b.getExaggeration(C),O=P===b.getExaggeration(Math.max(0,C-.1));if(O&&Math.abs(P-this._exaggeration)<.01)return P;let F=Math.min(.1,.00375*(this._updateTimestamp-D));return(O||P<.1||Math.abs(T)<1e-4)&&(F=Math.min(.2,4*F)),i.X(this._exaggeration,P,F)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let l=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(i.O.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let g=this.proxyCoords=l.getIds().map(D=>{let C=l.getTileByID(D).tileID;return C.projMatrix=f.calculateProjMatrix(C.toUnwrapped()),C});(function(D,C){let P=C.transform.pointCoordinate(C.transform.getCameraPoint()),O=new i.P(P.x,P.y);D.sort((F,N)=>{if(N.overscaledZ-F.overscaledZ)return N.overscaledZ-F.overscaledZ;let U=new i.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),V=new i.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),$=O.mult(1<<F.canonical.z);return $.x-=.5,$.y-=.5,$.distSqr(U)-$.distSqr(V)})})(g,this.painter);let v=this.proxyToSource||{};this.proxyToSource={},g.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};let b=this._style._mergedSourceCaches;for(let D in b){let C=b[D];if(!C.used||(C!==this.sourceCache&&this.resetTileLookupCache(C.id),this._setupProxiedCoordsForOrtho(C,r[D],v),C.usedForTerrain))continue;let P=r[D];C.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[l.id]=g.map(D=>new Zr(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;let T={};this._visibleDemTiles=[];for(let D of this.proxyCoords){let C=this.terrainTileForTile[D.key];if(!C)continue;let P=C.tileID.key;P in T||(this._visibleDemTiles.push(C),T[P]=P)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;let f=this._findTileCoveringTileID(l,this.sourceCache);f&&(this.terrainTileForTile[l.key]=f)})}_prepareDEMTextures(){let r=this.painter.context,l=r.gl;for(let f in this.terrainTileForTile){let g=this.terrainTileForTile[f],v=g.dem;!v||g.demTexture&&!g.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),ji(this.painter,g,v))}}_prepareDemTileUniforms(r,l,f,g){if(!l||l.demTexture==null)return!1;let v=r.tileID.canonical,b=Math.pow(2,l.tileID.canonical.z-v.z),T=g||"";return f[`u_dem_tl${T}`]=[v.x*b%1,v.y*b%1],f[`u_dem_scale${T}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let r=this.painter.context,l=r.gl;if(!this._emptyDepthBufferTexture){let f=new i.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new i.T(r,f,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0,l=this._visibleDemTiles.reduce((f,g)=>{if(!g.dem)return f;let v=g.dem.tree.minimums[0];return v>0&&r++,f+v},0);return r?l/r:0}_updateEmptyDEMTexture(){let r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);let f=this._getLoadedAreaMinimum(),[g,v]=(()=>{let T=new i.cr({width:1,height:1},new Float32Array([f]));return[l.R32F,T]})();this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new i.T(r,v,g,{premultiply:!1}),b}setupElevationDraw(r,l,f){let g=this.painter.context,v=g.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};b.u_exaggeration=this.exaggeration();let T=null,D=null,C=1;if(f&&f.morphing&&this._useVertexMorphing){let F=f.morphing.srcDemTile,N=f.morphing.dstDemTile;C=f.morphing.phase,F&&N&&(this._prepareDemTileUniforms(r,F,b,"_prev")&&(D=F),this._prepareDemTileUniforms(r,N,b)&&(T=N))}let P=F=>F&&F.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST,O=F=>{b.u_dem_size=F.size[0]===1?1:F.size[0]-2};if(D&&T)g.activeTexture.set(v.TEXTURE2),T.demTexture.bind(P(T),v.CLAMP_TO_EDGE),g.activeTexture.set(v.TEXTURE4),D.demTexture.bind(P(D),v.CLAMP_TO_EDGE),T.demTexture&&O(T.demTexture),b.u_dem_lerp=C;else{T=this.terrainTileForTile[r.tileID.key],g.activeTexture.set(v.TEXTURE2);let F=this._prepareDemTileUniforms(r,T,b)?T.demTexture:this.emptyDEMTexture;F.bind(P(T),v.CLAMP_TO_EDGE),O(F)}if(g.activeTexture.set(v.TEXTURE3),f&&f.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),f&&f.useMeterToDem&&T){let F=(1<<T.tileID.canonical.z)*i.bo(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=F}if(f&&f.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),l.setTerrainUniformValues(g,b),this.painter.transform.projection.name==="globe"){let F=this.globeUniformValues(this.painter.transform,r.tileID.canonical,f&&f.useDenormalizedUpVectorScale);l.setGlobeUniformValues(g,F)}}globeUniformValues(r,l,f){let g=r.projection;return{u_tile_tl_up:g.upVector(l,0,0),u_tile_tr_up:g.upVector(l,i.Y,0),u_tile_br_up:g.upVector(l,i.Y,i.Y),u_tile_bl_up:g.upVector(l,0,i.Y),u_tile_up_scale:f?i.cq(1):g.upVectorScale(l,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){let l=this.painter,f=this.painter.context;r.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,v,b,T,D){if(g.transform.projection.name==="globe")(function(C,P,O,F,N){let U=C.context,V=U.gl,$,G,Z=C.transform,te=i.ci(C,U,Z),ee=(xe,Ee)=>{if(G===Ee)return;let he=[mr[Ee],"PROJECTION_GLOBE_VIEW"];te&&he.push("CUSTOM_ANTIALIASING");let ye=C.isTileAffectedByFog(xe);$=C.getOrCreateProgram("globeRaster",{defines:he,overrideFog:ye}),G=Ee},re=C.colorModeForRenderPass(),H=new Tt(V.LEQUAL,Tt.ReadWrite,C.depthRangeFor3D);Br.update(N);let Y=i.cj(Z),ce=[i.a8(Z.center.lng),i.ah(Z.center.lat)],ae=C.globeSharedBuffers,fe=[Z.width*i.f.devicePixelRatio,Z.height*i.f.devicePixelRatio],we=Float32Array.from(Z.globeMatrix),de={useDenormalizedUpVectorScale:!0};{let xe=C.transform,Ee=cg(xe.zoom,P.exaggeration(),P.sourceCache._source.tileSize);G=-1;let he=V.TRIANGLES;for(let ye of F){let ze=O.getTile(ye),me=Ft.disabled,be=P.prevTerrainTileForTile[ye.key],Te=P.terrainTileForTile[ye.key];el(be,Te)&&Br.newMorphing(ye.key,be,Te,N,250),U.activeTexture.set(V.TEXTURE0),ze.texture&&ze.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let ne=Br.getMorphValuesForProxy(ye.key),Ae=ne?1:0;ne&&i.k(de,{morphing:{srcDemTile:ne.from,dstDemTile:ne.to,phase:i.ch(ne.phase)}});let rt=i.ck(ye.canonical),ut=i.cl(rt.getCenter().lat),yt=i.cm(ye.canonical,rt,ut,xe.worldSize/xe._pixelsPerMercatorPixel),pt=i.aW(i.cn(ye.canonical)),wt=Ja(xe.expandedFarZProjMatrix,we,Y,pt,i.W(xe.zoom),ce,xe.frustumCorners.TL,xe.frustumCorners.TR,xe.frustumCorners.BR,xe.frustumCorners.BL,xe.globeCenterInViewSpace,xe.globeRadius,fe,Ee,xe._farZ,yt);if(ee(ye,Ae),$&&(P.setupElevationDraw(ze,$,de),C.uploadCommonUniforms(U,$,ye.toUnwrapped()),ae)){let[nn,Lt,cn]=ae.getGridBuffers(ut,Ee!==0);$.draw(C,he,H,me,re,At.backCCW,wt,"globe_raster",nn,Lt,cn)}}}if(ae&&(C.renderDefaultNorthPole||C.renderDefaultSouthPole)){let xe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];te&&xe.push("CUSTOM_ANTIALIASING"),$=C.getOrCreateProgram("globeRaster",{defines:xe});for(let Ee of F){let{x:he,y:ye,z:ze}=Ee.canonical,me=ye===0,be=ye===(1<<ze)-1,[Te,ne,Ae,rt]=ae.getPoleBuffers(ze,!1);if(rt&&(me||be)){let ut=O.getTile(Ee);U.activeTexture.set(V.TEXTURE0),ut.texture&&ut.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let yt=i.co(ze,he,Z),pt=i.aW(i.cn(Ee.canonical)),wt=(nn,Lt)=>nn.draw(C,V.TRIANGLES,H,Ft.disabled,re,At.disabled,Ja(Z.expandedFarZProjMatrix,yt,yt,pt,0,ce,Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.globeCenterInViewSpace,Z.globeRadius,fe,0,Z._farZ),"globe_pole_raster",Lt,Ae,rt);P.setupElevationDraw(ut,$,de),C.uploadCommonUniforms(U,$,Ee.toUnwrapped()),me&&C.renderDefaultNorthPole&&wt($,Te),be&&C.renderDefaultSouthPole&&(yt=i.a9.scale(i.a9.create(),yt,[1,-1,1]),wt($,ne))}}}})(g,v,b,T,D);else{let C=g.context,P=C.gl,O,F,N=g.shadowRenderer,U=Ds(g,g.longestCutoffRange),V=re=>{if(F===re)return;let H=[];H.push(mr[re]),U.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),O=g.getOrCreateProgram("terrainRaster",{defines:H}),F=re},$=g.colorModeForRenderPass(),G=new Tt(P.LEQUAL,Tt.ReadWrite,g.depthRangeFor3D);Br.update(D);let Z=g.transform,te=cg(Z.zoom,v.exaggeration(),v.sourceCache._source.tileSize),ee=[0,0,0];if(N){let re=g.style.directionalLight,H=g.style.ambientLight;re&&H&&(ee=af(re,H))}{F=-1;let re=P.TRIANGLES,[H,Y]=[v.gridIndexBuffer,v.gridSegments];for(let ce of T){let ae=b.getTile(ce),fe=Ft.disabled,we=v.prevTerrainTileForTile[ce.key],de=v.terrainTileForTile[ce.key];el(we,de)&&Br.newMorphing(ce.key,we,de,D,250),C.activeTexture.set(P.TEXTURE0),ae.texture&&ae.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);let xe=Br.getMorphValuesForProxy(ce.key),Ee=xe?1:0,he;xe&&(he={morphing:{srcDemTile:xe.from,dstDemTile:xe.to,phase:i.ch(xe.phase)}});let ye=yc(ce.projMatrix,vc(ce.canonical,Z.renderWorldCopies)?te/10:te,ee);if(V(Ee),!O)continue;v.setupElevationDraw(ae,O,he);let ze=ce.toUnwrapped();N&&N.setupShadows(ze,O),g.uploadCommonUniforms(C,O,ze,null,U),O.draw(g,re,G,fe,$,At.backCCW,ye,"terrain_raster",v.gridBuffer,H,Y)}}}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;let l=this.painter,f=this.painter.context,g=this.proxySourceCache,v=this.proxiedCoords[g.id],b=this._drapedRenderBatches.shift(),T=l.style.order,D=[],C=0;for(let P of v){let O=g.getTileByID(P.proxyTileKey),F=g.proxyCachedFBO[P.key]?g.proxyCachedFBO[P.key][r]:void 0,N=F!==void 0?g.renderCache[F]:this.pool[C++],U=F!==void 0;if(O.texture=N.tex,U&&!N.dirty){D.push(O.tileID);continue}let V;f.bindFramebuffer.set(N.fb.framebuffer),this.renderedToTile=!1,N.dirty&&(f.clear({color:i.aA.transparent,stencil:0}),N.dirty=!1);for(let $=b.start;$<=b.end;++$){let G=l.style._mergedLayers[T[$]];if(G.isHidden(l.transform.zoom))continue;let Z=l.style.getLayerSourceCache(G),te=Z?this.proxyToSource[P.key][Z.id]:[P];if(!te)continue;let ee=te;f.viewport.set([0,0,N.fb.width,N.fb.height]),V!==(Z?Z.id:null)&&(this._setupStencil(N,te,G,Z),V=Z?Z.id:null),l.renderLayer(l,Z,G,ee)}if(this._drapedRenderBatches.length===0)for(let $ of this._pendingGroundEffectLayers){let G=l.style._mergedLayers[T[$]];if(G.isHidden(l.transform.zoom))continue;let Z=l.style.getLayerSourceCache(G),te=Z?this.proxyToSource[P.key][Z.id]:[P];if(!te)continue;let ee=te;f.viewport.set([0,0,N.fb.width,N.fb.height]),V!==(Z?Z.id:null)&&(this._setupStencil(N,te,G,Z),V=Z?Z.id:null),l.renderLayer(l,Z,G,ee)}this.renderedToTile?(N.dirty=!0,D.push(O.tileID)):U||--C,C===5&&(C=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,l.width,l.height]),b.end+1}postRender(){}isLayerOrderingCorrect(r){let l=r.order.length,f=-1,g=l;for(let v=0;v<l;++v)this._style.isLayerDraped(r._mergedLayers[r.order[v]])?f=Math.max(f,v):g=Math.min(g,v);return g>f}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,l,f){if(!this._visibleDemTiles)return null;let g=this._visibleDemTiles.filter(v=>v.dem).map(v=>{let b=v.tileID,T=1<<b.overscaledZ,{x:D,y:C}=b.canonical,P=D/T,O=(D+1)/T,F=C/T,N=(C+1)/T;return{minx:P,miny:F,maxx:O,maxy:N,t:v.dem.tree.raycastRoot(P,F,O,N,r,l,f),tile:v}});g.sort((v,b)=>(v.t!==null?v.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(let v of g){if(v.t==null)return null;let b=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,r,l,f);if(b!=null)return b}return null}_createFBO(){let r=this.painter.context,l=r.gl,f=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);let g=new i.T(r,{width:f[0],height:f[1],data:null},l.RGBA);g.bind(l.LINEAR,l.CLAMP_TO_EDGE);let v=r.createFramebuffer(f[0],f[1],!0,null);return v.colorAttachment.set(g.texture),v.depthAttachment=new nv(r,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:v,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{let l=this._style._mergedLayers[r],f=l.isHidden(this.painter.transform.zoom);return l.type==="custom"?!f&&l.shouldRedrape():!f&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(let f of this._style.getSources())if(f instanceof tt){r=!0;break}if(!r)return;let l={};for(let f=0;f<this._style.order.length;++f){let g=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(g);if(v&&!l[v.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof i.Z){l[v.id]=!0;for(let b of this.proxyCoords){let T=this.proxyToSource[b.key][v.id];if(T)for(let D of T)this._clearRenderCacheForTile(v.id,D)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(let f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof nt){r=!0;break}if(!r)return;let l={};for(let f=0;f<this._style.order.length;++f){let g=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(g);if(!v||l[v.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;let b=g.paint.get("raster-fade-duration");for(let T of this.proxyCoords){let D=this.proxyToSource[T.key][v.id];if(D)for(let C of D){let P=sa(v.getTile(C),v.findLoadedParent(C,0),v,this.painter.transform,b);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(v.id,C)}}}}_setupDrapedRenderBatches(){let r=this._style.order,l=r.length;if(l===0)return;let f=[];this._pendingGroundEffectLayers=[];let g,v=0,b=this._style._mergedLayers[r[v]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++v<l;)b=this._style._mergedLayers[r[v]];for(;v<l;++v){let T=this._style._mergedLayers[r[v]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?g===void 0&&(g=v):(T.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),g!==void 0&&(f.push({start:g,end:v-1}),g=void 0)))}if(g!==void 0&&f.push({start:g,end:v-1}),f.length!==0){let T=f[f.length-1];this._pendingGroundEffectLayers.every(D=>D>T.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(r){let l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){let b=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let T=0;T<b.length;++T){let D=Object.values(b[T]);l.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();let f=this.proxyCoords,g=this._tilesDirty;for(let b=f.length-1;b>=0;b--){let T=f[b];if(l.getTileByID(T.key),l.proxyCachedFBO[T.key]!==void 0){let D=r[T.key],C=this.proxyToSource[T.key],P=0;for(let O in C){let F=C[O],N=D[O];if(!N||N.length!==F.length||F.some((U,V)=>U!==N[V]||g[O]&&g[O].hasOwnProperty(U.key))){P=-1;break}++P}for(let O in l.proxyCachedFBO[T.key])l.renderCache[l.proxyCachedFBO[T.key][O]].dirty=P<0||P!==Object.values(D).length}}let v=[...this._drapedRenderBatches];v.sort((b,T)=>T.end-T.start-(b.end-b.start));for(let b of v)for(let T of f){if(l.proxyCachedFBO[T.key])continue;let D=l.renderCachePool.pop();D===void 0&&l.renderCache.length<50&&(D=l.renderCache.length,l.renderCache.push(this._createFBO())),D!==void 0&&(l.proxyCachedFBO[T.key]={},l.proxyCachedFBO[T.key][b.start]=D,l.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,f,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let v=this.painter.context,b=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let T;if(f.isTileClipped())T=l.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):Ft.disabled}_renderTileClippingMasks(r,l){let f=this.painter,g=this.painter.context,v=g.gl;f._tileClippingMaskIDs={},g.setColorMode(Qt.disabled),g.setDepthMode(Tt.disabled);let b=f.getOrCreateProgram("clippingMask");for(let T of r){let D=f._tileClippingMaskIDs[T.key]=--l;b.draw(f,v.TRIANGLES,Tt.disabled,new Ft({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),Qt.disabled,At.disabled,xc(T.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(r){let l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;let f=[r.x,r.y,1,1];i.aa.transformMat4(f,f,l.pixelMatrixInverse),i.aa.scale(f,f,1/f[3]),f[0]/=l.worldSize,f[1]/=l.worldSize;let g=l._camera.position,v=i.bo(1,l.center.lat),b=[g[0],g[1],g[2]/v,0],T=i.Q.subtract([],f.slice(0,3),b);i.Q.normalize(T,T);let D=this.raycast(b,T,this._exaggeration);return D!==null&&D?(i.Q.scaleAndAdd(b,b,T,D),b[3]=b[2],b[2]*=v,b):null}drawDepth(){let r=this.painter,l=r.context,f=this.proxySourceCache,g=Math.ceil(r.width),v=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===g&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let b=l.gl,T=l.createFramebuffer(g,v,!0,"renderbuffer");l.activeTexture.set(b.TEXTURE0);let D=new i.T(l,{width:g,height:v,data:null},b.RGBA);D.bind(b.NEAREST,b.CLAMP_TO_EDGE),T.colorAttachment.set(D.texture);let C=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,g,v);T.depthAttachment.set(C),this._depthFBO=T,this._depthTexture=D}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,g,v]),function(b,T,D,C){if(b.transform.projection.name==="globe")return;let P=b.context,O=P.gl;P.clear({depth:1});let F=b.getOrCreateProgram("terrainDepth"),N=new Tt(O.LESS,Tt.ReadWrite,b.depthRangeFor3D);for(let U of C){let V=D.getTile(U),$=yc(U.projMatrix,0,[0,0,0]);T.setupElevationDraw(V,F),F.draw(b,O.TRIANGLES,N,Ft.disabled,Qt.unblended,At.backCCW,$,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(r,this,f,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,l,f){if(r.getSource()instanceof i.as)return this._setupProxiedCoordsForImageSource(r,l,f);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};let g=this.proxiedCoords[r.id]=[],v=this.proxyCoords;for(let D=0;D<v.length;D++){let C=v[D],P=this._findTileCoveringTileID(C,r);if(P){let O=this._createProxiedId(C,P,f[C.key]&&f[C.key][r.id]);g.push(O),this.proxyToSource[C.key][r.id]=[O]}}let b=!1,T=new Set;for(let D=0;D<l.length;D++){let C=r.getTile(l[D]);if(!C||!C.hasData())continue;let P=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==C.tileID.canonical.z){let O=this.proxyToSource[P.tileID.key][r.id],F=this._createProxiedId(P.tileID,C,f[P.tileID.key]&&f[P.tileID.key][r.id]);O?O.splice(O.length-1,0,F):this.proxyToSource[P.tileID.key][r.id]=[F];let N=this.proxyToSource[P.tileID.key][r.id];T.has(N)||T.add(N),g.push(F),b=!0}}if(this._sourceTilesOverlap[r.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(let D of T)D.sort((C,P)=>P.overscaledZ-C.overscaledZ)}_setupProxiedCoordsForImageSource(r,l,f){if(!r.getSource().loaded())return;let g=this.proxiedCoords[r.id]=[],v=this.proxyCoords,b=r.getSource(),T=b.tileID;if(!T)return;let D=new i.P(T.x,T.y)._div(1<<T.z),C=b.coordinates.map(i.O.fromLngLat).reduce((O,F)=>(O.min.x=Math.min(O.min.x,F.x-D.x),O.min.y=Math.min(O.min.y,F.y-D.y),O.max.x=Math.max(O.max.x,F.x-D.x),O.max.y=Math.max(O.max.y,F.y-D.y),O),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(O,F)=>{let N=O.wrap+O.canonical.x/(1<<O.canonical.z),U=O.canonical.y/(1<<O.canonical.z),V=i.Y/(1<<O.canonical.z),$=F.wrap+F.canonical.x/(1<<F.canonical.z),G=F.canonical.y/(1<<F.canonical.z);return N+V<$+C.min.x||N>$+C.max.x||U+V<G+C.min.y||U>G+C.max.y};for(let O=0;O<v.length;O++){let F=v[O];for(let N=0;N<l.length;N++){let U=r.getTile(l[N]);if(!U||!U.hasData()||P(F,U.tileID))continue;let V=this._createProxiedId(F,U,f[F.key]&&f[F.key][r.id]),$=this.proxyToSource[F.key][r.id];$?$.push(V):this.proxyToSource[F.key][r.id]=[V],g.push(V)}}}_createProxiedId(r,l,f){let g=this.orthoMatrix;if(f){let v=f.find(b=>b.key===l.tileID.key);if(v)return v}if(l.tileID.key!==r.key){let v=r.canonical.z-l.tileID.canonical.z,b,T,D;g=i.a9.create();let C=l.tileID.wrap-r.wrap<<r.overscaledZ;v>0?(b=i.Y>>v,T=b*((l.tileID.canonical.x<<v)-r.canonical.x+C),D=b*((l.tileID.canonical.y<<v)-r.canonical.y)):(b=i.Y<<-v,T=i.Y*(l.tileID.canonical.x-(r.canonical.x+C<<-v)),D=i.Y*(l.tileID.canonical.y-(r.canonical.y<<-v))),i.a9.ortho(g,0,b,0,b,0,1),i.a9.translate(g,g,[T,D,0])}return new Zr(l.tileID,r.key,g)}_findTileCoveringTileID(r,l){let f=l.getTile(r);if(f&&f.hasData())return f;let g=this._findCoveringTileCache[l.id],v=g[r.key];if(f=v?l.getTileByID(v):null,f&&f.hasData()||v===null)return f;let b=f?f.tileID:r,T=b.overscaledZ,D=l.getSource().minzoom,C=[];if(!v){let O=l.getSource().maxzoom;if(r.canonical.z>=O){let F=r.canonical.z-O;l.getSource().reparseOverscaled?(T=Math.max(r.canonical.z+2,l.transform.tileZoom),b=new i.ap(T,r.wrap,O,r.canonical.x>>F,r.canonical.y>>F)):F!==0&&(T=O,b=new i.ap(T,r.wrap,O,r.canonical.x>>F,r.canonical.y>>F))}b.key!==r.key&&(C.push(b.key),f=l.getTile(b))}let P=O=>{C.forEach(F=>{g[F]=O}),C.length=0};for(T-=1;T>=D&&(!f||!f.hasData());T--){f&&P(f.tileID.key);let O=b.calculateScaledKey(T);if(f=l.getTileByID(O),f&&f.hasData())break;let F=g[O];if(F===null)break;F===void 0?C.push(O):f=l.getTileByID(F)}return P(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let f=this._tilesDirty[r];f||(f=this._tilesDirty[r]={}),f[l.key]=!0}}function ug(h,r,l){let f=function(T,D,C){let P=i.Q.dot(D,T),O=i.Q.dot(C,[.2126,.7152,.0722]),F=(U,V,$)=>(1-$)*U+$*V,N=F(1-.3*Math.min(O,1),1,Math.min(P+1,1));return F(.92,1,Math.asin(i.ad(D[2],-1,1))/Math.PI+.5)*N}(h,[0,0,1],r),g=[0,0,0];i.Q.scale(g,l.slice(0,3),f);let v=[0,0,0];i.Q.scale(v,r.slice(0,3),h[2]);let b=[0,0,0];return i.Q.add(b,g,v),i.bX(b)}let tl=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Mr=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Ki{static cacheKey(r,l,f,g){let v=`${l}${g?g.cacheKey:""}`;for(let b of f)r.usedDefines.includes(b)&&(v+=`/${b}`);return v}constructor(r,l,f,g,v,b){let T=r.gl;this.program=T.createProgram(),this.configuration=g,this.name=l,this.fixedDefines=[...b];let D=g?g.getBinderAttributes():[],C=(f.staticAttributes||[]).concat(D),P=g?g.defines():[];P=P.concat(b.map($=>`#define ${$}`));let O=`#version 300 es
`,F=O+P.concat("precision mediump float;",Ju,_c.fragmentSource).join(`
`);for(let $ of f.fragmentIncludes)F+=`
${Zt[$]}`;F+=`
${f.fragmentSource}`;let N=O+P.concat("precision highp float;",Ju,_c.vertexSource).join(`
`);for(let $ of f.vertexIncludes)N+=`
${Zt[$]}`;N+=`
${f.vertexSource}`;let U=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(U,F),T.compileShader(U),T.attachShader(this.program,U);let V=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(V,N),T.compileShader(V),T.attachShader(this.program,V),this.attributes={},this.numAttributes=C.length;for(let $=0;$<this.numAttributes;$++)if(C[$]){let G=C[$].startsWith("a_")?C[$]:`a_${C[$]}`;T.bindAttribLocation(this.program,$,G),this.attributes[G]=$}T.linkProgram(this.program),T.deleteShader(V),T.deleteShader(U),this.fixedUniforms=v(r),this.binderUniforms=g?g.getUniforms(r):[],b.includes("TERRAIN")&&(this.terrainUniforms=($=>({u_dem:new i.bR($),u_dem_prev:new i.bR($),u_dem_tl:new i.bO($),u_dem_scale:new i.bQ($),u_dem_tl_prev:new i.bO($),u_dem_scale_prev:new i.bQ($),u_dem_size:new i.bQ($),u_dem_lerp:new i.bQ($),u_exaggeration:new i.bQ($),u_depth:new i.bR($),u_depth_size_inv:new i.bO($),u_meter_to_dem:new i.bQ($),u_label_plane_matrix_inv:new i.bN($)}))(r)),b.includes("GLOBE")&&(this.globeUniforms=($=>({u_tile_tl_up:new i.bP($),u_tile_tr_up:new i.bP($),u_tile_br_up:new i.bP($),u_tile_bl_up:new i.bP($),u_tile_up_scale:new i.bQ($)}))(r)),b.includes("FOG")&&(this.fogUniforms=($=>({u_fog_matrix:new i.bN($),u_fog_range:new i.bO($),u_fog_color:new i.bS($),u_fog_horizon_blend:new i.bQ($),u_fog_vertical_limit:new i.bO($),u_fog_temporal_offset:new i.bQ($),u_frustum_tl:new i.bP($),u_frustum_tr:new i.bP($),u_frustum_br:new i.bP($),u_frustum_bl:new i.bP($),u_globe_pos:new i.bP($),u_globe_radius:new i.bQ($),u_globe_transition:new i.bQ($),u_is_globe:new i.bR($),u_viewport:new i.bO($)}))(r)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=($=>({u_cutoff_params:new i.bS($)}))(r)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=($=>({u_lighting_ambient_color:new i.bP($),u_lighting_directional_dir:new i.bP($),u_lighting_directional_color:new i.bP($),u_ground_radiance:new i.bP($)}))(r)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=($=>({u_light_matrix_0:new i.bN($),u_light_matrix_1:new i.bN($),u_fade_range:new i.bO($),u_shadow_normal_offset:new i.bP($),u_shadow_intensity:new i.bQ($),u_shadow_texel_size:new i.bQ($),u_shadow_map_resolution:new i.bQ($),u_shadow_direction:new i.bP($),u_shadow_bias:new i.bP($),u_shadowmap_0:new i.bR($),u_shadowmap_1:new i.bR($)}))(r))}}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;let f=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in l)f[g]&&f[g].set(this.program,g,l[g])}}setGlobeUniformValues(r,l){if(!this.globeUniforms)return;let f=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in l)f[g]&&f[g].set(this.program,g,l[g])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;let f=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in l)f[g].set(this.program,g,l[g])}}setCutoffUniformValues(r,l){if(!this.cutoffUniforms)return;let f=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in l)f[g].set(this.program,g,l[g])}}setLightsUniformValues(r,l){if(!this.lightsUniforms)return;let f=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in l)f[g].set(this.program,g,l[g])}}setShadowUniformValues(r,l){if(this.failedToCreate||!this.shadowUniforms)return;let f=this.shadowUniforms;r.program.set(this.program);for(let g in l)f[g].set(this.program,g,l[g])}_drawDebugWireframe(r,l,f,g,v,b,T,D,C,P){let O=r.options.wireframe;if(O.terrain===!1&&O.layers2D===!1&&O.layers3D===!1)return;let F=r.context;if(!(!(!O.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!O.layers2D||r._terrain&&r._terrain.renderingToTexture||!tl.includes(this.name))||!(!O.layers3D||!Mr.includes(this.name))))return;let N=F.gl,U=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,v,F);if(!U)return;let V=[...this.fixedDefines];V.push("DEBUG_WIREFRAME");let $=r.getOrCreateProgram(this.name,{config:this.configuration,defines:V});F.program.set($.program);let G=(ee,re,H)=>{if(re[ee]&&H[ee])for(let Y in re[ee])H[ee][Y]&&H[ee][Y].set(H.program,Y,re[ee][Y].current)};C&&C.setUniforms($.program,F,$.binderUniforms,T,{zoom:D}),G("fixedUniforms",this,$),G("terrainUniforms",this,$),G("globeUniforms",this,$),G("fogUniforms",this,$),G("lightsUniforms",this,$),G("shadowUniforms",this,$),U.bind(),F.setColorMode(new Qt([N.ONE,N.ONE_MINUS_SRC_ALPHA,N.ZERO,N.ONE],i.aA.transparent,[!0,!0,!0,!1])),F.setDepthMode(new Tt(l.func===N.LESS?N.LEQUAL:l.func,Tt.ReadOnly,l.range)),F.setStencilMode(Ft.disabled);let Z=3*b.primitiveLength*2,te=3*b.primitiveOffset*2*2;P&&P>1?N.drawElementsInstanced(N.LINES,Z,N.UNSIGNED_SHORT,te,P):N.drawElements(N.LINES,Z,N.UNSIGNED_SHORT,te),v.bind(),F.program.set(this.program),F.setDepthMode(l),F.setStencilMode(f),F.setColorMode(g)}draw(r,l,f,g,v,b,T,D,C,P,O,F,N,U,V,$){let G=r.context,Z=G.gl;if(this.failedToCreate)return;G.program.set(this.program),G.setDepthMode(f),G.setStencilMode(g),G.setColorMode(v),G.setCullFace(b);for(let re of Object.keys(this.fixedUniforms))this.fixedUniforms[re].set(this.program,re,T[re]);U&&U.setUniforms(this.program,G,this.binderUniforms,F,{zoom:N});let te={[Z.POINTS]:1,[Z.LINES]:2,[Z.TRIANGLES]:3,[Z.LINE_STRIP]:1}[l],ee=$&&$>0?1:void 0;for(let re of O.get()){let H=re.vaos||(re.vaos={});(H[D]||(H[D]=new at)).bind(G,this,C,U?U.getPaintVertexBuffers():[],P,re.vertexOffset,V||[],ee),$&&$>1?Z.drawElementsInstanced(l,re.primitiveLength*te,Z.UNSIGNED_SHORT,re.primitiveOffset*te*2,$):P?Z.drawElements(l,re.primitiveLength*te,Z.UNSIGNED_SHORT,re.primitiveOffset*te*2):Z.drawArrays(l,re.vertexOffset,re.vertexLength),l===Z.TRIANGLES&&P&&this._drawDebugWireframe(r,f,g,v,P,re,F,N,U,$)}}}function Lo(h,r){let l=Math.pow(2,r.tileID.overscaledZ),f=r.tileSize*Math.pow(2,h.transform.tileZoom)/l,g=f*(r.tileID.canonical.x+r.tileID.wrap*l),v=f*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.a6(r,1,h.transform.tileZoom),u_pixel_coord_upper:[g>>16,v>>16],u_pixel_coord_lower:[65535&g,65535&v]}}let Rr=i.a9.create(),th=(h,r,l,f,g,v,b,T,D,C,P,O,F,N,U,V)=>{let $=r.style.light,G=$.properties.get("position"),Z=[G.x,G.y,G.z],te=i.ct.create();$.properties.get("anchor")==="viewport"&&(i.ct.fromRotation(te,-r.transform.angle),i.Q.transformMat3(Z,Z,te));let ee=$.properties.get("color"),re=r.transform,H={u_matrix:h,u_lightpos:Z,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_vertical_gradient:+l,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Rr,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:g,u_edge_radius:v,u_flood_light_color:O,u_vertical_scale:F,u_flood_light_intensity:N,u_ground_shadow_factor:U,u_emissive_strength:V};return re.projection.name==="globe"&&(H.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],H.u_zoom_transition=D,H.u_inv_rot_matrix=P,H.u_merc_center=C,H.u_up_dir=re.projection.upVector(new i.bv(0,0,0),C[0]*i.Y,C[1]*i.Y),H.u_height_lift=T),H},_o=(h,r,l)=>({u_matrix:h,u_edge_radius:r,u_vertical_scale:l}),bc=(h,r,l,f,g,v,b,T,D,C,P,O,F,N)=>{let U=th(h,r,l,f,g,v,b,D,C,P,O,F,N,1,[0,0,0],0),V={u_height_factor:-Math.pow(2,b.overscaledZ)/T.tileSize/8};return i.e(U,Lo(r,T),V)},nl=(h,r)=>({u_matrix:h,u_emissive_strength:r}),Cs=(h,r,l,f)=>i.e(nl(h,r),Lo(l,f)),av=(h,r,l)=>({u_matrix:h,u_world:l,u_emissive_strength:r}),es=(h,r,l,f,g)=>i.e(Cs(h,r,l,f),{u_world:g}),lv=(h,r,l,f)=>{let g=i.Y/l.tileSize;return{u_matrix:h,u_camera_to_center_distance:r.getCameraToCenterDistance(f),u_extrude_scale:[r.pixelsToGLUnits[0]/g,r.pixelsToGLUnits[1]/g]}},ff=(h,r,l=1)=>({u_matrix:h,u_color:r,u_overlay:0,u_overlay_scale:l}),Si=i.a9.create(),cv=(h,r,l,f,g,v,b)=>{let T=h.transform,D=T.projection.name==="globe",C=D?i.cu(T.zoom,r.canonical)*T._pixelsPerMercatorPixel:i.a6(l,1,v),P={u_matrix:r.projMatrix,u_extrude_scale:C,u_intensity:b,u_inv_rot_matrix:Si,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){P.u_inv_rot_matrix=f,P.u_merc_center=g,P.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],P.u_zoom_transition=i.W(T.zoom);let O=g[0]*i.Y,F=g[1]*i.Y;P.u_up_dir=T.projection.upVector(new i.bv(0,0,0),O,F)}return P};function wc(h,[r,l,f,g],[v,b]){if(v===b)return[0,0,0,0];let T=255*(h-1)/(h*(b-v));return[r*T,l*T,f*T,g*T]}function pf(h,r,[l,f]){return l===f?0:.5/h+(r-l)*(h-1)/(h*(f-l))}let hg=(h,r,l,f,g,v,b,T,D,C,P,O,F,N,U,V,$,G,Z,te,ee)=>({u_matrix:h,u_normalize_matrix:r,u_globe_matrix:l,u_merc_matrix:f,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:C,u_fade_t:P.mix,u_opacity:P.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:i.cv(O.paint.get("raster-saturation")),u_contrast_factor:i.cw(O.paint.get("raster-contrast")),u_spin_weights:uv(O.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:N,u_zoom_transition:b,u_merc_center:T,u_cutoff_params:D,u_colorization_mix:wc(i.cx,V,G),u_colorization_offset:pf(i.cx,$,G),u_color_ramp:U,u_texture_offset:[te/(Z+2*te),Z/(Z+2*te)],u_texture_res:[Z+2*te,Z+2*te],u_emissive_strength:ee});function uv(h){h*=Math.PI/180;let r=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}let Tc=(h,r,l,f,g,v,b,T,D,C,P,O)=>({u_matrix:h,u_normalize_matrix:r,u_globe_matrix:l,u_merc_matrix:f,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:C,u_fade_t:P.mix,u_opacity:P.opacity,u_image0:0,u_image1:1,u_raster_elevation:O,u_zoom_transition:b,u_merc_center:T,u_cutoff_params:D}),Ec=(h,r,l,f,g,v,b,T,D,C)=>({u_particle_texture:h,u_particle_texture_side_len:r,u_tile_offset:l,u_velocity:f,u_color_ramp:v,u_velocity_res:g,u_max_speed:b,u_uv_offset:T,u_data_scale:D,u_data_offset:C,u_particle_pos_scale:1.3,u_particle_pos_offset:[ea,ea]}),hv=(h,r,l,f,g,v,b,T,D,C)=>({u_particle_texture:h,u_particle_texture_side_len:r,u_velocity:l,u_velocity_res:f,u_max_speed:g,u_speed_factor:v,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:T,u_data_scale:D,u_data_offset:C,u_particle_pos_scale:1.3,u_particle_pos_offset:[ea,ea]}),aa=i.a9.create(),mf=(h,r,l,f,g,v,b,T,D,C,P,O,F,N,U,V,$,G)=>{let Z=g.transform,te={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Z.getCameraToCenterDistance(V),u_rotate_symbol:+l,u_aspect_ratio:Z.width/Z.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:b,u_coord_matrix:T,u_is_text:+D,u_pitch_with_map:+f,u_texsize:C,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:aa,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:aa,u_up_vector:[0,-1,0],u_color_adj_mat:$,u_icon_transition:G||0};return V.name==="globe"&&(te.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],te.u_zoom_transition=O,te.u_inv_rot_matrix=N,te.u_merc_center=F,te.u_camera_forward=Z._camera.forward(),te.u_ecef_origin=i.cy(Z.globeMatrix,P.toUnwrapped()),te.u_tile_matrix=Float32Array.from(Z.globeMatrix),te.u_up_vector=U),te},rl=(h,r,l,f,g,v,b,T,D,C,P,O,F,N,U,V,$)=>i.e(mf(h,r,l,f,g,v,b,T,D,C,O,F,N,U,V,$),{u_gamma_scale:f?g.transform.getCameraToCenterDistance($)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:i.f.devicePixelRatio,u_is_halo:+P,undefined:void 0}),As=(h,r,l,f,g,v,b,T,D,C,P,O,F,N,U,V)=>i.e(rl(h,r,l,f,g,v,b,T,!0,D,!0,P,O,F,N,U,V),{u_texsize_icon:C,u_texture_icon:1}),dv=(h,r,l,f)=>({u_matrix:h,u_emissive_strength:r,u_opacity:l,u_color:f}),fv=(h,r,l,f,g,v,b)=>i.e(function(T,D,C,P){let O=C.imageManager.getPattern(T.toString(),D),{width:F,height:N}=C.imageManager.getPixelSize(D),U=Math.pow(2,P.tileID.overscaledZ),V=P.tileSize*Math.pow(2,C.transform.tileZoom)/U,$=V*(P.tileID.canonical.x+P.tileID.wrap*U),G=V*P.tileID.canonical.y;return{u_image:0,u_pattern_tl:O.tl,u_pattern_br:O.br,u_texsize:[F,N],u_pattern_size:O.displaySize,u_tile_units_to_pixels:1/i.a6(P,1,C.transform.tileZoom),u_pixel_coord_upper:[$>>16,G>>16],u_pixel_coord_lower:[65535&$,65535&G]}}(g,v,f,b),{u_matrix:h,u_emissive_strength:r,u_opacity:l}),gf=new Float32Array(i.a9.identity([])),nh=(h,r,l,f,g,v,b,T,D,C,P,O,F,N=[0,0,0],U)=>{let V=g.style.light,$=V.properties.get("position"),G=[-$.x,-$.y,$.z],Z=i.ct.create();V.properties.get("anchor")==="viewport"&&(i.ct.fromRotation(Z,-g.transform.angle),i.Q.transformMat3(G,G,Z));let te=P.alphaMode==="MASK",ee=V.properties.get("color"),re=F.paint.get("model-ambient-occlusion-intensity"),H=F.paint.get("model-color").constantOr(i.aA.white),Y=F.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:r,u_normal_matrix:l,u_node_matrix:f||gf,u_lightpos:G,u_lightintensity:V.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_camera_pos:N,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+te,u_alphaCutoff:P.alphaCutoff,u_baseColorFactor:[b.r,b.g,b.b,b.a],u_emissiveFactor:[T[0],T[1],T[2],1],u_metallicFactor:D,u_roughnessFactor:C,u_baseColorTexture:Di.BaseColor,u_metallicRoughnessTexture:Di.MetallicRoughness,u_normalTexture:Di.Normal,u_occlusionTexture:Di.Occlusion,u_emissionTexture:Di.Emission,u_color_mix:[H.r,H.g,H.b,Y],u_aoIntensity:re,u_emissive_strength:O,u_occlusionTextureTransform:U||[0,0,0,0]}},dg=(h,r=gf,l=gf)=>({u_matrix:h,u_instance:r,u_node_matrix:l}),_f={fillExtrusion:h=>({u_matrix:new i.bN(h),u_lightpos:new i.bP(h),u_lightintensity:new i.bQ(h),u_lightcolor:new i.bP(h),u_vertical_gradient:new i.bQ(h),u_opacity:new i.bQ(h),u_edge_radius:new i.bQ(h),u_ao:new i.bO(h),u_tile_id:new i.bP(h),u_zoom_transition:new i.bQ(h),u_inv_rot_matrix:new i.bN(h),u_merc_center:new i.bO(h),u_up_dir:new i.bP(h),u_height_lift:new i.bQ(h),u_flood_light_color:new i.bP(h),u_vertical_scale:new i.bQ(h),u_flood_light_intensity:new i.bQ(h),u_ground_shadow_factor:new i.bP(h),u_emissive_strength:new i.bQ(h)}),fillExtrusionDepth:h=>({u_matrix:new i.bN(h),u_edge_radius:new i.bQ(h),u_vertical_scale:new i.bQ(h)}),fillExtrusionPattern:h=>({u_matrix:new i.bN(h),u_lightpos:new i.bP(h),u_lightintensity:new i.bQ(h),u_lightcolor:new i.bP(h),u_vertical_gradient:new i.bQ(h),u_height_factor:new i.bQ(h),u_edge_radius:new i.bQ(h),u_ao:new i.bO(h),u_tile_id:new i.bP(h),u_zoom_transition:new i.bQ(h),u_inv_rot_matrix:new i.bN(h),u_merc_center:new i.bO(h),u_up_dir:new i.bP(h),u_height_lift:new i.bQ(h),u_image:new i.bR(h),u_texsize:new i.bO(h),u_pixel_coord_upper:new i.bO(h),u_pixel_coord_lower:new i.bO(h),u_tile_units_to_pixels:new i.bQ(h),u_opacity:new i.bQ(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new i.bN(h),u_opacity:new i.bQ(h),u_ao_pass:new i.bQ(h),u_meter_to_tile:new i.bQ(h),u_ao:new i.bO(h),u_flood_light_intensity:new i.bQ(h),u_flood_light_color:new i.bP(h),u_attenuation:new i.bQ(h),u_edge_radius:new i.bQ(h),u_fb:new i.bR(h),u_fb_size:new i.bQ(h)}),fill:h=>({u_matrix:new i.bN(h),u_emissive_strength:new i.bQ(h)}),fillPattern:h=>({u_matrix:new i.bN(h),u_emissive_strength:new i.bQ(h),u_image:new i.bR(h),u_texsize:new i.bO(h),u_pixel_coord_upper:new i.bO(h),u_pixel_coord_lower:new i.bO(h),u_tile_units_to_pixels:new i.bQ(h)}),fillOutline:h=>({u_matrix:new i.bN(h),u_emissive_strength:new i.bQ(h),u_world:new i.bO(h)}),fillOutlinePattern:h=>({u_matrix:new i.bN(h),u_emissive_strength:new i.bQ(h),u_world:new i.bO(h),u_image:new i.bR(h),u_texsize:new i.bO(h),u_pixel_coord_upper:new i.bO(h),u_pixel_coord_lower:new i.bO(h),u_tile_units_to_pixels:new i.bQ(h)}),circle:i.cz,collisionBox:h=>({u_matrix:new i.bN(h),u_camera_to_center_distance:new i.bQ(h),u_extrude_scale:new i.bO(h)}),collisionCircle:h=>({u_matrix:new i.bN(h),u_inv_matrix:new i.bN(h),u_camera_to_center_distance:new i.bQ(h),u_viewport_size:new i.bO(h)}),debug:h=>({u_color:new i.cf(h),u_matrix:new i.bN(h),u_overlay:new i.bR(h),u_overlay_scale:new i.bQ(h)}),clippingMask:h=>({u_matrix:new i.bN(h)}),heatmap:h=>({u_extrude_scale:new i.bQ(h),u_intensity:new i.bQ(h),u_matrix:new i.bN(h),u_inv_rot_matrix:new i.bN(h),u_merc_center:new i.bO(h),u_tile_id:new i.bP(h),u_zoom_transition:new i.bQ(h),u_up_dir:new i.bP(h)}),heatmapTexture:h=>({u_image:new i.bR(h),u_color_ramp:new i.bR(h),u_opacity:new i.bQ(h)}),hillshade:h=>({u_matrix:new i.bN(h),u_image:new i.bR(h),u_latrange:new i.bO(h),u_light:new i.bO(h),u_shadow:new i.cf(h),u_highlight:new i.cf(h),u_emissive_strength:new i.bQ(h),u_accent:new i.cf(h)}),hillshadePrepare:h=>({u_matrix:new i.bN(h),u_image:new i.bR(h),u_dimension:new i.bO(h),u_zoom:new i.bQ(h)}),line:i.cA,linePattern:i.cB,raster:h=>({u_matrix:new i.bN(h),u_normalize_matrix:new i.bN(h),u_globe_matrix:new i.bN(h),u_merc_matrix:new i.bN(h),u_grid_matrix:new i.cg(h),u_tl_parent:new i.bO(h),u_scale_parent:new i.bQ(h),u_fade_t:new i.bQ(h),u_opacity:new i.bQ(h),u_image0:new i.bR(h),u_image1:new i.bR(h),u_brightness_low:new i.bQ(h),u_brightness_high:new i.bQ(h),u_saturation_factor:new i.bQ(h),u_contrast_factor:new i.bQ(h),u_spin_weights:new i.bP(h),u_perspective_transform:new i.bO(h),u_raster_elevation:new i.bQ(h),u_zoom_transition:new i.bQ(h),u_merc_center:new i.bO(h),u_cutoff_params:new i.bS(h),u_colorization_mix:new i.bS(h),u_colorization_offset:new i.bQ(h),u_color_ramp:new i.bR(h),u_texture_offset:new i.bO(h),u_texture_res:new i.bO(h),u_emissive_strength:new i.bQ(h)}),rasterParticle:h=>({u_matrix:new i.bN(h),u_normalize_matrix:new i.bN(h),u_globe_matrix:new i.bN(h),u_merc_matrix:new i.bN(h),u_grid_matrix:new i.cg(h),u_tl_parent:new i.bO(h),u_scale_parent:new i.bQ(h),u_fade_t:new i.bQ(h),u_opacity:new i.bQ(h),u_image0:new i.bR(h),u_image1:new i.bR(h),u_raster_elevation:new i.bQ(h),u_zoom_transition:new i.bQ(h),u_merc_center:new i.bO(h),u_cutoff_params:new i.bS(h)}),rasterParticleTexture:h=>({u_texture:new i.bR(h),u_opacity:new i.bQ(h)}),rasterParticleDraw:h=>({u_particle_texture:new i.bR(h),u_particle_texture_side_len:new i.bQ(h),u_tile_offset:new i.bO(h),u_velocity:new i.bR(h),u_color_ramp:new i.bR(h),u_velocity_res:new i.bO(h),u_max_speed:new i.bQ(h),u_uv_offset:new i.bO(h),u_data_scale:new i.bS(h),u_data_offset:new i.bQ(h),u_particle_pos_scale:new i.bQ(h),u_particle_pos_offset:new i.bO(h)}),rasterParticleUpdate:h=>({u_particle_texture:new i.bR(h),u_particle_texture_side_len:new i.bQ(h),u_velocity:new i.bR(h),u_velocity_res:new i.bO(h),u_max_speed:new i.bQ(h),u_speed_factor:new i.bQ(h),u_reset_rate:new i.bQ(h),u_rand_seed:new i.bQ(h),u_uv_offset:new i.bO(h),u_data_scale:new i.bS(h),u_data_offset:new i.bQ(h),u_particle_pos_scale:new i.bQ(h),u_particle_pos_offset:new i.bO(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new i.bR(h),u_is_size_feature_constant:new i.bR(h),u_size_t:new i.bQ(h),u_size:new i.bQ(h),u_camera_to_center_distance:new i.bQ(h),u_rotate_symbol:new i.bR(h),u_aspect_ratio:new i.bQ(h),u_fade_change:new i.bQ(h),u_matrix:new i.bN(h),u_label_plane_matrix:new i.bN(h),u_coord_matrix:new i.bN(h),u_is_text:new i.bR(h),u_pitch_with_map:new i.bR(h),u_texsize:new i.bO(h),u_tile_id:new i.bP(h),u_zoom_transition:new i.bQ(h),u_inv_rot_matrix:new i.bN(h),u_merc_center:new i.bO(h),u_camera_forward:new i.bP(h),u_tile_matrix:new i.bN(h),u_up_vector:new i.bP(h),u_ecef_origin:new i.bP(h),u_texture:new i.bR(h),u_icon_transition:new i.bQ(h),u_color_adj_mat:new i.bN(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new i.bR(h),u_is_size_feature_constant:new i.bR(h),u_size_t:new i.bQ(h),u_size:new i.bQ(h),u_camera_to_center_distance:new i.bQ(h),u_rotate_symbol:new i.bR(h),u_aspect_ratio:new i.bQ(h),u_fade_change:new i.bQ(h),u_matrix:new i.bN(h),u_label_plane_matrix:new i.bN(h),u_coord_matrix:new i.bN(h),u_is_text:new i.bR(h),u_pitch_with_map:new i.bR(h),u_texsize:new i.bO(h),u_texture:new i.bR(h),u_gamma_scale:new i.bQ(h),u_device_pixel_ratio:new i.bQ(h),u_tile_id:new i.bP(h),u_zoom_transition:new i.bQ(h),u_inv_rot_matrix:new i.bN(h),u_merc_center:new i.bO(h),u_camera_forward:new i.bP(h),u_tile_matrix:new i.bN(h),u_up_vector:new i.bP(h),u_ecef_origin:new i.bP(h),u_is_halo:new i.bR(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new i.bR(h),u_is_size_feature_constant:new i.bR(h),u_size_t:new i.bQ(h),u_size:new i.bQ(h),u_camera_to_center_distance:new i.bQ(h),u_rotate_symbol:new i.bR(h),u_aspect_ratio:new i.bQ(h),u_fade_change:new i.bQ(h),u_matrix:new i.bN(h),u_label_plane_matrix:new i.bN(h),u_coord_matrix:new i.bN(h),u_is_text:new i.bR(h),u_pitch_with_map:new i.bR(h),u_texsize:new i.bO(h),u_texsize_icon:new i.bO(h),u_texture:new i.bR(h),u_texture_icon:new i.bR(h),u_gamma_scale:new i.bQ(h),u_device_pixel_ratio:new i.bQ(h),u_is_halo:new i.bR(h)}),background:h=>({u_matrix:new i.bN(h),u_emissive_strength:new i.bQ(h),u_opacity:new i.bQ(h),u_color:new i.cf(h)}),backgroundPattern:h=>({u_matrix:new i.bN(h),u_emissive_strength:new i.bQ(h),u_opacity:new i.bQ(h),u_image:new i.bR(h),u_pattern_tl:new i.bO(h),u_pattern_br:new i.bO(h),u_texsize:new i.bO(h),u_pattern_size:new i.bO(h),u_pixel_coord_upper:new i.bO(h),u_pixel_coord_lower:new i.bO(h),u_tile_units_to_pixels:new i.bQ(h)}),terrainRaster:dn,terrainDepth:dn,skybox:h=>({u_matrix:new i.bN(h),u_sun_direction:new i.bP(h),u_cubemap:new i.bR(h),u_opacity:new i.bQ(h),u_temporal_offset:new i.bQ(h)}),skyboxGradient:h=>({u_matrix:new i.bN(h),u_color_ramp:new i.bR(h),u_center_direction:new i.bP(h),u_radius:new i.bQ(h),u_opacity:new i.bQ(h),u_temporal_offset:new i.bQ(h)}),skyboxCapture:h=>({u_matrix_3f:new i.cg(h),u_sun_direction:new i.bP(h),u_sun_intensity:new i.bQ(h),u_color_tint_r:new i.bS(h),u_color_tint_m:new i.bS(h),u_luminance:new i.bQ(h)}),globeRaster:h=>({u_proj_matrix:new i.bN(h),u_globe_matrix:new i.bN(h),u_normalize_matrix:new i.bN(h),u_merc_matrix:new i.bN(h),u_zoom_transition:new i.bQ(h),u_merc_center:new i.bO(h),u_image0:new i.bR(h),u_grid_matrix:new i.cg(h),u_skirt_height:new i.bQ(h),u_far_z_cutoff:new i.bQ(h),u_frustum_tl:new i.bP(h),u_frustum_tr:new i.bP(h),u_frustum_br:new i.bP(h),u_frustum_bl:new i.bP(h),u_globe_pos:new i.bP(h),u_globe_radius:new i.bQ(h),u_viewport:new i.bO(h)}),globeAtmosphere:h=>({u_frustum_tl:new i.bP(h),u_frustum_tr:new i.bP(h),u_frustum_br:new i.bP(h),u_frustum_bl:new i.bP(h),u_horizon:new i.bQ(h),u_transition:new i.bQ(h),u_fadeout_range:new i.bQ(h),u_color:new i.bS(h),u_high_color:new i.bS(h),u_space_color:new i.bS(h),u_temporal_offset:new i.bQ(h),u_horizon_angle:new i.bQ(h)}),model:h=>({u_matrix:new i.bN(h),u_lighting_matrix:new i.bN(h),u_normal_matrix:new i.bN(h),u_node_matrix:new i.bN(h),u_lightpos:new i.bP(h),u_lightintensity:new i.bQ(h),u_lightcolor:new i.bP(h),u_camera_pos:new i.bP(h),u_opacity:new i.bQ(h),u_baseColorFactor:new i.bS(h),u_emissiveFactor:new i.bS(h),u_metallicFactor:new i.bQ(h),u_roughnessFactor:new i.bQ(h),u_baseTextureIsAlpha:new i.bR(h),u_alphaMask:new i.bR(h),u_alphaCutoff:new i.bQ(h),u_baseColorTexture:new i.bR(h),u_metallicRoughnessTexture:new i.bR(h),u_normalTexture:new i.bR(h),u_occlusionTexture:new i.bR(h),u_emissionTexture:new i.bR(h),u_color_mix:new i.bS(h),u_aoIntensity:new i.bQ(h),u_emissive_strength:new i.bQ(h),u_occlusionTextureTransform:new i.bS(h)}),modelDepth:h=>({u_matrix:new i.bN(h),u_instance:new i.bN(h),u_node_matrix:new i.bN(h)}),groundShadow:h=>({u_matrix:new i.bN(h),u_ground_shadow_factor:new i.bP(h)}),stars:h=>({u_matrix:new i.bN(h),u_up:new i.bP(h),u_right:new i.bP(h),u_intensity_multiplier:new i.bQ(h)})},Ic;function yf(h,r,l,f,g,v,b){let T=h.context,D=T.gl,C=h.transform,P=h.getOrCreateProgram("collisionBox"),O=[],F=0,N=0;for(let ee=0;ee<f.length;ee++){let re=f[ee],H=r.getTile(re),Y=H.getBucket(l);if(!Y)continue;let ce=Ro(re,Y,C),ae=ce;g[0]===0&&g[1]===0||(ae=h.translatePosMatrix(ce,H,g,v));let fe=b?Y.textCollisionBox:Y.iconCollisionBox,we=Y.collisionCircleArray;if(we.length>0){let de=i.a9.create(),xe=ae;i.a9.mul(de,Y.placementInvProjMatrix,C.glCoordMatrix),i.a9.mul(de,de,Y.placementViewportMatrix),O.push({circleArray:we,circleOffset:N,transform:xe,invTransform:de,projection:Y.getProjection()}),F+=we.length/4,N=F}fe&&(h.terrain&&h.terrain.setupElevationDraw(H,P),P.draw(h,D.LINES,Tt.disabled,Ft.disabled,h.colorModeForRenderPass(),At.disabled,lv(ae,C,H,Y.getProjection()),l.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,null,C.zoom,null,[fe.collisionVertexBuffer,fe.collisionVertexBufferExt]))}if(!b||!O.length)return;let U=h.getOrCreateProgram("collisionCircle"),V=new i.cC;V.resize(4*F),V._trim();let $=0;for(let ee of O)for(let re=0;re<ee.circleArray.length/4;re++){let H=4*re,Y=ee.circleArray[H+0],ce=ee.circleArray[H+1],ae=ee.circleArray[H+2],fe=ee.circleArray[H+3];V.emplace($++,Y,ce,ae,fe,0),V.emplace($++,Y,ce,ae,fe,1),V.emplace($++,Y,ce,ae,fe,2),V.emplace($++,Y,ce,ae,fe,3)}(!Ic||Ic.length<2*F)&&(Ic=function(ee){let re=2*ee,H=new i.az;H.resize(re),H._trim();for(let Y=0;Y<re;Y++){let ce=6*Y;H.uint16[ce+0]=4*Y+0,H.uint16[ce+1]=4*Y+1,H.uint16[ce+2]=4*Y+2,H.uint16[ce+3]=4*Y+2,H.uint16[ce+4]=4*Y+3,H.uint16[ce+5]=4*Y+0}return H}(F));let G=T.createIndexBuffer(Ic,!0),Z=T.createVertexBuffer(V,i.cD.members,!0);for(let ee of O){let re={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(te=C).getCameraToCenterDistance(ee.projection),u_viewport_size:[te.width,te.height]};U.draw(h,D.TRIANGLES,Tt.disabled,Ft.disabled,h.colorModeForRenderPass(),At.disabled,re,l.id,Z,G,i.aE.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,C.zoom)}var te;Z.destroy(),G.destroy()}let Dc=i.a9.create();function vf(h){let r=h._camera.getWorldToCamera(h.worldSize,1),l=i.a9.multiply([],r,h.globeMatrix);i.a9.invert(l,l);let f=[0,0,0],g=[0,1,0,0];return i.aa.transformMat4(g,g,l),f[0]=g[0],f[1]=g[1],f[2]=g[2],i.Q.normalize(f,f),f}function la({width:h,height:r,anchor:l,textOffset:f,textScale:g},v){let{horizontalAlign:b,verticalAlign:T}=i.bi(l),D=-(b-.5)*h,C=-(T-.5)*r,P=i.bh(l,f);return new i.P((D/g+P[0])*v,(C/g+P[1])*v)}function fg(h,r,l,f,g,v,b,T,D,C,P){let O=h.text.placedSymbolArray,F=h.text.dynamicLayoutVertexArray,N=h.icon.dynamicLayoutVertexArray,U={},V=h.getProjection(),$=Nu(T,V,v),G=v.elevation,Z=V.upVectorScale(T.canonical,v.center.lat,v.worldSize).metersToTile;F.clear();for(let te=0;te<O.length;te++){let ee=O.get(te),{tileAnchorX:re,tileAnchorY:H,numGlyphs:Y}=ee,ce=ee.hidden||!ee.crossTileID||h.allowVerticalPlacement&&!ee.placedOrientation?null:f[ee.crossTileID];if(ce){let ae=0,fe=0,we=0;if(G){let Te=G?G.getAtTileOffset(T,re,H):0,[ne,Ae,rt]=V.upVector(T.canonical,re,H);ae=Te*ne*Z,fe=Te*Ae*Z,we=Te*rt*Z}let[de,xe,Ee,he]=Bi(ee.projectedAnchorX+ae,ee.projectedAnchorY+fe,ee.projectedAnchorZ+we,l?$:b),ye=Ru(v.getCameraToCenterDistance(V),he),ze=g.evaluateSizeForFeature(h.textSizeData,C,ee)*ye/i.bf;l&&(ze*=h.tilePixelRatio/D);let me=la(ce,ze);l?({x:de,y:xe,z:Ee}=V.projectTilePoint(re+me.x,H+me.y,T.canonical),[de,xe,Ee]=Bi(de+ae,xe+fe,Ee+we,b)):(r&&me._rotate(-v.angle),de+=me.x,xe+=me.y,Ee=0);let be=h.allowVerticalPlacement&&ee.placedOrientation===i.b9.vertical?Math.PI/2:0;for(let Te=0;Te<Y;Te++)i.bc(F,de,xe,Ee,be);P&&ee.associatedIconIndex>=0&&(U[ee.associatedIconIndex]={x:de,y:xe,z:Ee,angle:be})}else ra(Y,F)}if(P){N.clear();let te=h.icon.placedSymbolArray;for(let ee=0;ee<te.length;ee++){let re=te.get(ee),{numGlyphs:H}=re,Y=U[ee];if(re.hidden||!Y)ra(H,N);else{let{x:ce,y:ae,z:fe,angle:we}=Y;for(let de=0;de<H;de++)i.bc(N,ce,ae,fe,we)}}h.icon.dynamicLayoutVertexBuffer.updateData(N)}h.text.dynamicLayoutVertexBuffer.updateData(F)}function Mc(h,r,l,f,g,v,b={}){let T=l.paint.get("icon-translate"),D=l.paint.get("text-translate"),C=l.paint.get("icon-translate-anchor"),P=l.paint.get("text-translate-anchor"),O=l.layout.get("icon-rotation-alignment"),F=l.layout.get("text-rotation-alignment"),N=l.layout.get("icon-pitch-alignment"),U=l.layout.get("text-pitch-alignment"),V=l.layout.get("icon-keep-upright"),$=l.layout.get("text-keep-upright"),G=l.paint.get("icon-color-saturation"),Z=l.paint.get("icon-color-contrast"),te=l.paint.get("icon-color-brightness-min"),ee=l.paint.get("icon-color-brightness-max"),re=h.context,H=re.gl,Y=h.transform,ce=O==="map",ae=F==="map",fe=N==="map",we=U==="map",de=l.layout.get("symbol-sort-key").constantOr(1)!==void 0,xe=!1,Ee=h.depthModeForSublayer(0,Tt.ReadOnly),he=[i.a8(Y.center.lng),i.ah(Y.center.lat)],ye=l.layout.get("text-variable-anchor"),ze=Y.projection.name==="globe",me=[],be=[0,-1,0];for(let Te of f){let ne=r.getTile(Te),Ae=ne.getBucket(l);if(!Ae||Ae.projection.name==="mercator"&&ze||Ae.fullyClipped)continue;let rt=Ae.projection.name==="globe",ut=rt?i.W(Y.zoom):0,yt=Nu(Te,Ae.getProjection(),Y),pt=Y.calculatePixelsToTileUnitsMatrix(ne),wt=ye&&Ae.hasTextData(),nn=Ae.hasIconTextFit()&&wt&&Ae.hasIconData(),Lt=Ae.getProjection().createInversionMatrix(Y,Te.canonical),cn=()=>{let Gt=ce&&l.layout.get("symbol-placement")!=="point",qt=[],Zn=Gt||nn,$n=l.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&fe&&qt.push("PITCH_WITH_MAP_TERRAIN"),rt&&(qt.push("PROJECTION_GLOBE_VIEW"),Zn&&qt.push("PROJECTED_POS_ON_VIEWPORT")),$n>0&&qt.push("ICON_TRANSITION"),Ae.icon.zOffsetVertexBuffer&&qt.push("Z_OFFSET"),G===0&&Z===0&&te===0&&ee===1||qt.push("COLOR_ADJUSTMENT");let Kt=Ae.icon.programConfigurations.get(l.id),Bt=h.getOrCreateProgram(Ae.sdfIcons?"symbolSDF":"symbolIcon",{config:Kt,defines:qt}),vi,Yr=ne.imageAtlasTexture?ne.imageAtlasTexture.size:[0,0],Or=Ae.iconSizeData,Xr=i.b8(Or,Y.zoom),xi=fe||Y.pitch!==0,oi=ic(yt,ne.tileID.canonical,fe,ce,Y,Ae.getProjection(),pt),Lr=Ko(yt,ne.tileID.canonical,fe,ce,Y,Ae.getProjection(),pt),Ur=h.translatePosMatrix(Lr,ne,T,C,!0),$r=h.translatePosMatrix(yt,ne,T,C),Fo=Zn?Dc:oi,vo=ce&&!fe&&!Gt,No=be;!ze&&!Y.mercatorFromTransition||ce||(No=vf(Y));let zo=rt?No:be;if(Ae.sdfIcons&&!Ae.iconsInText)vi=rl(Or.kind,Xr,vo,fe,h,$r,Fo,Ur,!1,Yr,!0,Te,ut,he,Lt,zo,Ae.getProjection());else{let rs=l.getColorAdjustmentMatrix(G,Z,te,ee);vi=mf(Or.kind,Xr,vo,fe,h,$r,Fo,Ur,!1,Yr,Te,ut,he,Lt,zo,Ae.getProjection(),rs,$n)}let ks=ne.imageAtlasTexture?ne.imageAtlasTexture:null,Ji=l.layout.get("icon-size").constantOr(0)!==1||Ae.iconsNeedLinear,Vc=Ae.sdfIcons||h.options.rotating||h.options.zooming||Ji||xi?H.LINEAR:H.NEAREST,fl=Ae.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,Uc=h.terrain&&fe&&Gt?i.a9.invert(i.a9.create(),oi):Dc;if(Gt&&Ae.icon){let rs=Y.elevation,kr=rs?rs.getAtTileOffsetFunc(Te,Y.center.lat,Y.worldSize,Ae.getProjection()):null,$c=oc(yt,ne.tileID.canonical,fe,ce,Y,Ae.getProjection(),pt);Lu(Ae,yt,h,!1,$c,Lr,fe,V,kr,Te)}return{program:Bt,buffers:Ae.icon,uniformValues:vi,atlasTexture:ks,atlasTextureIcon:null,atlasInterpolation:Vc,atlasInterpolationIcon:null,isSDF:Ae.sdfIcons,hasHalo:fl,tile:ne,labelPlaneMatrixInv:Uc}},rn=()=>{let Gt=ae&&l.layout.get("symbol-placement")!=="point",qt=[],Zn=Gt||ye||nn;h.terrainRenderModeElevated()&&we&&qt.push("PITCH_WITH_MAP_TERRAIN"),rt&&(qt.push("PROJECTION_GLOBE_VIEW"),Zn&&qt.push("PROJECTED_POS_ON_VIEWPORT")),Ae.text.zOffsetVertexBuffer&&qt.push("Z_OFFSET");let $n=Ae.text.programConfigurations.get(l.id),Kt=h.getOrCreateProgram(Ae.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:$n,defines:qt}),Bt,vi=[0,0],Yr=null,Or=Ae.textSizeData;Ae.iconsInText&&(vi=ne.imageAtlasTexture?ne.imageAtlasTexture.size:[0,0],Yr=ne.imageAtlasTexture?ne.imageAtlasTexture:null,Bt=we||Y.pitch!==0||h.options.rotating||h.options.zooming||Or.kind==="composite"||Or.kind==="camera"?H.LINEAR:H.NEAREST);let Xr=ne.glyphAtlasTexture?ne.glyphAtlasTexture.size:[0,0],xi=i.b8(Or,Y.zoom),oi=ic(yt,ne.tileID.canonical,we,ae,Y,Ae.getProjection(),pt),Lr=Ko(yt,ne.tileID.canonical,we,ae,Y,Ae.getProjection(),pt),Ur=h.translatePosMatrix(Lr,ne,D,P,!0),$r=h.translatePosMatrix(yt,ne,D,P),Fo=Zn?Dc:oi,vo=ae&&!we&&!Gt,No=be;!ze&&!Y.mercatorFromTransition||ae||(No=vf(Y));let zo=rt?No:be,ks;ks=Ae.iconsInText?As(Or.kind,xi,vo,we,h,$r,Fo,Ur,Xr,vi,Te,ut,he,Lt,zo,Ae.getProjection()):rl(Or.kind,xi,vo,we,h,$r,Fo,Ur,!0,Xr,!0,Te,ut,he,Lt,zo,Ae.getProjection());let Ji=ne.glyphAtlasTexture?ne.glyphAtlasTexture:null,Vc=H.LINEAR,fl=l.paint.get("text-halo-width").constantOr(1)!==0,Uc=h.terrain&&we&&Gt?i.a9.invert(i.a9.create(),oi):Dc;if(Gt&&Ae.text){let rs=Y.elevation,kr=rs?rs.getAtTileOffsetFunc(Te,Y.center.lat,Y.worldSize,Ae.getProjection()):null,$c=oc(yt,ne.tileID.canonical,we,ae,Y,Ae.getProjection(),pt);Lu(Ae,yt,h,!0,$c,Lr,we,$,kr,Te)}return{program:Kt,buffers:Ae.text,uniformValues:ks,atlasTexture:Ji,atlasTextureIcon:Yr,atlasInterpolation:Vc,atlasInterpolationIcon:Bt,isSDF:!0,hasHalo:fl,tile:ne,labelPlaneMatrixInv:Uc}},er=Ae.icon.segments.get().length,Cn=Ae.text.segments.get().length,Sr=er&&!b.onlyText?cn():null,xr=Cn&&!b.onlyIcons?rn():null,Un=l.paint.get("icon-opacity").constantOr(1),Pn=l.paint.get("text-opacity").constantOr(1);if(de&&Ae.canOverlap){xe=!0;let Gt=Un&&!b.onlyText?Ae.icon.segments.get():[],qt=Pn&&!b.onlyIcons?Ae.text.segments.get():[];for(let Zn of Gt)me.push({segments:new i.aE([Zn]),sortKey:Zn.sortKey,state:Sr});for(let Zn of qt)me.push({segments:new i.aE([Zn]),sortKey:Zn.sortKey,state:xr})}else b.onlyText||me.push({segments:Un?Ae.icon.segments:new i.aE([]),sortKey:0,state:Sr}),b.onlyIcons||me.push({segments:Pn?Ae.text.segments:new i.aE([]),sortKey:0,state:xr})}xe&&me.sort((Te,ne)=>Te.sortKey-ne.sortKey);for(let Te of me){let ne=Te.state;if(ne)if(h.terrain&&h.terrain.setupElevationDraw(ne.tile,ne.program,{useDepthForOcclusion:Y.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ne.labelPlaneMatrixInv}),re.activeTexture.set(H.TEXTURE0),ne.atlasTexture&&ne.atlasTexture.bind(ne.atlasInterpolation,H.CLAMP_TO_EDGE,!0),ne.atlasTextureIcon&&(re.activeTexture.set(H.TEXTURE1),ne.atlasTextureIcon&&ne.atlasTextureIcon.bind(ne.atlasInterpolationIcon,H.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,ne.program),ne.hasHalo){let Ae=ne.uniformValues;Ae.u_is_halo=1,rh(ne.buffers,Te.segments,l,h,ne.program,Ee,g,v,Ae,2),Ae.u_is_halo=0}else{if(ne.isSDF){let Ae=ne.uniformValues;ne.hasHalo&&(Ae.u_is_halo=1,rh(ne.buffers,Te.segments,l,h,ne.program,Ee,g,v,Ae,1)),Ae.u_is_halo=0}rh(ne.buffers,Te.segments,l,h,ne.program,Ee,g,v,ne.uniformValues,1)}}}function rh(h,r,l,f,g,v,b,T,D,C){let P=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];g.draw(f,f.context.gl.TRIANGLES,v,b,T,At.disabled,D,l.id,h.layoutVertexBuffer,h.indexBuffer,r,l.paint,f.transform.zoom,h.programConfigurations.get(l.id),P,C)}function ih(h,r,l,f,g,v,b){let T=h.context.gl,D=l.paint.get("fill-pattern"),C=D&&D.constantOr(1),P,O,F,N,U;b?(O=C&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",P=T.LINES):(O=C?"fillPattern":"fill",P=T.TRIANGLES);for(let V of f){let $=r.getTile(V);if(C&&!$.patternsLoaded())continue;let G=$.getBucket(l);if(!G)continue;h.prepareDrawTile();let Z=G.programConfigurations.get(l.id),te=h.isTileAffectedByFog(V),ee=h.getOrCreateProgram(O,{config:Z,overrideFog:te});C&&(h.context.activeTexture.set(T.TEXTURE0),$.imageAtlasTexture&&$.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Z.updatePaintBuffers());let re=D.constantOr(null);if(re&&$.imageAtlas){let ce=$.imageAtlas.patternPositions[re.toString()];ce&&Z.setConstantPatternPositions(ce)}let H=h.translatePosMatrix(V.projMatrix,$,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),Y=l.paint.get("fill-emissive-strength");if(b){N=G.indexBuffer2,U=G.segments2;let ce=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];F=O==="fillOutlinePattern"&&C?es(H,Y,h,$,ce):av(H,Y,ce)}else N=G.indexBuffer,U=G.segments,F=C?Cs(H,Y,h,$):nl(H,Y);h.uploadCommonUniforms(h.context,ee,V.toUnwrapped()),ee.draw(h,P,g,h.stencilModeForClipping(V),v,At.disabled,F,l.id,G.layoutVertexBuffer,N,U,l.paint,h.transform.zoom,Z,void 0)}}function et(h,r,l,f,g,v,b,T){l.resetLayerRenderingStats(h);let D=h.context,C=D.gl,P=h.transform,O=l.paint.get("fill-extrusion-pattern"),F=O.constantOr(1),N=l.paint.get("fill-extrusion-opacity"),U=h.style.enable3dLights(),V=l.paint.get(U&&!F?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),$=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),V],G=l.layout.get("fill-extrusion-edge-radius"),Z=G>0&&!l.paint.get("fill-extrusion-rounded-roof"),te=Z?0:G,ee=P.projection.name==="globe"?i.cM():0,re=P.projection.name==="globe",H=re?i.W(P.zoom):0,Y=[i.a8(P.center.lng),i.ah(P.center.lat)],ce=l.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),ae=l.paint.get("fill-extrusion-flood-light-intensity"),fe=l.paint.get("fill-extrusion-vertical-scale"),we=Ds(h,l.paint.get("fill-extrusion-cutoff-fade-range")),de=l.paint.get("fill-extrusion-emissive-strength"),xe=[],Ee;re&&xe.push("PROJECTION_GLOBE_VIEW"),$[0]>0&&xe.push("FAUX_AO"),Z&&xe.push("ZERO_ROOF_RADIUS"),T&&xe.push("HAS_CENTROID"),ae>0&&xe.push("FLOOD_LIGHT"),we.shouldRenderCutoff&&xe.push("RENDER_CUTOFF");let he=h.renderPass==="shadow",ye=h.shadowRenderer,ze=he&&!!ye;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let me=[0,0,0];if(ye){let ne=h.style.directionalLight,Ae=h.style.ambientLight;ne&&Ae&&(me=af(ne,Ae)),Ee=xe.concat(["SHADOWS_SINGLE_CASCADE"])}let be=ze?"fillExtrusionDepth":F?"fillExtrusionPattern":"fillExtrusion",Te=l.getLayerRenderingStats();for(let ne of f){let Ae=r.getTile(ne),rt=Ae.getBucket(l);if(!rt||rt.projection.name!==P.projection.name)continue;let ut=!1;ye&&(ut=ye.getMaxCascadeForTile(ne.toUnwrapped())===0);let yt=h.isTileAffectedByFog(ne),pt=rt.programConfigurations.get(l.id),wt=h.getOrCreateProgram(be,{config:pt,defines:ut?Ee:xe,overrideFog:yt});if(h.terrain&&h.terrain.setupElevationDraw(Ae,wt,{useMeterToDem:!0}),!rt.centroidVertexBuffer){let Cn=wt.attributes.a_centroid_pos;Cn!==void 0&&C.vertexAttrib2f(Cn,0,0)}!he&&ye&&ye.setupShadows(Ae.tileID.toUnwrapped(),wt,"vector-tile",Ae.tileID.overscaledZ),F&&(h.context.activeTexture.set(C.TEXTURE0),Ae.imageAtlasTexture&&Ae.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),pt.updatePaintBuffers());let nn=O.constantOr(null);if(nn&&Ae.imageAtlas){let Cn=Ae.imageAtlas.patternPositions[nn.toString()];Cn&&pt.setConstantPatternPositions(Cn)}let Lt=l.paint.get("fill-extrusion-vertical-gradient"),cn;if(he&&ye){if(ts(Ae.tileID,rt,h))continue;let Cn=ye.calculateShadowPassMatrixFromTile(Ae.tileID.toUnwrapped());cn=_o(Cn,te,fe)}else{let Cn=h.translatePosMatrix(ne.expandedProjMatrix,Ae,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Sr=P.projection.createInversionMatrix(P,ne.canonical);cn=F?bc(Cn,h,Lt,N,$,te,ne,Ae,ee,H,Y,Sr,ce,fe):th(Cn,h,Lt,N,$,te,ne,ee,H,Y,Sr,ce,fe,ae,me,de)}h.uploadCommonUniforms(D,wt,ne.toUnwrapped(),null,we);let rn=rt.segments;if(P.projection.name==="mercator"&&!he&&(rn=rt.getVisibleSegments(Ae.tileID,h.terrain,h.transform.getFrustum(0)),!rn.get().length))continue;if(Te)if(he)for(let Cn of rn.get())Te.numRenderedVerticesInShadowPass+=Cn.primitiveLength;else for(let Cn of rn.get())Te.numRenderedVerticesInTransparentPass+=Cn.primitiveLength;let er=[];(h.terrain||T)&&er.push(rt.centroidVertexBuffer),re&&er.push(rt.layoutVertexExtBuffer),wt.draw(h,D.gl.TRIANGLES,g,v,b,At.backCCW,cn,l.id,rt.layoutVertexBuffer,rt.indexBuffer,rn,l.paint,h.transform.zoom,pt,er)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function ca(h,r,l,f,g,v,b,T,D,C,P,O,F,N,U,V,$,G,Z){let te=h.context,ee=te.gl,re=h.transform,H=h.transform.zoom,Y=[],ce=Ds(h,l.paint.get("fill-extrusion-cutoff-fade-range"));C==="clear"?(Y.push("CLEAR_SUBPASS"),Z&&(Y.push("CLEAR_FROM_TEXTURE"),te.activeTexture.set(ee.TEXTURE0),Z.bind(ee.LINEAR,ee.CLAMP_TO_EDGE))):C==="sdf"&&Y.push("SDF_SUBPASS"),$&&Y.push("HAS_CENTROID"),ce.shouldRenderCutoff&&Y.push("RENDER_CUTOFF");let ae=l.layout.get("fill-extrusion-edge-radius"),fe=(we,de,xe,Ee,he)=>{let ye=de.programConfigurations.get(l.id),ze=h.isTileAffectedByFog(we),me=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:ye,defines:Y,overrideFog:ze}),be=((ne,Ae,rt,ut,yt,pt,wt,nn,Lt,cn,rn)=>({u_matrix:Ae,u_opacity:rt,u_ao_pass:ut?1:0,u_meter_to_tile:yt,u_ao:pt,u_flood_light_intensity:wt,u_flood_light_color:nn,u_attenuation:Lt,u_edge_radius:cn,u_fb:0,u_fb_size:rn}))(0,Ee,P,D,he,[O,F*he],N,U,V,H>=17?0:ae*he,Z?Z.size[0]:0),Te=[];$&&Te.push(de.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(te,me,we.toUnwrapped(),null,ce),me.draw(h,te.gl.TRIANGLES,g,v,b,T,be,l.id,de.vertexBuffer,de.indexBuffer,xe,l.paint,H,ye,Te)};for(let we of f){let de=r.getTile(we),xe=de.getBucket(l);if(!xe||xe.projection.name!==re.projection.name||!xe.groundEffect||xe.groundEffect&&!xe.groundEffect.hasData())continue;let Ee=xe.groundEffect,he=1/xe.tileToMeter;{let ye=h.translatePosMatrix(we.projMatrix,de,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),ze=Ee.getDefaultSegment();fe(we,Ee,ze,ye,he)}if(G)for(let ye=0;ye<4;ye++){let ze=i.cN[ye](we),me=r.getTile(ze);if(!me)continue;let be=me.getBucket(l);if(!be||be.projection.name!==re.projection.name||!be.groundEffect||be.groundEffect&&!be.groundEffect.hasData())continue;let Te=be.groundEffect,ne,Ae;ye===0?(ne=[-i.Y,0,0],Ae=1):ye===1?(ne=[i.Y,0,0],Ae=0):ye===2?(ne=[0,-i.Y,0],Ae=3):(ne=[0,i.Y,0],Ae=2);let rt=Te.regionSegments[Ae];if(!rt)continue;let ut=new Float32Array(16);i.a9.translate(ut,we.projMatrix,ne),fe(we,Te,rt,h.translatePosMatrix(ut,de,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),he)}}}function xf(h,r,l,f,g,v,b){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();let T=v?v.findDEMTileFor(l):null;if(!(T&&T.dem||b))return;let D=G=>new i.P(Math.ceil((G+i.cQ)*i.cR),0),C=G=>{let Z=r.getSource().minzoom,te=re=>{let H=r.getTileByID(re);if(H&&H.hasData())return H.getBucket(g)},ee=[0,-1,1];for(let re of ee){if(G.overscaledZ+re<Z)continue;let H=te(G.calculateScaledKey(G.overscaledZ+re));if(H)return H}},P=[0,0,0],O=(G,Z)=>(P[0]=Math.min(G.min.y,Z.min.y),P[1]=Math.max(G.max.y,Z.max.y),P[2]=i.Y-Z.min.x>G.max.x?Z.min.x-i.Y:G.max.x,P),F=(G,Z)=>(P[0]=Math.min(G.min.x,Z.min.x),P[1]=Math.max(G.max.x,Z.max.x),P[2]=i.Y-Z.min.y>G.max.y?Z.min.y-i.Y:G.max.y,P),N=[(G,Z)=>O(G,Z),(G,Z)=>O(Z,G),(G,Z)=>F(G,Z),(G,Z)=>F(Z,G)],U=(G,Z,te,ee,re,H,Y)=>{if(!v)return 0;let ce=[[H?te:G,H?G:te,0],[H?te:Z,H?Z:te,0]],ae=Y<0?i.Y+Y:Y,fe=[H?ae:(G+Z)/2,H?(G+Z)/2:ae,0];return te===0&&Y<0||te!==0&&Y>0?v.getForTilePoints(re,[fe],!0,ee):ce.push(fe),v.getForTilePoints(l,ce,!0,T),Math.max(ce[0][2],ce[1][2],fe[2])/v.exaggeration()};for(let G=0;G<4;G++){let Z=f.borderFeatureIndices[G];if(Z.length===0)continue;let te=i.cN[G](l),ee=C(te);if(!(ee&&ee instanceof i.cO)||f.borderDoneWithNeighborZ[G]===ee.canonical.z)continue;ee.centroidVertexArray.length===0&&ee.createCentroidsBuffer();let re=v?v.findDEMTileFor(te):null;if(!(re&&re.dem||b))continue;let H=(G<2?1:5)-G,Y=ee.borderDoneWithNeighborZ[H]!==f.canonical.z,ce=ee.borderFeatureIndices[H],ae=0;if(f.canonical.z!==ee.canonical.z){for(let fe of Z)f.showCentroid(f.featuresOnBorder[fe]);if(Y)for(let fe of ce)ee.showCentroid(ee.featuresOnBorder[fe]);f.borderDoneWithNeighborZ[G]=ee.canonical.z,ee.borderDoneWithNeighborZ[H]=f.canonical.z}for(let fe of Z){let we=f.featuresOnBorder[fe],de=f.centroidData[we.centroidDataIndex],xe=we.borders[G],Ee;for(;ae<ce.length;){Ee=ee.featuresOnBorder[ce[ae]];let he=Ee.borders[H];if(he[1]>xe[0]+3||he[0]>xe[0]-3)break;ee.showCentroid(Ee),ae++}if(Ee&&ae<ce.length){let he=ae,ye=0;for(;!(Ee.borders[H][0]>xe[1]-3)&&(ye++,++ae!==ce.length);)Ee=ee.featuresOnBorder[ce[ae]];if(Ee=ee.featuresOnBorder[ce[he]],ye>1){let be=Ee.borders[H];Math.abs(xe[0]-be[0])<3&&Math.abs(xe[1]-be[1])<3&&(ye=1,ae=he+1)}else if(ye===0){f.showCentroid(we);continue}let ze=ee.centroidData[Ee.centroidDataIndex];b&&ye===1&&(((V=de).flags|($=ze).flags)&i.cP?(V.flags|=i.cP,$.flags|=i.cP):(V.flags&=~i.cP,$.flags&=~i.cP));let me=we.intersectsCount()>1||Ee.intersectsCount()>1;if(ye>1)ae=he,de.centroidXY=ze.centroidXY=new i.P(0,0);else if(re&&re.dem&&!me){let be=N[G](de,ze),Te=G%2?i.Y-1:0,ne=U(be[0],Math.min(i.Y-1,be[1]),Te,re,te,G<2,be[2]);de.centroidXY=ze.centroidXY=D(ne)}else me?de.centroidXY=ze.centroidXY=new i.P(0,0):(de.centroidXY=f.encodeBorderCentroid(we),ze.centroidXY=ee.encodeBorderCentroid(Ee));f.writeCentroidToBuffer(de),ee.writeCentroidToBuffer(ze)}else f.showCentroid(we)}f.borderDoneWithNeighborZ[G]=ee.canonical.z,ee.borderDoneWithNeighborZ[H]=f.canonical.z}var V,$;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(h)}let bf=[1,0,0],pg=[0,1,0],oh=[0,0,1];function ts(h,r,l){let f=l.transform,g=l.shadowRenderer;if(!g)return!0;let v=h.toUnwrapped(),b=f.tileSize*g._cascades[l.currentShadowCascade].scale,T=r.maxHeight;if(f.elevation){let V=f.elevation.getMinMaxForTile(h);V&&(T+=V.max)}let D=[...g.shadowDirection];D[2]=-D[2];let C=g.computeSimplifiedTileShadowVolume(v,T,b,D);if(!C)return!1;let P=[bf,pg,oh,D,[D[0],0,D[2]],[0,D[1],D[2]]],O=f.projection.name==="globe",F=f.scaleZoom(b),N=i.bt.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,F,!O),U=g.getCurrentCascadeFrustum();return N.intersectsPrecise(C.vertices,C.planes,P)===0||U.intersectsPrecise(C.vertices,C.planes,P)===0}function sh(h){return[h[0]*i.cS,h[1]*i.cS,h[2]*i.cS,0]}function ns(h,r,l,f,g,v,b,T,D){let C=f.getSource(),P=l.globeSharedBuffers;if(!P)return;let O,F,N;if(r&&(O=f.getTile(r)),C instanceof i.as?(F=C.texture,N=i.co(0,0,l.transform)):O&&r&&(F=O.texture,N=i.co(r.canonical.z,r.canonical.x,l.transform)),!F||!N)return;h||(N=i.a9.scale(i.a9.create(),N,[1,-1,1]));let U=l.context,V=U.gl,$=g.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR,G=l.colorModeForDrapableLayerRenderPass(v),Z=b.defines;Z.push("GLOBE_POLES");let te=new Tt(V.LEQUAL,Tt.ReadWrite,l.depthRangeFor3D),ee=Float32Array.from(l.transform.expandedFarZProjMatrix),re=Float32Array.from(i.aW(i.cn(new i.bv(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),U.activeTexture.set(V.TEXTURE0),F.bind($,V.CLAMP_TO_EDGE),U.activeTexture.set(V.TEXTURE1),F.bind($,V.CLAMP_TO_EDGE),F.useMipmap&&U.extTextureFilterAnisotropic&&l.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);let[H,Y,ce,ae]=r?P.getPoleBuffers(r.canonical.z,!1):P.getPoleBuffers(0,!0),fe=g.paint.get("raster-elevation"),we;h?(we=H,l.renderDefaultNorthPole=fe!==0):(we=Y,l.renderDefaultSouthPole=fe!==0);let de=sh(b.mix),xe=((he,ye,ze,me,be,Te,ne,Ae,rt,ut,yt,pt,wt)=>hg(he,ye,ze,new Float32Array(16),new Float32Array(9),[0,0],me,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Te,[0,0],Ae,2,ut,yt,pt,1,0,wt))(ee,re,N,i.W(l.transform.zoom),0,g,0,fe,0,de,b.offset,b.range,v),Ee=l.getOrCreateProgram("raster",{defines:Z});l.uploadCommonUniforms(U,Ee,null),Ee.draw(l,V.TRIANGLES,te,D,G,T,xe,g.id,we,ce,ae)}function ah(h){let r=h._nearZ,l=h.projection.farthestPixelDistance(h),f=l-r,g=.2*h.height,v=r+g;return[r,l,(v-g-r)/f,(v-r)/f]}function il(h,r,l,f){if(h)return r instanceof Qe&&h instanceof Au?r.getTextureDescriptor(h,l,!0):{texture:h.texture,mix:sh(f.mix),offset:f.offset,buffer:0,tileSize:1}}function pv(h,r,l){if(!h)return null;let f=r.getTextureDescriptor(h,l,!0);if(!f)return null;let{texture:g,mix:v,offset:b,tileSize:T,buffer:D,format:C}=f;if(!g||!C)return null;let P=!1;return C==="uint32"&&(P=!0,v[3]=0,v=wc(i.cT,v,[0,l.paint.get("raster-particle-max-speed")]),b=pf(i.cT,b,[0,l.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[D/(T+2*D),T/(T+2*D)],tileSize:T,scalarData:P,scale:v,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[C]]}}function mv(h){let r=h._nearZ,l=h.projection.farthestPixelDistance(h),f=l-r,g=.2*h.height,v=r+g;return[r,l,(v-g-r)/f,(v-r)/f]}let wf=new i.aA(1,0,0,1),gv=new i.aA(0,1,0,1),mg=new i.aA(0,0,1,1),gg=new i.aA(1,0,1,1),Tf=new i.aA(0,1,1,1);function ol(h,r,l,f,g,v,b){let T=h.context,D=h.transform,C=T.gl,P=D.projection.name==="globe",O=P?["PROJECTION_GLOBE_VIEW"]:[],F=i.a9.clone(l.projMatrix);if(P&&i.W(D.zoom)>0){let de=i.aV(l.canonical,D),xe=i.cU(de);F=i.a9.multiply(new Float32Array(16),D.globeMatrix,xe),i.a9.multiply(F,D.projMatrix,F)}let N=i.a9.create();N[12]+=2*g/(i.f.devicePixelRatio*D.width),N[13]+=2*v/(i.f.devicePixelRatio*D.height),i.a9.multiply(F,N,F);let U=h.getOrCreateProgram("debug",{defines:O}),V=r.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(V,U);let $=Tt.disabled,G=Ft.disabled,Z=h.colorModeForRenderPass(),te="$debug";T.activeTexture.set(C.TEXTURE0),h.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),P?V._makeGlobeTileDebugBuffers(h.context,D):V._makeDebugTileBoundsBuffers(h.context,D.projection);let ee=V._tileDebugBuffer||h.debugBuffer,re=V._tileDebugIndexBuffer||h.debugIndexBuffer,H=V._tileDebugSegments||h.debugSegments;if(U.draw(h,C.LINE_STRIP,$,G,Z,At.disabled,ff(F,f),te,ee,re,H,null,null,null,[V._globeTileDebugBorderBuffer]),b){let de=V.latestRawTileData,xe=Math.floor((de&&de.byteLength||0)/1024),Ee=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Ee+=` => ${l.overscaledZ}`),Ee+=` ${V.state}`,Ee+=` ${xe}kb`,function(he,ye){he.initDebugOverlayCanvas();let ze=he.debugOverlayCanvas,me=he.context.gl,be=he.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,ze.width,ze.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(ye,5,5),be.strokeText(ye,5,5),he.debugOverlayTexture.update(ze),he.debugOverlayTexture.bind(me.LINEAR,me.CLAMP_TO_EDGE)}(h,Ee)}let Y=r.getTile(l).tileSize,ce=512/Math.min(Y,512)*(l.overscaledZ/D.zoom)*.5,ae=V._tileDebugTextBuffer||h.debugBuffer,fe=V._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,we=V._tileDebugTextSegments||h.debugSegments;U.draw(h,C.TRIANGLES,$,G,Qt.alphaBlended,At.disabled,ff(F,i.aA.transparent,ce),te,ae,fe,we,null,null,null,[V._globeTileDebugTextBuffer])}function _g(h,r,l,f){lh(h,0,r+l/2,h.transform.width,l,f)}function yg(h,r,l,f){lh(h,r-l/2,0,l,h.transform.height,f)}function lh(h,r,l,f,g,v){let b=h.context,T=b.gl;T.enable(T.SCISSOR_TEST),T.scissor(r*i.f.devicePixelRatio,l*i.f.devicePixelRatio,f*i.f.devicePixelRatio,g*i.f.devicePixelRatio),b.clear({color:v}),T.disable(T.SCISSOR_TEST)}let vg=i.aB([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:_v}=vg;function yo(h,r,l,f){h.emplaceBack(r,l,f)}class xg{constructor(r){this.vertexArray=new i.cV,this.indices=new i.az,yo(this.vertexArray,-1,-1,1),yo(this.vertexArray,1,-1,1),yo(this.vertexArray,-1,1,1),yo(this.vertexArray,1,1,1),yo(this.vertexArray,-1,-1,-1),yo(this.vertexArray,1,-1,-1),yo(this.vertexArray,-1,1,-1),yo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,_v),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=i.aE.simpleSegment(0,0,36,12)}}function ua(h,r,l,f,g,v){let b=h.context.gl,T=r.paint.get("sky-atmosphere-color"),D=r.paint.get("sky-atmosphere-halo-color"),C=r.paint.get("sky-atmosphere-sun-intensity"),P=((O,F,N,U,V)=>({u_matrix_3f:O,u_sun_direction:F,u_sun_intensity:N,u_color_tint_r:[U.r,U.g,U.b,U.a],u_color_tint_m:[V.r,V.g,V.b,V.a],u_luminance:5e-5}))(i.ct.fromMat4(i.ct.create(),f),g,C,T,D);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+v,r.skyboxTexture,0),l.draw(h,b.TRIANGLES,Tt.disabled,Ft.disabled,Qt.unblended,At.frontCW,P,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}let Ef=i.aB([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ch{constructor(r){let l=new i.cW;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);let f=new i.az;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,Ef.members),this.indexBuffer=r.createIndexBuffer(f),this.segments=i.aE.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let If=i.aB([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class ha{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Df{constructor(r){this.colorModeAlphaBlendedWriteRGB=new Qt([1,Su,1,Su],i.aA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Qt([1,0,1,0],i.aA.transparent,[!1,!1,!1,!0]),this.params=new ha,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){let l=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ch(l);let f=this.params.sizeRange,g=this.params.intensityRange,v=function(P){let O=i.aC(30),F=[];for(let N=0;N<P;++N){let U=2*Math.PI*O(),V=Math.acos(1-2*O())-.5*Math.PI;F.push(i.Q.fromValues(Math.cos(V)*Math.cos(U),Math.cos(V)*Math.sin(U),Math.sin(V)))}return F}(this.params.starsCount),b=i.aC(300),T=new i.cX,D=new i.az,C=0;for(let P=0;P<v.length;++P){let O=i.Q.scale([],v[P],200),F=Math.max(0,1+.01*f*(1*b()-.5)),N=Math.max(0,1+.01*g*(1*b()-.5));T.emplaceBack(O[0],O[1],O[2],-1,-1,F,N),T.emplaceBack(O[0],O[1],O[2],1,-1,F,N),T.emplaceBack(O[0],O[1],O[2],1,1,F,N),T.emplaceBack(O[0],O[1],O[2],-1,1,F,N),D.emplaceBack(C+0,C+1,C+2),D.emplaceBack(C+0,C+2,C+3),C+=4}this.starsVx=l.createVertexBuffer(T,If.members),this.starsIdx=l.createIndexBuffer(D),this.starsSegments=i.aE.simpleSegment(0,0,T.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,l){let f=r.context,g=f.gl,v=r.transform,b=new Tt(g.LEQUAL,Tt.ReadOnly,[0,1]),T=i.W(v.zoom),D=l.properties.get("color").toArray01(),C=l.properties.get("high-color").toArray01(),P=l.properties.get("space-color").toArray01PremultipliedAlpha(),O=5e-4,F=i.cY(l.properties.get("horizon-blend"),0,1,O,.25),N=i.ci(r,f,v)&&F===O?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,U=r.frameCounter/1e3%1,V=i.Q.length(v.globeCenterInViewSpace),$=Math.sqrt(Math.pow(V,2)-Math.pow(N,2)),G=Math.acos($/V),Z=te=>{let ee=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];te&&ee.push("ALPHA_PASS");let re=r.getOrCreateProgram("globeAtmosphere",{defines:ee}),H=((ce,ae,fe,we,de,xe,Ee,he,ye,ze,me,be)=>({u_frustum_tl:ce,u_frustum_tr:ae,u_frustum_br:fe,u_frustum_bl:we,u_horizon:de,u_transition:xe,u_fadeout_range:Ee,u_color:he,u_high_color:ye,u_space_color:ze,u_temporal_offset:me,u_horizon_angle:be}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,T,F,D,C,P,U,G);r.uploadCommonUniforms(f,re);let Y=this.atmosphereBuffer;Y&&re.draw(r,g.TRIANGLES,b,Ft.disabled,te?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,At.backCW,H,te?"atmosphere_glow_alpha":"atmosphere_glow",Y.vertexBuffer,Y.indexBuffer,Y.segments)};Z(!1),Z(!0)}drawStars(r,l){let f=i.ad(l.properties.get("star-intensity"),0,1);if(f===0)return;let g=r.context,v=g.gl,b=r.transform,T=r.getOrCreateProgram("stars"),D=i.bl.identity([]);i.bl.rotateX(D,D,-b._pitch),i.bl.rotateZ(D,D,-b.angle),i.bl.rotateX(D,D,i.bm(b._center.lat)),i.bl.rotateY(D,D,-i.bm(b._center.lng));let C=i.a9.fromQuat(new Float32Array(16),D),P=i.a9.multiply([],b.starsProjMatrix,C),O=i.ct.fromMat4([],C),F=i.ct.invert([],O),N=[0,1,0];i.Q.transformMat3(N,N,F),i.Q.scale(N,N,this.params.sizeMultiplier);let U=[1,0,0];i.Q.transformMat3(U,U,F),i.Q.scale(U,U,this.params.sizeMultiplier);let V=($=N,G=U,Z=f,{u_matrix:Float32Array.from(P),u_up:$,u_right:G,u_intensity_multiplier:Z});var $,G,Z;r.uploadCommonUniforms(g,T),this.starsVx&&this.starsIdx&&T.draw(r,v.TRIANGLES,Tt.disabled,Ft.disabled,this.colorModeAlphaBlendedWriteRGB,At.disabled,V,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Mf(h,r){let l=[...h],f=r.cameraWorldSizeForFog/r.worldSize,g=i.a9.identity([]);return i.a9.scale(g,g,[f,f,1]),i.a9.multiply(l,g,l),i.a9.multiply(l,r.worldToFogMatrix,l),l}function Ps(h,r,l,f){let g=l.material,v=f.context,{baseColorTexture:b,metallicRoughnessTexture:T}=g.pbrMetallicRoughness,{normalTexture:D,occlusionTexture:C,emissionTexture:P}=g;function O(F,N,U){if(F&&(h.push(N),v.activeTexture.set(v.gl.TEXTURE0+U),F.gfxTexture)){let{minFilter:V,magFilter:$,wrapS:G,wrapT:Z}=F.sampler;F.gfxTexture.bindExtraParam(V,$,G,Z)}}O(b,"HAS_TEXTURE_u_baseColorTexture",Di.BaseColor),O(T,"HAS_TEXTURE_u_metallicRoughnessTexture",Di.MetallicRoughness),O(D,"HAS_TEXTURE_u_normalTexture",Di.Normal),O(C,"HAS_TEXTURE_u_occlusionTexture",Di.Occlusion),O(P,"HAS_TEXTURE_u_emissionTexture",Di.Emission),l.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(l.texcoordBuffer)),l.colorBuffer&&(h.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(l.colorBuffer)),l.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(l.normalBuffer)),l.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(l.pbrBuffer)),g.alphaMode!=="OPAQUE"&&g.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),g.defined||h.push("DIFFUSE_SHADED"),h.push("USE_STANDARD_DERIVATIVES")}function Rs(h,r,l,f,g,v){let b=l.paint.get("model-opacity"),T=r.context,D=new Tt(r.context.gl.LEQUAL,Tt.ReadWrite,r.depthRangeFor3D),C=r.transform,P=h.mesh,O=P.material,F=O.pbrMetallicRoughness,N=r.style.fog,U;U=r.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:i.a9.multiply([],f.zScaleMatrix,h.nodeModelMatrix),i.a9.multiply(U,f.negCameraPosMatrix,U);let V=i.a9.invert([],U);i.a9.transpose(V,V);let $=l.paint.get("model-emissive-strength").constantOr(0),G=nh(new Float32Array(h.worldViewProjection),new Float32Array(U),new Float32Array(V),null,r,b,F.baseColorFactor,O.emissiveFactor,F.metallicFactor,F.roughnessFactor,O,$,l),Z={defines:[]},te=[];Ps(Z.defines,te,P,r);let ee=r.shadowRenderer;ee&&(ee.useNormalOffset=!1);let re=null;if(N){let ce=Mf(h.nodeModelMatrix,r.transform);if(re=new Float32Array(ce),C.projection.name!=="globe"){let ae=P.aabb.min,fe=P.aabb.max,[we,de]=N.getOpacityForBounds(ce,ae[0],ae[1],fe[0],fe[1]);Z.overrideFog=we>=Dn||de>=Dn}}let H=Ds(r,l.paint.get("model-cutoff-fade-range"));H.shouldRenderCutoff&&Z.defines.push("RENDER_CUTOFF");let Y=r.getOrCreateProgram("model",Z);r.uploadCommonUniforms(T,Y,null,re,H),r.renderPass!=="shadow"&&ee&&ee.setupShadowsFromMatrix(h.nodeModelMatrix,Y),Y.draw(r,T.gl.TRIANGLES,D,g,v,P.material.doubleSided?At.disabled:At.backCCW,G,l.id,P.vertexBuffer,P.indexBuffer,P.segments,l.paint,r.transform.zoom,void 0,te)}function Sc(h,r,l,f,g,v,b){let T;T=h.projection.name==="globe"?i.c_(l,h):[...l],i.a9.multiply(T,T,r.matrix);let D=i.a9.multiply([],f,T);if(r.meshes)for(let C of r.meshes){if(C.material.alphaMode!=="BLEND"){b.push({mesh:C,depth:0,modelIndex:g,worldViewProjection:D,nodeModelMatrix:T});continue}let P=i.Q.transformMat4([],C.centroid,D);P[2]>0&&v.push({mesh:C,depth:P[2],modelIndex:g,worldViewProjection:D,nodeModelMatrix:T})}if(r.children)for(let C of r.children)Sc(h,C,l,f,g,v,b)}function Cc(h,r,l,f){let g=l.shadowRenderer;if(!g)return;let v=g.getShadowPassDepthMode(),b=g.getShadowPassColorMode(),T=g.calculateShadowPassMatrixFromMatrix(r),D=dg(T);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,v,Ft.disabled,b,At.backCCW,D,f.id,h.vertexBuffer,h.indexBuffer,h.segments,f.paint,l.transform.zoom,void 0,void 0)}function Ac(h,r,l){let f=r.updateZoomBasedPaintProperties(),g=function(v,b,T){let D,C,P,O=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&O>0){let F=v.terrain,N=F.findDEMTileFor(T);N&&N.dem?D=i.d0.create(F,T,N):O=0}if(O===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),O===b.validForExaggeration&&(O===0||D&&D._demTile&&D._demTile.tileID===b.validForDEMTile.id&&D._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(let F in b.instancesPerModel){let N=b.instancesPerModel[F];for(let U=0;U<N.instancedDataArray.length;++U){let V=(D?O*D.getElevationAt(0|N.instancedDataArray.float32[16*U],0|N.instancedDataArray.float32[16*U+1],!0,!0):0)+N.instancesEvaluatedElevation[U];N.instancedDataArray.float32[16*U+6]=V,C=C?Math.min(b.terrainElevationMin,V):V,P=P?Math.max(b.terrainElevationMax,V):V}}return b.terrainElevationMin=C||0,b.terrainElevationMax=P||0,b.validForExaggeration=O,b.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,r,l);(f||g)&&(r.uploaded=!1,r.upload(h.context))}let Ui={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.bV([0,0,0],[i.Y,i.Y,0])};function uh(h,r){let l=1<<h.canonical.z,f=r.getFreeCameraOptions().position,g=r.elevation,v=h.canonical.x/l,b=(h.canonical.x+1)/l,T=h.canonical.y/l,D=(h.canonical.y+1)/l,C=r._centerAltitude;if(g){let N=g.getMinMaxForTile(h);N&&N.max>C&&(C=N.max)}let P=i.ad(f.x,v,b)-f.x,O=i.ad(f.y,T,D)-f.y,F=i.bo(C,r.center.lat)-f.z;return r._zoomFromMercatorZ(Math.sqrt(P*P+O*O+F*F))}function hh(h,r,l,f,g,v,b){let T=h.context,D=h.renderPass==="shadow",C=h.shadowRenderer,P=D&&C?C.getShadowPassDepthMode():new Tt(T.gl.LEQUAL,Tt.ReadWrite,h.depthRangeFor3D),O=h.isTileAffectedByFog(v);if(l.meshes)for(let F of l.meshes){let N=["MODEL_POSITION_ON_GPU"],U=[],V,$,G;f.instancedDataArray.length>20&&N.push("INSTANCED_ARRAYS");let Z=Ds(h,r.paint.get("model-cutoff-fade-range"));if(Z.shouldRenderCutoff&&N.push("RENDER_CUTOFF"),D&&C)V=h.getOrCreateProgram("modelDepth",{defines:N}),$=dg(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(l.matrix)),G=C.getShadowPassColorMode();else{Ps(N,U,F,h),V=h.getOrCreateProgram("model",{defines:N,overrideFog:O});let ee=F.material,re=ee.pbrMetallicRoughness,H=r.paint.get("model-opacity"),Y=r.paint.get("model-emissive-strength").constantOr(0);$=nh(v.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,h,H,re.baseColorFactor,ee.emissiveFactor,re.metallicFactor,re.roughnessFactor,ee,Y,r,g),C&&(b.shadowUniformsInitialized?V.setShadowUniformValues(T,C.getShadowUniformValues()):(C.setupShadows(v.toUnwrapped(),V,"model-tile",v.overscaledZ),b.shadowUniformsInitialized=!0)),G=Z.shouldRenderCutoff||H<1||ee.alphaMode!=="OPAQUE"?Qt.alphaBlended:Qt.unblended}h.uploadCommonUniforms(T,V,v.toUnwrapped(),null,Z);let te=F.material.doubleSided?At.disabled:At.backCCW;if(f.instancedDataArray.length>20)U.push(f.instancedDataBuffer),V.draw(h,T.gl.TRIANGLES,P,Ft.disabled,G,te,$,r.id,F.vertexBuffer,F.indexBuffer,F.segments,r.paint,h.transform.zoom,void 0,U,f.instancedDataArray.length);else{let ee=D?"u_instance":"u_normal_matrix";for(let re=0;re<f.instancedDataArray.length;++re)$[ee]=new Float32Array(f.instancedDataArray.arrayBuffer,64*re,16),V.draw(h,T.gl.TRIANGLES,P,Ft.disabled,G,te,$,r.id,F.vertexBuffer,F.indexBuffer,F.segments,r.paint,h.transform.zoom,void 0,U)}}if(l.children)for(let F of l.children)hh(h,r,F,f,g,v,b)}let dh=[1,-1,1];function Pc(h,r,l,f){if(!l.modelManager)return!0;let g=l.modelManager;if(!l.shadowRenderer)return!0;let v=l.shadowRenderer,b=r.aabb,T=!0,D=h.maxHeight;if(D===0){let P=0;for(let O in h.instancesPerModel){let F=g.getModel(O,f);F?P=Math.max(P,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):T=!1}D=h.maxScale*P*1.41+h.maxVerticalOffset,T&&(h.maxHeight=D)}b.max[2]=D,b.min[2]+=h.terrainElevationMin,b.max[2]+=h.terrainElevationMax,i.Q.transformMat4(b.min,b.min,r.tileMatrix),i.Q.transformMat4(b.max,b.max,r.tileMatrix);let C=b.intersects(v.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=C===2),C===0}class bg{}class wg{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,l,f){{let O=this._storage.get(l.id);if(O)return O.lastUsedFrameIdx=r,O.buf}let g=f.gl,v=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),b=new ArrayBuffer(v),T=new Int16Array(b);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));let D=new i.d2;for(let O=0;O<v/2;O+=3){let F=T[O],N=T[O+1],U=T[O+2];D.emplaceBack(F,N),D.emplaceBack(N,U),D.emplaceBack(U,F)}let C=f.bindVertexArrayOES.current,P=new bg;return P.buf=new hr(f,D),P.lastUsedFrameIdx=r,this._storage.set(l.id,P),f.bindVertexArrayOES.set(C),P.buf}update(r){for(let[l,f]of this._storage)r-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(l))}destroy(){for(let[r,l]of this._storage)l.buf.destroy(),this._storage.delete(r)}}let fh={symbol:function(h,r,l,f,g){if(h.renderPass!=="translucent")return;let v=Ft.disabled,b=h.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(C,P,O,F,N,U,V){let $=P.transform,G=N==="map",Z=U==="map";for(let te of C){let ee=F.getTile(te),re=ee.getBucket(O);if(!re||!re.text||!re.text.segments.get().length)continue;let H=i.b8(re.textSizeData,$.zoom),Y=Nu(te,re.getProjection(),$),ce=$.calculatePixelsToTileUnitsMatrix(ee),ae=ic(Y,ee.tileID.canonical,Z,G,$,re.getProjection(),ce),fe=re.hasIconTextFit()&&re.hasIconData();if(H){let we=Math.pow(2,$.zoom-ee.tileID.overscaledZ);fg(re,G,Z,V,i.cE,$,ae,te,we,H,fe)}}}(f,h,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),g);let T=l.paint.get("icon-opacity").constantOr(1)!==0,D=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(T||D)?Mc(h,r,l,f,v,b):(T&&Mc(h,r,l,f,v,b,{onlyIcons:!0}),D&&Mc(h,r,l,f,v,b,{onlyText:!0})),r.map.showCollisionBoxes&&(yf(h,r,l,f,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),yf(h,r,l,f,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,r,l,f){if(h.renderPass!=="translucent")return;let g=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),b=l.paint.get("circle-stroke-opacity"),T=l.layout.get("circle-sort-key").constantOr(1)!==void 0,D=l.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(v.constantOr(1)===0||b.constantOr(1)===0))return;let C=h.context,P=C.gl,O=h.transform,F=h.depthModeForSublayer(0,Tt.ReadOnly),N=Ft.disabled,U=h.colorModeForDrapableLayerRenderPass(D),V=O.projection.name==="globe",$=[i.a8(O.center.lng),i.ah(O.center.lat)],G=[];for(let te=0;te<f.length;te++){let ee=f[te],re=r.getTile(ee),H=re.getBucket(l);if(!H||H.projection.name!==O.projection.name)continue;let Y=H.programConfigurations.get(l.id),ce=i.cF(l),ae=h.isTileAffectedByFog(ee);V&&ce.push("PROJECTION_GLOBE_VIEW");let fe=h.getOrCreateProgram("circle",{config:Y,defines:ce,overrideFog:ae}),we=H.layoutVertexBuffer,de=H.globeExtVertexBuffer,xe=H.indexBuffer,Ee=O.projection.createInversionMatrix(O,ee.canonical),he={programConfiguration:Y,program:fe,layoutVertexBuffer:we,globeExtVertexBuffer:de,indexBuffer:xe,uniformValues:i.cG(h,ee,re,Ee,$,l),tile:re};if(T){let ye=H.segments.get();for(let ze of ye)G.push({segments:new i.aE([ze]),sortKey:ze.sortKey,state:he})}else G.push({segments:H.segments,sortKey:0,state:he})}T&&G.sort((te,ee)=>te.sortKey-ee.sortKey);let Z={useDepthForOcclusion:O.depthOcclusionForSymbolsAndCircles};for(let te of G){let{programConfiguration:ee,program:re,layoutVertexBuffer:H,globeExtVertexBuffer:Y,indexBuffer:ce,uniformValues:ae,tile:fe}=te.state,we=te.segments;h.terrain&&h.terrain.setupElevationDraw(fe,re,Z),h.uploadCommonUniforms(C,re,fe.tileID.toUnwrapped()),re.draw(h,P.TRIANGLES,F,N,U,At.disabled,ae,l.id,H,ce,we,l.paint,O.zoom,ee,[Y])}},heatmap:function(h,r,l,f){if(l.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){let g=h.context,v=g.gl,b=Ft.disabled,T=new Qt([v.ONE,v.ONE,v.ONE,v.ONE],i.aA.transparent,[!0,!0,!0,!0]);(function(N,U,V,$){let G=N.gl,Z=U.width*$,te=U.height*$;N.activeTexture.set(G.TEXTURE1),N.viewport.set([0,0,Z,te]);let ee=V.heatmapFbo;if(!ee||ee&&(ee.width!==Z||ee.height!==te)){ee&&ee.destroy();let re=G.createTexture();G.bindTexture(G.TEXTURE_2D,re),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),ee=V.heatmapFbo=N.createFramebuffer(Z,te,!0,null),function(H,Y,ce,ae,fe,we){let de=H.gl;de.texImage2D(de.TEXTURE_2D,0,H.extRenderToTextureHalfFloat?de.RGBA16F:de.RGBA,fe,we,0,de.RGBA,H.extRenderToTextureHalfFloat?de.HALF_FLOAT:de.UNSIGNED_BYTE,null),ae.colorAttachment.set(ce)}(N,0,re,ee,Z,te)}else G.bindTexture(G.TEXTURE_2D,ee.colorAttachment.get()),N.bindFramebuffer.set(ee.framebuffer)})(g,h,l,h.transform.projection.name==="globe"?.5:.25),g.clear({color:i.aA.transparent});let D=h.transform,C=D.projection.name==="globe",P=C?["PROJECTION_GLOBE_VIEW"]:[],O=C?At.frontCCW:At.disabled,F=[i.a8(D.center.lng),i.ah(D.center.lat)];for(let N=0;N<f.length;N++){let U=f[N];if(r.hasRenderableParent(U))continue;let V=r.getTile(U),$=V.getBucket(l);if(!$||$.projection.name!==D.projection.name)continue;let G=h.isTileAffectedByFog(U),Z=$.programConfigurations.get(l.id),te=h.getOrCreateProgram("heatmap",{config:Z,defines:P,overrideFog:G}),{zoom:ee}=h.transform;h.terrain&&h.terrain.setupElevationDraw(V,te),h.uploadCommonUniforms(g,te,U.toUnwrapped());let re=D.projection.createInversionMatrix(D,U.canonical);te.draw(h,v.TRIANGLES,Tt.disabled,b,T,O,cv(h,U,V,re,F,ee,l.paint.get("heatmap-intensity")),l.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,l.paint,h.transform.zoom,Z,C?[$.globeExtVertexBuffer]:null)}g.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(g,v){let b=g.context,T=b.gl,D=v.heatmapFbo;if(!D)return;b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,D.colorAttachment.get()),b.activeTexture.set(T.TEXTURE1);let C=v.colorRampTexture;C||(C=v.colorRampTexture=new i.T(b,v.colorRamp,T.RGBA)),C.bind(T.LINEAR,T.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,T.TRIANGLES,Tt.disabled,Ft.disabled,g.colorModeForRenderPass(),At.disabled,((P,O,F,N)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,v),v.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,v.paint,g.transform.zoom)}(h,l))},line:function(h,r,l,f){if(h.renderPass!=="translucent")return;let g=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(g.constantOr(1)===0||v.constantOr(1)===0)return;let b=l.paint.get("line-emissive-strength"),T=h.depthModeForSublayer(0,Tt.ReadOnly),D=h.colorModeForDrapableLayerRenderPass(b),C=h.terrain&&h.terrain.renderingToTexture?1:i.f.devicePixelRatio,P=l.paint.get("line-dasharray"),O=P.constantOr(1),F=l.layout.get("line-cap"),N=l.paint.get("line-pattern"),U=N.constantOr(1),V=l.paint.get("line-opacity").constantOr(1)!==1,$=!U&&V,G=l.paint.get("line-gradient"),Z=U?"linePattern":"line",te=h.context,ee=te.gl,re=i.cH(l);h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&($=!1);for(let H of f){let Y=r.getTile(H);if(U&&!Y.patternsLoaded())continue;let ce=Y.getBucket(l);if(!ce)continue;h.prepareDrawTile();let ae=ce.programConfigurations.get(l.id),fe=h.isTileAffectedByFog(H),we=h.getOrCreateProgram(Z,{config:ae,defines:re,overrideFog:fe}),de=N.constantOr(null);if(de&&Y.imageAtlas){let Te=Y.imageAtlas.patternPositions[de.toString()];Te&&ae.setConstantPatternPositions(Te)}let xe=P.constantOr(null),Ee=F.constantOr(null);if(!U&&xe&&Ee&&Y.lineAtlas){let Te=Y.lineAtlas.getDash(xe,Ee);Te&&ae.setConstantPatternPositions(Te)}let[he,ye]=l.paint.get("line-trim-offset");(Ee==="round"||Ee==="square")&&he!==ye&&(he===0&&(he-=1),ye===1&&(ye+=1));let ze=h.terrain?H.projMatrix:null,me=U?i.cI(h,Y,l,ze,C,[he,ye]):i.cJ(h,Y,l,ze,ce.lineClipsArray.length,C,[he,ye]);if(G){let Te=ce.gradients[l.id],ne=Te.texture;if(l.gradientVersion!==Te.version){let Ae=256;if(l.stepInterpolant){let rt=r.getSource().maxzoom,ut=H.canonical.z===rt?Math.ceil(1<<h.transform.maxZoom-H.canonical.z):1;Ae=i.ad(i.cK(ce.maxLineLength/i.Y*1024*ut),256,te.maxTextureSize)}Te.gradient=i.cL({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Ae,image:Te.gradient||void 0,clips:ce.lineClipsArray}),Te.texture?Te.texture.update(Te.gradient):Te.texture=new i.T(te,Te.gradient,ee.RGBA),Te.version=l.gradientVersion,ne=Te.texture}te.activeTexture.set(ee.TEXTURE1),ne.bind(l.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}O&&(te.activeTexture.set(ee.TEXTURE0),Y.lineAtlasTexture&&Y.lineAtlasTexture.bind(ee.LINEAR,ee.REPEAT),ae.updatePaintBuffers()),U&&(te.activeTexture.set(ee.TEXTURE0),Y.imageAtlasTexture&&Y.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),ae.updatePaintBuffers()),h.uploadCommonUniforms(te,we,H.toUnwrapped());let be=Te=>{we.draw(h,ee.TRIANGLES,T,Te,D,At.disabled,me,l.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,l.paint,h.transform.zoom,ae,[ce.layoutVertexBuffer2,ce.patternVertexBuffer])};if($){let Te=h.stencilModeForClipping(H).ref;Te===0&&h.terrain&&te.clear({stencil:0});let ne={func:ee.EQUAL,mask:255};me.u_alpha_discard_threshold=.8,be(new Ft(ne,Te,255,ee.KEEP,ee.KEEP,ee.INVERT)),me.u_alpha_discard_threshold=0,be(new Ft(ne,Te,255,ee.KEEP,ee.KEEP,ee.KEEP))}else be(h.stencilModeForClipping(H))}$&&(h.resetStencilClippingMasks(),h.terrain&&te.clear({stencil:0}))},fill:function(h,r,l,f){let g=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(v.constantOr(1)===0)return;let b=l.paint.get("fill-emissive-strength"),T=h.colorModeForDrapableLayerRenderPass(b),D=l.paint.get("fill-pattern"),C=h.opaquePassEnabledForLayer()&&!D.constantOr(1)&&g.constantOr(i.aA.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===C){let P=h.depthModeForSublayer(1,h.renderPass==="opaque"?Tt.ReadWrite:Tt.ReadOnly);ih(h,r,l,f,P,T,!1)}if(h.renderPass==="translucent"&&l.paint.get("fill-antialias")){let P=h.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,Tt.ReadOnly);ih(h,r,l,f,P,T,!0)}},"fill-extrusion":function(h,r,l,f){let g=l.paint.get("fill-extrusion-opacity"),v=h.context,b=v.gl,T=h.terrain,D=T&&T.renderingToTexture;if(g===0)return;let C=h.conflationActive&&h.layerUsedInConflation(l,r.getSource());if(C&&function(P,O,F,N){for(let U of N){let V=O.getTile(U).getBucket(F);V&&(V.updateReplacement(U,P.replacementSource),V.uploadCentroid(P.context))}}(h,r,l,f),T||C)for(let P of f){let O=r.getTile(P).getBucket(l);O&&xf(h.context,r,P,O,l,T,C)}if(h.renderPass==="shadow"&&h.shadowRenderer){let P=h.shadowRenderer;if(T&&g<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.Z)return;let O=P.getShadowPassDepthMode(),F=P.getShadowPassColorMode();et(h,r,l,f,O,Ft.disabled,F,C)}else if(h.renderPass==="translucent"){let P=!l.paint.get("fill-extrusion-pattern").constantOr(1),O=l.paint.get("fill-extrusion-color").constantOr(i.aA.white);if(!D&&O.a!==0){let F=new Tt(h.context.gl.LEQUAL,Tt.ReadWrite,h.depthRangeFor3D);g===1&&P?et(h,r,l,f,F,Ft.disabled,Qt.unblended,C):(et(h,r,l,f,F,Ft.disabled,Qt.disabled,C),et(h,r,l,f,F,h.stencilModeFor3D(),h.colorModeForRenderPass(),C),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&P&&(!T&&h.transform.projection.name!=="globe"||D)){let F=l.paint.get("fill-extrusion-opacity"),N=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),U=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),V=l.paint.get("fill-extrusion-flood-light-intensity"),$=l.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),G=N>0&&U>0,Z=V>0,te=(re,H,Y)=>(1-Y)*re+Y*H,ee=re=>{let H=h.depthModeForSublayer(1,Tt.ReadOnly,b.LEQUAL,!0),Y=l.paint.get(re?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ce=te(.1,3,Y),ae=h._showOverdrawInspector;if(!ae){let fe=new Ft({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),we=new Qt([b.ONE,b.ONE,b.ONE,b.ONE],i.aA.transparent,[!1,!1,!1,!0],b.MIN);ca(h,r,l,f,H,fe,we,At.disabled,re,"sdf",F,N,U,V,$,ce,C,!1)}{let fe=ae?Ft.disabled:new Ft({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),we=ae?h.colorModeForRenderPass():new Qt([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],i.aA.transparent,[!0,!0,!0,!0]);ca(h,r,l,f,H,fe,we,At.disabled,re,"color",F,N,U,V,$,ce,C,!1)}};if(D){let re=(H,Y,ce)=>{let ae=h.depthModeForSublayer(1,Tt.ReadOnly,b.LEQUAL,!1),fe=l.paint.get(H?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),we=te(.1,3,fe);{let de=new Qt([b.ONE,b.ONE,b.ONE,b.ONE],i.aA.transparent,[!1,!1,!1,!0]);ca(h,r,l,f,ae,Ft.disabled,de,At.disabled,H,"clear",F,N,U,V,$,we,C,Y)}{let de=new Ft({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),xe=new Qt([b.ONE,b.ONE,b.ONE,b.ONE],i.aA.transparent,[!1,!1,!1,!0],b.MIN);ca(h,r,l,f,ae,de,xe,At.disabled,H,"sdf",F,N,U,V,$,we,C,Y)}{let de=H?b.ZERO:b.ONE_MINUS_DST_ALPHA,xe=new Ft({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Ee=new Qt([de,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],i.aA.transparent,[!0,!0,!0,!0]);ca(h,r,l,f,ae,xe,Ee,At.disabled,H,"color",F,N,U,V,$,we,C,Y)}{let de=new Qt([b.ONE,b.ONE,b.ONE,H?b.ZERO:b.ONE],i.aA.transparent,[!1,!1,!1,!0],H?b.FUNC_ADD:b.MAX);ca(h,r,l,f,ae,Ft.disabled,de,At.disabled,H,"clear",F,N,U,V,$,we,C,Y,ce)}};if(G||Z){let H;if(h.prepareDrawTile(),T){let Y=T.drapeBufferSize[0],ce=T.drapeBufferSize[1];H=T.framebufferCopyTexture,H&&(!H||H.size[0]===Y&&H.size[1]===ce)||(H&&H.destroy(),H=T.framebufferCopyTexture=new i.T(v,new i.h({width:Y,height:ce}),b.RGBA)),H.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGBA,0,0,Y,ce,0)}G&&re(!0,!1,H),Z&&re(!1,!0,H)}}else G&&ee(!0),Z&&ee(!1)}}},hillshade:function(h,r,l,f){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;let g=h.context,v=h.terrain&&h.terrain.renderingToTexture,[b,T]=h.renderPass!=="translucent"||v?[{},f]:h.stencilConfigForOverlap(f);for(let D of T){let C=r.getTile(D);if(C.needsHillshadePrepare&&h.renderPass==="offscreen")Ka(h,C,l);else if(h.renderPass==="translucent"){let P=h.depthModeForSublayer(0,Tt.ReadOnly),O=l.paint.get("hillshade-emissive-strength"),F=h.colorModeForDrapableLayerRenderPass(O),N=v&&h.terrain?h.terrain.stencilModeForRTTOverlap(D):b[D.overscaledZ];xn(h,D,C,l,P,N,F)}}g.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,r,l,f,g,v){if(h.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;let b=h.transform.projection.name==="globe",T=l.paint.get("raster-elevation")!==0,D=T&&b;if(h.renderElevatedRasterBackface&&!D)return;let C=h.context,P=C.gl,O=r.getSource(),F=function(H,Y,ce,ae){let fe=Y.paint.get("raster-color"),we=H.type==="raster-array",de=[],xe=Y.paint.get("raster-resampling"),Ee=Y.paint.get("raster-color-mix"),he=Y.paint.get("raster-color-range"),ye=[Ee[0],Ee[1],Ee[2],0],ze=Ee[3],me=xe==="nearest"?ae.NEAREST:ae.LINEAR;if(we&&(de.push("RASTER_ARRAY"),fe||de.push("RASTER_COLOR"),xe==="linear"&&de.push("RASTER_ARRAY_LINEAR"),me=ae.NEAREST,!he&&H.rasterLayers)){let be=H.rasterLayers.find(({id:Te})=>Te===Y.sourceLayer);be&&be.fields&&be.fields.range&&(he=be.fields.range)}if(he=he||[0,1],fe){de.push("RASTER_COLOR"),ce.activeTexture.set(ae.TEXTURE2),Y.updateColorRamp(he);let be=Y.colorRampTexture;be||(be=Y.colorRampTexture=new i.T(ce,Y.colorRamp,ae.RGBA)),be.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}return{mix:ye,range:he,offset:ze,defines:de,resampling:me}}(O,l,C,P);if(O instanceof i.as&&!f.length&&!b)return;let N=l.paint.get("raster-emissive-strength"),U=h.colorModeForDrapableLayerRenderPass(N),V=h.terrain&&h.terrain.renderingToTexture,$=!h.options.moving,G=l.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(O instanceof i.as&&!f.length&&(O.onNorthPole||O.onSouthPole)){let H=T?h.stencilModeFor3D():Ft.disabled;return void ns(!!O.onNorthPole,null,h,r,l,N,F,At.disabled,H)}if(!f.length)return;let[Z,te]=O instanceof i.as||V?[{},f]:h.stencilConfigForOverlap(f),ee=te[te.length-1].overscaledZ;D&&F.defines.push("PROJECTION_GLOBE_VIEW"),T&&F.defines.push("RENDER_CUTOFF");let re=(H,Y,ce)=>{for(let ae of H){let fe=ae.toUnwrapped(),we=r.getTile(ae);if(V&&(!we||!we.hasData()))continue;C.activeTexture.set(P.TEXTURE0);let de=il(we,O,l,F);if(!de||!de.texture)continue;let{texture:xe,mix:Ee,offset:he,tileSize:ye,buffer:ze}=de,me,be;V?(me=Tt.disabled,be=ae.projMatrix):T?(me=new Tt(P.LEQUAL,Tt.ReadWrite,h.depthRangeFor3D),be=b?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(fe,$)):(me=h.depthModeForSublayer(ae.overscaledZ-ee,l.paint.get("raster-opacity")===1?Tt.ReadWrite:Tt.ReadOnly,P.LESS),be=h.transform.calculateProjMatrix(fe,$));let Te=h.terrain&&V?h.terrain.stencilModeForRTTOverlap(ae):Z[ae.overscaledZ],ne=v?0:l.paint.get("raster-fade-duration");we.registerFadeDuration(ne);let Ae=r.findLoadedParent(ae,0),rt=sa(we,Ae,r,h.transform,ne),ut,yt;h.terrain&&h.terrain.prepareDrawTile(),C.activeTexture.set(P.TEXTURE0),xe.bind(G,P.CLAMP_TO_EDGE),C.activeTexture.set(P.TEXTURE1),Ae?(Ae.texture&&Ae.texture.bind(G,P.CLAMP_TO_EDGE),ut=Math.pow(2,Ae.tileID.overscaledZ-we.tileID.overscaledZ),yt=[we.tileID.canonical.x*ut%1,we.tileID.canonical.y*ut%1]):xe.bind(G,P.CLAMP_TO_EDGE),xe.useMipmap&&C.extTextureFilterAnisotropic&&h.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);let pt=h.transform,wt,nn=T?ah(pt):[0,0,0,0],Lt,cn,rn,er,Cn,Sr=0;if(D&&O instanceof i.as&&O.coordinates.length>3)Lt=Float32Array.from(i.aW(i.cn(new i.bv(0,0,0)))),cn=Float32Array.from(pt.globeMatrix),rn=Float32Array.from(i.cj(pt)),er=[i.a8(pt.center.lng),i.ah(pt.center.lat)],wt=O.elevatedGlobePerspectiveTransform,Cn=O.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){let Gt=i.ck(ae.canonical);Sr=i.cl(Gt.getCenter().lat),Lt=Float32Array.from(i.aW(i.cn(ae.canonical))),cn=Float32Array.from(pt.globeMatrix),rn=Float32Array.from(i.cj(pt)),er=[i.a8(pt.center.lng),i.ah(pt.center.lat)],wt=[0,0],Cn=Float32Array.from(i.cm(ae.canonical,Gt,Sr,pt.worldSize/pt._pixelsPerMercatorPixel))}else wt=O instanceof i.as?O.perspectiveTransform:[0,0],Lt=new Float32Array(16),cn=new Float32Array(9),rn=new Float32Array(16),er=[0,0],Cn=new Float32Array(9);let xr=hg(be,Lt,cn,rn,Cn,yt||[0,0],i.W(h.transform.zoom),er,nn,ut||1,rt,l,wt,T?l.paint.get("raster-elevation"):0,2,Ee,he,F.range,ye,ze,N),Un=h.isTileAffectedByFog(ae),Pn=h.getOrCreateProgram("raster",{defines:F.defines,overrideFog:Un});if(h.uploadCommonUniforms(C,Pn,fe),O instanceof i.as){let Gt=O.elevatedGlobeVertexBuffer,qt=O.elevatedGlobeIndexBuffer;if(V||!b)O.boundsBuffer&&O.boundsSegments&&Pn.draw(h,P.TRIANGLES,me,Ft.disabled,U,At.disabled,xr,l.id,O.boundsBuffer,h.quadTriangleIndexBuffer,O.boundsSegments);else if(Gt&&qt){let Zn=pt.zoom<=i.bJ?O.elevatedGlobeSegments:O.getSegmentsForLongitude(pt.center.lng);Zn&&Pn.draw(h,P.TRIANGLES,me,Ft.disabled,U,Y,xr,l.id,Gt,qt,Zn)}}else if(D){me=new Tt(P.LEQUAL,Tt.ReadOnly,h.depthRangeFor3D);let Gt=h.globeSharedBuffers;if(Gt){let[qt,Zn,$n]=Gt.getGridBuffers(Sr,!1);Pn.draw(h,P.TRIANGLES,me,ce||Te,h.colorModeForRenderPass(),Y,xr,l.id,qt,Zn,$n)}}else{let{tileBoundsBuffer:Gt,tileBoundsIndexBuffer:qt,tileBoundsSegments:Zn}=h.getTileBoundsBuffers(we);Pn.draw(h,P.TRIANGLES,me,Te,U,At.disabled,xr,l.id,Gt,qt,Zn)}}if(!(O instanceof i.as)&&D)for(let ae of H){let fe=ae.canonical.y===(1<<ae.canonical.z)-1;ae.canonical.y===0&&ns(!0,ae,h,r,l,N,F,Y,ce||Ft.disabled),fe&&ns(!1,ae,h,r,l,N,F,Y===At.frontCW?At.backCW:At.frontCW,ce||Ft.disabled)}};D?re(te,h.renderElevatedRasterBackface?At.backCW:At.frontCW,h.stencilModeFor3D()):re(te,At.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,r,l,f,g,v){h.renderPass==="offscreen"&&function(b,T,D,C){if(!C.length)return;let P=b.context,O=P.gl,F=T.getSource();if(!(F instanceof Qe))return;let N=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count"))),U=D.particleFramebuffer;U?U.width!==N&&(U.destroy(),U=D.particleFramebuffer=P.createFramebuffer(N,N,!0,null)):U=D.particleFramebuffer=P.createFramebuffer(N,N,!0,null);let V=[];for(let Z of C){let te=T.getTile(Z);if(!(te instanceof Au))continue;let ee=pv(te,F,D);if(!ee)continue;let re=[te.tileSize,te.tileSize],H=D.tileFramebuffer;H||(H=D.tileFramebuffer=P.createFramebuffer(re[0],re[1],!0,null));let Y=te.rasterParticleState;Y||(Y=te.rasterParticleState=new Qm(P,Z,re,N));let ce=Y.update(D.lastInvalidatedAt);Y.particleTextureDimension!==N&&Y.setParticleTextureDimension(Z,N);let ae=Y.targetColorTexture;Y.targetColorTexture=Y.backgroundColorTexture,Y.backgroundColorTexture=ae;let fe=Y.particleTexture0;Y.particleTexture0=Y.particleTexture1,Y.particleTexture1=fe,V.push([Z,ee,Y,ce])}if(V.length===0)return;let $=i.f.now(),G=D.previousDrawTimestamp?.001*($-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=$,D.hasColorMap()){P.activeTexture.set(O.TEXTURE0+2);let Z=D.colorRampTexture;Z||(Z=D.colorRampTexture=new i.T(P,D.colorRamp,O.RGBA)),Z.bind(O.LINEAR,O.CLAMP_TO_EDGE)}P.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(Z,te,ee){let re=Z.context,H=re.gl,Y=te.tileFramebuffer;re.activeTexture.set(H.TEXTURE0);let ce={u_texture:0,u_opacity:1.05*(fe=te.paint.get("raster-particle-fade-opacity-factor"))/(fe+.05)},ae=Z.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var fe;for(let we of ee){let[,,de,xe]=we;Y.colorAttachment.set(de.targetColorTexture.texture),re.viewport.set([0,0,Y.width,Y.height]),re.clear({color:i.aA.transparent}),xe&&(de.backgroundColorTexture.bind(H.NEAREST,H.CLAMP_TO_EDGE),ae.draw(Z,H.TRIANGLES,Tt.disabled,Ft.disabled,Qt.alphaBlended,At.disabled,ce,te.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments))}}(b,D,V),function(Z,te,ee,re){let H=Z.context,Y=H.gl,ce=ee.tileFramebuffer,ae=Z.transform.projection.name==="globe",fe=ee.paint.get("raster-particle-max-speed");for(let we of re){let[de,xe,Ee]=we;H.activeTexture.set(Y.TEXTURE0+0),xe.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),ce.colorAttachment.set(Ee.targetColorTexture.texture);let he=Z.getOrCreateProgram("rasterParticleDraw",{defines:xe.defines,overrideFog:!1});H.activeTexture.set(Y.TEXTURE0+1);let ye=xe.scalarData?[]:[0,1,2,3].map(be=>i.cN[be](de));ye.push(de);let ze=de.canonical.x,me=de.canonical.y;for(let be of ye){let Te=te.getTile(ae?be.wrapped():be);if(!Te)continue;let ne=Te.rasterParticleState;if(!ne)continue;let Ae=be.canonical.x+(1<<be.canonical.z)*(be.wrap-de.wrap),rt=be.canonical.y;ne.particleTexture0.bind(Y.NEAREST,Y.CLAMP_TO_EDGE);let ut=Ec(1,ne.particleTexture0.size[0],[Ae-ze,rt-me],0,xe.texture.size,2,fe,xe.textureOffset,xe.scale,xe.offset);he.draw(Z,Y.POINTS,Tt.disabled,Ft.disabled,Qt.alphaBlended,At.disabled,ut,ee.id,ne.particleIndexBuffer,void 0,ne.particleSegment)}}}(b,T,D,V),P.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(Z,te,ee,re){let H=Z.context,Y=H.gl,ce=te.paint.get("raster-particle-max-speed"),ae=re*te.paint.get("raster-particle-speed-factor")*.3,fe=function(de){return Math.pow(de,6)}(.01+1*te.paint.get("raster-particle-reset-rate-factor")),we=te.particleFramebuffer;H.viewport.set([0,0,we.width,we.height]);for(let de of ee){let[,xe,Ee]=de;H.activeTexture.set(Y.TEXTURE0+0),xe.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),H.activeTexture.set(Y.TEXTURE0+1);let he=Ee.particleTexture0;he.bind(Y.NEAREST,Y.CLAMP_TO_EDGE);let ye=hv(1,he.size[0],0,xe.texture.size,ce,ae,fe,xe.textureOffset,xe.scale,xe.offset);we.colorAttachment.set(Ee.particleTexture1.texture),H.clear({color:i.aA.transparent}),Z.getOrCreateProgram("rasterParticleUpdate",{defines:xe.defines}).draw(Z,Y.TRIANGLES,Tt.disabled,Ft.disabled,Qt.unblended,At.disabled,ye,te.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments)}}(b,D,V,G)}(h,r,l,f),h.renderPass==="translucent"&&(function(b,T,D,C,P){let O=b.context,F=O.gl,N=!b.options.moving,U=b.transform.projection.name==="globe";if(!C.length)return;let[V,$]=b.stencilConfigForOverlap(C),G=[];U&&G.push("PROJECTION_GLOBE_VIEW");let Z=b.stencilModeFor3D();for(let te of $){let ee=te.toUnwrapped(),re=T.getTile(te);if(!re.rasterParticleState)continue;let H=re.rasterParticleState,Y=100;re.registerFadeDuration(Y);let ce=T.findLoadedParent(te,0),ae=sa(re,ce,T,b.transform,Y),fe,we;b.terrain&&b.terrain.prepareDrawTile(),O.activeTexture.set(F.TEXTURE0),H.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),O.activeTexture.set(F.TEXTURE1),ce&&ce.rasterParticleState?(ce.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),fe=Math.pow(2,ce.tileID.overscaledZ-re.tileID.overscaledZ),we=[re.tileID.canonical.x*fe%1,re.tileID.canonical.y*fe%1]):H.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);let de=U?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(ee,N),xe=b.transform,Ee=mv(xe),he=i.ck(te.canonical),ye=i.cl(he.getCenter().lat),ze,me,be,Te,ne;U?(ze=Float32Array.from(i.aW(i.cn(te.canonical))),me=Float32Array.from(xe.globeMatrix),be=Float32Array.from(i.cj(xe)),Te=[i.a8(xe.center.lng),i.ah(xe.center.lat)],ne=Float32Array.from(i.cm(te.canonical,he,ye,xe.worldSize/xe._pixelsPerMercatorPixel))):(ze=new Float32Array(16),me=new Float32Array(9),be=new Float32Array(16),Te=[0,0],ne=new Float32Array(9));let Ae=Tc(de,ze,me,be,ne,we||[0,0],i.W(b.transform.zoom),Te,Ee,fe||1,ae,250),rt=b.isTileAffectedByFog(te),ut=b.getOrCreateProgram("rasterParticle",{defines:G,overrideFog:rt});if(b.uploadCommonUniforms(O,ut,ee),U){let yt=new Tt(F.LEQUAL,Tt.ReadWrite,b.depthRangeFor3D),pt=0,wt=b.globeSharedBuffers;if(wt){let[nn,Lt,cn]=wt.getGridBuffers(ye,pt!==0);ut.draw(b,F.TRIANGLES,yt,Z,Qt.alphaBlended,At.backCCW,Ae,D.id,nn,Lt,cn)}}else{let yt=b.depthModeForSublayer(0,Tt.ReadOnly),pt=V[te.overscaledZ],{tileBoundsBuffer:wt,tileBoundsIndexBuffer:nn,tileBoundsSegments:Lt}=b.getTileBoundsBuffers(re);ut.draw(b,F.TRIANGLES,yt,pt,Qt.alphaBlended,At.disabled,Ae,D.id,wt,nn,Lt)}}b.resetStencilClippingMasks()}(h,r,l,f),h.style.map.triggerRepaint())},background:function(h,r,l,f){let g=l.paint.get("background-color"),v=l.paint.get("background-opacity"),b=l.paint.get("background-emissive-strength");if(v===0)return;let T=h.context,D=T.gl,C=h.transform,P=C.tileSize,O=l.paint.get("background-pattern");if(h.isPatternMissing(O,l.scope))return;let F=!O&&g.a===1&&v===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==F)return;let N=Ft.disabled,U=h.depthModeForSublayer(0,F==="opaque"?Tt.ReadWrite:Tt.ReadOnly),V=h.colorModeForDrapableLayerRenderPass(b),$=O?"backgroundPattern":"background",G,Z=f;Z||(G=h.getBackgroundTiles(),Z=Object.values(G).map(te=>te.tileID)),O&&(T.activeTexture.set(D.TEXTURE0),h.imageManager.bind(h.context,l.scope));for(let te of Z){let ee=h.isTileAffectedByFog(te),re=h.getOrCreateProgram($,{overrideFog:ee}),H=te.toUnwrapped(),Y=f?te.projMatrix:h.transform.calculateProjMatrix(H);h.prepareDrawTile();let ce=r?r.getTile(te):G?G[te.key]:new uo(te,P,C.zoom,h),ae=O?fv(Y,b,v,h,O,l.scope,{tileID:te,tileSize:P}):dv(Y,b,v,g);h.uploadCommonUniforms(T,re,H);let{tileBoundsBuffer:fe,tileBoundsIndexBuffer:we,tileBoundsSegments:de}=h.getTileBoundsBuffers(ce);re.draw(h,D.TRIANGLES,U,N,V,At.disabled,ae,l.id,fe,we,de)}},sky:function(h,r,l){let f=h._atmosphere?i.W(h.transform.zoom):1,g=l.paint.get("sky-opacity")*f;if(g===0)return;let v=h.context,b=l.paint.get("sky-type"),T=new Tt(v.gl.LEQUAL,Tt.ReadOnly,[0,1]),D=h.frameCounter/1e3%1;b==="atmosphere"?h.renderPass==="offscreen"?l.needsSkyboxCapture(h)&&(function(C,P,O,F){let N=C.context,U=N.gl,V=P.skyboxFbo;if(!V){V=P.skyboxFbo=N.createFramebuffer(32,32,!0,null),P.skyboxGeometry=new xg(N),P.skyboxTexture=N.gl.createTexture(),U.bindTexture(U.TEXTURE_CUBE_MAP,P.skyboxTexture),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR);for(let te=0;te<6;++te)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,U.RGBA,32,32,0,U.RGBA,U.UNSIGNED_BYTE,null)}N.bindFramebuffer.set(V.framebuffer),N.viewport.set([0,0,32,32]);let $=P.getCenter(C,!0),G=C.getOrCreateProgram("skyboxCapture"),Z=new Float64Array(16);i.a9.identity(Z),i.a9.rotateY(Z,Z,.5*-Math.PI),ua(C,P,G,Z,$,0),i.a9.identity(Z),i.a9.rotateY(Z,Z,.5*Math.PI),ua(C,P,G,Z,$,1),i.a9.identity(Z),i.a9.rotateX(Z,Z,.5*-Math.PI),ua(C,P,G,Z,$,2),i.a9.identity(Z),i.a9.rotateX(Z,Z,.5*Math.PI),ua(C,P,G,Z,$,3),i.a9.identity(Z),ua(C,P,G,Z,$,4),i.a9.identity(Z),i.a9.rotateY(Z,Z,Math.PI),ua(C,P,G,Z,$,5),N.viewport.set([0,0,C.width,C.height])}(h,l),l.markSkyboxValid(h)):h.renderPass==="sky"&&function(C,P,O,F,N){let U=C.context,V=U.gl,$=C.transform,G=C.getOrCreateProgram("skybox");U.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_CUBE_MAP,P.skyboxTexture);let Z=((te,ee,re,H,Y)=>({u_matrix:te,u_sun_direction:ee,u_cubemap:0,u_opacity:H,u_temporal_offset:Y}))($.skyboxMatrix,P.getCenter(C,!1),0,F,N);C.uploadCommonUniforms(U,G),G.draw(C,V.TRIANGLES,O,Ft.disabled,C.colorModeForRenderPass(),At.backCW,Z,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(h,l,T,g,D):b==="gradient"&&h.renderPass==="sky"&&function(C,P,O,F,N){let U=C.context,V=U.gl,$=C.transform,G=C.getOrCreateProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new xg(U)),U.activeTexture.set(V.TEXTURE0);let Z=P.colorRampTexture;Z||(Z=P.colorRampTexture=new i.T(U,P.colorRamp,V.RGBA)),Z.bind(V.LINEAR,V.CLAMP_TO_EDGE);let te=((ee,re,H,Y,ce)=>({u_matrix:ee,u_color_ramp:0,u_center_direction:re,u_radius:i.bm(H),u_opacity:Y,u_temporal_offset:ce}))($.skyboxMatrix,P.getCenter(C,!1),P.paint.get("sky-gradient-radius"),F,N);C.uploadCommonUniforms(U,G),G.draw(C,V.TRIANGLES,O,Ft.disabled,C.colorModeForRenderPass(),At.backCW,te,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(h,l,T,g,D)},debug:function(h,r,l,f,g,v){for(let b=0;b<l.length;b++)if(g){let C=new i.aA(f.r*.8,f.g*.8,f.b*.8,1);ol(h,r,l[b],f,-1,-1,v),ol(h,r,l[b],f,-1,1,v),ol(h,r,l[b],f,1,1,v),ol(h,r,l[b],f,1,-1,v),ol(h,r,l[b],C,0,0,v)}else ol(h,r,l[b],f,0,0,v)},custom:function(h,r,l,f){let g=h.context,v=l.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&l.isDraped(r)){if(h.renderPass==="offscreen"){let b=v.prerender;if(b){if(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){let T=h.transform.pointMerc;b.call(v,g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),i.W(h.transform.zoom),[T.x,T.y],h.transform.pixelsPerMeterRatio)}else b.call(v,g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){let T=v.renderToTile;if(T){let D=f[0].canonical,C=new i.O(D.x+f[0].wrap*(1<<D.z),D.y,D.z);g.setDepthMode(Tt.disabled),g.setStencilMode(Ft.disabled),g.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),T.call(v,g.gl,C),g.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(Ft.disabled);let b=v.renderingMode==="3d"?new Tt(h.context.gl.LEQUAL,Tt.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Tt.ReadOnly);if(g.setDepthMode(b),h.transform.projection.name==="globe"){let T=h.transform.pointMerc;v.render(g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),i.W(h.transform.zoom),[T.x,T.y],h.transform.pixelsPerMeterRatio)}else v.render(g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,r,l,f){if(h.renderPass==="opaque")return;let g=l.paint.get("model-opacity");if(g===0)return;let v=l.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!v||h.terrain&&g<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof i.Z))return;let b=h.shadowRenderer,T=l.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,T||(b.enabled=!1));let D=()=>{b&&(b.useNormalOffset=!0,T||(b.enabled=!0))},C=r.getSource();if(h.renderPass==="light-beam"&&C.type!=="batched-model")return;if(C.type==="vector"||C.type==="geojson")return function(G,Z,te,ee,re){let H=G.transform;if(H.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${H.projection.name} projection is not yet implemented`);let Y=H.getFreeCameraOptions().position;if(!G.modelManager)return;let ce=G.modelManager;te.modelManager=ce;let ae=G.shadowRenderer;if(!te._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let fe=te._unevaluatedLayout._values["model-id"],we=Ct({},te.layout.get("model-id").parameters);for(let de of ee){let xe=Z.getTile(de).getBucket(te);if(!xe||xe.projection.name!==H.projection.name)continue;let Ee=xe.getModelUris();Ee&&!xe.modelsRequested&&(ce.addModelsFromBucket(Ee,re),xe.modelsRequested=!0);let he=uh(de,H);we.zoom=he;let ye=fe.possiblyEvaluate(we);if(Ac(G,xe,de),Ui.shadowUniformsInitialized=!1,Ui.useSingleShadowCascade=!!ae&&ae.getMaxCascadeForTile(de.toUnwrapped())===0,G.renderPass==="shadow"&&ae){if(G.currentShadowCascade===1&&xe.isInsideFirstShadowMapFrustum)continue;let be=H.calculatePosMatrix(de.toUnwrapped(),H.worldSize);if(Ui.tileMatrix.set(be),Ui.shadowTileMatrix=Float32Array.from(ae.calculateShadowPassMatrixFromMatrix(be)),Ui.aabb.min.fill(0),Ui.aabb.max[0]=Ui.aabb.max[1]=i.Y,Ui.aabb.max[2]=0,Pc(xe,Ui,G,te.scope))continue}let ze=1<<de.canonical.z,me=[((Y.x-de.wrap)*ze-de.canonical.x)*i.Y,(Y.y*ze-de.canonical.y)*i.Y,Y.z*ze*i.Y];for(let be in xe.instancesPerModel){let Te=xe.instancesPerModel[be];Te.features.length>0&&(be=ye.evaluate(Te.features[0].feature,{}));let ne=ce.getModel(be,re);if(ne&&ne.uploaded)for(let Ae of ne.nodes)hh(G,te,Ae,Te,me,de,Ui)}}}(h,r,l,f,C.type==="vector"?l.scope:""),void D();if(!C.loaded())return;if(C.type==="batched-model")return function(G,Z,te,ee){te.resetLayerRenderingStats(G);let re=G.context,H=G.transform,Y=G.style.fog,ce=G.shadowRenderer;if(H.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${H.projection.name} projection is not yet implemented`);let ae=G.transform.getFreeCameraOptions().position,fe=i.Q.scale([],[ae.x,ae.y,ae.z],G.transform.worldSize);i.Q.negate(fe,fe);let we=i.a9.identity([]),de=i.cZ(H.center.lat,H.zoom),xe=i.a9.fromScaling([],[1,1,1/de]);i.a9.translate(we,we,fe);let Ee=te.paint.get("model-opacity"),he=new Tt(re.gl.LEQUAL,Tt.ReadWrite,G.depthRangeFor3D),ye=new Tt(re.gl.LEQUAL,Tt.ReadOnly,G.depthRangeFor3D),ze=new i.bV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),me=G.renderPass==="shadow",be=me&&ce?ce.getCurrentCascadeFrustum():H.getFrustum(H.scaleZoom(H.worldSize)),Te=te.getLayerRenderingStats(),ne=function(Ae,rt){for(let ut of ee){let yt=Z.getTile(ut).getBucket(te);if(!yt||!yt.uploaded)continue;let pt=!1;ce&&(pt=ce.getMaxCascadeForTile(ut.toUnwrapped())===0);let wt=H.calculatePosMatrix(ut.toUnwrapped(),H.worldSize),nn=yt.modelTraits;for(let Lt of yt.getNodesInfo()){if(Lt.hiddenByReplacement||!Lt.node.meshes)continue;let cn=Lt.evaluatedScale,rn=Lt.node,er=0;if(G.terrain&&rn.elevation&&(er=rn.elevation*G.terrain.exaggeration()),cn[0]<=1&&cn[1]<=1&&cn[2]<=1&&(()=>{let Kt=Lt.getLocalBounds();return ze.min=[...Kt.min],ze.max=[...Kt.max],ze.min[2]+=er,ze.max[2]+=er,i.Q.transformMat4(ze.min,ze.min,wt),i.Q.transformMat4(ze.max,ze.max,wt),ze})().intersects(be)===0)continue;let Cn=[...wt];i.a9.translate(Cn,Cn,[(rn.anchor?rn.anchor[0]:0)*(cn[0]-1),(rn.anchor?rn.anchor[1]:0)*(cn[1]-1),er]),i.Q.exactEquals(cn,i.c$)||i.a9.scale(Cn,Cn,cn);let Sr=i.a9.multiply([],Cn,rn.matrix),xr=i.a9.multiply([],xe,Cn);i.a9.multiply(xr,we,xr);let Un=i.a9.invert([],xr);i.a9.transpose(Un,Un),i.a9.scale(Un,Un,dh),xr=i.a9.multiply(xr,xr,rn.matrix);let Pn=G.renderPass==="light-beam",Gt=i.a9.multiply([],H.expandedFarZProjMatrix,Sr),qt=i.a9.multiply([],H.expandedFarZProjMatrix,Cn),Zn=nn&i.d1.HasMapboxMeshFeatures,$n=Zn?0:Lt.evaluatedRMEA[0][2];for(let Kt=0;Kt<rn.meshes.length;++Kt){let Bt=rn.meshes[Kt],vi=Kt===rn.lightMeshIndex,Yr=Gt;if(vi){if(!Pn&&!G.terrain&&G.shadowRenderer){G.currentLayer<G.firstLightBeamLayer&&(G.firstLightBeamLayer=G.currentLayer);continue}Yr=qt}else if(Pn)continue;let Or={defines:[]},Xr=[];if(Ps(Or.defines,Xr,Bt,G),Zn||Or.defines.push("DIFFUSE_SHADED"),pt&&Or.defines.push("SHADOWS_SINGLE_CASCADE"),Te&&(me?Te.numRenderedVerticesInShadowPass+=Bt.vertexArray.length:Te.numRenderedVerticesInTransparentPass+=Bt.vertexArray.length),me){Cc(Bt,Sr,G,te);continue}let xi=null;if(Y){let vo=Mf(Sr,G.transform);if(xi=new Float32Array(vo),H.projection.name!=="globe"){let No=Bt.aabb.min,zo=Bt.aabb.max,[ks,Ji]=Y.getOpacityForBounds(vo,No[0],No[1],zo[0],zo[1]);Or.overrideFog=ks>=Dn||Ji>=Dn}}let oi=Bt.material,Lr;oi.occlusionTexture&&oi.occlusionTexture.offsetScale&&(Lr=oi.occlusionTexture.offsetScale,Or.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!me&&ce&&(ce.useNormalOffset=!!Bt.normalBuffer);let Ur=G.getOrCreateProgram("model",Or);!me&&ce&&ce.setupShadowsFromMatrix(Cn,Ur,ce.useNormalOffset),G.uploadCommonUniforms(re,Ur,null,xi);let $r=oi.pbrMetallicRoughness;$r.metallicFactor=.9,$r.roughnessFactor=.5;let Fo=nh(new Float32Array(Yr),new Float32Array(xr),new Float32Array(Un),new Float32Array(rn.matrix),G,Ee,$r.baseColorFactor,oi.emissiveFactor,$r.metallicFactor,$r.roughnessFactor,oi,$n,te,[0,0,0],Lr);Ur.draw(G,re.gl.TRIANGLES,rt&&!vi?he:ye,Ft.disabled,Ae?vi||Ee<1||Lt.hasTranslucentParts?Qt.alphaBlended:Qt.unblended:Qt.disabled,At.backCCW,Fo,te.id,Bt.vertexBuffer,Bt.indexBuffer,Bt.segments,te.paint,G.transform.zoom,void 0,Xr)}}}};(function(Ae,rt,ut,yt){let pt=Ae.terrain?Ae.terrain.exaggeration():0,wt=Ae.transform.zoom;for(let nn of yt){let Lt=rt.getTile(nn).getBucket(ut);Lt&&(Ae.conflationActive&&Lt.updateReplacement(nn,Ae.replacementSource),Lt.evaluateScale(Ae,ut),Ae.terrain&&pt>0&&Lt.elevationUpdate(Ae.terrain,pt,nn,ut.source),Lt.needsReEvaluation(Ae,wt,ut)&&Lt.evaluate(ut))}})(G,Z,te,ee),Ee===1?ne(!0,!0):(ne(!1,!0),ne(!0,!1))}(h,r,l,f),void D();let P=C.getModels(),O=[],F=h.transform.getFreeCameraOptions().position,N=i.Q.scale([],[F.x,F.y,F.z],h.transform.worldSize);i.Q.negate(N,N);let U=[],V=[],$=0;for(let G of P){let Z=l.paint.get("model-rotation").constantOr(null),te=l.paint.get("model-scale").constantOr(null),ee=l.paint.get("model-translation").constantOr(null);G.computeModelMatrix(h,Z,te,ee,!0,!0,!1);let re=i.a9.identity([]),H=i.cZ(G.position.lat,h.transform.zoom),Y=i.a9.fromScaling([],[1,1,1/H]);i.a9.translate(re,re,N),O.push({zScaleMatrix:Y,negCameraPosMatrix:re});for(let ce of G.nodes)Sc(h.transform,ce,G.matrix,h.transform.expandedFarZProjMatrix,$,U,V);$++}if(U.sort((G,Z)=>Z.depth-G.depth),h.renderPass!=="shadow"){if(g===1)for(let G of V)Rs(G,h,l,O[G.modelIndex],Ft.disabled,h.colorModeForRenderPass());else{for(let G of V)Rs(G,h,l,O[G.modelIndex],Ft.disabled,Qt.disabled);for(let G of V)Rs(G,h,l,O[G.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(let G of U)Rs(G,h,l,O[G.modelIndex],Ft.disabled,h.colorModeForRenderPass());D()}else{for(let G of V)Cc(G.mesh,G.nodeModelMatrix,h,l);for(let G of U)Cc(G.mesh,G.nodeModelMatrix,h,l);D()}}},da={model:function(h,r,l){let f=r.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,f.type==="vector"?h.scope:""));if(f.type==="batched-model")return;let g=f.getModels();for(let v of g)v.upload(l.context)},raster:function(h,r,l){let f=r.getSource();if(!(f instanceof Qe&&f.loaded()))return;let g=h.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!g)return;let v=h.paint.get("raster-array-band")||f.getInitialBand(g);if(v==null)return;let b=r.getIds().map(T=>r.getTileByID(T));for(let T of b)T.updateNeeded(g,v)&&f.prepareTile(T,g,v)},"raster-particle":function(h,r,l){let f=r.getSource();if(!(f instanceof Qe&&f.loaded()))return;let g=h.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!g)return;let v=h.paint.get("raster-particle-array-band")||f.getInitialBand(g);if(v==null)return;let b=r.getIds().map(T=>r.getTileByID(T));for(let T of b)T.updateNeeded(g,v)&&f.prepareTile(T,g,v)}};class Tg{constructor(r,l,f,g){this.context=new Po(r,l),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._timeStamp=new Date().getTime(),this._averageFPS=0,this._fpsHistory=[],this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let v=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let b of v)this._debugParams.enabledLayers[b]=!0;g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),g.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),g.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let b of v)g.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],b);this.setup(),this.numSublayers=ho.maxUnderzooming+ho.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.d3,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ag(this),this._wireframeDebugCache=new wg,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(r,l){let f=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Vi(this,r));let g=this._terrain;this.transform.elevation=f?g:null,g.update(r,this.transform,l),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(r){let l=r.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[f,g]=l.getFovAdjustedRange(this.transform._fov);if(f>g)return void(this.transform.fogCullDistSq=null);let v=f+.78*(g-f);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,l){if(this.width=r*i.f.devicePixelRatio,this.height=l*i.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let f of this.style.order)this.style._mergedLayers[f].resize()}setup(){let r=this.context,l=new i.aQ;l.emplaceBack(0,0),l.emplaceBack(i.Y,0),l.emplaceBack(0,i.Y),l.emplaceBack(i.Y,i.Y),this.tileExtentBuffer=r.createVertexBuffer(l,i.aS.members),this.tileExtentSegments=i.aE.simpleSegment(0,0,4,2);let f=new i.aQ;f.emplaceBack(0,0),f.emplaceBack(i.Y,0),f.emplaceBack(0,i.Y),f.emplaceBack(i.Y,i.Y),this.debugBuffer=r.createVertexBuffer(f,i.aS.members),this.debugSegments=i.aE.simpleSegment(0,0,4,5);let g=new i.aQ;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(g,i.aS.members),this.viewportSegments=i.aE.simpleSegment(0,0,4,2);let v=new i.ay;v.emplaceBack(0,0,0,0),v.emplaceBack(i.Y,0,i.Y,0),v.emplaceBack(0,i.Y,0,i.Y),v.emplaceBack(i.Y,i.Y,i.Y,i.Y),this.mercatorBoundsBuffer=r.createVertexBuffer(v,i.aU.members),this.mercatorBoundsSegments=i.aE.simpleSegment(0,0,4,2);let b=new i.az;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(b);let T=new i.aR;for(let C of[0,1,3,2,0])T.emplaceBack(C);this.debugIndexBuffer=r.createIndexBuffer(T),this.emptyTexture=new i.T(r,new i.h({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=i.a9.create();let D=this.context.gl;this.stencilClearMode=new Ft({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,Tt.disabled,this.stencilClearMode,Qt.disabled,At.disabled,xc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,f){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(let D of f)if(this._tileClippingMaskIDs[D.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=l.id;let g=this.context,v=g.gl;this.nextStencilID+f.length>256&&this.clearStencil(),g.setColorMode(Qt.disabled),g.setDepthMode(Tt.disabled);let b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let T of f){let D=l.getTile(T),C=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:O,tileBoundsSegments:F}=this.getTileBoundsBuffers(D);b.draw(this,v.TRIANGLES,Tt.disabled,new Ft({func:v.ALWAYS,mask:0},C,255,v.KEEP,v.KEEP,v.REPLACE),Qt.disabled,At.disabled,xc(T.projMatrix),"$clipping",P,O,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let r=this.nextStencilID++,l=this.context.gl;return new Ft({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);let l=this.context.gl;return new Ft({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){let l=this.context.gl,f=r.sort((b,T)=>T.overscaledZ-b.overscaledZ),g=f[f.length-1].overscaledZ,v=f[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();let b={};for(let T=0;T<v;T++)b[T+g]=new Ft({func:l.GEQUAL,mask:255},T+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[b,f]}return[{[g]:Ft.disabled},f]}colorModeForRenderPass(){let r=this.context.gl;return this._showOverdrawInspector?new Qt([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new i.aA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Qt.unblended:Qt.alphaBlended}colorModeForDrapableLayerRenderPass(r){let l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Qt([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new i.aA(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,l,f,g=!1){if(!this.opaquePassEnabledForLayer()&&!g)return Tt.disabled;let v=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Tt(f||this.context.gl.LEQUAL,l,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){let r=new Date().getTime(),l=r-this._timeStamp;this._timeStamp=r,this._fpsHistory.push(l===0?0:1e3/l),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((f,g)=>f+g/this._fpsHistory.length,0))}render(r,l){this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=l;let f=this.style._mergedLayers,g=this.style.order.filter(H=>{let Y=f[H];return!(Y.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Y.type]}),v=g.map(H=>f[H]),b=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(i.f.now()),this.imageManager.beginFrame();let T=0,D=!1;for(let H in b){let Y=b[H];Y.used&&(Y.prepare(this.context),Y.getSource().usedInConflation&&++T)}for(let H of v)H.isHidden(this.transform.zoom)||this.prepareLayer(H);let C={},P={},O={},F={},N={};for(let H in b){let Y=b[H];C[H]=Y.getVisibleCoordinates(),P[H]=C[H].slice().reverse(),O[H]=Y.getVisibleCoordinates(!0).reverse(),F[H]=Y.getShadowCasterCoordinates(),N[H]=Y.sortCoordinatesByDistance(C[H])}let U=H=>{let Y=this.style.getLayerSourceCache(H);return Y&&Y.used?Y.getSource():null};if(T){let H=[];for(let Y of v)this.layerUsedInConflation(Y,U(Y))&&H.push(Y);if(H&&H.length>1){let Y=[];for(let ce of H){let ae=this.style.getLayerSourceCache(ce);ae&&ae.used&&ae.getSource().usedInConflation&&Y.push({layer:ce.fqid,cache:ae})}this.replacementSource.setSources(Y),D=!0}}D||this.replacementSource.clear(),this.conflationActive=D,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let H of v){let Y=H.cutoffRange();if(this.longestCutoffRange=Math.max(Y,this.longestCutoffRange),Y>0){let ce=U(H);ce&&(this.minCutoffZoom=Math.max(ce.minzoom,this.minCutoffZoom)),H.minzoom&&(this.minCutoffZoom=Math.max(H.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let H=0;H<v.length;H++)if(v[H].is3D()){this.opaquePassCutoff=H;break}let V=this.style&&this.style.fog;V?(this._fogVisible=V.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=V.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(O),this.opaquePassCutoff=0);let $=this._shadowRenderer;if($){$.updateShadowParameters(this.transform,this.style.directionalLight);for(let H in b)for(let Y of C[H]){let ce={min:0,max:0};this.terrain&&(ce=this.terrain.getMinMaxForTile(Y)||ce),$.addShadowReceiver(Y.toUnwrapped(),ce.min,ce.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.d4(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Df(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!i.d5(this.context.gl))return;this.renderPass="offscreen";for(let H of v){let Y=r.getLayerSourceCache(H);if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;let ce=Y?P[Y.id]:void 0;(H.type==="custom"||H.type==="raster"||H.type==="raster-particle"||H.isSky()||ce&&ce.length)&&this.renderLayer(this,Y,H,ce)}this.depthRangeFor3D=[0,1-(v.length+2)*this.numSublayers*this.depthEpsilon];let G=this.terrain;G&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&G.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,F)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let Z=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),te=(()=>{if(l.showOverdrawInspector)return i.aA.black;if(this.style.fog&&this.transform.projection.supportsFog&&!Z){let H=this.style.fog.properties.get("color").toArray01();return new i.aA(...H)}if(this.style.fog&&this.transform.projection.supportsFog&&Z){let H=this.style.fog.properties.get("space-color").toArray01();return new i.aA(...H)}return i.aA.transparent})();if(this.context.clear({color:te,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Z&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){let H=v[this.currentLayer],Y=r.getLayerSourceCache(H);if(H.isSky())continue;let ce=Y?(H.is3D()?N:P)[Y.id]:void 0;this._renderTileClippingMasks(H,Y,ce),this.renderLayer(this,Y,H,ce)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Z&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.W(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){let H=v[this.currentLayer],Y=r.getLayerSourceCache(H);H.isSky()&&this.renderLayer(this,Y,H,Y?P[Y.id]:void 0)}function ee(H,Y){let ce;return Y&&(ce=(H.type==="symbol"?O:H.is3D()?N:P)[Y.id]),ce}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<g.length;){let H=v[this.currentLayer];if(H.type==="raster"){let Y=r.getLayerSourceCache(H);this.renderLayer(this,Y,H,ee(H,Y))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let re=0;for($&&(re=$.getShadowCastingLayerCount());this.currentLayer<g.length;){let H=v[this.currentLayer],Y=r.getLayerSourceCache(H);if(H.isSky())++this.currentLayer;else if(G&&this.style.isLayerDraped(H)){if(H.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=G.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(H,Y,Y?C[Y.id]:void 0),this.renderLayer(this,Y,H,ee(H,Y)),!G&&$&&re>0&&H.hasShadowPass()&&--re==0&&($.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let ce=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ce;this.currentLayer++){let ae=v[this.currentLayer];if(!ae.hasLightBeamPass())continue;let fe=r.getLayerSourceCache(ae);this.renderLayer(this,fe,ae,fe?P[fe.id]:void 0)}this.currentLayer=ce,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let H=null;v.forEach(Y=>{let ce=r.getLayerSourceCache(Y);ce&&!Y.isHidden(this.transform.zoom)&&ce.getVisibleCoordinates().length&&(!H||H.getSource().maxzoom<ce.getSource().maxzoom)&&(H=ce)}),H&&this.options.showTileBoundaries&&fh.debug(this,H,H.getVisibleCoordinates(),i.aA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&fh.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.aA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(H){let Y=H.transform.padding;_g(H,H.transform.height-(Y.top||0),3,wf),_g(H,Y.bottom||0,3,gv),yg(H,Y.left||0,3,mg),yg(H,H.transform.width-(Y.right||0),3,gg);let ce=H.transform.centerPoint;(function(ae,fe,we,de){lh(ae,fe-1,we-10,2,20,de),lh(ae,fe-10,we-1,20,2,de)})(H,ce.x,H.transform.height-ce.y,Tf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),D||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);let{unsupportedLayers:l}=this.transform.projection,f=!l||!l.includes(r.type);if(da[r.type]&&(f||this.terrain&&r.type==="custom")){let g=this.style.getLayerSourceCache(r);da[r.type](r,g,this)}this.gpuTimingEnd()}renderLayer(r,l,f,g){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||g&&g.length)&&(this.id=f.id,this.gpuTimingStart(f),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(f.type)||r.terrain&&f.type==="custom")&&fh[f.type](r,l,f,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;let l=this.context.extTimerQuery,f=this.context.gl,g=this.gpuTimers[r.id];g||(g=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:f.createQuery()}),g.calls++,f.beginQuery(l.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let r=this.context.extTimerQuery,l=this.context.gl,f=l.createQuery();this.deferredRenderGpuTimeQueries.push(f),l.beginQuery(r.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){let r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){let l={};for(let f in r){let g=r[f],v=this.context.extTimerQuery,b=v.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(g.query),l[f]=b}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;let l=this.context.extTimerQuery,f=this.context.gl,g=0;for(let v of r)g+=l.getQueryParameter(v,f.QUERY_RESULT)/1e6,l.deleteQueryEXT(v);return g}translatePosMatrix(r,l,f,g,v){if(!f[0]&&!f[1])return r;let b=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(b){let C=Math.sin(b),P=Math.cos(b);f=[f[0]*P-f[1]*C,f[0]*C+f[1]*P]}let T=[v?f[0]:i.a6(l,f[0],this.transform.zoom),v?f[1]:i.a6(l,f[1],this.transform.zoom),0],D=new Float32Array(16);return i.a9.translate(D,r,T),D}saveTileTexture(r){let l=r.size[0],f=this._tileTextures[l];f?f.push(r):this._tileTextures[l]=[r]}getTileTexture(r){let l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r,l){return r===null||r!==void 0&&!this.imageManager.getPattern(r.toString(),l)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,l,f){let g=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,v=this.terrain&&this.terrain.exaggeration()===0,b=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||b.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?b.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):b.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT"),v&&b.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||g||l!==void 0&&!l||b.push("FOG","FOG_DITHERING"),g&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(r,l){this.cache=this.cache||{};let f=l&&l.defines||[],g=l&&l.config,v=this.currentGlobalDefines(r,l&&l.overrideFog,l&&l.overrideRtt).concat(f),b=Ki.cacheKey(go[r],r,v,g);return this.cache[b]||(this.cache[b]=new Ki(this.context,r,go[r],g,_f[r],v)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,l){if(this.style.enable3dLights()){let f=this.style.directionalLight,g=this.style.ambientLight;if(f&&g){let v=((b,T)=>{let D=b.properties.get("direction"),C=b.properties.get("color").toArray01(),P=b.properties.get("intensity"),O=T.properties.get("color").toArray01(),F=T.properties.get("intensity"),N=[D.x,D.y,D.z],U=i.cs(O,F),V=i.cs(C,P);return{u_lighting_ambient_color:U,u_lighting_directional_dir:N,u_lighting_directional_color:V,u_ground_radiance:ug(N,V,U)}})(f,g);l.setLightsUniformValues(r,v)}}}uploadCommonUniforms(r,l,f,g,v){if(this.uploadCommonLightUniforms(r,l),this.terrain&&this.terrain.renderingToTexture)return;let b=this.style.fog;if(b){let T=b.getOpacity(this.transform.pitch),D=((C,P,O,F,N,U,V,$,G,Z,te,ee)=>{let re=C.transform,H=P.properties.get("color").toArray01();H[3]=F;let Y=C.frameCounter/1e3%1,[ce,ae]=P.properties.get("vertical-range");return{u_fog_matrix:O?re.calculateFogTileMatrix(O):ee||C.identityMat,u_fog_range:P.getFovAdjustedRange(re._fov),u_fog_color:H,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ce,ae),ae],u_fog_temporal_offset:Y,u_frustum_tl:N,u_frustum_tr:U,u_frustum_br:V,u_frustum_bl:$,u_globe_pos:G,u_globe_radius:Z,u_viewport:te,u_globe_transition:i.W(re.zoom),u_is_globe:+(re.projection.name==="globe")}})(this,b,f,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.f.devicePixelRatio,this.transform.height*i.f.devicePixelRatio],g);l.setFogUniformValues(r,D)}v&&l.setCutoffUniformValues(r,v.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){let r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){let r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let r=this._backgroundTiles,l=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(let g of f)l[g.key]=r[g.key]||new uo(g,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(r,l){return!(!r.is3D()||r.minzoom&&r.minzoom>this.transform.zoom||r.sourceLayer!=="building"&&(!l||l.type!=="batched-model"))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[r.key];return l||(this._cachedTileFogOpacities[r.key]=l=this.style.fog.getOpacityForTile(r)),l[0]>=Dn||l[1]>=Dn}}function Eg(h,r){let l=!1,f=null,g=()=>{f=null,l&&(h(),f=setTimeout(g,r),l=!1)};return()=>(l=!0,f||g(),f)}class yv{constructor(r){this._hashName=r&&encodeURIComponent(r),i.a$(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Eg(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let r=this._map;if(!r)return"";let l=Ig(r);if(this._hashName){let f=this._hashName,g=!1,v=location.hash.slice(1).split("&").map(b=>{let T=b.split("=")[0];return T===f?(g=!0,`${T}=${l}`):b}).filter(b=>b);return g||v.push(`${f}=${l}`),`#${v.join("&")}`}return`#${l}`}_getCurrentHash(){let r=location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(l=f)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){let r=this._map;if(!r)return!1;let l=this._getCurrentHash();if(l.length>=3&&!l.some(f=>isNaN(f))){let f=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ig(h,r){let l=h.getCenter(),f=Math.round(100*h.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),b=Math.round(l.lng*v)/v,T=Math.round(l.lat*v)/v,D=h.getBearing(),C=h.getPitch(),P=r?`/${b}/${T}/${f}`:`${f}/${T}/${b}`;return(D||C)&&(P+="/"+Math.round(10*D)/10),C&&(P+=`/${Math.round(C)}`),P}let sl={linearity:.3,easing:i.d6(0,0,.3,1)},Sf=i.e({deceleration:2500,maxSpeed:1400},sl),Cf=i.e({deceleration:20,maxSpeed:1400},sl),Af=i.e({deceleration:1e3,maxSpeed:360},sl),Dg=i.e({deceleration:1e3,maxSpeed:90},sl);class Mg{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.f.now(),settings:r})}_drainInertiaBuffer(){let r=this._inertiaBuffer,l=i.f.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let l={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);let f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(l.pan.mag()){let v=Os(l.pan.mag(),f,i.e({},Sf,r||{}));g.offset=l.pan.mult(v.amount/l.pan.mag()),g.center=this._map.transform.center,ph(g,v)}if(l.zoom){let v=Os(l.zoom,f,Cf);g.zoom=this._map.transform.zoom+v.amount,ph(g,v)}if(l.bearing){let v=Os(l.bearing,f,Af);g.bearing=this._map.transform.bearing+i.ad(v.amount,-179,179),ph(g,v)}if(l.pitch){let v=Os(l.pitch,f,Dg);g.pitch=this._map.transform.pitch+v.amount,ph(g,v)}if(g.zoom||g.bearing){let v=l.pinchAround===void 0?l.around:l.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function ph(h,r){(!h.duration||h.duration<r.duration)&&(h.duration=r.duration,h.easing=r.easing)}function Os(h,r,l){let{maxSpeed:f,linearity:g,deceleration:v}=l,b=i.ad(h*g/(r/1e3),-f,f),T=Math.abs(b)/(v*g);return{easing:l.easing,duration:1e3*T,amount:b*(T/2)}}class Qr extends i.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f,g={}){let v=or(l.getCanvasContainer(),f),b=l.unproject(v);super(r,i.e({point:v,lngLat:b,originalEvent:f},g)),this._defaultPrevented=!1,this.target=l}}class Rc extends i.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f){let g=r==="touchend"?f.changedTouches:f.touches,v=kn(l.getCanvasContainer(),g),b=v.map(D=>l.unproject(D)),T=v.reduce((D,C,P,O)=>D.add(C.div(O.length)),new i.P(0,0));super(r,{points:v,point:T,lngLats:b,lngLat:l.unproject(T),originalEvent:f}),this._defaultPrevented=!1}}class $i extends i.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f){super(r,{originalEvent:f}),this._defaultPrevented=!1}}class Pf{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new $i(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new Qr(r.type,this._map,r))}mouseup(r){this._map.fire(new Qr(r.type,this._map,r))}preclick(r){let l=i.e({},r);l.type="preclick",this._map.fire(new Qr(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Qr(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Qr(r.type,this._map,r))}mouseover(r){this._map.fire(new Qr(r.type,this._map,r))}mouseout(r){this._map.fire(new Qr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Rc(r.type,this._map,r))}touchmove(r){this._map.fire(new Rc(r.type,this._map,r))}touchend(r){this._map.fire(new Rc(r.type,this._map,r))}touchcancel(r){this._map.fire(new Rc(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mh{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Qr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Qr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gh{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(sn(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;let f=l,g=this._startPos,v=this._lastPos;if(!g||!v||v.equals(f)||!this._box&&f.dist(g)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=se("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));let b=Math.min(g.x,f.x),T=Math.max(g.x,f.x),D=Math.min(g.y,f.y),C=Math.max(g.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${D}px)`,this._box.style.width=T-b+"px",this._box.style.height=C-D+"px")})}mouseupWindow(r,l){if(!this._active)return;let f=this._startPos,g=l;if(f&&r.button===0){if(this.reset(),an(),f.x!==g.x||f.y!==g.y)return this._map.fire(new i.b("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(f,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Rt(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new i.b(r,{originalEvent:l}))}}function Oc(h,r){let l={};for(let f=0;f<h.length;f++)l[h[f].identifier]=r[f];return l}class Rf{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){let v=new i.P(0,0);for(let b of g)v._add(b);return v.div(g.length)}(l),this.touches=Oc(f,l)))}touchmove(r,l,f){if(this.aborted||!this.centroid)return;let g=Oc(f,l);for(let v in this.touches){let b=g[v];(!b||b.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(r,l,f){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){let g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class al{constructor(r){this.singleTap=new Rf(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,f){this.singleTap.touchstart(r,l,f)}touchmove(r,l,f){this.singleTap.touchmove(r,l,f)}touchend(r,l,f){let g=this.singleTap.touchend(r,l,f);if(g){let v=r.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(g)<30;if(v&&b||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Of{constructor(){this._zoomIn=new al({numTouches:1,numTaps:2}),this._zoomOut=new al({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,f){this._zoomIn.touchstart(r,l,f),this._zoomOut.touchstart(r,l,f)}touchmove(r,l,f){this._zoomIn.touchmove(r,l,f),this._zoomOut.touchmove(r,l,f)}touchend(r,l,f){let g=this._zoomIn.touchend(r,l,f),v=this._zoomOut.touchend(r,l,f);return g?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(g)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Lf={0:1,2:2};class ll{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;let f=fi(r);this._correctButton(r,f)&&(this._lastPoint=l,this._eventButton=f)}mousemoveWindow(r,l){let f=this._lastPoint;if(f){if(r.preventDefault(),this._eventButton!=null&&function(g,v){let b=Lf[v];return g.buttons===void 0||(g.buttons&b)!==b}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(f,l)}}mouseupWindow(r){this._lastPoint&&fi(r)===this._eventButton&&(this._moved&&an(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sg extends ll{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return l===0&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class kf extends ll{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){let f=.8*(l.x-r.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(r){r.preventDefault()}}class fa extends ll{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){let f=-.5*(l.y-r.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(r){r.preventDefault()}}class vv{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),i.a$(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(r,l,f){return this._calculateTransform(r,l,f)}touchmove(r,l,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!i.d7())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,f)}}touchend(r,l,f){this._calculateTransform(r,l,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,f){f.length>0&&(this._active=!0);let g=Oc(f,l),v=new i.P(0,0),b=new i.P(0,0),T=0;for(let C in g){let P=g[C],O=this._touches[C];O&&(v._add(P),b._add(P.sub(O)),T++,g[C]=P)}if(this._touches=g,T<this._minTouches||!b.mag())return;let D=b.div(T);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(T),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ff{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,f){return{}}touchstart(r,l,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,f){let g=this._firstTwoTouches;if(!g)return;r.preventDefault();let[v,b]=g,T=_h(f,l,v),D=_h(f,l,b);if(!T||!D)return;let C=this._aroundCenter?null:T.add(D).div(2);return this._move([T,D],C,r)}touchend(r,l,f){if(!this._firstTwoTouches)return;let[g,v]=this._firstTwoTouches,b=_h(f,l,g),T=_h(f,l,v);b&&T||(this._active&&an(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function _h(h,r,l){for(let f=0;f<h.length;f++)if(h[f].identifier===l)return r[f]}function Cg(h,r){return Math.log(h/r)/Math.LN2}class xv extends Ff{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){let f=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Cg(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cg(this._distance,f),pinchAround:l}}}function Ag(h,r){return 180*h.angleWith(r)/Math.PI}class Nf extends Ff{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){let f=this._vector;if(this._vector=r[0].sub(r[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ag(this._vector,f),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());let l=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;let g=Ag(r,f);return Math.abs(g)<l}}function Lc(h){return Math.abs(h.y)>Math.abs(h.x)}class Pg extends Ff{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Lc(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,f){let g=this._lastPoints;if(!g)return;let v=r[0].sub(g[0]),b=r[1].sub(g[1]);return this._map._cooperativeGestures&&!i.d7()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(v,b,f.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(v.y+b.y)/2*-.5})}gestureBeginsVertically(r,l,f){if(this._valid!==void 0)return this._valid;let g=r.mag()>=2,v=l.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;let b=r.y>0==l.y>0;return Lc(r)&&Lc(l)&&b}}let cl={panStep:100,bearingStep:15,pitchStep:10};class Rg{constructor(){let r=cl;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,f=0,g=0,v=0,b=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?f=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?f=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?g=1:(r.preventDefault(),b=-1);break;case 40:r.shiftKey?g=-1:(r.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:T=>{let D=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:Og,zoom:l?Math.round(D)+l*(r.shiftKey?2:1):D,bearing:T.getBearing()+f*this._bearingStep,pitch:T.getPitch()+g*this._pitchStep,offset:[-v*this._panStep,-b*this._panStep],center:T.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Og(h){return h*(2-h)}let zf=4.000244140625,Bf=1/450;class pa{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Bf,i.a$(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||i.d7()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY,f=i.f.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,l!==0&&l%zf==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(g*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let l=or(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){let C=this._type==="wheel"&&Math.abs(this._delta)>zf?this._wheelZoomRate:this._defaultZoomRate,P=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&P!==0&&(P=1/P);let O=l(),F=Math.pow(2,O),N=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(N*P))),this._type==="wheel"&&(this._startZoom=O,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let f=typeof this._targetZoom=="number"?this._targetZoom:l(),g=this._startZoom,v=this._easing,b,T=!1;if(this._type==="wheel"&&g&&v){let C=Math.min((i.f.now()-this._lastWheelEventTime)/200,1),P=v(C);b=i.X(g,f,P),C<1?this._frameId||(this._frameId=!0):T=!0}else b=f,T=!0;this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=b-l();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!T,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=i.d8;if(this._prevEase){let f=this._prevEase,g=(i.f.now()-f.start)/f.duration,v=f.easing(g+.01)-f.easing(g),b=.27/Math.sqrt(v*v+1e-4)*.01,T=Math.sqrt(.0729-b*b);l=i.d6(b,T,.25,1)}return this._prevEase={start:i.f.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Lg{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ma{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(r.shiftKey?-1:1),around:f.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kg{constructor(){this._tap=new al({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,f){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=l[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(r,l,f))}touchmove(r,l,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;let g=l[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,l,f)}touchend(r,l,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(r,l,f)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yh{constructor(r,l,f){this._el=r,this._mousePan=l,this._touchPan=f}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Fg{constructor(r,l,f){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ng{constructor(r,l,f,g){this._el=r,this._touchZoom=l,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let ul=h=>h.zoom||h.drag||h.pitch||h.rotate;class jf extends i.b{}class bv{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){let f=i.Q.sub([],l,r);this.radius=i.Q.length(f[2]<0?i.Q.div([],f,this.constants):[f[0],f[1],0])}projectRay(r){i.Q.div(r,r,this.constants),i.Q.normalize(r,r),i.Q.mul(r,r,this.constants);let l=i.Q.scale([],r,this.radius);if(l[2]>0){let f=i.Q.scale([],[0,0,1],i.Q.dot(l,[0,0,1])),g=i.Q.scale([],i.Q.normalize([],[l[0],l[1],0]),this.radius),v=i.Q.add([],l,i.Q.scale([],i.Q.sub([],i.Q.add([],g,f),l),2));l[0]=v[0],l[1]=v[1]}return l}}function kc(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Fc{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mg(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new bv,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),i.a$(["handleEvent","handleWindowEvent"],this);let f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(let[g,v,b]of this._listeners){let T=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(v,T,b)}}destroy(){for(let[r,l,f]of this._listeners){let g=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(l,g,f)}}_addDefaultHandlers(r){let l=this._map,f=l.getCanvasContainer();this._add("mapEvent",new Pf(l,r));let g=l.boxZoom=new gh(l,r);this._add("boxZoom",g);let v=new Of,b=new ma;l.doubleClickZoom=new Lg(b,v),this._add("tapZoom",v),this._add("clickZoom",b);let T=new kg;this._add("tapDragZoom",T);let D=l.touchPitch=new Pg(l);this._add("touchPitch",D);let C=new kf(r),P=new fa(r);l.dragRotate=new Fg(r,C,P),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);let O=new Sg(r),F=new vv(l,r);l.dragPan=new yh(f,O,F),this._add("mousePan",O),this._add("touchPan",F,["touchZoom","touchRotate"]);let N=new Nf,U=new xv;l.touchZoomRotate=new Ng(f,U,N,T),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]),this._add("blockableMapEvent",new mh(l));let V=l.scrollZoom=new pa(l,this);this._add("scrollZoom",V,["mousePan"]);let $=l.keyboard=new Rg;this._add("keyboard",$);for(let G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[G]&&l[G].enable(r[G])}_add(r,l,f){this._handlers.push({handlerName:r,handler:l,allowed:f}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(let{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ul(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,l,f){for(let g in r)if(g!==f&&(!l||l.indexOf(g)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){let l=[];for(let f of r)this._el.contains(f.target)&&l.push(f);return l}handleEvent(r,l){this._updatingCamera=!0;let f=r.type==="renderFrame",g=f?void 0:r,v={needsRenderFrame:!1},b={},T={},D=r.touches?this._getMapTouches(r.touches):void 0,C=D?kn(this._el,D):f?void 0:or(this._el,r);for(let{handlerName:F,handler:N,allowed:U}of this._handlers){if(!N.isEnabled())continue;let V;this._blockedByActive(T,U,F)?N.reset():N[l||r.type]&&(V=N[l||r.type](r,C,D),this.mergeHandlerResult(v,b,V,F,g),V&&V.needsRenderFrame&&this._triggerRenderFrame()),(V||N.isActive())&&(T[F]=N)}let P={};for(let F in this._previousActiveHandlers)T[F]||(P[F]=g);this._previousActiveHandlers=T,(Object.keys(P).length||kc(v))&&(this._changes.push([v,b,P]),this._triggerRenderFrame()),(Object.keys(T).length||kc(v))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:O}=v;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(r,l,f,g,v){if(!f)return;i.e(r,f);let b={handlerName:g,originalEvent:f.originalEvent||v};f.zoomDelta!==void 0&&(l.zoom=b),f.panDelta!==void 0&&(l.drag=b),f.pitchDelta!==void 0&&(l.pitch=b),f.bearingDelta!==void 0&&(l.rotate=b)}_applyChanges(){let r={},l={},f={};for(let[g,v,b]of this._changes)g.panDelta&&(r.panDelta=(r.panDelta||new i.P(0,0))._add(g.panDelta)),g.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(r.around=g.around),g.aroundCoord!==void 0&&(r.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(r.pinchAround=g.pinchAround),g.noInertia&&(r.noInertia=g.noInertia),i.e(l,v),i.e(f,b);this._updateMapTransform(r,l,f),this._changes=[]}_updateMapTransform(r,l,f){let g=this._map,v=g.transform,b=Z=>[Z.x,Z.y,Z.z];if((Z=>{let te=this._eventsInProgress.drag;return te&&!this._handlersById[te.handlerName].isActive()})()&&!kc(r)){let Z=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),Z!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&g._stop(!0),!kc(r))return void this._fireEvents(l,f,!0);let{panDelta:T,zoomDelta:D,bearingDelta:C,pitchDelta:P,around:O,aroundCoord:F,pinchAround:N}=r;v._isCameraConstrained&&(D>0&&(D=0),v._isCameraConstrained=!1),N!==void 0&&(O=N),(D||(Z=>l[Z]&&!this._eventsInProgress[Z])("drag"))&&O&&(this._dragOrigin=b(v.pointCoordinate3D(O)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",g._stop(!0),O=O||g.transform.centerPoint,C&&(v.bearing+=C),P&&(v.pitch+=P),v._updateCameraState();let U=[0,0,0];if(T)if(v.projection.name==="mercator"){let Z=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(O).dir),te=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(O.sub(T)).dir);U[0]=te[0]-Z[0],U[1]=te[1]-Z[1]}else{let Z=v.pointCoordinate(O);if(v.projection.name==="globe"){T=T.rotate(-v.angle);let te=v._pixelsPerMercatorPixel/v.worldSize;U[0]=-T.x*i.d9(i.ax(Z.y))*te,U[1]=-T.y*i.d9(v.center.lat)*te}else{let te=v.pointCoordinate(O.sub(T));Z&&te&&(U[0]=te.x-Z.x,U[1]=te.y-Z.y)}}let V=v.zoom,$=[0,0,0];if(D){let Z=b(F||v.pointCoordinate3D(O)),te={dir:i.Q.normalize([],i.Q.sub([],Z,v._camera.position))};if(te.dir[2]<0){let ee=v.zoomDeltaToMovement(Z,D);i.Q.scale($,te.dir,ee)}}let G=i.Q.add(U,U,$);v._translateCameraConstrained(G),D&&Math.abs(v.zoom-V)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,f,!0)}_fireEvents(r,l,f){let g=ul(this._eventsInProgress),v=ul(r),b={};for(let P in r){let{originalEvent:O}=r[P];this._eventsInProgress[P]||(b[`${P}start`]=O),this._eventsInProgress[P]=r[P]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(let P in b)this._fireEvent(P,b[P]);v&&this._fireEvent("move",v.originalEvent);for(let P in r){let{originalEvent:O}=r[P];this._fireEvent(P,O)}let T={},D;for(let P in this._eventsInProgress){let{handlerName:O,originalEvent:F}=this._eventsInProgress[P];this._handlersById[O].isActive()||(delete this._eventsInProgress[P],D=l[O]||F,T[`${P}end`]=D)}for(let P in T)this._fireEvent(P,T[P]);let C=ul(this._eventsInProgress);if(f&&(g||v)&&!C){this._updatingCamera=!0;let P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;P?(O(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:D})):(this._map.fire(new i.b("moveend",{originalEvent:D})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new i.b(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new jf("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let zg="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class wv extends i.E{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,i.a$(["_renderFrameCallback"],this)}getCenter(){return new i.bq(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,f){return r=i.P.convert(r).mult(-1),this.panTo(this.transform.center,i.e({offset:r},l),f)}panTo(r,l,f){return this.easeTo(i.e({center:r},l),f)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,f){return this.easeTo(i.e({zoom:r},l),f)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,f){return this.easeTo(i.e({bearing:r},l),f)}resetNorth(r,l){return this.rotateTo(0,i.e({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(i.e({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=i.ag.convert(r);let f=l&&l.bearing||0,g=l&&l.pitch||0,v=r.getNorthWest(),b=r.getSouthEast();return this._cameraForBounds(this.transform,v,b,f,g,l)}_extendPadding(r){let l={top:0,right:0,bottom:0,left:0};return r==null?i.e({},l,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:i.e({},l,r)}_extendCameraOptions(r){return(r=i.e({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,l){let f=l.max[0]-l.min[0],g=l.max[1]-l.min[1];return f/g>r.aspect?f/(2*Math.tan(.5*r.fovX)*r.aspect):g/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,l,f,g,v,b){let T=r.clone(),D=this._extendCameraOptions(b);T.bearing=g,T.pitch=v;let C=i.bq.convert(l),P=i.bq.convert(f),O=.5*(C.lat+P.lat),F=.5*(C.lng+P.lng),N=i.da(O,F),U=i.Q.normalize([],N),V=i.Q.normalize([],i.Q.cross([],U,[0,1,0])),$=i.Q.cross([],V,U),G=[V[0],V[1],V[2],0,$[0],$[1],$[2],0,U[0],U[1],U[2],0,0,0,0,1],Z=[N,i.da(C.lat,C.lng),i.da(P.lat,C.lng),i.da(P.lat,P.lng),i.da(C.lat,P.lng),i.da(O,C.lng),i.da(O,P.lng),i.da(C.lat,F),i.da(P.lat,F)],te=i.bV.fromPoints(Z.map(Te=>[i.Q.dot(V,Te),i.Q.dot($,Te),i.Q.dot(U,Te)])),ee=i.Q.transformMat4([],te.center,G);i.Q.squaredLength(ee)===0&&i.Q.set(ee,0,0,1),i.Q.normalize(ee,ee),i.Q.scale(ee,ee,i.ae),T.center=i.db(ee);let re=T.getWorldToCameraMatrix(),H=i.a9.invert(new Float64Array(16),re);te=i.bV.applyTransform(te,i.a9.multiply([],re,G));let Y=this._extendAABB(te,T,D,g);if(!Y)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");te=Y,i.Q.transformMat4(ee,ee,re);let ce=.5*(te.max[2]-te.min[2]),ae=this._minimumAABBFrustumDistance(T,te),fe=i.Q.scale([],[0,0,1],ce),we=i.Q.add(fe,ee,fe),de=ae+(T.pitch===0?0:i.Q.distance(ee,we)),xe=T.globeCenterInViewSpace,Ee=i.Q.sub([],ee,[xe[0],xe[1],xe[2]]);i.Q.normalize(Ee,Ee),i.Q.scale(Ee,Ee,de);let he=i.Q.add([],ee,Ee);i.Q.transformMat4(he,he,H);let ye=i.dc/i.ae,ze=i.Q.length(he),me=i.bo(Math.max(ze*ye-i.dc,Number.EPSILON),0),be=Math.min(T.zoomFromMercatorZAdjusted(me),D.maxZoom);return be>.5*(i.bJ+i.bA)?(T.setProjection({name:"mercator"}),T.zoom=be,this._cameraForBounds(T,l,f,g,v,b)):{center:T.center,zoom:be,bearing:g,pitch:v}}_extendAABB(r,l,f,g){let v=.5*((f.padding.left||0)+(f.padding.right||0)),b=.5*((f.padding.top||0)+(f.padding.bottom||0)),T=b,D=v,C=v,P=b,O=l.width-(D+C),F=l.height-(T+P),N=i.Q.sub([],r.max,r.min),U=Math.min(O/N[0],F/N[1]),V=Math.min(l.scaleZoom(l.scale*U),f.maxZoom);if(isNaN(V))return null;let $=l.scale/l.zoomScale(V),G=new i.bV([r.min[0]-D*$,r.min[1]-P*$,r.min[2]],[r.max[0]+C*$,r.max[1]+T*$,r.max[2]]),Z=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new i.P(f.offset.x,f.offset.y):i.P.convert(f.offset)).rotate(-i.bm(g));return G.center[0]-=Z.x*$,G.center[1]+=Z.y*$,G}queryTerrainElevation(r,l){let f=this.transform.elevation;return f?(l=i.e({},{exaggerated:!0},l),f.getAtPoint(i.O.fromLngLat(r),null,l.exaggerated)):null}_cameraForBounds(r,l,f,g,v,b){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,l,f,g,v,b);let T=r.clone(),D=this._extendCameraOptions(b);T.bearing=g,T.pitch=v;let C=i.bq.convert(l),P=i.bq.convert(f),O=new i.bq(C.lng,P.lat),F=new i.bq(P.lng,C.lat),N=T.project(C),U=T.project(P),V=this.queryTerrainElevation(C),$=this.queryTerrainElevation(P),G=this.queryTerrainElevation(O),Z=this.queryTerrainElevation(F),te=[[N.x,N.y,Math.min(V||0,$||0,G||0,Z||0)],[U.x,U.y,Math.max(V||0,$||0,G||0,Z||0)]],ee=i.bV.fromPoints(te),re=T.getWorldToCameraMatrix(),H=i.a9.invert(new Float64Array(16),re);ee=i.bV.applyTransform(ee,re);let Y=this._extendAABB(ee,T,D,g);if(!Y)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ee=Y;let ce=.5*i.Q.sub([],ee.max,ee.min)[2],ae=this._minimumAABBFrustumDistance(T,ee),fe=[0,0,1,0];i.aa.transformMat4(fe,fe,re),i.aa.normalize(fe,fe);let we=i.Q.scale([],fe,ae+ce),de=i.Q.add([],ee.center,we);i.Q.transformMat4(ee.center,ee.center,H),i.Q.transformMat4(de,de,H);let xe=[ee.center[0],ee.center[1],de[2]*T.pixelsPerMeter];i.Q.scale(xe,xe,1/T.worldSize);let Ee=i.aw(xe[0]),he=i.ax(xe[1]),ye=Math.min(T._zoomFromMercatorZ(xe[2]),D.maxZoom),ze=new i.bq(Ee,he);return T.mercatorFromTransition&&ye<.5*(i.bJ+i.bA)?(T.setProjection({name:"globe"}),T.zoom=ye,this._cameraForBounds(T,l,f,g,v,b)):{center:ze,zoom:ye,bearing:g,pitch:v}}fitBounds(r,l,f){let g=this.cameraForBounds(r,l);return this._fitInternal(g,l,f)}fitScreenCoordinates(r,l,f,g,v){let b=i.P.convert(r),T=i.P.convert(l),D=new i.P(Math.min(b.x,T.x),Math.min(b.y,T.y)),C=new i.P(Math.max(b.x,T.x),Math.max(b.y,T.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,T))return this;let P=this.transform.pointLocation3D(D),O=this.transform.pointLocation3D(C),F=this.transform.pointLocation3D(new i.P(D.x,C.y)),N=this.transform.pointLocation3D(new i.P(C.x,D.y)),U=[Math.min(P.lng,O.lng,F.lng,N.lng),Math.min(P.lat,O.lat,F.lat,N.lat)],V=[Math.max(P.lng,O.lng,F.lng,N.lng),Math.max(P.lat,O.lat,F.lat,N.lat)],$=g&&g.pitch?g.pitch:this.getPitch(),G=this._cameraForBounds(this.transform,U,V,f,$,g);return this._fitInternal(G,g,v)}_fitInternal(r,l,f){return r?(l=i.e(r,l)).linear?this.easeTo(l,f):this.flyTo(l,f):this}jumpTo(r,l){this.stop();let f=r.preloadOnly?this.transform.clone():this.transform,g=!1,v=!1,b=!1;return"zoom"in r&&f.zoom!==+r.zoom&&(g=!0,f.zoom=+r.zoom),r.center!==void 0&&(f.center=i.bq.convert(r.center)),"bearing"in r&&f.bearing!==+r.bearing&&(v=!0,f.bearing=+r.bearing),"pitch"in r&&f.pitch!==+r.pitch&&(b=!0,f.pitch=+r.pitch),r.padding==null||f.isPaddingEqual(r.padding)||(f.padding=r.padding),r.preloadOnly?(this._preloadTiles(f),this):(this.fire(new i.b("movestart",l)).fire(new i.b("move",l)),g&&this.fire(new i.b("zoomstart",l)).fire(new i.b("zoom",l)).fire(new i.b("zoomend",l)),v&&this.fire(new i.b("rotatestart",l)).fire(new i.b("rotate",l)).fire(new i.b("rotateend",l)),b&&this.fire(new i.b("pitchstart",l)).fire(new i.b("pitch",l)).fire(new i.b("pitchend",l)),this.fire(new i.b("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(zg),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){let f=this.transform;if(!f.projection.supportsFreeCamera)return i.w(zg),this;this.stop();let g=f.zoom,v=f.pitch,b=f.bearing;f.setFreeCameraOptions(r);let T=g!==f.zoom,D=v!==f.pitch,C=b!==f.bearing;return this.fire(new i.b("movestart",l)).fire(new i.b("move",l)),T&&this.fire(new i.b("zoomstart",l)).fire(new i.b("zoom",l)).fire(new i.b("zoomend",l)),C&&this.fire(new i.b("rotatestart",l)).fire(new i.b("rotate",l)).fire(new i.b("rotateend",l)),D&&this.fire(new i.b("pitchstart",l)).fire(new i.b("pitch",l)).fire(new i.b("pitchend",l)),this.fire(new i.b("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),((r=i.e({offset:[0,0],duration:500,easing:i.d8},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);let f=this.transform,g=this.getZoom(),v=this.getBearing(),b=this.getPitch(),T=this.getPadding(),D="zoom"in r?+r.zoom:g,C="bearing"in r?this._normalizeBearing(r.bearing,v):v,P="pitch"in r?+r.pitch:b,O=this._extendPadding(r.padding),F=i.P.convert(r.offset),N,U,V;if(f.projection.name==="globe"){let ae=i.O.fromLngLat(f.center),fe=F.rotate(-f.angle);ae.x+=fe.x/f.worldSize,ae.y+=fe.y/f.worldSize;let we=ae.toLngLat(),de=i.bq.convert(r.center||we);this._normalizeCenter(de),N=f.centerPoint.add(fe),U=new i.P(ae.x,ae.y).mult(f.worldSize),V=new i.P(i.a8(de.lng),i.ah(de.lat)).mult(f.worldSize).sub(U)}else{N=f.centerPoint.add(F);let ae=f.pointLocation(N),fe=i.bq.convert(r.center||ae);this._normalizeCenter(fe),U=f.project(ae),V=f.project(fe).sub(U)}let $=f.zoomScale(D-g),G,Z;r.around&&(G=i.bq.convert(r.around),Z=f.locationPoint(G));let te=this._zooming||D!==g,ee=this._rotating||v!==C,re=this._pitching||P!==b,H=!f.isPaddingEqual(O),Y=ae=>fe=>{if(te&&(ae.zoom=i.X(g,D,fe)),ee&&(ae.bearing=i.X(v,C,fe)),re&&(ae.pitch=i.X(b,P,fe)),H&&(ae.interpolatePadding(T,O,fe),N=ae.centerPoint.add(F)),G)ae.setLocationAtPoint(G,Z);else{let we=ae.zoomScale(ae.zoom-g),de=D>g?Math.min(2,$):Math.max(.5,$),xe=Math.pow(de,1-fe),Ee=ae.unproject(U.add(V.mult(fe*xe)).mult(we));ae.setLocationAtPoint(ae.renderWorldCopies?Ee.wrap():Ee,N)}return r.preloadOnly||this._fireMoveEvents(l),ae};if(r.preloadOnly){let ae=this._emulate(Y,r.duration,f);return this._preloadTiles(ae),this}let ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=te,this._rotating=ee,this._pitching=re,this._padding=H,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,ce),this._ease(Y(f),ae=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(l,ae)},r),this}_prepareEase(r,l,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||f.moving||this.fire(new i.b("movestart",r)),this._zooming&&!f.zooming&&this.fire(new i.b("zoomstart",r)),this._rotating&&!f.rotating&&this.fire(new i.b("rotatestart",r)),this._pitching&&!f.pitching&&this.fire(new i.b("pitchstart",r))}_fireMoveEvents(r){this.fire(new i.b("move",r)),this._zooming&&this.fire(new i.b("zoom",r)),this._rotating&&this.fire(new i.b("rotate",r)),this._pitching&&this.fire(new i.b("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let f=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new i.b("zoomend",r)),g&&this.fire(new i.b("rotateend",r)),v&&this.fire(new i.b("pitchend",r)),this.fire(new i.b("moveend",r))}flyTo(r,l){if(this._prefersReducedMotion(r)){let be=i.af(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(be,l)}this.stop(),r=i.e({offset:[0,0],speed:1.2,curve:1.42,easing:i.d8},r);let f=this.transform,g=this.getZoom(),v=this.getBearing(),b=this.getPitch(),T=this.getPadding(),D="zoom"in r?i.ad(+r.zoom,f.minZoom,f.maxZoom):g,C="bearing"in r?this._normalizeBearing(r.bearing,v):v,P="pitch"in r?+r.pitch:b,O=this._extendPadding(r.padding),F=f.zoomScale(D-g),N=i.P.convert(r.offset),U=f.centerPoint.add(N),V=f.pointLocation(U),$=i.bq.convert(r.center||V);this._normalizeCenter($);let G=f.project(V),Z=f.project($).sub(G),te=r.curve,ee=Math.max(f.width,f.height),re=ee/F,H=Z.mag();if("minZoom"in r){let be=i.ad(Math.min(r.minZoom,g,D),f.minZoom,f.maxZoom),Te=ee/f.zoomScale(be-g);te=Math.sqrt(Te/H*2)}let Y=te*te;function ce(be){let Te=(re*re-ee*ee+(be?-1:1)*Y*Y*H*H)/(2*(be?re:ee)*Y*H);return Math.log(Math.sqrt(Te*Te+1)-Te)}function ae(be){return(Math.exp(be)-Math.exp(-be))/2}function fe(be){return(Math.exp(be)+Math.exp(-be))/2}let we=ce(0),de=function(be){return fe(we)/fe(we+te*be)},xe=function(be){return ee*((fe(we)*(ae(Te=we+te*be)/fe(Te))-ae(we))/Y)/H;var Te},Ee=(ce(1)-we)/te;if(Math.abs(H)<1e-6||!isFinite(Ee)){if(Math.abs(ee-re)<1e-6)return this.easeTo(r,l);let be=re<ee?-1:1;Ee=Math.abs(Math.log(re/ee))/te,xe=function(){return 0},de=function(Te){return Math.exp(be*te*Te)}}r.duration="duration"in r?+r.duration:1e3*Ee/("screenSpeed"in r?+r.screenSpeed/te:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);let he=v!==C,ye=P!==b,ze=!f.isPaddingEqual(O),me=be=>Te=>{let ne=Te*Ee,Ae=1/de(ne);be.zoom=Te===1?D:g+be.scaleZoom(Ae),he&&(be.bearing=i.X(v,C,Te)),ye&&(be.pitch=i.X(b,P,Te)),ze&&(be.interpolatePadding(T,O,Te),U=be.centerPoint.add(N));let rt=Te===1?$:be.unproject(G.add(Z.mult(xe(ne))).mult(Ae));return be.setLocationAtPoint(be.renderWorldCopies?rt.wrap():rt,U),be._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),be};if(r.preloadOnly){let be=this._emulate(me,r.duration,f);return this._preloadTiles(be),this}return this._zooming=!0,this._rotating=he,this._pitching=ye,this._padding=ze,this._prepareEase(l,!1),this._ease(me(f),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,l)}if(!r){let f=this.handlers;f&&f.stop(!1)}return this}_ease(r,l,f){f.animate===!1||f.duration===0?(r(1),l()):(this._easeStart=i.f.now(),this._easeOptions=f,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let r=Math.min((i.f.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=i.bk(r,-180,180);let f=Math.abs(r-l);return Math.abs(r-360-l)<f&&(r-=360),Math.abs(r+360-l)<f&&(r+=360),r}_normalizeCenter(r){let l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;let f=r.lng-l.center.lng;r.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&i.f.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,l,f){let g=Math.ceil(15*l/1e3),v=[],b=r(f.clone());for(let T=0;T<=g;T++){let D=b(T/g);v.push(D.clone())}return v}_preloadTiles(r,l){}}class Vf{constructor(r={}){this.options=r,i.a$(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){let l=this.options&&this.options.compact;return this._map=r,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=se("button","mapboxgl-ctrl-attrib-button",this._container),se("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=se("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,l){let f=this._map._getUIString(`AttributionControl.${l}`);r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));let l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.dd.ACCESS_TOKEN}];if(r){let f=l.reduce((g,v,b)=>(v.value&&(g+=`${v.key}=${v.value}${b<l.length-1?"&":""}`),g),"?");r.href=`${i.dd.FEEDBACK_URL}/${f}#${Ig(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){let g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}let l=this._map.style._mergedSourceCaches;for(let g in l){let v=l[g];if(v.used){let b=v.getSource();b.attribution&&r.indexOf(b.attribution)<0&&r.push(b.attribution)}}r.sort((g,v)=>g.length-v.length),r=r.filter((g,v)=>{for(let b=v+1;b<r.length;b++)if(r[b].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));let f=r.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,r.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Bg{constructor(){i.a$(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=se("div","mapboxgl-ctrl");let l=se("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(let l in r){let f=r[l].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){let r=this._container.children;if(r.length){let l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class vh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){let l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){let l=this._currentlyRunning,f=l?this._queue.concat(l):this._queue;for(let g of f)if(g.id===r)return void(g.cancelled=!0)}run(r=0){let l=this._currentlyRunning=this._queue;this._queue=[];for(let f of l)if(!f.cancelled&&(f.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function xh(h,r,l){if(h=new i.bq(h.lng,h.lat),r){let f=new i.bq(h.lng-360,h.lat),g=new i.bq(h.lng+360,h.lat),v=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),b=l.locationPoint(h).distSqr(r),T=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint(f).distSqr(r)<b&&(T||Math.abs(f.lng-l.center.lng)<v)?h=f:l.locationPoint(g).distSqr(r)<b&&(T||Math.abs(g.lng-l.center.lng)<v)&&(h=g)}for(;Math.abs(h.lng-l.center.lng)>180;){let f=l.locationPoint(h);if(f.x>=0&&f.y>=0&&f.x<=l.width&&f.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}let hl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Nc extends i.E{constructor(r,l){if(super(),(r instanceof HTMLElement||l)&&(r=i.e({element:r},l)),i.a$(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=i.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=se("div");let v=41,b=27,T=ge("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),D=ge("radialGradient",{id:"shadowGradient"},ge("defs",{},T));ge("stop",{offset:"10%","stop-opacity":.4},D),ge("stop",{offset:"100%","stop-opacity":.05},D),ge("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),ge("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),ge("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),ge("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=i.P.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});let f=this._element.classList;for(let v in hl)f.remove(`mapboxgl-marker-anchor-${v}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);let g=r&&r.className?r.className.trim().split(/\s+/):[];f.add(...g),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){let r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=i.bq.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){let g=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){let l=r.code,f=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(r){let l=r.originalEvent.target,f=this._element;this._popup&&(l===f||f.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let r=this._map,l=this._pos;if(!r||!l)return!1;let f=r.unproject(l),g=r.getFreeCameraOptions();if(!g.position)return!1;let v=g.position.toLngLat();return v.distanceTo(f)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){let r=this._map;if(!r)return;let l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();let f=r.unproject(l),g;r._showingGlobe()&&i.de(r.transform,this._lngLat)?g=0:(g=1-r._queryFogOpacity(f),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let r=this._pos;if(!r||!this._map)return;let l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${hl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){let r=this._pos,l=this._map,f=this.getPitchAlignment();if(!l||!r||f!=="map")return"";if(!l._showingGlobe()){let D=l.getPitch();return D?`rotateX(${D}deg)`:""}let g=i.bI(i.df(l.transform,this._lngLat)),v=r.sub(i.dg(l.transform)),b=Math.abs(v.x)+Math.abs(v.y);if(b===0)return"";let T=g/b;return`rotateX(${-v.y*T}deg) rotateY(${v.x*T}deg)`}_calculateZTransform(){let r=this._pos,l=this._map;if(!l||!r)return"";let f=0,g=this.getRotationAlignment();if(g==="map")if(l._showingGlobe()){let v=l.project(new i.bq(this._lngLat.lng,this._lngLat.lat+.001)),b=l.project(new i.bq(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);f=i.bI(Math.atan2(b.y,b.x))-90}else f=-l.getBearing();else if(g==="horizon"){let v=i.S(4,6,l.getZoom()),b=i.dg(l.transform);b.y+=v*l.transform.height;let T=r.sub(b),D=i.bI(Math.atan2(T.y,T.x));f=(D>90?D-270:D+90)*(1-v)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);let l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=xh(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=i.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){let l=this._map;if(!l)return;let f=this._pointerdownPos,g=this._positionDelta;if(f&&g){if(!this._isDragging){let v=this._clickTolerance||l._clickTolerance;if(r.point.dist(f)<v)return;this._isDragging=!0}this._pos=r.point.sub(g),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.b("dragstart"))),this.fire(new i.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.b("dragend")),this._state="inactive"}_addDragHandler(r){let l=this._map,f=this._pos;l&&f&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(f),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;let l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let zc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},jg=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Bc(h=new i.P(0,0),r="bottom"){if(typeof h=="number"){let l=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(r){case"top":return new i.P(0,h);case"top-left":return new i.P(l,l);case"top-right":return new i.P(-l,l);case"bottom":return new i.P(0,-h);case"bottom-left":return new i.P(l,-l);case"bottom-right":return new i.P(-l,-l);case"left":return new i.P(h,0);case"right":return new i.P(-h,0)}return new i.P(0,0)}return h instanceof i.P||Array.isArray(h)?i.P.convert(h):i.P.convert(h[r]||[0,0])}class bh{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;let l=i.ch((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,f){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+f}}class Vg{registerParameter(r,l,f,g,v){}registerButton(r,l,f){}registerBinding(r,l,f,g){}refreshUI(){}}let Ls={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ko={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},dl={showCompass:!0,showZoom:!0,visualizePitch:!1};class wh{constructor(r,l,f=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new kf({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,f&&(this.mousePitch=new fa({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),i.a$(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),sn()}move(r,l){let f=this.map,g=this.mouseRotate.mousemoveWindow(r,l),v=g&&g.bearingDelta;if(v&&f.setBearing(f.getBearing()+v),this.mousePitch){let b=this.mousePitch.mousemoveWindow(r,l),T=b&&b.pitchDelta;T&&f.setPitch(f.getPitch()+T)}}off(){let r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Rt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(i.e({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),or(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,or(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=kn(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=kn(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let lt={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ug={maxWidth:100,unit:"metric"},$g={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:i.du,supported:L,setRTLTextPlugin:i.dw,getRTLTextPluginStatus:i.dx,Map:class extends wv{constructor(h){let r=h;if((h=i.e({},ko,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&i.dh(window)&&(h.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Hu(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new vh,this._domRenderTaskQueue=new vh,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.aF(),this._locale=i.e({},Ls,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new bh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new i.di(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Ct({},h.contextCreateOptions):{},typeof h.container=="string"){let l=document.getElementById(h.container);if(!l)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=l}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),i.a$(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp=h.devtools?new Vg(this):new Vg,this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Fc(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||i.dd.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),h.hash&&(this._hash=new yv(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});let l=h.bounds;l&&(this.resize(),this.fitBounds(l,i.e({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Vf({customAttribution:h.customAttribution})),this._logoControl=new Bg,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new i.b(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new i.b(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(h,r){if(r===void 0&&(r=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new i.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let l=h.onAdd(this);this._controls.push(h);let f=this._controlPositions[r];return r.indexOf("bottom")!==-1?f.insertBefore(l,f.firstChild):f.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new i.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let r=this._controls.indexOf(h);return r>-1&&this._controls.splice(r,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let r=!this._moving;return r&&this.fire(new i.b("movestart",h)).fire(new i.b("move",h)),this.fire(new i.b("resize",h)),r&&this.fire(new i.b("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(i.ag.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new i.b("zoomstart")).fire(new i.b("zoom")).fire(new i.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new i.b("zoomstart")).fire(new i.b("zoom")).fire(new i.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new i.b("pitchstart")).fire(new i.b("pitch")).fire(new i.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new i.b("pitchstart")).fire(new i.b("pitch")).fire(new i.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(r=>r==="auto"?navigator.language:r):h}setLanguage(h){let r=this._parseLanguage(h);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(let l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let h=this.transform,r=h.projection.name,l;r==="globe"&&h.zoom>=i.bA?(h.setMercatorFromTransition(),l=!0):r==="mercator"&&h.zoom<i.bA&&(h.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,r){return this._updateProjection(h||r||{name:"mercator"})}_updateProjection(h){let r;return r=h.name==="globe"&&this.transform.zoom>=i.bA?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h){return this.transform.locationPoint3D(i.bq.convert(h))}unproject(h){return this.transform.pointLocation3D(i.P.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,r,l){if(h==="mouseenter"||h==="mouseover"){let f=!1,g=b=>{let T=r.filter(C=>this.getLayer(C)),D=T.length?this.queryRenderedFeatures(b.point,{layers:T}):[];D.length?f||(f=!0,l.call(this,new Qr(h,this,b.originalEvent,{features:D}))):f=!1},v=()=>{f=!1};return{layers:new Set(r),listener:l,delegates:{mousemove:g,mouseout:v}}}if(h==="mouseleave"||h==="mouseout"){let f=!1,g=b=>{let T=r.filter(D=>this.getLayer(D));(T.length?this.queryRenderedFeatures(b.point,{layers:T}):[]).length?f=!0:f&&(f=!1,l.call(this,new Qr(h,this,b.originalEvent)))},v=b=>{f&&(f=!1,l.call(this,new Qr(h,this,b.originalEvent)))};return{layers:new Set(r),listener:l,delegates:{mousemove:g,mouseout:v}}}{let f=g=>{let v=r.filter(T=>this.getLayer(T)),b=v.length?this.queryRenderedFeatures(g.point,{layers:v}):[];b.length&&(g.features=b,l.call(this,g),delete g.features)};return{layers:new Set(r),listener:l,delegates:{[h]:f}}}}on(h,r,l){if(l===void 0)return super.on(h,r);if(Array.isArray(r)||(r=[r]),r){for(let g of r)if(!this._isValidId(g))return this}let f=this._createDelegatedListener(h,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(f);for(let g in f.delegates)this.on(g,f.delegates[g]);return this}once(h,r,l){if(l===void 0)return super.once(h,r);if(Array.isArray(r)||(r=[r]),r){for(let g of r)if(!this._isValidId(g))return this}let f=this._createDelegatedListener(h,r,l);for(let g in f.delegates)this.once(g,f.delegates[g]);return this}off(h,r,l){if(l===void 0)return super.off(h,r);r=new Set(Array.isArray(r)?r:[r]);for(let v of r)if(!this._isValidId(v))return this;let f=(v,b)=>{if(v.size!==b.size)return!1;for(let T of v)if(!b.has(T))return!1;return!0},g=this._delegatedListeners?this._delegatedListeners[h]:void 0;return g&&(v=>{for(let b=0;b<v.length;b++){let T=v[b];if(T.listener===l&&f(T.layers,r)){for(let D in T.delegates)this.off(D,T.delegates[D]);return v.splice(b,1),this}}})(g),this}queryRenderedFeatures(h,r){if(!this.style)return[];if(r!==void 0||h===void 0||h instanceof i.P||Array.isArray(h)||(r=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],(r=r||{}).layers&&Array.isArray(r.layers)){for(let l of r.layers)if(!this._isValidId(l))return[]}return this.style.queryRenderedFeatures(h,r,this.transform)}querySourceFeatures(h,r){return this._isValidId(h)?this.style.querySourceFeatures(h,r):[]}isPointOnSurface(h){let{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&i.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(h))}setStyle(h,r){return r=i.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&h&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(h,(l,f)=>{l?(i.w(`Unable to perform style diff: ${String(l.message||l.error||l)}. Rebuilding the style from scratch.`),this._updateStyle(h,r)):f&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(h,r))}_getUIString(h){let r=this._locale[h];if(r==null)throw new Error(`Missing UI string '${h}'`);return r}_updateStyle(h,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){let l=i.e({},r);r&&r.config&&(l.initialConfig=r.config,delete l.config),this.style=new mo(this,l).setEventedParent(this,{style:this.style}).load(h)}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new mo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new i.a(new Error("IDs can't be empty."))),!1):!i.c9(h)||(this.fire(new i.a(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}addSource(h,r){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,r),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(h,r,l)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,r,{pixelRatio:l=1,sdf:f=!1,stretchX:g,stretchY:v,content:b}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){let{width:T,height:D,data:C}=i.f.getImageData(r);this.style.addImage(h,{data:new i.h({width:T,height:D},C),pixelRatio:l,stretchX:g,stretchY:v,content:b,sdf:f,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new i.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:T,height:D}=r,C=r;this.style.addImage(h,{data:new i.h({width:T,height:D},new Uint8Array(C.data)),pixelRatio:l,stretchX:g,stretchY:v,content:b,sdf:f,version:0,userImage:C}),C.onAdd&&C.onAdd(this,h)}}updateImage(h,r){this._lazyInitEmptyStyle();let l=this.style.getImage(h);if(!l)return void this.fire(new i.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let f=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?i.f.getImageData(r):r,{width:g,height:v}=f,b=f.data;if(g===void 0||v===void 0)return void this.fire(new i.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==l.data.width||v!==l.data.height)return void this.fire(new i.a(new Error(`The width and height of the updated image (${g}, ${v})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`)));let T=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);l.data.replace(b,T),this.style.updateImage(h,l)}hasImage(h){return h?!!this.style&&!!this.style.getImage(h):(this.fire(new i.a(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,r){i.d(this._requestManager.transformRequest(h,i.R.Image),(l,f)=>{r(l,f instanceof HTMLImageElement?i.f.getImageData(f):f)})}listImages(){return this.style.listImages()}addModel(h,r){this._lazyInitEmptyStyle(),this.style.addModel(h,r)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new i.a(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,r){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,r),this._update(!0)):this}getSlot(h){let r=this.getLayer(h);return r&&r.slot||null}setSlot(h,r){return this.style.setSlot(h,r),this.style.mergeLayers(),this._update(!0)}addImport(h,r){return this.style.addImport(h,r),this}updateImport(h,r){return typeof r!="string"&&r.id!==h?(this.removeImport(h),this.addImport(r)):(this.style.updateImport(h,r),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,r){return this.style.moveImport(h,r),this._update(!0)}moveLayer(h,r){return this._isValidId(h)?(this.style.moveLayer(h,r),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){return this._isValidId(h)?this.style.getOwnLayer(h):null}setLayerZoomRange(h,r,l){return this._isValidId(h)?(this.style.setLayerZoomRange(h,r,l),this._update(!0)):this}setFilter(h,r,l={}){return this._isValidId(h)?(this.style.setFilter(h,r,l),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,r,l,f={}){return this._isValidId(h)?(this.style.setPaintProperty(h,r,l,f),this._update(!0)):this}getPaintProperty(h,r){return this._isValidId(h)?this.style.getPaintProperty(h,r):null}setLayoutProperty(h,r,l,f={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,r,l,f),this._update(!0)):this}getLayoutProperty(h,r){return this._isValidId(h)?this.style.getLayoutProperty(h,r):null}getSchema(h){return this.style.getSchema(h)}setSchema(h,r){return this.style.setSchema(h,r),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,r){return this.style.setConfig(h,r),this._update(!0)}getConfigProperty(h,r){return this.style.getConfigProperty(h,r)}setConfigProperty(h,r,l){return this.style.setConfigProperty(h,r,l),this._update(!0)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){let r=h[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.bq.convert(h),this.transform):0}setFeatureState(h,r){return this._isValidId(h.source)?(this.style.setFeatureState(h,r),this._update()):this}removeFeatureState(h,r){return this._isValidId(h.source)?(this.style.removeFeatureState(h,r),this._update()):this}getFeatureState(h){return this._isValidId(h.source)?this.style.getFeatureState(h):null}_updateContainerDimensions(){if(!this._container)return;let h=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300,l,f,g,v=this._container;for(;v&&(!f||!g);){let b=window.getComputedStyle(v).transform;b&&b!=="none"&&(l=b.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(f=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(g=l[3])),v=v.parentElement}this._containerWidth=f?Math.abs(h/f):h,this._containerHeight=g?Math.abs(r/g):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=se("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();let r=this._canvasContainer=se("div","mapboxgl-canvas-container",h);this._canvas=se("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let l=this._controlContainer=se("div","mapboxgl-control-container",h),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{f[g]=se("div",`mapboxgl-ctrl-${g}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,r){let l=i.f.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${r}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){let r=this._markers.indexOf(h);r!==-1&&this._markers.splice(r,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){let r=this._popups.indexOf(h);r!==-1&&this._popups.splice(r,1)}_setupPainter(){let h=i.e({},L.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",h);r?(i.dj(r,!0),this.painter=new Tg(r,this._contextCreateOptions,this.transform,this._tp),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.dk.testSupport(r)):this.fire(new i.a(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.b("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new i.b("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let r;this.fire(new i.b("renderstart"));let l=this.painter.context.extTimerQuery,f=i.f.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=g.createQuery(),g.beginQuery(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();let v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let D=this.transform.zoom,C=this.transform.pitch,P=i.f.now(),O=new i.N(D,{now:P,fadeDuration:v,pitch:C,transition:this.style.transition});this.style.update(O)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(f),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(f),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new i.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){let D=i.f.now()-f;g.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{let C=g.getQueryParameter(r,g.QUERY_RESULT)/1e6;g.deleteQuery(r),this.fire(new i.b("gpu-timing-frame",{cpuTime:D,gpuTime:C}))},50)}if(this.listens("gpu-timing-layer")){let D=this.painter.collectGpuTimers();setTimeout(()=>{let C=this.painter.queryGpuTimers(D);this.fire(new i.b("gpu-timing-layer",{layerTimes:C}))},50)}if(this.listens("gpu-timing-deferred-render")){let D=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let C=this.painter.queryGpuTimeDeferredRender(D);this.fire(new i.b("gpu-timing-deferred-render",{gpuTime:C}))},50)}let T=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(T||this._repaint)this.triggerRepaint();else{let D=!this.isMoving()&&this.loaded();if(D&&(b=this._updateAverageElevation(f,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new i.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let C=this._calculateSpeedIndex();this.fire(new i.b("speedindexcompleted",{speedIndex:C})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,this._performanceMetricsCollection&&i.dl(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(let r of this._markers)h&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(let r of this._popups)!h||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(h,r=!1){let l=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);let f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(r||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){let g=this.transform.averageElevation,v=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=h;let b=Math.abs(g-v);if(b>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(v),l(v);this._averageElevation.easeTo(v,h,300)}else if(b>1e-4)return this._averageElevation.jumpTo(v),l(v)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){i.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===i.dn||h.status===401)){let r=this.painter.context.gl;i.dj(r,!1),this._logoControl instanceof Bg&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),i.dp(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&i.dq(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){let h=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());let l=this.painter.context.gl,f=l.createFramebuffer();function g(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);let b=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,b),b}return l.bindFramebuffer(l.FRAMEBUFFER,f),this._canvasPixelComparison(g(h),r.canvasCopies.map(g),r.timeStamps)}_canvasPixelComparison(h,r,l){let f=l[1]-l[0],g=h.length/4;for(let v=0;v<r.length;v++){let b=r[v],T=0;for(let D=0;D<b.length;D+=4)b[D]===h[D]&&b[D+1]===h[D+1]&&b[D+2]===h[D+2]&&b[D+3]===h[D+3]&&(T+=1);f+=(l[v+2]-l[v+1])*(1-T/g)}return f}remove(){this._hash&&this._hash.remove();for(let r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),i.dr(this.painter.context.gl),i.ds.remove(),i.dt.remove(),this._removed=!0,this.fire(new i.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=i.f.frame(r=>{let l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(h){let r=this.style?this.style.getSourceCaches():[];return i.b4(r,(l,f)=>l._preloadTiles(h,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,r){i.dv(h,r)}get version(){return i.du}},NavigationControl:class{constructor(h){this.options=i.e({},dl,h),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(i.a$(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),se("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),se("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.a$(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{let l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=se("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let h=this._map;if(!h)return;let r=h.getZoom(),l=r===h.getMaxZoom(),f=r===h.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){let h=this._map;if(!h)return;let r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wh(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){let h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,r){let l=se("button",h,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(h,r){if(!this._map)return;let l=this._map._getUIString(`NavigationControl.${r}`);h.setAttribute("aria-label",l),h.firstElementChild&&h.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends i.E{constructor(h){super();let r=navigator.geolocation;this.options=i.e({geolocation:r},lt,h),i.a$(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Eg(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){let r=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,h(l)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>r(l.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(h){let r=this._map.getMaxBounds(),l=h.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new i.b("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.b("geolocate",h)),this._finish()}}_updateCamera(h){let r=new i.bq(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,f=this._map.getBearing(),g=i.e({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),g,{geolocateSource:!0})}_updateMarker(h){if(h){let r=new i.bq(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let h=this._map.transform,r=i.bo(1,h._center.lat)*h.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.b("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=se("button","mapboxgl-ctrl-geolocate",this._container),se("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{let r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=se("div","mapboxgl-user-location"),this._dotElement.appendChild(se("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(se("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Nc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=se("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Nc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.b("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Vf,ScaleControl:class{constructor(h){this.options=i.e({},Ug,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.a$(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let h=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,f=r._containerWidth/2-h/2,g=r.unproject([f,l]),v=r.unproject([f+h,l]),b=g.distanceTo(v);if(this.options.unit==="imperial"){let T=3.2808*b;T>5280?this._setScale(h,T/5280,"mile"):this._setScale(h,T,"foot")}else this.options.unit==="nautical"?this._setScale(h,b/1852,"nautical-mile"):b>=1e3?this._setScale(h,b/1e3,"kilometer"):this._setScale(h,b,"meter")}_setScale(h,r,l){this._map._requestDomTask(()=>{let f=function(v){let b=Math.pow(10,`${Math.floor(v)}`.length-1),T=v/b;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(D){let C=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*C)/C}(T),b*T}(r),g=f/r;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(f):`${f}&nbsp;${$g[l]}`,this._container.style.width=h*g+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:i.w("Full screen control 'container' must be a DOM element.")),i.a$(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let h=this._fullscreenButton=se("button","mapboxgl-ctrl-fullscreen",this._controlContainer);se("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(h){super(),this.options=i.e(Object.create(zc),h),i.a$(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new i.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new i.b("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=i.bq.convert(h),this._pos=null,this._trackPointer=!1,this._update();let r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){let r=document.createDocumentFragment(),l=document.createElement("body"),f;for(l.innerHTML=h;f=l.firstChild,f;)r.appendChild(f);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=se("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(h),this.options.closeButton){let l=this._closeButton=se("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let r;return this._classList.delete(h)?r=!1:(this._classList.add(h),r=!0),this._updateClassList(),r}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;let r=this._map,l=this._container,f=this._pos;if(!r||!l||!f)return"bottom";let g=l.offsetWidth,v=l.offsetHeight,b=f.x<g/2,T=f.x>r.transform.width-g/2;if(f.y+h<v)return b?"top-left":T?"top-right":"top";if(f.y>r.transform.height-v){if(b)return"bottom-left";if(T)return"bottom-right"}return b?"left":T?"right":"bottom"}_updateClassList(){let h=this._container;if(!h)return;let r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),h.className=r.join(" ")}_update(h){let r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let f=this._container;if(f||(f=this._container=se("div","mapboxgl-popup",r.getContainer()),this._tip=se("div","mapboxgl-popup-tip",f),f.appendChild(l)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=xh(this._lngLat,this._pos,r.transform)),!this._trackPointer||h){let g=this._pos=this._trackPointer&&h?h:r.project(this._lngLat),v=Bc(this.options.offset),b=this._anchor=this._getAnchor(v.y),T=Bc(this.options.offset,b),D=g.add(T).round();r._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${hl[b]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&r._showingGlobe()){let g=i.de(r.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let h=this._container.querySelector(jg);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Nc,Style:mo,LngLat:i.bq,LngLatBounds:i.ag,Point:i.P,MercatorCoordinate:i.O,FreeCameraOptions:Ya,Evented:i.E,config:i.dd,prewarm:i.dy,clearPrewarmedResources:i.dz,get accessToken(){return i.dd.ACCESS_TOKEN},set accessToken(h){i.dd.ACCESS_TOKEN=h},get baseApiUrl(){return i.dd.API_URL},set baseApiUrl(h){i.dd.API_URL=h},get workerCount(){return i.dA.workerCount},set workerCount(h){i.dA.workerCount=h},get maxParallelImageRequests(){return i.dd.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){i.dd.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){i.dB(h)},get workerUrl(){return i.dC.workerUrl},set workerUrl(h){i.dC.workerUrl=h},get workerClass(){return i.dC.workerClass},set workerClass(h){i.dC.workerClass=h},get workerParams(){return i.dC.workerParams},set workerParams(h){i.dC.workerParams=h},get dracoUrl(){return i.dD()},set dracoUrl(h){i.dE(h)},get meshoptUrl(){return i.dF()},set meshoptUrl(h){i.dG(h)},setNow:i.f.setNow,restoreNow:i.f.restoreNow}});var y=m;return y})});var oM=null;var e1=1,sM=Symbol("SIGNAL");function qn(s){let a=oM;return oM=s,a}var aM={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function jk(s){if(!(r1(s)&&!s.dirty)&&!(!s.dirty&&s.lastCleanEpoch===e1)){if(!s.producerMustRecompute(s)&&!t1(s)){s.dirty=!1,s.lastCleanEpoch=e1;return}s.producerRecomputeValue(s),s.dirty=!1,s.lastCleanEpoch=e1}}function lM(s){return s&&(s.nextProducerIndex=0),qn(s)}function cM(s,a){if(qn(a),!(!s||s.producerNode===void 0||s.producerIndexOfThis===void 0||s.producerLastReadVersion===void 0)){if(r1(s))for(let m=s.nextProducerIndex;m<s.producerNode.length;m++)n1(s.producerNode[m],s.producerIndexOfThis[m]);for(;s.producerNode.length>s.nextProducerIndex;)s.producerNode.pop(),s.producerLastReadVersion.pop(),s.producerIndexOfThis.pop()}}function t1(s){G_(s);for(let a=0;a<s.producerNode.length;a++){let m=s.producerNode[a],d=s.producerLastReadVersion[a];if(d!==m.version||(jk(m),d!==m.version))return!0}return!1}function uM(s){if(G_(s),r1(s))for(let a=0;a<s.producerNode.length;a++)n1(s.producerNode[a],s.producerIndexOfThis[a]);s.producerNode.length=s.producerLastReadVersion.length=s.producerIndexOfThis.length=0,s.liveConsumerNode&&(s.liveConsumerNode.length=s.liveConsumerIndexOfThis.length=0)}function n1(s,a){if(Vk(s),G_(s),s.liveConsumerNode.length===1)for(let d=0;d<s.producerNode.length;d++)n1(s.producerNode[d],s.producerIndexOfThis[d]);let m=s.liveConsumerNode.length-1;if(s.liveConsumerNode[a]=s.liveConsumerNode[m],s.liveConsumerIndexOfThis[a]=s.liveConsumerIndexOfThis[m],s.liveConsumerNode.length--,s.liveConsumerIndexOfThis.length--,a<s.liveConsumerNode.length){let d=s.liveConsumerIndexOfThis[a],y=s.liveConsumerNode[a];G_(y),y.producerIndexOfThis[d]=a}}function r1(s){return s.consumerIsAlwaysLive||(s?.liveConsumerNode?.length??0)>0}function G_(s){s.producerNode??=[],s.producerIndexOfThis??=[],s.producerLastReadVersion??=[]}function Vk(s){s.liveConsumerNode??=[],s.liveConsumerIndexOfThis??=[]}function Uk(){throw new Error}var $k=Uk;function hM(s){$k=s}function En(s){return typeof s=="function"}function Zh(s){let m=s(d=>{Error.call(d),d.stack=new Error().stack});return m.prototype=Object.create(Error.prototype),m.prototype.constructor=m,m}var H_=Zh(s=>function(m){s(this),this.message=m?`${m.length} errors occurred during unsubscription:
${m.map((d,y)=>`${y+1}) ${d.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=m});function xp(s,a){if(s){let m=s.indexOf(a);0<=m&&s.splice(m,1)}}var ei=class s{constructor(a){this.initialTeardown=a,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let a;if(!this.closed){this.closed=!0;let{_parentage:m}=this;if(m)if(this._parentage=null,Array.isArray(m))for(let i of m)i.remove(this);else m.remove(this);let{initialTeardown:d}=this;if(En(d))try{d()}catch(i){a=i instanceof H_?i.errors:[i]}let{_finalizers:y}=this;if(y){this._finalizers=null;for(let i of y)try{dM(i)}catch(M){a=a??[],M instanceof H_?a=[...a,...M.errors]:a.push(M)}}if(a)throw new H_(a)}}add(a){var m;if(a&&a!==this)if(this.closed)dM(a);else{if(a instanceof s){if(a.closed||a._hasParent(this))return;a._addParent(this)}(this._finalizers=(m=this._finalizers)!==null&&m!==void 0?m:[]).push(a)}}_hasParent(a){let{_parentage:m}=this;return m===a||Array.isArray(m)&&m.includes(a)}_addParent(a){let{_parentage:m}=this;this._parentage=Array.isArray(m)?(m.push(a),m):m?[m,a]:a}_removeParent(a){let{_parentage:m}=this;m===a?this._parentage=null:Array.isArray(m)&&xp(m,a)}remove(a){let{_finalizers:m}=this;m&&xp(m,a),a instanceof s&&a._removeParent(this)}};ei.EMPTY=(()=>{let s=new ei;return s.closed=!0,s})();var i1=ei.EMPTY;function q_(s){return s instanceof ei||s&&"closed"in s&&En(s.remove)&&En(s.add)&&En(s.unsubscribe)}function dM(s){En(s)?s():s.unsubscribe()}var ds={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Qh={setTimeout(s,a,...m){let{delegate:d}=Qh;return d?.setTimeout?d.setTimeout(s,a,...m):setTimeout(s,a,...m)},clearTimeout(s){let{delegate:a}=Qh;return(a?.clearTimeout||clearTimeout)(s)},delegate:void 0};function W_(s){Qh.setTimeout(()=>{let{onUnhandledError:a}=ds;if(a)a(s);else throw s})}function bp(){}var fM=o1("C",void 0,void 0);function pM(s){return o1("E",void 0,s)}function mM(s){return o1("N",s,void 0)}function o1(s,a,m){return{kind:s,value:a,error:m}}var iu=null;function Yh(s){if(ds.useDeprecatedSynchronousErrorHandling){let a=!iu;if(a&&(iu={errorThrown:!1,error:null}),s(),a){let{errorThrown:m,error:d}=iu;if(iu=null,m)throw d}}else s()}function gM(s){ds.useDeprecatedSynchronousErrorHandling&&iu&&(iu.errorThrown=!0,iu.error=s)}var ou=class extends ei{constructor(a){super(),this.isStopped=!1,a?(this.destination=a,q_(a)&&a.add(this)):this.destination=qk}static create(a,m,d){return new Xh(a,m,d)}next(a){this.isStopped?a1(mM(a),this):this._next(a)}error(a){this.isStopped?a1(pM(a),this):(this.isStopped=!0,this._error(a))}complete(){this.isStopped?a1(fM,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(a){this.destination.next(a)}_error(a){try{this.destination.error(a)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Gk=Function.prototype.bind;function s1(s,a){return Gk.call(s,a)}var l1=class{constructor(a){this.partialObserver=a}next(a){let{partialObserver:m}=this;if(m.next)try{m.next(a)}catch(d){Z_(d)}}error(a){let{partialObserver:m}=this;if(m.error)try{m.error(a)}catch(d){Z_(d)}else Z_(a)}complete(){let{partialObserver:a}=this;if(a.complete)try{a.complete()}catch(m){Z_(m)}}},Xh=class extends ou{constructor(a,m,d){super();let y;if(En(a)||!a)y={next:a??void 0,error:m??void 0,complete:d??void 0};else{let i;this&&ds.useDeprecatedNextContext?(i=Object.create(a),i.unsubscribe=()=>this.unsubscribe(),y={next:a.next&&s1(a.next,i),error:a.error&&s1(a.error,i),complete:a.complete&&s1(a.complete,i)}):y=a}this.destination=new l1(y)}};function Z_(s){ds.useDeprecatedSynchronousErrorHandling?gM(s):W_(s)}function Hk(s){throw s}function a1(s,a){let{onStoppedNotification:m}=ds;m&&Qh.setTimeout(()=>m(s,a))}var qk={closed:!0,next:bp,error:Hk,complete:bp};var Kh=typeof Symbol=="function"&&Symbol.observable||"@@observable";function To(s){return s}function c1(...s){return u1(s)}function u1(s){return s.length===0?To:s.length===1?s[0]:function(m){return s.reduce((d,y)=>y(d),m)}}var ir=(()=>{class s{constructor(m){m&&(this._subscribe=m)}lift(m){let d=new s;return d.source=this,d.operator=m,d}subscribe(m,d,y){let i=Zk(m)?m:new Xh(m,d,y);return Yh(()=>{let{operator:M,source:L}=this;i.add(M?M.call(i,L):L?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(m){try{return this._subscribe(m)}catch(d){m.error(d)}}forEach(m,d){return d=_M(d),new d((y,i)=>{let M=new Xh({next:L=>{try{m(L)}catch(B){i(B),M.unsubscribe()}},error:i,complete:y});this.subscribe(M)})}_subscribe(m){var d;return(d=this.source)===null||d===void 0?void 0:d.subscribe(m)}[Kh](){return this}pipe(...m){return u1(m)(this)}toPromise(m){return m=_M(m),new m((d,y)=>{let i;this.subscribe(M=>i=M,M=>y(M),()=>d(i))})}}return s.create=a=>new s(a),s})();function _M(s){var a;return(a=s??ds.Promise)!==null&&a!==void 0?a:Promise}function Wk(s){return s&&En(s.next)&&En(s.error)&&En(s.complete)}function Zk(s){return s&&s instanceof ou||Wk(s)&&q_(s)}function h1(s){return En(s?.lift)}function Yn(s){return a=>{if(h1(a))return a.lift(function(m){try{return s(m,this)}catch(d){this.error(d)}});throw new TypeError("Unable to lift unknown Observable type")}}function Xn(s,a,m,d,y){return new d1(s,a,m,d,y)}var d1=class extends ou{constructor(a,m,d,y,i,M){super(a),this.onFinalize=i,this.shouldUnsubscribe=M,this._next=m?function(L){try{m(L)}catch(B){a.error(B)}}:super._next,this._error=y?function(L){try{y(L)}catch(B){a.error(B)}finally{this.unsubscribe()}}:super._error,this._complete=d?function(){try{d()}catch(L){a.error(L)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var a;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:m}=this;super.unsubscribe(),!m&&((a=this.onFinalize)===null||a===void 0||a.call(this))}}};function Jh(){return Yn((s,a)=>{let m=null;s._refCount++;let d=Xn(a,void 0,void 0,void 0,()=>{if(!s||s._refCount<=0||0<--s._refCount){m=null;return}let y=s._connection,i=m;m=null,y&&(!i||y===i)&&y.unsubscribe(),a.unsubscribe()});s.subscribe(d),d.closed||(m=s.connect())})}var ed=class extends ir{constructor(a,m){super(),this.source=a,this.subjectFactory=m,this._subject=null,this._refCount=0,this._connection=null,h1(a)&&(this.lift=a.lift)}_subscribe(a){return this.getSubject().subscribe(a)}getSubject(){let a=this._subject;return(!a||a.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:a}=this;this._subject=this._connection=null,a?.unsubscribe()}connect(){let a=this._connection;if(!a){a=this._connection=new ei;let m=this.getSubject();a.add(this.source.subscribe(Xn(m,void 0,()=>{this._teardown(),m.complete()},d=>{this._teardown(),m.error(d)},()=>this._teardown()))),a.closed&&(this._connection=null,a=ei.EMPTY)}return a}refCount(){return Jh()(this)}};var yM=Zh(s=>function(){s(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Gi=(()=>{class s extends ir{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(m){let d=new Q_(this,this);return d.operator=m,d}_throwIfClosed(){if(this.closed)throw new yM}next(m){Yh(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let d of this.currentObservers)d.next(m)}})}error(m){Yh(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=m;let{observers:d}=this;for(;d.length;)d.shift().error(m)}})}complete(){Yh(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:m}=this;for(;m.length;)m.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var m;return((m=this.observers)===null||m===void 0?void 0:m.length)>0}_trySubscribe(m){return this._throwIfClosed(),super._trySubscribe(m)}_subscribe(m){return this._throwIfClosed(),this._checkFinalizedStatuses(m),this._innerSubscribe(m)}_innerSubscribe(m){let{hasError:d,isStopped:y,observers:i}=this;return d||y?i1:(this.currentObservers=null,i.push(m),new ei(()=>{this.currentObservers=null,xp(i,m)}))}_checkFinalizedStatuses(m){let{hasError:d,thrownError:y,isStopped:i}=this;d?m.error(y):i&&m.complete()}asObservable(){let m=new ir;return m.source=this,m}}return s.create=(a,m)=>new Q_(a,m),s})(),Q_=class extends Gi{constructor(a,m){super(),this.destination=a,this.source=m}next(a){var m,d;(d=(m=this.destination)===null||m===void 0?void 0:m.next)===null||d===void 0||d.call(m,a)}error(a){var m,d;(d=(m=this.destination)===null||m===void 0?void 0:m.error)===null||d===void 0||d.call(m,a)}complete(){var a,m;(m=(a=this.destination)===null||a===void 0?void 0:a.complete)===null||m===void 0||m.call(a)}_subscribe(a){var m,d;return(d=(m=this.source)===null||m===void 0?void 0:m.subscribe(a))!==null&&d!==void 0?d:i1}};var bi=class extends Gi{constructor(a){super(),this._value=a}get value(){return this.getValue()}_subscribe(a){let m=super._subscribe(a);return!m.closed&&a.next(this._value),m}getValue(){let{hasError:a,thrownError:m,_value:d}=this;if(a)throw m;return this._throwIfClosed(),d}next(a){super.next(this._value=a)}};var Eo=new ir(s=>s.complete());function vM(s){return s&&En(s.schedule)}function xM(s){return s[s.length-1]}function bM(s){return En(xM(s))?s.pop():void 0}function Ol(s){return vM(xM(s))?s.pop():void 0}function TM(s,a,m,d){function y(i){return i instanceof m?i:new m(function(M){M(i)})}return new(m||(m=Promise))(function(i,M){function L(se){try{q(d.next(se))}catch(ge){M(ge)}}function B(se){try{q(d.throw(se))}catch(ge){M(ge)}}function q(se){se.done?i(se.value):y(se.value).then(L,B)}q((d=d.apply(s,a||[])).next())})}function wM(s){var a=typeof Symbol=="function"&&Symbol.iterator,m=a&&s[a],d=0;if(m)return m.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&d>=s.length&&(s=void 0),{value:s&&s[d++],done:!s}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")}function su(s){return this instanceof su?(this.v=s,this):new su(s)}function EM(s,a,m){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=m.apply(s,a||[]),y,i=[];return y={},M("next"),M("throw"),M("return"),y[Symbol.asyncIterator]=function(){return this},y;function M(Pe){d[Pe]&&(y[Pe]=function(Ke){return new Promise(function(Nt,sn){i.push([Pe,Ke,Nt,sn])>1||L(Pe,Ke)})})}function L(Pe,Ke){try{B(d[Pe](Ke))}catch(Nt){ge(i[0][3],Nt)}}function B(Pe){Pe.value instanceof su?Promise.resolve(Pe.value.v).then(q,se):ge(i[0][2],Pe)}function q(Pe){L("next",Pe)}function se(Pe){L("throw",Pe)}function ge(Pe,Ke){Pe(Ke),i.shift(),i.length&&L(i[0][0],i[0][1])}}function IM(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=s[Symbol.asyncIterator],m;return a?a.call(s):(s=typeof wM=="function"?wM(s):s[Symbol.iterator](),m={},d("next"),d("throw"),d("return"),m[Symbol.asyncIterator]=function(){return this},m);function d(i){m[i]=s[i]&&function(M){return new Promise(function(L,B){M=s[i](M),y(L,B,M.done,M.value)})}}function y(i,M,L,B){Promise.resolve(B).then(function(q){i({value:q,done:L})},M)}}var Y_=s=>s&&typeof s.length=="number"&&typeof s!="function";function X_(s){return En(s?.then)}function K_(s){return En(s[Kh])}function J_(s){return Symbol.asyncIterator&&En(s?.[Symbol.asyncIterator])}function ey(s){return new TypeError(`You provided ${s!==null&&typeof s=="object"?"an invalid object":`'${s}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function Qk(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ty=Qk();function ny(s){return En(s?.[ty])}function ry(s){return EM(this,arguments,function*(){let m=s.getReader();try{for(;;){let{value:d,done:y}=yield su(m.read());if(y)return yield su(void 0);yield yield su(d)}}finally{m.releaseLock()}})}function iy(s){return En(s?.getReader)}function ci(s){if(s instanceof ir)return s;if(s!=null){if(K_(s))return Yk(s);if(Y_(s))return Xk(s);if(X_(s))return Kk(s);if(J_(s))return DM(s);if(ny(s))return Jk(s);if(iy(s))return eF(s)}throw ey(s)}function Yk(s){return new ir(a=>{let m=s[Kh]();if(En(m.subscribe))return m.subscribe(a);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Xk(s){return new ir(a=>{for(let m=0;m<s.length&&!a.closed;m++)a.next(s[m]);a.complete()})}function Kk(s){return new ir(a=>{s.then(m=>{a.closed||(a.next(m),a.complete())},m=>a.error(m)).then(null,W_)})}function Jk(s){return new ir(a=>{for(let m of s)if(a.next(m),a.closed)return;a.complete()})}function DM(s){return new ir(a=>{tF(s,a).catch(m=>a.error(m))})}function eF(s){return DM(ry(s))}function tF(s,a){var m,d,y,i;return TM(this,void 0,void 0,function*(){try{for(m=IM(s);d=yield m.next(),!d.done;){let M=d.value;if(a.next(M),a.closed)return}}catch(M){y={error:M}}finally{try{d&&!d.done&&(i=m.return)&&(yield i.call(m))}finally{if(y)throw y.error}}a.complete()})}function io(s,a,m,d=0,y=!1){let i=a.schedule(function(){m(),y?s.add(this.schedule(null,d)):this.unsubscribe()},d);if(s.add(i),!y)return i}function oy(s,a=0){return Yn((m,d)=>{m.subscribe(Xn(d,y=>io(d,s,()=>d.next(y),a),()=>io(d,s,()=>d.complete(),a),y=>io(d,s,()=>d.error(y),a)))})}function sy(s,a=0){return Yn((m,d)=>{d.add(s.schedule(()=>m.subscribe(d),a))})}function MM(s,a){return ci(s).pipe(sy(a),oy(a))}function SM(s,a){return ci(s).pipe(sy(a),oy(a))}function CM(s,a){return new ir(m=>{let d=0;return a.schedule(function(){d===s.length?m.complete():(m.next(s[d++]),m.closed||this.schedule())})})}function AM(s,a){return new ir(m=>{let d;return io(m,a,()=>{d=s[ty](),io(m,a,()=>{let y,i;try{({value:y,done:i}=d.next())}catch(M){m.error(M);return}i?m.complete():m.next(y)},0,!0)}),()=>En(d?.return)&&d.return()})}function ay(s,a){if(!s)throw new Error("Iterable cannot be null");return new ir(m=>{io(m,a,()=>{let d=s[Symbol.asyncIterator]();io(m,a,()=>{d.next().then(y=>{y.done?m.complete():m.next(y.value)})},0,!0)})})}function PM(s,a){return ay(ry(s),a)}function RM(s,a){if(s!=null){if(K_(s))return MM(s,a);if(Y_(s))return CM(s,a);if(X_(s))return SM(s,a);if(J_(s))return ay(s,a);if(ny(s))return AM(s,a);if(iy(s))return PM(s,a)}throw ey(s)}function Pr(s,a){return a?RM(s,a):ci(s)}function on(...s){let a=Ol(s);return Pr(s,a)}function td(s,a){let m=En(s)?s:()=>s,d=y=>y.error(m());return new ir(a?y=>a.schedule(d,0,y):d)}function f1(s){return!!s&&(s instanceof ir||En(s.lift)&&En(s.subscribe))}var Ea=Zh(s=>function(){s(this),this.name="EmptyError",this.message="no elements in sequence"});function On(s,a){return Yn((m,d)=>{let y=0;m.subscribe(Xn(d,i=>{d.next(s.call(a,i,y++))}))})}var{isArray:nF}=Array;function rF(s,a){return nF(a)?s(...a):s(a)}function OM(s){return On(a=>rF(s,a))}var{isArray:iF}=Array,{getPrototypeOf:oF,prototype:sF,keys:aF}=Object;function LM(s){if(s.length===1){let a=s[0];if(iF(a))return{args:a,keys:null};if(lF(a)){let m=aF(a);return{args:m.map(d=>a[d]),keys:m}}}return{args:s,keys:null}}function lF(s){return s&&typeof s=="object"&&oF(s)===sF}function kM(s,a){return s.reduce((m,d,y)=>(m[d]=a[y],m),{})}function wp(...s){let a=Ol(s),m=bM(s),{args:d,keys:y}=LM(s);if(d.length===0)return Pr([],a);let i=new ir(cF(d,a,y?M=>kM(y,M):To));return m?i.pipe(OM(m)):i}function cF(s,a,m=To){return d=>{FM(a,()=>{let{length:y}=s,i=new Array(y),M=y,L=y;for(let B=0;B<y;B++)FM(a,()=>{let q=Pr(s[B],a),se=!1;q.subscribe(Xn(d,ge=>{i[B]=ge,se||(se=!0,L--),L||d.next(m(i.slice()))},()=>{--M||d.complete()}))},d)},d)}}function FM(s,a,m){s?io(m,s,a):a()}function NM(s,a,m,d,y,i,M,L){let B=[],q=0,se=0,ge=!1,Pe=()=>{ge&&!B.length&&!q&&a.complete()},Ke=sn=>q<d?Nt(sn):B.push(sn),Nt=sn=>{i&&a.next(sn),q++;let Rt=!1;ci(m(sn,se++)).subscribe(Xn(a,bt=>{y?.(bt),i?Ke(bt):a.next(bt)},()=>{Rt=!0},void 0,()=>{if(Rt)try{for(q--;B.length&&q<d;){let bt=B.shift();M?io(a,M,()=>Nt(bt)):Nt(bt)}Pe()}catch(bt){a.error(bt)}}))};return s.subscribe(Xn(a,Ke,()=>{ge=!0,Pe()})),()=>{L?.()}}function qr(s,a,m=1/0){return En(a)?qr((d,y)=>On((i,M)=>a(d,i,y,M))(ci(s(d,y))),m):(typeof a=="number"&&(m=a),Yn((d,y)=>NM(d,y,s,m)))}function nd(s=1/0){return qr(To,s)}function zM(){return nd(1)}function rd(...s){return zM()(Pr(s,Ol(s)))}function ly(s){return new ir(a=>{ci(s()).subscribe(a)})}function oo(s,a){return Yn((m,d)=>{let y=0;m.subscribe(Xn(d,i=>s.call(a,i,y++)&&d.next(i)))})}function Ll(s){return Yn((a,m)=>{let d=null,y=!1,i;d=a.subscribe(Xn(m,void 0,void 0,M=>{i=ci(s(M,Ll(s)(a))),d?(d.unsubscribe(),d=null,i.subscribe(m)):y=!0})),y&&(d.unsubscribe(),d=null,i.subscribe(m))})}function BM(s,a,m,d,y){return(i,M)=>{let L=m,B=a,q=0;i.subscribe(Xn(M,se=>{let ge=q++;B=L?s(B,se,ge):(L=!0,se),d&&M.next(B)},y&&(()=>{L&&M.next(B),M.complete()})))}}function Ia(s,a){return En(a)?qr(s,a,1):qr(s,1)}function kl(s){return Yn((a,m)=>{let d=!1;a.subscribe(Xn(m,y=>{d=!0,m.next(y)},()=>{d||m.next(s),m.complete()}))})}function Da(s){return s<=0?()=>Eo:Yn((a,m)=>{let d=0;a.subscribe(Xn(m,y=>{++d<=s&&(m.next(y),s<=d&&m.complete())}))})}function p1(s){return On(()=>s)}function cy(s=uF){return Yn((a,m)=>{let d=!1;a.subscribe(Xn(m,y=>{d=!0,m.next(y)},()=>d?m.complete():m.error(s())))})}function uF(){return new Ea}function Fl(s){return Yn((a,m)=>{try{a.subscribe(m)}finally{m.add(s)}})}function fs(s,a){let m=arguments.length>=2;return d=>d.pipe(s?oo((y,i)=>s(y,i,d)):To,Da(1),m?kl(a):cy(()=>new Ea))}function id(s){return s<=0?()=>Eo:Yn((a,m)=>{let d=[];a.subscribe(Xn(m,y=>{d.push(y),s<d.length&&d.shift()},()=>{for(let y of d)m.next(y);m.complete()},void 0,()=>{d=null}))})}function m1(s,a){let m=arguments.length>=2;return d=>d.pipe(s?oo((y,i)=>s(y,i,d)):To,id(1),m?kl(a):cy(()=>new Ea))}function g1(s,a){return Yn(BM(s,a,arguments.length>=2,!0))}function _1(...s){let a=Ol(s);return Yn((m,d)=>{(a?rd(s,m,a):rd(s,m)).subscribe(d)})}function so(s,a){return Yn((m,d)=>{let y=null,i=0,M=!1,L=()=>M&&!y&&d.complete();m.subscribe(Xn(d,B=>{y?.unsubscribe();let q=0,se=i++;ci(s(B,se)).subscribe(y=Xn(d,ge=>d.next(a?a(B,ge,se,q++):ge),()=>{y=null,L()}))},()=>{M=!0,L()}))})}function y1(s){return Yn((a,m)=>{ci(s).subscribe(Xn(m,()=>m.complete(),bp)),!m.closed&&a.subscribe(m)})}function ti(s,a,m){let d=En(s)||a||m?{next:s,error:a,complete:m}:s;return d?Yn((y,i)=>{var M;(M=d.subscribe)===null||M===void 0||M.call(d);let L=!0;y.subscribe(Xn(i,B=>{var q;(q=d.next)===null||q===void 0||q.call(d,B),i.next(B)},()=>{var B;L=!1,(B=d.complete)===null||B===void 0||B.call(d),i.complete()},B=>{var q;L=!1,(q=d.error)===null||q===void 0||q.call(d,B),i.error(B)},()=>{var B,q;L&&((B=d.unsubscribe)===null||B===void 0||B.call(d)),(q=d.finalize)===null||q===void 0||q.call(d)}))}):To}var hF="https://g.co/ng/security#xss",Xt=class extends Error{constructor(a,m){super($y(a,m)),this.code=a}};function $y(s,a){return`${`NG0${Math.abs(s)}`}${a?": "+a:""}`}function Up(s){return{toString:s}.toString()}var uy="__parameters__";function dF(s){return function(...m){if(s){let d=s(...m);for(let y in d)this[y]=d[y]}}}function TS(s,a,m){return Up(()=>{let d=dF(a);function y(...i){if(this instanceof y)return d.apply(this,i),this;let M=new y(...i);return L.annotation=M,L;function L(B,q,se){let ge=B.hasOwnProperty(uy)?B[uy]:Object.defineProperty(B,uy,{value:[]})[uy];for(;ge.length<=se;)ge.push(null);return(ge[se]=ge[se]||[]).push(M),B}}return m&&(y.prototype=Object.create(m.prototype)),y.prototype.ngMetadataName=s,y.annotationCls=y,y})}var Io=globalThis;function yr(s){for(let a in s)if(s[a]===yr)return a;throw Error("Could not find renamed property on target object.")}function ao(s){if(typeof s=="string")return s;if(Array.isArray(s))return"["+s.map(ao).join(", ")+"]";if(s==null)return""+s;if(s.overriddenName)return`${s.overriddenName}`;if(s.name)return`${s.name}`;let a=s.toString();if(a==null)return""+a;let m=a.indexOf(`
`);return m===-1?a:a.substring(0,m)}function jM(s,a){return s==null||s===""?a===null?"":a:a==null||a===""?s:s+" "+a}var fF=yr({__forward_ref__:yr});function ES(s){return s.__forward_ref__=ES,s.toString=function(){return ao(this())},s}function $o(s){return IS(s)?s():s}function IS(s){return typeof s=="function"&&s.hasOwnProperty(fF)&&s.__forward_ref__===ES}function kt(s){return{token:s.token,providedIn:s.providedIn||null,factory:s.factory,value:void 0}}function Hi(s){return{providers:s.providers||[],imports:s.imports||[]}}function Gy(s){return VM(s,MS)||VM(s,SS)}function DS(s){return Gy(s)!==null}function VM(s,a){return s.hasOwnProperty(a)?s[a]:null}function pF(s){let a=s&&(s[MS]||s[SS]);return a||null}function UM(s){return s&&(s.hasOwnProperty($M)||s.hasOwnProperty(mF))?s[$M]:null}var MS=yr({\u0275prov:yr}),$M=yr({\u0275inj:yr}),SS=yr({ngInjectableDef:yr}),mF=yr({ngInjectorDef:yr}),Wt=class{constructor(a,m){this._desc=a,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof m=="number"?this.__NG_ELEMENT_ID__=m:m!==void 0&&(this.\u0275prov=kt({token:this,providedIn:m.providedIn||"root",factory:m.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function CS(s){return s&&!!s.\u0275providers}var gF=yr({\u0275cmp:yr}),_F=yr({\u0275dir:yr}),yF=yr({\u0275pipe:yr}),vF=yr({\u0275mod:yr}),by=yr({\u0275fac:yr}),Ep=yr({__NG_ELEMENT_ID__:yr}),GM=yr({__NG_ENV_ID__:yr});function AS(s){return typeof s=="string"?s:s==null?"":String(s)}function xF(s){return typeof s=="function"?s.name||s.toString():typeof s=="object"&&s!=null&&typeof s.type=="function"?s.type.name||s.type.toString():AS(s)}function bF(s,a){let m=a?`. Dependency path: ${a.join(" > ")} > ${s}`:"";throw new Xt(-200,s)}function Pb(s,a){throw new Xt(-201,!1)}var zn=function(s){return s[s.Default=0]="Default",s[s.Host=1]="Host",s[s.Self=2]="Self",s[s.SkipSelf=4]="SkipSelf",s[s.Optional=8]="Optional",s}(zn||{}),L1;function PS(){return L1}function Uo(s){let a=L1;return L1=s,a}function RS(s,a,m){let d=Gy(s);if(d&&d.providedIn=="root")return d.value===void 0?d.value=d.factory():d.value;if(m&zn.Optional)return null;if(a!==void 0)return a;Pb(s,"Injector")}var wF={},Dp=wF,k1="__NG_DI_FLAG__",wy="ngTempTokenPath",TF="ngTokenPath",EF=/\n/gm,IF="\u0275",HM="__source",cd;function DF(){return cd}function Nl(s){let a=cd;return cd=s,a}function MF(s,a=zn.Default){if(cd===void 0)throw new Xt(-203,!1);return cd===null?RS(s,void 0,a):cd.get(s,a&zn.Optional?null:void 0,a)}function jt(s,a=zn.Default){return(PS()||MF)($o(s),a)}function Xe(s,a=zn.Default){return jt(s,Hy(a))}function Hy(s){return typeof s>"u"||typeof s=="number"?s:0|(s.optional&&8)|(s.host&&1)|(s.self&&2)|(s.skipSelf&&4)}function F1(s){let a=[];for(let m=0;m<s.length;m++){let d=$o(s[m]);if(Array.isArray(d)){if(d.length===0)throw new Xt(900,!1);let y,i=zn.Default;for(let M=0;M<d.length;M++){let L=d[M],B=SF(L);typeof B=="number"?B===-1?y=L.token:i|=B:y=L}a.push(jt(y,i))}else a.push(jt(d))}return a}function OS(s,a){return s[k1]=a,s.prototype[k1]=a,s}function SF(s){return s[k1]}function CF(s,a,m,d){let y=s[wy];throw a[HM]&&y.unshift(a[HM]),s.message=AF(`
`+s.message,y,m,d),s[TF]=y,s[wy]=null,s}function AF(s,a,m,d=null){s=s&&s.charAt(0)===`
`&&s.charAt(1)==IF?s.slice(2):s;let y=ao(a);if(Array.isArray(a))y=a.map(ao).join(" -> ");else if(typeof a=="object"){let i=[];for(let M in a)if(a.hasOwnProperty(M)){let L=a[M];i.push(M+":"+(typeof L=="string"?JSON.stringify(L):ao(L)))}y=`{${i.join(", ")}}`}return`${m}${d?"("+d+")":""}[${y}]: ${s.replace(EF,`
  `)}`}var Rb=OS(TS("Optional"),8);var LS=OS(TS("SkipSelf"),4);function hd(s,a){let m=s.hasOwnProperty(by);return m?s[by]:null}function PF(s,a,m){if(s.length!==a.length)return!1;for(let d=0;d<s.length;d++){let y=s[d],i=a[d];if(m&&(y=m(y),i=m(i)),i!==y)return!1}return!0}function RF(s){return s.flat(Number.POSITIVE_INFINITY)}function Ob(s,a){s.forEach(m=>Array.isArray(m)?Ob(m,a):a(m))}function kS(s,a,m){a>=s.length?s.push(m):s.splice(a,0,m)}function Ty(s,a){return a>=s.length-1?s.pop():s.splice(a,1)[0]}function OF(s,a,m,d){let y=s.length;if(y==a)s.push(m,d);else if(y===1)s.push(d,s[0]),s[0]=m;else{for(y--,s.push(s[y-1],s[y]);y>a;){let i=y-2;s[y]=s[i],y--}s[a]=m,s[a+1]=d}}function LF(s,a,m){let d=$p(s,a);return d>=0?s[d|1]=m:(d=~d,OF(s,d,a,m)),d}function v1(s,a){let m=$p(s,a);if(m>=0)return s[m|1]}function $p(s,a){return kF(s,a,1)}function kF(s,a,m){let d=0,y=s.length>>m;for(;y!==d;){let i=d+(y-d>>1),M=s[i<<m];if(a===M)return i<<m;M>a?y=i:d=i+1}return~(y<<m)}var Mp={},Go=[],lu=new Wt(""),FS=new Wt("",-1),NS=new Wt(""),Ey=class{get(a,m=Dp){if(m===Dp){let d=new Error(`NullInjectorError: No provider for ${ao(a)}!`);throw d.name="NullInjectorError",d}return m}},zS=function(s){return s[s.OnPush=0]="OnPush",s[s.Default=1]="Default",s}(zS||{}),js=function(s){return s[s.Emulated=0]="Emulated",s[s.None=2]="None",s[s.ShadowDom=3]="ShadowDom",s}(js||{}),Sa=function(s){return s[s.None=0]="None",s[s.SignalBased=1]="SignalBased",s[s.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",s}(Sa||{});function FF(s,a,m){let d=s.length;for(;;){let y=s.indexOf(a,m);if(y===-1)return y;if(y===0||s.charCodeAt(y-1)<=32){let i=a.length;if(y+i===d||s.charCodeAt(y+i)<=32)return y}m=y+1}}function N1(s,a,m){let d=0;for(;d<m.length;){let y=m[d];if(typeof y=="number"){if(y!==0)break;d++;let i=m[d++],M=m[d++],L=m[d++];s.setAttribute(a,M,L,i)}else{let i=y,M=m[++d];zF(i)?s.setProperty(a,i,M):s.setAttribute(a,i,M),d++}}return d}function NF(s){return s===3||s===4||s===6}function zF(s){return s.charCodeAt(0)===64}function Lb(s,a){if(!(a===null||a.length===0))if(s===null||s.length===0)s=a.slice();else{let m=-1;for(let d=0;d<a.length;d++){let y=a[d];typeof y=="number"?m=y:m===0||(m===-1||m===2?qM(s,m,y,null,a[++d]):qM(s,m,y,null,null))}}return s}function qM(s,a,m,d,y){let i=0,M=s.length;if(a===-1)M=-1;else for(;i<s.length;){let L=s[i++];if(typeof L=="number"){if(L===a){M=-1;break}else if(L>a){M=i-1;break}}}for(;i<s.length;){let L=s[i];if(typeof L=="number")break;if(L===m){if(d===null){y!==null&&(s[i+1]=y);return}else if(d===s[i+1]){s[i+2]=y;return}}i++,d!==null&&i++,y!==null&&i++}M!==-1&&(s.splice(M,0,a),i=M+1),s.splice(i++,0,m),d!==null&&s.splice(i++,0,d),y!==null&&s.splice(i++,0,y)}var BS="ng-template";function BF(s,a,m,d){let y=0;if(d){for(;y<a.length&&typeof a[y]=="string";y+=2)if(a[y]==="class"&&FF(a[y+1].toLowerCase(),m,0)!==-1)return!0}else if(kb(s))return!1;if(y=a.indexOf(1,y),y>-1){let i;for(;++y<a.length&&typeof(i=a[y])=="string";)if(i.toLowerCase()===m)return!0}return!1}function kb(s){return s.type===4&&s.value!==BS}function jF(s,a,m){let d=s.type===4&&!m?BS:s.value;return a===d}function VF(s,a,m){let d=4,y=s.attrs,i=y!==null?GF(y):0,M=!1;for(let L=0;L<a.length;L++){let B=a[L];if(typeof B=="number"){if(!M&&!ps(d)&&!ps(B))return!1;if(M&&ps(B))continue;M=!1,d=B|d&1;continue}if(!M)if(d&4){if(d=2|d&1,B!==""&&!jF(s,B,m)||B===""&&a.length===1){if(ps(d))return!1;M=!0}}else if(d&8){if(y===null||!BF(s,y,B,m)){if(ps(d))return!1;M=!0}}else{let q=a[++L],se=UF(B,y,kb(s),m);if(se===-1){if(ps(d))return!1;M=!0;continue}if(q!==""){let ge;if(se>i?ge="":ge=y[se+1].toLowerCase(),d&2&&q!==ge){if(ps(d))return!1;M=!0}}}}return ps(d)||M}function ps(s){return(s&1)===0}function UF(s,a,m,d){if(a===null)return-1;let y=0;if(d||!m){let i=!1;for(;y<a.length;){let M=a[y];if(M===s)return y;if(M===3||M===6)i=!0;else if(M===1||M===2){let L=a[++y];for(;typeof L=="string";)L=a[++y];continue}else{if(M===4)break;if(M===0){y+=4;continue}}y+=i?1:2}return-1}else return HF(a,s)}function $F(s,a,m=!1){for(let d=0;d<a.length;d++)if(VF(s,a[d],m))return!0;return!1}function GF(s){for(let a=0;a<s.length;a++){let m=s[a];if(NF(m))return a}return s.length}function HF(s,a){let m=s.indexOf(4);if(m>-1)for(m++;m<s.length;){let d=s[m];if(typeof d=="number")return-1;if(d===a)return m;m++}return-1}function WM(s,a){return s?":not("+a.trim()+")":a}function qF(s){let a=s[0],m=1,d=2,y="",i=!1;for(;m<s.length;){let M=s[m];if(typeof M=="string")if(d&2){let L=s[++m];y+="["+M+(L.length>0?'="'+L+'"':"")+"]"}else d&8?y+="."+M:d&4&&(y+=" "+M);else y!==""&&!ps(M)&&(a+=WM(i,y),y=""),d=M,i=i||!ps(d);m++}return y!==""&&(a+=WM(i,y)),a}function WF(s){return s.map(qF).join(",")}function ZF(s){let a=[],m=[],d=1,y=2;for(;d<s.length;){let i=s[d];if(typeof i=="string")y===2?i!==""&&a.push(i,s[++d]):y===8&&m.push(i);else{if(!ps(y))break;y=i}d++}return{attrs:a,classes:m}}function hi(s){return Up(()=>{let a=GS(s),m=Fr(Ct({},a),{decls:s.decls,vars:s.vars,template:s.template,consts:s.consts||null,ngContentSelectors:s.ngContentSelectors,onPush:s.changeDetection===zS.OnPush,directiveDefs:null,pipeDefs:null,dependencies:a.standalone&&s.dependencies||null,getStandaloneInjector:null,signals:s.signals??!1,data:s.data||{},encapsulation:s.encapsulation||js.Emulated,styles:s.styles||Go,_:null,schemas:s.schemas||null,tView:null,id:""});HS(m);let d=s.dependencies;return m.directiveDefs=QM(d,!1),m.pipeDefs=QM(d,!0),m.id=XF(m),m})}function QF(s){return Bl(s)||jS(s)}function YF(s){return s!==null}function qi(s){return Up(()=>({type:s.type,bootstrap:s.bootstrap||Go,declarations:s.declarations||Go,imports:s.imports||Go,exports:s.exports||Go,transitiveCompileScopes:null,schemas:s.schemas||null,id:s.id||null}))}function ZM(s,a){if(s==null)return Mp;let m={};for(let d in s)if(s.hasOwnProperty(d)){let y=s[d],i,M,L=Sa.None;Array.isArray(y)?(L=y[0],i=y[1],M=y[2]??i):(i=y,M=y),a?(m[i]=L!==Sa.None?[d,L]:d,a[i]=M):m[i]=d}return m}function qy(s){return Up(()=>{let a=GS(s);return HS(a),a})}function Bl(s){return s[gF]||null}function jS(s){return s[_F]||null}function VS(s){return s[yF]||null}function US(s){let a=Bl(s)||jS(s)||VS(s);return a!==null?a.standalone:!1}function $S(s,a){let m=s[vF]||null;if(!m&&a===!0)throw new Error(`Type ${ao(s)} does not have '\u0275mod' property.`);return m}function GS(s){let a={};return{type:s.type,providersResolver:null,factory:null,hostBindings:s.hostBindings||null,hostVars:s.hostVars||0,hostAttrs:s.hostAttrs||null,contentQueries:s.contentQueries||null,declaredInputs:a,inputTransforms:null,inputConfig:s.inputs||Mp,exportAs:s.exportAs||null,standalone:s.standalone===!0,signals:s.signals===!0,selectors:s.selectors||Go,viewQuery:s.viewQuery||null,features:s.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:ZM(s.inputs,a),outputs:ZM(s.outputs),debugInfo:null}}function HS(s){s.features?.forEach(a=>a(s))}function QM(s,a){if(!s)return null;let m=a?VS:QF;return()=>(typeof s=="function"?s():s).map(d=>m(d)).filter(YF)}function XF(s){let a=0,m=[s.selectors,s.ngContentSelectors,s.hostVars,s.hostAttrs,s.consts,s.vars,s.decls,s.encapsulation,s.standalone,s.signals,s.exportAs,JSON.stringify(s.inputs),JSON.stringify(s.outputs),Object.getOwnPropertyNames(s.type.prototype),!!s.contentQueries,!!s.viewQuery].join("|");for(let y of m)a=Math.imul(31,a)+y.charCodeAt(0)<<0;return a+=2147483648,"c"+a}function _d(s){return{\u0275providers:s}}function KF(...s){return{\u0275providers:qS(!0,s),\u0275fromNgModule:!0}}function qS(s,...a){let m=[],d=new Set,y,i=M=>{m.push(M)};return Ob(a,M=>{let L=M;z1(L,i,[],d)&&(y||=[],y.push(L))}),y!==void 0&&WS(y,i),m}function WS(s,a){for(let m=0;m<s.length;m++){let{ngModule:d,providers:y}=s[m];Fb(y,i=>{a(i,d)})}}function z1(s,a,m,d){if(s=$o(s),!s)return!1;let y=null,i=UM(s),M=!i&&Bl(s);if(!i&&!M){let B=s.ngModule;if(i=UM(B),i)y=B;else return!1}else{if(M&&!M.standalone)return!1;y=s}let L=d.has(y);if(M){if(L)return!1;if(d.add(y),M.dependencies){let B=typeof M.dependencies=="function"?M.dependencies():M.dependencies;for(let q of B)z1(q,a,m,d)}}else if(i){if(i.imports!=null&&!L){d.add(y);let q;try{Ob(i.imports,se=>{z1(se,a,m,d)&&(q||=[],q.push(se))})}finally{}q!==void 0&&WS(q,a)}if(!L){let q=hd(y)||(()=>new y);a({provide:y,useFactory:q,deps:Go},y),a({provide:NS,useValue:y,multi:!0},y),a({provide:lu,useValue:()=>jt(y),multi:!0},y)}let B=i.providers;if(B!=null&&!L){let q=s;Fb(B,se=>{a(se,q)})}}else return!1;return y!==s&&s.providers!==void 0}function Fb(s,a){for(let m of s)CS(m)&&(m=m.\u0275providers),Array.isArray(m)?Fb(m,a):a(m)}var JF=yr({provide:String,useValue:yr});function ZS(s){return s!==null&&typeof s=="object"&&JF in s}function eN(s){return!!(s&&s.useExisting)}function tN(s){return!!(s&&s.useFactory)}function B1(s){return typeof s=="function"}var Wy=new Wt(""),my={},nN={},x1;function Nb(){return x1===void 0&&(x1=new Ey),x1}var ki=class{},Sp=class extends ki{get destroyed(){return this._destroyed}constructor(a,m,d,y){super(),this.parent=m,this.source=d,this.scopes=y,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,V1(a,M=>this.processProvider(M)),this.records.set(FS,od(void 0,this)),y.has("environment")&&this.records.set(ki,od(void 0,this));let i=this.records.get(Wy);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(NS,Go,zn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let a=qn(null);try{for(let d of this._ngOnDestroyHooks)d.ngOnDestroy();let m=this._onDestroyHooks;this._onDestroyHooks=[];for(let d of m)d()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),qn(a)}}onDestroy(a){return this.assertNotDestroyed(),this._onDestroyHooks.push(a),()=>this.removeOnDestroy(a)}runInContext(a){this.assertNotDestroyed();let m=Nl(this),d=Uo(void 0),y;try{return a()}finally{Nl(m),Uo(d)}}get(a,m=Dp,d=zn.Default){if(this.assertNotDestroyed(),a.hasOwnProperty(GM))return a[GM](this);d=Hy(d);let y,i=Nl(this),M=Uo(void 0);try{if(!(d&zn.SkipSelf)){let B=this.records.get(a);if(B===void 0){let q=lN(a)&&Gy(a);q&&this.injectableDefInScope(q)?B=od(j1(a),my):B=null,this.records.set(a,B)}if(B!=null)return this.hydrate(a,B)}let L=d&zn.Self?Nb():this.parent;return m=d&zn.Optional&&m===Dp?null:m,L.get(a,m)}catch(L){if(L.name==="NullInjectorError"){if((L[wy]=L[wy]||[]).unshift(ao(a)),i)throw L;return CF(L,a,"R3InjectorError",this.source)}else throw L}finally{Uo(M),Nl(i)}}resolveInjectorInitializers(){let a=qn(null),m=Nl(this),d=Uo(void 0),y;try{let i=this.get(lu,Go,zn.Self);for(let M of i)M()}finally{Nl(m),Uo(d),qn(a)}}toString(){let a=[],m=this.records;for(let d of m.keys())a.push(ao(d));return`R3Injector[${a.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Xt(205,!1)}processProvider(a){a=$o(a);let m=B1(a)?a:$o(a&&a.provide),d=iN(a);if(!B1(a)&&a.multi===!0){let y=this.records.get(m);y||(y=od(void 0,my,!0),y.factory=()=>F1(y.multi),this.records.set(m,y)),m=a,y.multi.push(a)}this.records.set(m,d)}hydrate(a,m){let d=qn(null);try{return m.value===my&&(m.value=nN,m.value=m.factory()),typeof m.value=="object"&&m.value&&aN(m.value)&&this._ngOnDestroyHooks.add(m.value),m.value}finally{qn(d)}}injectableDefInScope(a){if(!a.providedIn)return!1;let m=$o(a.providedIn);return typeof m=="string"?m==="any"||this.scopes.has(m):this.injectorDefTypes.has(m)}removeOnDestroy(a){let m=this._onDestroyHooks.indexOf(a);m!==-1&&this._onDestroyHooks.splice(m,1)}};function j1(s){let a=Gy(s),m=a!==null?a.factory:hd(s);if(m!==null)return m;if(s instanceof Wt)throw new Xt(204,!1);if(s instanceof Function)return rN(s);throw new Xt(204,!1)}function rN(s){if(s.length>0)throw new Xt(204,!1);let m=pF(s);return m!==null?()=>m.factory(s):()=>new s}function iN(s){if(ZS(s))return od(void 0,s.useValue);{let a=oN(s);return od(a,my)}}function oN(s,a,m){let d;if(B1(s)){let y=$o(s);return hd(y)||j1(y)}else if(ZS(s))d=()=>$o(s.useValue);else if(tN(s))d=()=>s.useFactory(...F1(s.deps||[]));else if(eN(s))d=()=>jt($o(s.useExisting));else{let y=$o(s&&(s.useClass||s.provide));if(sN(s))d=()=>new y(...F1(s.deps));else return hd(y)||j1(y)}return d}function od(s,a,m=!1){return{factory:s,value:a,multi:m?[]:void 0}}function sN(s){return!!s.deps}function aN(s){return s!==null&&typeof s=="object"&&typeof s.ngOnDestroy=="function"}function lN(s){return typeof s=="function"||typeof s=="object"&&s instanceof Wt}function V1(s,a){for(let m of s)Array.isArray(m)?V1(m,a):m&&CS(m)?V1(m.\u0275providers,a):a(m)}function _s(s,a){s instanceof Sp&&s.assertNotDestroyed();let m,d=Nl(s),y=Uo(void 0);try{return a()}finally{Nl(d),Uo(y)}}function QS(){return PS()!==void 0||DF()!=null}function cN(s){if(!QS())throw new Xt(-203,!1)}function uN(s){let a=Io.ng;if(a&&a.\u0275compilerFacade)return a.\u0275compilerFacade;throw new Error("JIT compiler unavailable")}function hN(s){return typeof s=="function"}var Do=0,bn=1,fn=2,ui=3,ms=4,ys=5,Ho=6,Cp=7,Li=8,dd=9,Vs=10,Nr=11,Ap=12,YM=13,yd=14,Mo=15,Gp=16,sd=17,Ca=18,Zy=19,YS=20,zl=21,b1=22,cu=23,Ti=25,XS=1,Pp=6,Aa=7,Iy=8,fd=9,wi=10,zb=function(s){return s[s.None=0]="None",s[s.HasTransplantedViews=2]="HasTransplantedViews",s}(zb||{});function Ma(s){return Array.isArray(s)&&typeof s[XS]=="object"}function $s(s){return Array.isArray(s)&&s[XS]===!0}function KS(s){return(s.flags&4)!==0}function Hp(s){return s.componentOffset>-1}function Bb(s){return(s.flags&1)===1}function qp(s){return!!s.template}function JS(s){return(s[fn]&512)!==0}var U1=class{constructor(a,m,d){this.previousValue=a,this.currentValue=m,this.firstChange=d}isFirstChange(){return this.firstChange}};function eC(s,a,m,d){a!==null?a.applyValueToInputSignal(a,d):s[m]=d}function Qy(){return tC}function tC(s){return s.type.prototype.ngOnChanges&&(s.setInput=fN),dN}Qy.ngInherit=!0;function dN(){let s=rC(this),a=s?.current;if(a){let m=s.previous;if(m===Mp)s.previous=a;else for(let d in a)m[d]=a[d];s.current=null,this.ngOnChanges(a)}}function fN(s,a,m,d,y){let i=this.declaredInputs[d],M=rC(s)||pN(s,{previous:Mp,current:null}),L=M.current||(M.current={}),B=M.previous,q=B[i];L[i]=new U1(q&&q.currentValue,m,B===Mp),eC(s,a,y,m)}var nC="__ngSimpleChanges__";function rC(s){return s[nC]||null}function pN(s,a){return s[nC]=a}var XM=null;var zs=function(s,a,m){XM?.(s,a,m)},mN="svg",gN="math",_N=!1;function yN(){return _N}function gs(s){for(;Array.isArray(s);)s=s[Do];return s}function iC(s,a){return gs(a[s])}function qo(s,a){return gs(a[s.index])}function jb(s,a){return s.data[a]}function vN(s,a){return s[a]}function Vl(s,a){let m=a[s];return Ma(m)?m:m[Do]}function xN(s){return(s[fn]&4)===4}function Vb(s){return(s[fn]&128)===128}function bN(s){return $s(s[ui])}function Dy(s,a){return a==null?null:s[a]}function oC(s){s[sd]=0}function wN(s){s[fn]&1024||(s[fn]|=1024,Vb(s)&&Rp(s))}function TN(s,a){for(;s>0;)a=a[yd],s--;return a}function Ub(s){return!!(s[fn]&9216||s[cu]?.dirty)}function $1(s){s[Vs].changeDetectionScheduler?.notify(1),Ub(s)?Rp(s):s[fn]&64&&(yN()?(s[fn]|=1024,Rp(s)):s[Vs].changeDetectionScheduler?.notify())}function Rp(s){s[Vs].changeDetectionScheduler?.notify();let a=Op(s);for(;a!==null&&!(a[fn]&8192||(a[fn]|=8192,!Vb(a)));)a=Op(a)}function sC(s,a){if((s[fn]&256)===256)throw new Xt(911,!1);s[zl]===null&&(s[zl]=[]),s[zl].push(a)}function EN(s,a){if(s[zl]===null)return;let m=s[zl].indexOf(a);m!==-1&&s[zl].splice(m,1)}function Op(s){let a=s[ui];return $s(a)?a[ui]:a}var Ln={lFrame:fC(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function IN(){return Ln.lFrame.elementDepthCount}function DN(){Ln.lFrame.elementDepthCount++}function MN(){Ln.lFrame.elementDepthCount--}function aC(){return Ln.bindingsEnabled}function Wp(){return Ln.skipHydrationRootTNode!==null}function SN(s){return Ln.skipHydrationRootTNode===s}function CN(s){Ln.skipHydrationRootTNode=s}function AN(){Ln.skipHydrationRootTNode=null}function Tr(){return Ln.lFrame.lView}function Gs(){return Ln.lFrame.tView}function Zp(s){return Ln.lFrame.contextLView=s,s[Li]}function Qp(s){return Ln.lFrame.contextLView=null,s}function vs(){let s=lC();for(;s!==null&&s.type===64;)s=s.parent;return s}function lC(){return Ln.lFrame.currentTNode}function PN(){let s=Ln.lFrame,a=s.currentTNode;return s.isParent?a:a.parent}function Yp(s,a){let m=Ln.lFrame;m.currentTNode=s,m.isParent=a}function cC(){return Ln.lFrame.isParent}function RN(){Ln.lFrame.isParent=!1}function ON(){return Ln.lFrame.contextLView}function LN(s){return Ln.lFrame.bindingIndex=s}function Yy(){return Ln.lFrame.bindingIndex++}function kN(s){let a=Ln.lFrame,m=a.bindingIndex;return a.bindingIndex=a.bindingIndex+s,m}function FN(){return Ln.lFrame.inI18n}function NN(s,a){let m=Ln.lFrame;m.bindingIndex=m.bindingRootIndex=s,G1(a)}function zN(){return Ln.lFrame.currentDirectiveIndex}function G1(s){Ln.lFrame.currentDirectiveIndex=s}function BN(s){let a=Ln.lFrame.currentDirectiveIndex;return a===-1?null:s[a]}function uC(){return Ln.lFrame.currentQueryIndex}function $b(s){Ln.lFrame.currentQueryIndex=s}function jN(s){let a=s[bn];return a.type===2?a.declTNode:a.type===1?s[ys]:null}function hC(s,a,m){if(m&zn.SkipSelf){let y=a,i=s;for(;y=y.parent,y===null&&!(m&zn.Host);)if(y=jN(i),y===null||(i=i[yd],y.type&10))break;if(y===null)return!1;a=y,s=i}let d=Ln.lFrame=dC();return d.currentTNode=a,d.lView=s,!0}function Gb(s){let a=dC(),m=s[bn];Ln.lFrame=a,a.currentTNode=m.firstChild,a.lView=s,a.tView=m,a.contextLView=s,a.bindingIndex=m.bindingStartIndex,a.inI18n=!1}function dC(){let s=Ln.lFrame,a=s===null?null:s.child;return a===null?fC(s):a}function fC(s){let a={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:s,child:null,inI18n:!1};return s!==null&&(s.child=a),a}function pC(){let s=Ln.lFrame;return Ln.lFrame=s.parent,s.currentTNode=null,s.lView=null,s}var mC=pC;function Hb(){let s=pC();s.isParent=!0,s.tView=null,s.selectedIndex=-1,s.contextLView=null,s.elementDepthCount=0,s.currentDirectiveIndex=-1,s.currentNamespace=null,s.bindingRootIndex=-1,s.bindingIndex=-1,s.currentQueryIndex=0}function VN(s){return(Ln.lFrame.contextLView=TN(s,Ln.lFrame.contextLView))[Li]}function mu(){return Ln.lFrame.selectedIndex}function uu(s){Ln.lFrame.selectedIndex=s}function UN(){let s=Ln.lFrame;return jb(s.tView,s.selectedIndex)}function gC(){return Ln.lFrame.currentNamespace}var _C=!0;function qb(){return _C}function Hs(s){_C=s}function $N(s,a,m){let{ngOnChanges:d,ngOnInit:y,ngDoCheck:i}=a.type.prototype;if(d){let M=tC(a);(m.preOrderHooks??=[]).push(s,M),(m.preOrderCheckHooks??=[]).push(s,M)}y&&(m.preOrderHooks??=[]).push(0-s,y),i&&((m.preOrderHooks??=[]).push(s,i),(m.preOrderCheckHooks??=[]).push(s,i))}function Wb(s,a){for(let m=a.directiveStart,d=a.directiveEnd;m<d;m++){let i=s.data[m].type.prototype,{ngAfterContentInit:M,ngAfterContentChecked:L,ngAfterViewInit:B,ngAfterViewChecked:q,ngOnDestroy:se}=i;M&&(s.contentHooks??=[]).push(-m,M),L&&((s.contentHooks??=[]).push(m,L),(s.contentCheckHooks??=[]).push(m,L)),B&&(s.viewHooks??=[]).push(-m,B),q&&((s.viewHooks??=[]).push(m,q),(s.viewCheckHooks??=[]).push(m,q)),se!=null&&(s.destroyHooks??=[]).push(m,se)}}function gy(s,a,m){yC(s,a,3,m)}function _y(s,a,m,d){(s[fn]&3)===m&&yC(s,a,m,d)}function w1(s,a){let m=s[fn];(m&3)===a&&(m&=16383,m+=1,s[fn]=m)}function yC(s,a,m,d){let y=d!==void 0?s[sd]&65535:0,i=d??-1,M=a.length-1,L=0;for(let B=y;B<M;B++)if(typeof a[B+1]=="number"){if(L=a[B],d!=null&&L>=d)break}else a[B]<0&&(s[sd]+=65536),(L<i||i==-1)&&(GN(s,m,a,B),s[sd]=(s[sd]&4294901760)+B+2),B++}function KM(s,a){zs(4,s,a);let m=qn(null);try{a.call(s)}finally{qn(m),zs(5,s,a)}}function GN(s,a,m,d){let y=m[d]<0,i=m[d+1],M=y?-m[d]:m[d],L=s[M];y?s[fn]>>14<s[sd]>>16&&(s[fn]&3)===a&&(s[fn]+=16384,KM(L,i)):KM(L,i)}var ud=-1,Lp=class{constructor(a,m,d){this.factory=a,this.resolving=!1,this.canSeeViewProviders=m,this.injectImpl=d}};function HN(s){return s instanceof Lp}function qN(s){return(s.flags&8)!==0}function WN(s){return(s.flags&16)!==0}function vC(s){return s!==ud}function My(s){return s&32767}function ZN(s){return s>>16}function Sy(s,a){let m=ZN(s),d=a;for(;m>0;)d=d[yd],m--;return d}var H1=!0;function JM(s){let a=H1;return H1=s,a}var QN=256,xC=QN-1,bC=5,YN=0,Bs={};function XN(s,a,m){let d;typeof m=="string"?d=m.charCodeAt(0)||0:m.hasOwnProperty(Ep)&&(d=m[Ep]),d==null&&(d=m[Ep]=YN++);let y=d&xC,i=1<<y;a.data[s+(y>>bC)]|=i}function wC(s,a){let m=TC(s,a);if(m!==-1)return m;let d=a[bn];d.firstCreatePass&&(s.injectorIndex=a.length,T1(d.data,s),T1(a,null),T1(d.blueprint,null));let y=Zb(s,a),i=s.injectorIndex;if(vC(y)){let M=My(y),L=Sy(y,a),B=L[bn].data;for(let q=0;q<8;q++)a[i+q]=L[M+q]|B[M+q]}return a[i+8]=y,i}function T1(s,a){s.push(0,0,0,0,0,0,0,0,a)}function TC(s,a){return s.injectorIndex===-1||s.parent&&s.parent.injectorIndex===s.injectorIndex||a[s.injectorIndex+8]===null?-1:s.injectorIndex}function Zb(s,a){if(s.parent&&s.parent.injectorIndex!==-1)return s.parent.injectorIndex;let m=0,d=null,y=a;for(;y!==null;){if(d=SC(y),d===null)return ud;if(m++,y=y[yd],d.injectorIndex!==-1)return d.injectorIndex|m<<16}return ud}function KN(s,a,m){XN(s,a,m)}function EC(s,a,m){if(m&zn.Optional||s!==void 0)return s;Pb(a,"NodeInjector")}function IC(s,a,m,d){if(m&zn.Optional&&d===void 0&&(d=null),!(m&(zn.Self|zn.Host))){let y=s[dd],i=Uo(void 0);try{return y?y.get(a,d,m&zn.Optional):RS(a,d,m&zn.Optional)}finally{Uo(i)}}return EC(d,a,m)}function DC(s,a,m,d=zn.Default,y){if(s!==null){if(a[fn]&2048&&!(d&zn.Self)){let M=n3(s,a,m,d,Bs);if(M!==Bs)return M}let i=MC(s,a,m,d,Bs);if(i!==Bs)return i}return IC(a,m,d,y)}function MC(s,a,m,d,y){let i=e3(m);if(typeof i=="function"){if(!hC(a,s,d))return d&zn.Host?EC(y,m,d):IC(a,m,d,y);try{let M;if(M=i(d),M==null&&!(d&zn.Optional))Pb(m);else return M}finally{mC()}}else if(typeof i=="number"){let M=null,L=TC(s,a),B=ud,q=d&zn.Host?a[Mo][ys]:null;for((L===-1||d&zn.SkipSelf)&&(B=L===-1?Zb(s,a):a[L+8],B===ud||!tS(d,!1)?L=-1:(M=a[bn],L=My(B),a=Sy(B,a)));L!==-1;){let se=a[bn];if(eS(i,L,se.data)){let ge=JN(L,a,m,M,d,q);if(ge!==Bs)return ge}B=a[L+8],B!==ud&&tS(d,a[bn].data[L+8]===q)&&eS(i,L,a)?(M=se,L=My(B),a=Sy(B,a)):L=-1}}return y}function JN(s,a,m,d,y,i){let M=a[bn],L=M.data[s+8],B=d==null?Hp(L)&&H1:d!=M&&(L.type&3)!==0,q=y&zn.Host&&i===L,se=yy(L,M,m,B,q);return se!==null?pd(a,M,se,L):Bs}function yy(s,a,m,d,y){let i=s.providerIndexes,M=a.data,L=i&1048575,B=s.directiveStart,q=s.directiveEnd,se=i>>20,ge=d?L:L+se,Pe=y?L+se:q;for(let Ke=ge;Ke<Pe;Ke++){let Nt=M[Ke];if(Ke<B&&m===Nt||Ke>=B&&Nt.type===m)return Ke}if(y){let Ke=M[B];if(Ke&&qp(Ke)&&Ke.type===m)return B}return null}function pd(s,a,m,d){let y=s[m],i=a.data;if(HN(y)){let M=y;M.resolving&&bF(xF(i[m]));let L=JM(M.canSeeViewProviders);M.resolving=!0;let B,q=M.injectImpl?Uo(M.injectImpl):null,se=hC(s,d,zn.Default);try{y=s[m]=M.factory(void 0,i,s,d),a.firstCreatePass&&m>=d.directiveStart&&$N(m,i[m],a)}finally{q!==null&&Uo(q),JM(L),M.resolving=!1,mC()}}return y}function e3(s){if(typeof s=="string")return s.charCodeAt(0)||0;let a=s.hasOwnProperty(Ep)?s[Ep]:void 0;return typeof a=="number"?a>=0?a&xC:t3:a}function eS(s,a,m){let d=1<<s;return!!(m[a+(s>>bC)]&d)}function tS(s,a){return!(s&zn.Self)&&!(s&zn.Host&&a)}var au=class{constructor(a,m){this._tNode=a,this._lView=m}get(a,m,d){return DC(this._tNode,this._lView,a,Hy(d),m)}};function t3(){return new au(vs(),Tr())}function Qb(s){return Up(()=>{let a=s.prototype.constructor,m=a[by]||q1(a),d=Object.prototype,y=Object.getPrototypeOf(s.prototype).constructor;for(;y&&y!==d;){let i=y[by]||q1(y);if(i&&i!==m)return i;y=Object.getPrototypeOf(y)}return i=>new i})}function q1(s){return IS(s)?()=>{let a=q1($o(s));return a&&a()}:hd(s)}function n3(s,a,m,d,y){let i=s,M=a;for(;i!==null&&M!==null&&M[fn]&2048&&!(M[fn]&512);){let L=MC(i,M,m,d|zn.Self,Bs);if(L!==Bs)return L;let B=i.parent;if(!B){let q=M[YS];if(q){let se=q.get(m,Bs,d);if(se!==Bs)return se}B=SC(M),M=M[yd]}i=B}return y}function SC(s){let a=s[bn],m=a.type;return m===2?a.declTNode:m===1?s[ys]:null}function nS(s,a=null,m=null,d){let y=CC(s,a,m,d);return y.resolveInjectorInitializers(),y}function CC(s,a=null,m=null,d,y=new Set){let i=[m||Go,KF(s)];return d=d||(typeof s=="object"?void 0:ao(s)),new Sp(i,a||Nb(),d||null,y)}var xs=(()=>{let a=class a{static create(d,y){if(Array.isArray(d))return nS({name:""},y,d,"");{let i=d.name??"";return nS({name:i},d.parent,d.providers,i)}}};a.THROW_IF_NOT_FOUND=Dp,a.NULL=new Ey,a.\u0275prov=kt({token:a,providedIn:"any",factory:()=>jt(FS)}),a.__NG_ELEMENT_ID__=-1;let s=a;return s})();var r3="ngOriginalError";function E1(s){return s[r3]}var Us=class{constructor(){this._console=console}handleError(a){let m=this._findOriginalError(a);this._console.error("ERROR",a),m&&this._console.error("ORIGINAL ERROR",m)}_findOriginalError(a){let m=a&&E1(a);for(;m&&E1(m);)m=E1(m);return m||null}},AC=new Wt("",{providedIn:"root",factory:()=>Xe(Us).handleError.bind(void 0)}),Yb=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=i3,a.__NG_ENV_ID__=d=>d;let s=a;return s})(),W1=class extends Yb{constructor(a){super(),this._lView=a}onDestroy(a){return sC(this._lView,a),()=>EN(this._lView,a)}};function i3(){return new W1(Tr())}function o3(){return vd(vs(),Tr())}function vd(s,a){return new Ul(qo(s,a))}var Ul=(()=>{let a=class a{constructor(d){this.nativeElement=d}};a.__NG_ELEMENT_ID__=o3;let s=a;return s})();function s3(s){return s instanceof Ul?s.nativeElement:s}var Z1=class extends Gi{constructor(a=!1){super(),this.destroyRef=void 0,this.__isAsync=a,QS()&&(this.destroyRef=Xe(Yb,{optional:!0})??void 0)}emit(a){let m=qn(null);try{super.next(a)}finally{qn(m)}}subscribe(a,m,d){let y=a,i=m||(()=>null),M=d;if(a&&typeof a=="object"){let B=a;y=B.next?.bind(B),i=B.error?.bind(B),M=B.complete?.bind(B)}this.__isAsync&&(i=I1(i),y&&(y=I1(y)),M&&(M=I1(M)));let L=super.subscribe({next:y,error:i,complete:M});return a instanceof ei&&a.add(L),L}};function I1(s){return a=>{setTimeout(s,void 0,a)}}var Oi=Z1;function a3(){return this._results[Symbol.iterator]()}var Q1=class s{get changes(){return this._changes??=new Oi}constructor(a=!1){this._emitDistinctChangesOnly=a,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let m=s.prototype;m[Symbol.iterator]||(m[Symbol.iterator]=a3)}get(a){return this._results[a]}map(a){return this._results.map(a)}filter(a){return this._results.filter(a)}find(a){return this._results.find(a)}reduce(a,m){return this._results.reduce(a,m)}forEach(a){this._results.forEach(a)}some(a){return this._results.some(a)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(a,m){this.dirty=!1;let d=RF(a);(this._changesDetected=!PF(this._results,d,m))&&(this._results=d,this.length=d.length,this.last=d[this.length-1],this.first=d[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(a){this._onDirty=a}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}},l3="ngSkipHydration",c3="ngskiphydration";function PC(s){let a=s.mergedAttrs;if(a===null)return!1;for(let m=0;m<a.length;m+=2){let d=a[m];if(typeof d=="number")return!1;if(typeof d=="string"&&d.toLowerCase()===c3)return!0}return!1}function RC(s){return s.hasAttribute(l3)}function Cy(s){return(s.flags&128)===128}function u3(s){if(Cy(s))return!0;let a=s.parent;for(;a;){if(Cy(s)||PC(a))return!0;a=a.parent}return!1}var OC=new Map,h3=0;function d3(){return h3++}function f3(s){OC.set(s[Zy],s)}function p3(s){OC.delete(s[Zy])}var rS="__ngContext__";function hu(s,a){Ma(a)?(s[rS]=a[Zy],f3(a)):s[rS]=a}function LC(s){return FC(s[Ap])}function kC(s){return FC(s[ms])}function FC(s){for(;s!==null&&!$s(s);)s=s[ms];return s}var Y1;function NC(s){Y1=s}function Xy(){if(Y1!==void 0)return Y1;if(typeof document<"u")return document;throw new Xt(210,!1)}var Xp=new Wt("",{providedIn:"root",factory:()=>m3}),m3="ng",Xb=new Wt(""),Wo=new Wt("",{providedIn:"platform",factory:()=>"unknown"});var Kb=new Wt("",{providedIn:"root",factory:()=>Xy().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function g3(){let s=new gu;return Xe(Wo)==="browser"&&(s.store=_3(Xy(),Xe(Xp))),s}var gu=(()=>{let a=class a{constructor(){this.store={},this.onSerializeCallbacks={}}get(d,y){return this.store[d]!==void 0?this.store[d]:y}set(d,y){this.store[d]=y}remove(d){delete this.store[d]}hasKey(d){return this.store.hasOwnProperty(d)}get isEmpty(){return Object.keys(this.store).length===0}onSerialize(d,y){this.onSerializeCallbacks[d]=y}toJson(){for(let d in this.onSerializeCallbacks)if(this.onSerializeCallbacks.hasOwnProperty(d))try{this.store[d]=this.onSerializeCallbacks[d]()}catch(y){console.warn("Exception in onSerialize callback: ",y)}return JSON.stringify(this.store).replace(/</g,"\\u003C")}};a.\u0275prov=kt({token:a,providedIn:"root",factory:g3});let s=a;return s})();function _3(s,a){let m=s.getElementById(a+"-state");if(m?.textContent)try{return JSON.parse(m.textContent)}catch(d){console.warn("Exception while restoring TransferState for app "+a,d)}return{}}var zC="h",BC="b",X1=function(s){return s.FirstChild="f",s.NextSibling="n",s}(X1||{}),y3="e",v3="t",Jb="c",jC="x",Ay="r",x3="i",b3="n",w3="d",T3="__nghData__",VC=T3,D1="ngh",E3="nghm",UC=()=>null;function I3(s,a,m=!1){let d=s.getAttribute(D1);if(d==null)return null;let[y,i]=d.split("|");if(d=m?i:y,!d)return null;let M=i?`|${i}`:"",L=m?y:M,B={};if(d!==""){let se=a.get(gu,null,{optional:!0});se!==null&&(B=se.get(VC,[])[Number(d)])}let q={data:B,firstChild:s.firstChild??null};return m&&(q.firstChild=s,Ky(q,0,s.nextSibling)),L?s.setAttribute(D1,L):s.removeAttribute(D1),q}function D3(){UC=I3}function ew(s,a,m=!1){return UC(s,a,m)}function M3(s){let a=s._lView;return a[bn].type===2?null:(JS(a)&&(a=a[Ti]),a)}function S3(s){return s.textContent?.replace(/\s/gm,"")}function C3(s){let a=Xy(),m=a.createNodeIterator(s,NodeFilter.SHOW_COMMENT,{acceptNode(i){let M=S3(i);return M==="ngetn"||M==="ngtns"?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),d,y=[];for(;d=m.nextNode();)y.push(d);for(let i of y)i.textContent==="ngetn"?i.replaceWith(a.createTextNode("")):i.remove()}function Ky(s,a,m){s.segmentHeads??={},s.segmentHeads[a]=m}function K1(s,a){return s.segmentHeads?.[a]??null}function A3(s,a){let m=s.data,d=m[y3]?.[a]??null;return d===null&&m[Jb]?.[a]&&(d=tw(s,a)),d}function $C(s,a){return s.data[Jb]?.[a]??null}function tw(s,a){let m=$C(s,a)??[],d=0;for(let y of m)d+=y[Ay]*(y[jC]??1);return d}function Jy(s,a){if(typeof s.disconnectedNodes>"u"){let m=s.data[w3];s.disconnectedNodes=m?new Set(m):null}return!!s.disconnectedNodes?.has(a)}var hy=new Wt(""),GC=!1,HC=new Wt("",{providedIn:"root",factory:()=>GC}),P3=new Wt("");var J1=class{constructor(a){this.changingThisBreaksApplicationSecurity=a}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${hF})`}};function nw(s){return s instanceof J1?s.changingThisBreaksApplicationSecurity:s}var R3=/^>|^->|<!--|-->|--!>|<!-$/g,O3=/(<|>)/g,L3="\u200B$1\u200B";function k3(s){return s.replace(R3,a=>a.replace(O3,L3))}function F3(s){return s.ownerDocument.body}function qC(s){return s instanceof Function?s():s}function Tp(s){return(s??Xe(xs)).get(Wo)==="browser"}var Pa=function(s){return s[s.Important=1]="Important",s[s.DashCase=2]="DashCase",s}(Pa||{}),N3;function rw(s,a){return N3(s,a)}function ad(s,a,m,d,y){if(d!=null){let i,M=!1;$s(d)?i=d:Ma(d)&&(M=!0,d=d[Do]);let L=gs(d);s===0&&m!==null?y==null?QC(a,m,L):Py(a,m,L,y||null,!0):s===1&&m!==null?Py(a,m,L,y||null,!0):s===2?lw(a,L,M):s===3&&a.destroyNode(L),i!=null&&ez(a,s,i,m,y)}}function iw(s,a){return s.createText(a)}function z3(s,a,m){s.setValue(a,m)}function ow(s,a){return s.createComment(k3(a))}function e0(s,a,m){return s.createElement(a,m)}function B3(s,a){WC(s,a),a[Do]=null,a[ys]=null}function j3(s,a,m,d,y,i){d[Do]=y,d[ys]=a,n0(s,d,m,1,y,i)}function WC(s,a){a[Vs].changeDetectionScheduler?.notify(1),n0(s,a,a[Nr],2,null,null)}function V3(s){let a=s[Ap];if(!a)return M1(s[bn],s);for(;a;){let m=null;if(Ma(a))m=a[Ap];else{let d=a[wi];d&&(m=d)}if(!m){for(;a&&!a[ms]&&a!==s;)Ma(a)&&M1(a[bn],a),a=a[ui];a===null&&(a=s),Ma(a)&&M1(a[bn],a),m=a&&a[ms]}a=m}}function U3(s,a,m,d){let y=wi+d,i=m.length;d>0&&(m[y-1][ms]=a),d<i-wi?(a[ms]=m[y],kS(m,wi+d,a)):(m.push(a),a[ms]=null),a[ui]=m;let M=a[Gp];M!==null&&m!==M&&$3(M,a);let L=a[Ca];L!==null&&L.insertView(s),$1(a),a[fn]|=128}function $3(s,a){let m=s[fd],y=a[ui][ui][Mo];a[Mo]!==y&&(s[fn]|=zb.HasTransplantedViews),m===null?s[fd]=[a]:m.push(a)}function ZC(s,a){let m=s[fd],d=m.indexOf(a);m.splice(d,1)}function kp(s,a){if(s.length<=wi)return;let m=wi+a,d=s[m];if(d){let y=d[Gp];y!==null&&y!==s&&ZC(y,d),a>0&&(s[m-1][ms]=d[ms]);let i=Ty(s,wi+a);B3(d[bn],d);let M=i[Ca];M!==null&&M.detachView(i[bn]),d[ui]=null,d[ms]=null,d[fn]&=-129}return d}function t0(s,a){if(!(a[fn]&256)){let m=a[Nr];m.destroyNode&&n0(s,a,m,3,null,null),V3(a)}}function M1(s,a){if(a[fn]&256)return;let m=qn(null);try{a[fn]&=-129,a[fn]|=256,a[cu]&&uM(a[cu]),H3(s,a),G3(s,a),a[bn].type===1&&a[Nr].destroy();let d=a[Gp];if(d!==null&&$s(a[ui])){d!==a[ui]&&ZC(d,a);let y=a[Ca];y!==null&&y.detachView(s)}p3(a)}finally{qn(m)}}function G3(s,a){let m=s.cleanup,d=a[Cp];if(m!==null)for(let i=0;i<m.length-1;i+=2)if(typeof m[i]=="string"){let M=m[i+3];M>=0?d[M]():d[-M].unsubscribe(),i+=2}else{let M=d[m[i+1]];m[i].call(M)}d!==null&&(a[Cp]=null);let y=a[zl];if(y!==null){a[zl]=null;for(let i=0;i<y.length;i++){let M=y[i];M()}}}function H3(s,a){let m;if(s!=null&&(m=s.destroyHooks)!=null)for(let d=0;d<m.length;d+=2){let y=a[m[d]];if(!(y instanceof Lp)){let i=m[d+1];if(Array.isArray(i))for(let M=0;M<i.length;M+=2){let L=y[i[M]],B=i[M+1];zs(4,L,B);try{B.call(L)}finally{zs(5,L,B)}}else{zs(4,y,i);try{i.call(y)}finally{zs(5,y,i)}}}}}function q3(s,a,m){return W3(s,a.parent,m)}function W3(s,a,m){let d=a;for(;d!==null&&d.type&40;)a=d,d=a.parent;if(d===null)return m[Do];{let{componentOffset:y}=d;if(y>-1){let{encapsulation:i}=s.data[d.directiveStart+y];if(i===js.None||i===js.Emulated)return null}return qo(d,m)}}function Py(s,a,m,d,y){s.insertBefore(a,m,d,y)}function QC(s,a,m){s.appendChild(a,m)}function iS(s,a,m,d,y){d!==null?Py(s,a,m,d,y):QC(s,a,m)}function Z3(s,a,m,d){s.removeChild(a,m,d)}function sw(s,a){return s.parentNode(a)}function Q3(s,a){return s.nextSibling(a)}function Y3(s,a,m){return K3(s,a,m)}function X3(s,a,m){return s.type&40?qo(s,m):null}var K3=X3,oS;function aw(s,a,m,d){let y=q3(s,d,a),i=a[Nr],M=d.parent||a[ys],L=Y3(M,d,a);if(y!=null)if(Array.isArray(m))for(let B=0;B<m.length;B++)iS(i,y,m[B],L,!1);else iS(i,y,m,L,!1);oS!==void 0&&oS(i,d,a,m,y)}function vy(s,a){if(a!==null){let m=a.type;if(m&3)return qo(a,s);if(m&4)return eb(-1,s[a.index]);if(m&8){let d=a.child;if(d!==null)return vy(s,d);{let y=s[a.index];return $s(y)?eb(-1,y):gs(y)}}else{if(m&32)return rw(a,s)()||gs(s[a.index]);{let d=YC(s,a);if(d!==null){if(Array.isArray(d))return d[0];let y=Op(s[Mo]);return vy(y,d)}else return vy(s,a.next)}}}return null}function YC(s,a){if(a!==null){let d=s[Mo][ys],y=a.projection;return d.projection[y]}return null}function eb(s,a){let m=wi+s+1;if(m<a.length){let d=a[m],y=d[bn].firstChild;if(y!==null)return vy(d,y)}return a[Aa]}function lw(s,a,m){let d=sw(s,a);d&&Z3(s,d,a,m)}function XC(s){s.textContent=""}function cw(s,a,m,d,y,i,M){for(;m!=null;){let L=d[m.index],B=m.type;if(M&&a===0&&(L&&hu(gs(L),d),m.flags|=2),(m.flags&32)!==32)if(B&8)cw(s,a,m.child,d,y,i,!1),ad(a,s,y,L,i);else if(B&32){let q=rw(m,d),se;for(;se=q();)ad(a,s,y,se,i);ad(a,s,y,L,i)}else B&16?J3(s,a,d,m,y,i):ad(a,s,y,L,i);m=M?m.projectionNext:m.next}}function n0(s,a,m,d,y,i){cw(m,d,s.firstChild,a,y,i,!1)}function J3(s,a,m,d,y,i){let M=m[Mo],B=M[ys].projection[d.projection];if(Array.isArray(B))for(let q=0;q<B.length;q++){let se=B[q];ad(a,s,y,se,i)}else{let q=B,se=M[ui];Cy(d)&&(q.flags|=128),cw(s,a,q,se,y,i,!0)}}function ez(s,a,m,d,y){let i=m[Aa],M=gs(m);i!==M&&ad(a,s,d,i,y);for(let L=wi;L<m.length;L++){let B=m[L];n0(B[bn],B,s,a,d,i)}}function tz(s,a,m,d,y){if(a)y?s.addClass(m,d):s.removeClass(m,d);else{let i=d.indexOf("-")===-1?void 0:Pa.DashCase;y==null?s.removeStyle(m,d,i):(typeof y=="string"&&y.endsWith("!important")&&(y=y.slice(0,-10),i|=Pa.Important),s.setStyle(m,d,y,i))}}function nz(s,a,m){s.setAttribute(a,"style",m)}function KC(s,a,m){m===""?s.removeAttribute(a,"class"):s.setAttribute(a,"class",m)}function JC(s,a,m){let{mergedAttrs:d,classes:y,styles:i}=m;d!==null&&N1(s,a,d),y!==null&&KC(s,a,y),i!==null&&nz(s,a,i)}var xd={};function bd(s=1){eA(Gs(),Tr(),mu()+s,!1)}function eA(s,a,m,d){if(!d)if((a[fn]&3)===3){let i=s.preOrderCheckHooks;i!==null&&gy(a,i,m)}else{let i=s.preOrderHooks;i!==null&&_y(a,i,0,m)}uu(m)}function Kp(s,a=zn.Default){let m=Tr();if(m===null)return jt(s,a);let d=vs();return DC(d,m,$o(s),a)}function tA(){let s="invalid";throw new Error(s)}function nA(s,a,m,d,y,i){let M=qn(null);try{let L=null;y&Sa.SignalBased&&(L=a[d][sM]),L!==null&&L.transformFn!==void 0&&(i=L.transformFn(i)),y&Sa.HasDecoratorInputTransform&&(i=s.inputTransforms[d].call(a,i)),s.setInput!==null?s.setInput(a,L,i,m,d):eC(a,L,d,i)}finally{qn(M)}}function rz(s,a){let m=s.hostBindingOpCodes;if(m!==null)try{for(let d=0;d<m.length;d++){let y=m[d];if(y<0)uu(~y);else{let i=y,M=m[++d],L=m[++d];NN(M,i);let B=a[i];L(2,B)}}}finally{uu(-1)}}function r0(s,a,m,d,y,i,M,L,B,q,se){let ge=a.blueprint.slice();return ge[Do]=y,ge[fn]=d|4|128|8|64,(q!==null||s&&s[fn]&2048)&&(ge[fn]|=2048),oC(ge),ge[ui]=ge[yd]=s,ge[Li]=m,ge[Vs]=M||s&&s[Vs],ge[Nr]=L||s&&s[Nr],ge[dd]=B||s&&s[dd]||null,ge[ys]=i,ge[Zy]=d3(),ge[Ho]=se,ge[YS]=q,ge[Mo]=a.type==2?s[Mo]:ge,ge}function i0(s,a,m,d,y){let i=s.data[a];if(i===null)i=iz(s,a,m,d,y),FN()&&(i.flags|=32);else if(i.type&64){i.type=m,i.value=d,i.attrs=y;let M=PN();i.injectorIndex=M===null?-1:M.injectorIndex}return Yp(i,!0),i}function iz(s,a,m,d,y){let i=lC(),M=cC(),L=M?i:i&&i.parent,B=s.data[a]=hz(s,L,m,a,d,y);return s.firstChild===null&&(s.firstChild=B),i!==null&&(M?i.child==null&&B.parent!==null&&(i.child=B):i.next===null&&(i.next=B,B.prev=i)),B}function rA(s,a,m,d){if(m===0)return-1;let y=a.length;for(let i=0;i<m;i++)a.push(d),s.blueprint.push(d),s.data.push(null);return y}function iA(s,a,m,d,y){let i=mu(),M=d&2;try{uu(-1),M&&a.length>Ti&&eA(s,a,Ti,!1),zs(M?2:0,y),m(d,y)}finally{uu(i),zs(M?3:1,y)}}function oA(s,a,m){if(KS(a)){let d=qn(null);try{let y=a.directiveStart,i=a.directiveEnd;for(let M=y;M<i;M++){let L=s.data[M];if(L.contentQueries){let B=m[M];L.contentQueries(1,B,M)}}}finally{qn(d)}}}function sA(s,a,m){aC()&&(yz(s,a,m,qo(m,a)),(m.flags&64)===64&&dA(s,a,m))}function aA(s,a,m=qo){let d=a.localNames;if(d!==null){let y=a.index+1;for(let i=0;i<d.length;i+=2){let M=d[i+1],L=M===-1?m(a,s):s[M];s[y++]=L}}}function lA(s){let a=s.tView;return a===null||a.incompleteFirstPass?s.tView=uw(1,null,s.template,s.decls,s.vars,s.directiveDefs,s.pipeDefs,s.viewQuery,s.schemas,s.consts,s.id):a}function uw(s,a,m,d,y,i,M,L,B,q,se){let ge=Ti+d,Pe=ge+y,Ke=oz(ge,Pe),Nt=typeof q=="function"?q():q;return Ke[bn]={type:s,blueprint:Ke,template:m,queries:null,viewQuery:L,declTNode:a,data:Ke.slice().fill(null,ge),bindingStartIndex:ge,expandoStartIndex:Pe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof M=="function"?M():M,firstChild:null,schemas:B,consts:Nt,incompleteFirstPass:!1,ssrId:se}}function oz(s,a){let m=[];for(let d=0;d<a;d++)m.push(d<s?null:xd);return m}function sz(s,a,m,d){let i=d.get(HC,GC)||m===js.ShadowDom,M=s.selectRootElement(a,i);return az(M),M}function az(s){cA(s)}var cA=()=>null;function lz(s){RC(s)?XC(s):C3(s)}function cz(){cA=lz}function uz(s,a,m,d){let y=mA(a);y.push(m),s.firstCreatePass&&gA(s).push(d,y.length-1)}function hz(s,a,m,d,y,i){let M=a?a.injectorIndex:-1,L=0;return Wp()&&(L|=128),{type:m,index:d,insertBeforeIndex:null,injectorIndex:M,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:L,providerIndexes:0,value:y,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:a,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function sS(s,a,m,d,y){for(let i in a){if(!a.hasOwnProperty(i))continue;let M=a[i];if(M===void 0)continue;d??={};let L,B=Sa.None;Array.isArray(M)?(L=M[0],B=M[1]):L=M;let q=i;if(y!==null){if(!y.hasOwnProperty(i))continue;q=y[i]}s===0?aS(d,m,q,L,B):aS(d,m,q,L)}return d}function aS(s,a,m,d,y){let i;s.hasOwnProperty(m)?(i=s[m]).push(a,d):i=s[m]=[a,d],y!==void 0&&i.push(y)}function dz(s,a,m){let d=a.directiveStart,y=a.directiveEnd,i=s.data,M=a.attrs,L=[],B=null,q=null;for(let se=d;se<y;se++){let ge=i[se],Pe=m?m.get(ge):null,Ke=Pe?Pe.inputs:null,Nt=Pe?Pe.outputs:null;B=sS(0,ge.inputs,se,B,Ke),q=sS(1,ge.outputs,se,q,Nt);let sn=B!==null&&M!==null&&!kb(a)?Mz(B,se,M):null;L.push(sn)}B!==null&&(B.hasOwnProperty("class")&&(a.flags|=8),B.hasOwnProperty("style")&&(a.flags|=16)),a.initialInputs=L,a.inputs=B,a.outputs=q}function fz(s){return s==="class"?"className":s==="for"?"htmlFor":s==="formaction"?"formAction":s==="innerHtml"?"innerHTML":s==="readonly"?"readOnly":s==="tabindex"?"tabIndex":s}function pz(s,a,m,d,y,i,M,L){let B=qo(a,m),q=a.inputs,se;!L&&q!=null&&(se=q[d])?(hw(s,m,se,d,y),Hp(a)&&mz(m,a.index)):a.type&3?(d=fz(d),y=M!=null?M(y,a.value||"",d):y,i.setProperty(B,d,y)):a.type&12}function mz(s,a){let m=Vl(a,s);m[fn]&16||(m[fn]|=64)}function uA(s,a,m,d){if(aC()){let y=d===null?null:{"":-1},i=xz(s,m),M,L;i===null?M=L=null:[M,L]=i,M!==null&&hA(s,a,m,M,y,L),y&&bz(m,d,y)}m.mergedAttrs=Lb(m.mergedAttrs,m.attrs)}function hA(s,a,m,d,y,i){for(let q=0;q<d.length;q++)KN(wC(m,a),s,d[q].type);Tz(m,s.data.length,d.length);for(let q=0;q<d.length;q++){let se=d[q];se.providersResolver&&se.providersResolver(se)}let M=!1,L=!1,B=rA(s,a,d.length,null);for(let q=0;q<d.length;q++){let se=d[q];m.mergedAttrs=Lb(m.mergedAttrs,se.hostAttrs),Ez(s,m,a,B,se),wz(B,se,y),se.contentQueries!==null&&(m.flags|=4),(se.hostBindings!==null||se.hostAttrs!==null||se.hostVars!==0)&&(m.flags|=64);let ge=se.type.prototype;!M&&(ge.ngOnChanges||ge.ngOnInit||ge.ngDoCheck)&&((s.preOrderHooks??=[]).push(m.index),M=!0),!L&&(ge.ngOnChanges||ge.ngDoCheck)&&((s.preOrderCheckHooks??=[]).push(m.index),L=!0),B++}dz(s,m,i)}function gz(s,a,m,d,y){let i=y.hostBindings;if(i){let M=s.hostBindingOpCodes;M===null&&(M=s.hostBindingOpCodes=[]);let L=~a.index;_z(M)!=L&&M.push(L),M.push(m,d,i)}}function _z(s){let a=s.length;for(;a>0;){let m=s[--a];if(typeof m=="number"&&m<0)return m}return 0}function yz(s,a,m,d){let y=m.directiveStart,i=m.directiveEnd;Hp(m)&&Iz(a,m,s.data[y+m.componentOffset]),s.firstCreatePass||wC(m,a),hu(d,a);let M=m.initialInputs;for(let L=y;L<i;L++){let B=s.data[L],q=pd(a,s,L,m);if(hu(q,a),M!==null&&Dz(a,L-y,q,B,m,M),qp(B)){let se=Vl(m.index,a);se[Li]=pd(a,s,L,m)}}}function dA(s,a,m){let d=m.directiveStart,y=m.directiveEnd,i=m.index,M=zN();try{uu(i);for(let L=d;L<y;L++){let B=s.data[L],q=a[L];G1(L),(B.hostBindings!==null||B.hostVars!==0||B.hostAttrs!==null)&&vz(B,q)}}finally{uu(-1),G1(M)}}function vz(s,a){s.hostBindings!==null&&s.hostBindings(1,a)}function xz(s,a){let m=s.directiveRegistry,d=null,y=null;if(m)for(let i=0;i<m.length;i++){let M=m[i];if($F(a,M.selectors,!1))if(d||(d=[]),qp(M))if(M.findHostDirectiveDefs!==null){let L=[];y=y||new Map,M.findHostDirectiveDefs(M,L,y),d.unshift(...L,M);let B=L.length;tb(s,a,B)}else d.unshift(M),tb(s,a,0);else y=y||new Map,M.findHostDirectiveDefs?.(M,d,y),d.push(M)}return d===null?null:[d,y]}function tb(s,a,m){a.componentOffset=m,(s.components??=[]).push(a.index)}function bz(s,a,m){if(a){let d=s.localNames=[];for(let y=0;y<a.length;y+=2){let i=m[a[y+1]];if(i==null)throw new Xt(-301,!1);d.push(a[y],i)}}}function wz(s,a,m){if(m){if(a.exportAs)for(let d=0;d<a.exportAs.length;d++)m[a.exportAs[d]]=s;qp(a)&&(m[""]=s)}}function Tz(s,a,m){s.flags|=1,s.directiveStart=a,s.directiveEnd=a+m,s.providerIndexes=a}function Ez(s,a,m,d,y){s.data[d]=y;let i=y.factory||(y.factory=hd(y.type,!0)),M=new Lp(i,qp(y),Kp);s.blueprint[d]=M,m[d]=M,gz(s,a,d,rA(s,m,y.hostVars,xd),y)}function Iz(s,a,m){let d=qo(a,s),y=lA(m),i=s[Vs].rendererFactory,M=16;m.signals?M=4096:m.onPush&&(M=64);let L=o0(s,r0(s,y,null,M,d,a,null,i.createRenderer(d,m),null,null,null));s[a.index]=L}function Dz(s,a,m,d,y,i){let M=i[a];if(M!==null)for(let L=0;L<M.length;){let B=M[L++],q=M[L++],se=M[L++],ge=M[L++];nA(d,m,B,q,se,ge)}}function Mz(s,a,m){let d=null,y=0;for(;y<m.length;){let i=m[y];if(i===0){y+=4;continue}else if(i===5){y+=2;continue}if(typeof i=="number")break;if(s.hasOwnProperty(i)){d===null&&(d=[]);let M=s[i];for(let L=0;L<M.length;L+=3)if(M[L]===a){d.push(i,M[L+1],M[L+2],m[y+1]);break}}y+=2}return d}function fA(s,a,m,d){return[s,!0,0,a,null,d,null,m,null,null]}function pA(s,a){let m=s.contentQueries;if(m!==null){let d=qn(null);try{for(let y=0;y<m.length;y+=2){let i=m[y],M=m[y+1];if(M!==-1){let L=s.data[M];$b(i),L.contentQueries(2,a[M],M)}}}finally{qn(d)}}}function o0(s,a){return s[Ap]?s[YM][ms]=a:s[Ap]=a,s[YM]=a,a}function nb(s,a,m){$b(0);let d=qn(null);try{a(s,m)}finally{qn(d)}}function mA(s){return s[Cp]||(s[Cp]=[])}function gA(s){return s.cleanup||(s.cleanup=[])}function _A(s,a){let m=s[dd],d=m?m.get(Us,null):null;d&&d.handleError(a)}function hw(s,a,m,d,y){for(let i=0;i<m.length;){let M=m[i++],L=m[i++],B=m[i++],q=a[M],se=s.data[M];nA(se,q,d,L,B,y)}}function Sz(s,a,m){let d=iC(a,s);z3(s[Nr],d,m)}function Cz(s,a){let m=Vl(a,s),d=m[bn];Az(d,m);let y=m[Do];y!==null&&m[Ho]===null&&(m[Ho]=ew(y,m[dd])),dw(d,m,m[Li])}function Az(s,a){for(let m=a.length;m<s.blueprint.length;m++)a.push(s.blueprint[m])}function dw(s,a,m){Gb(a);try{let d=s.viewQuery;d!==null&&nb(1,d,m);let y=s.template;y!==null&&iA(s,a,y,1,m),s.firstCreatePass&&(s.firstCreatePass=!1),a[Ca]?.finishViewCreation(s),s.staticContentQueries&&pA(s,a),s.staticViewQueries&&nb(2,s.viewQuery,m);let i=s.components;i!==null&&Pz(a,i)}catch(d){throw s.firstCreatePass&&(s.incompleteFirstPass=!0,s.firstCreatePass=!1),d}finally{a[fn]&=-5,Hb()}}function Pz(s,a){for(let m=0;m<a.length;m++)Cz(s,a[m])}function s0(s,a,m,d){let y=qn(null);try{let i=a.tView,L=s[fn]&4096?4096:16,B=r0(s,i,m,L,null,a,null,null,d?.injector??null,d?.embeddedViewInjector??null,d?.dehydratedView??null),q=s[a.index];B[Gp]=q;let se=s[Ca];return se!==null&&(B[Ca]=se.createEmbeddedView(i)),dw(i,B,m),B}finally{qn(y)}}function yA(s,a){let m=wi+a;if(m<s.length)return s[m]}function Fp(s,a){return!a||a.firstChild===null||Cy(s)}function a0(s,a,m,d=!0){let y=a[bn];if(U3(y,a,s,m),d){let M=eb(m,s),L=a[Nr],B=sw(L,s[Aa]);B!==null&&j3(y,s[ys],L,a,B,M)}let i=a[Ho];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function vA(s,a){let m=kp(s,a);return m!==void 0&&t0(m[bn],m),m}function Ry(s,a,m,d,y=!1){for(;m!==null;){let i=a[m.index];i!==null&&d.push(gs(i)),$s(i)&&Rz(i,d);let M=m.type;if(M&8)Ry(s,a,m.child,d);else if(M&32){let L=rw(m,a),B;for(;B=L();)d.push(B)}else if(M&16){let L=YC(a,m);if(Array.isArray(L))d.push(...L);else{let B=Op(a[Mo]);Ry(B[bn],B,L,d,!0)}}m=y?m.projectionNext:m.next}return d}function Rz(s,a){for(let m=wi;m<s.length;m++){let d=s[m],y=d[bn].firstChild;y!==null&&Ry(d[bn],d,y,a)}s[Aa]!==s[Do]&&a.push(s[Aa])}var xA=[];function Oz(s){return s[cu]??Lz(s)}function Lz(s){let a=xA.pop()??Object.create(Fz);return a.lView=s,a}function kz(s){s.lView[cu]!==s&&(s.lView=null,xA.push(s))}var Fz=Fr(Ct({},aM),{consumerIsAlwaysLive:!0,consumerMarkedDirty:s=>{Rp(s.lView)},consumerOnSignalRead(){this.lView[cu]=this}}),bA=100;function wA(s,a=!0,m=0){let d=s[Vs],y=d.rendererFactory,i=!1;i||y.begin?.();try{Nz(s,m)}catch(M){throw a&&_A(s,M),M}finally{i||(y.end?.(),d.inlineEffectRunner?.flush())}}function Nz(s,a){rb(s,a);let m=0;for(;Ub(s);){if(m===bA)throw new Xt(103,!1);m++,rb(s,1)}}function zz(s,a,m,d){let y=a[fn];if((y&256)===256)return;let i=!1;!i&&a[Vs].inlineEffectRunner?.flush(),Gb(a);let M=null,L=null;!i&&Bz(s)&&(L=Oz(a),M=lM(L));try{oC(a),LN(s.bindingStartIndex),m!==null&&iA(s,a,m,2,d);let B=(y&3)===3;if(!i)if(B){let ge=s.preOrderCheckHooks;ge!==null&&gy(a,ge,null)}else{let ge=s.preOrderHooks;ge!==null&&_y(a,ge,0,null),w1(a,0)}if(jz(a),TA(a,0),s.contentQueries!==null&&pA(s,a),!i)if(B){let ge=s.contentCheckHooks;ge!==null&&gy(a,ge)}else{let ge=s.contentHooks;ge!==null&&_y(a,ge,1),w1(a,1)}rz(s,a);let q=s.components;q!==null&&IA(a,q,0);let se=s.viewQuery;if(se!==null&&nb(2,se,d),!i)if(B){let ge=s.viewCheckHooks;ge!==null&&gy(a,ge)}else{let ge=s.viewHooks;ge!==null&&_y(a,ge,2),w1(a,2)}if(s.firstUpdatePass===!0&&(s.firstUpdatePass=!1),a[b1]){for(let ge of a[b1])ge();a[b1]=null}i||(a[fn]&=-73)}catch(B){throw Rp(a),B}finally{L!==null&&(cM(L,M),kz(L)),Hb()}}function Bz(s){return s.type!==2}function TA(s,a){for(let m=LC(s);m!==null;m=kC(m))for(let d=wi;d<m.length;d++){let y=m[d];EA(y,a)}}function jz(s){for(let a=LC(s);a!==null;a=kC(a)){if(!(a[fn]&zb.HasTransplantedViews))continue;let m=a[fd];for(let d=0;d<m.length;d++){let y=m[d],i=y[ui];wN(y)}}}function Vz(s,a,m){let d=Vl(a,s);EA(d,m)}function EA(s,a){Vb(s)&&rb(s,a)}function rb(s,a){let d=s[bn],y=s[fn],i=s[cu],M=!!(a===0&&y&16);if(M||=!!(y&64&&a===0),M||=!!(y&1024),M||=!!(i?.dirty&&t1(i)),i&&(i.dirty=!1),s[fn]&=-9217,M)zz(d,s,d.template,s[Li]);else if(y&8192){TA(s,1);let L=d.components;L!==null&&IA(s,L,1)}}function IA(s,a,m){for(let d=0;d<a.length;d++)Vz(s,a[d],m)}function fw(s){for(s[Vs].changeDetectionScheduler?.notify();s;){s[fn]|=64;let a=Op(s);if(JS(s)&&!a)return s;s=a}return null}var du=class{get rootNodes(){let a=this._lView,m=a[bn];return Ry(m,a,m.firstChild,[])}constructor(a,m,d=!0){this._lView=a,this._cdRefInjectingView=m,this.notifyErrorHandler=d,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Li]}set context(a){this._lView[Li]=a}get destroyed(){return(this._lView[fn]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let a=this._lView[ui];if($s(a)){let m=a[Iy],d=m?m.indexOf(this):-1;d>-1&&(kp(a,d),Ty(m,d))}this._attachedToViewContainer=!1}t0(this._lView[bn],this._lView)}onDestroy(a){sC(this._lView,a)}markForCheck(){fw(this._cdRefInjectingView||this._lView)}detach(){this._lView[fn]&=-129}reattach(){$1(this._lView),this._lView[fn]|=128}detectChanges(){this._lView[fn]|=1024,wA(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Xt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,WC(this._lView[bn],this._lView)}attachToAppRef(a){if(this._attachedToViewContainer)throw new Xt(902,!1);this._appRef=a,$1(this._lView)}},Np=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=Gz;let s=a;return s})(),Uz=Np,$z=class extends Uz{constructor(a,m,d){super(),this._declarationLView=a,this._declarationTContainer=m,this.elementRef=d}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(a,m){return this.createEmbeddedViewImpl(a,m)}createEmbeddedViewImpl(a,m,d){let y=s0(this._declarationLView,this._declarationTContainer,a,{embeddedViewInjector:m,dehydratedView:d});return new du(y)}};function Gz(){return pw(vs(),Tr())}function pw(s,a){return s.type&4?new $z(a,s,vd(s,a)):null}function DA(s){let a=s[Pp]??[],d=s[ui][Nr];for(let y of a)Hz(y,d);s[Pp]=Go}function Hz(s,a){let m=0,d=s.firstChild;if(d){let y=s.data[Ay];for(;m<y;){let i=d.nextSibling;lw(a,d,!1),d=i,m++}}}function MA(s){DA(s);for(let a=wi;a<s.length;a++)Oy(s[a])}function qz(s){let a=s[Ho]?.i18nNodes;if(a){let m=s[Nr];for(let d of a.values())lw(m,d,!1);s[Ho].i18nNodes=void 0}}function Oy(s){qz(s);let a=s[bn];for(let m=Ti;m<a.bindingStartIndex;m++)if($s(s[m])){let d=s[m];MA(d)}else Ma(s[m])&&Oy(s[m])}function Wz(s){let a=s._views;for(let m of a){let d=M3(m);if(d!==null&&d[Do]!==null)if(Ma(d))Oy(d);else{let y=d[Do];Oy(y),MA(d)}}}var Zz=new RegExp(`^(\\d+)*(${BC}|${zC})*(.*)`);function Qz(s){let a=s.match(Zz),[m,d,y,i]=a,M=d?parseInt(d,10):y,L=[];for(let[B,q,se]of i.matchAll(/(f|n)(\d*)/g)){let ge=parseInt(se,10)||1;L.push(q,ge)}return[M,...L]}function Yz(s){return!s.prev&&s.parent?.type===8}function S1(s){return s.index-Ti}function Xz(s,a){let m=s.i18nNodes;if(m){let d=m.get(a);return d&&m.delete(a),d}return null}function l0(s,a,m,d){let y=S1(d),i=Xz(s,y);if(!i){let M=s.data[b3];if(M?.[y])i=Jz(M[y],m);else if(a.firstChild===d)i=s.firstChild;else{let L=d.prev===null,B=d.prev??d.parent;if(Yz(d)){let q=S1(d.parent);i=K1(s,q)}else{let q=qo(B,m);if(L)i=q.firstChild;else{let se=S1(B),ge=K1(s,se);if(B.type===2&&ge){let Ke=tw(s,se)+1;i=c0(Ke,ge)}else i=q.nextSibling}}}}return i}function c0(s,a){let m=a;for(let d=0;d<s;d++)m=m.nextSibling;return m}function Kz(s,a){let m=s;for(let d=0;d<a.length;d+=2){let y=a[d],i=a[d+1];for(let M=0;M<i;M++)switch(y){case X1.FirstChild:m=m.firstChild;break;case X1.NextSibling:m=m.nextSibling;break}}return m}function Jz(s,a){let[m,...d]=Qz(s),y;if(m===zC)y=a[Mo][Do];else if(m===BC)y=F3(a[Mo][Do]);else{let i=Number(m);y=gs(a[i+Ti])}return Kz(y,d)}function eB(s,a){let m=[];for(let d of a)for(let y=0;y<(d[jC]??1);y++){let i={data:d,firstChild:null};d[Ay]>0&&(i.firstChild=s,s=c0(d[Ay],s)),m.push(i)}return[s,m]}var SA=()=>null;function tB(s,a){let m=s[Pp];return!a||m===null||m.length===0?null:m[0].data[x3]===a?m.shift():(DA(s),null)}function nB(){SA=tB}function zp(s,a){return SA(s,a)}var Ly=class{},ib=class{},ky=class{};function rB(s){let a=Error(`No component factory found for ${ao(s)}.`);return a[iB]=s,a}var iB="ngComponent";var ob=class{resolveComponentFactory(a){throw rB(a)}},u0=(()=>{let a=class a{};a.NULL=new ob;let s=a;return s})(),Bp=class{},h0=(()=>{let a=class a{constructor(){this.destroyNode=null}};a.__NG_ELEMENT_ID__=()=>oB();let s=a;return s})();function oB(){let s=Tr(),a=vs(),m=Vl(a.index,s);return(Ma(m)?m:s)[Nr]}var sB=(()=>{let a=class a{};a.\u0275prov=kt({token:a,providedIn:"root",factory:()=>null});let s=a;return s})(),C1={};var lS=new Set;function $l(s){lS.has(s)||(lS.add(s),performance?.mark?.("mark_feature_usage",{detail:{feature:s}}))}function cS(...s){}function aB(){let s=typeof Io.requestAnimationFrame=="function",a=Io[s?"requestAnimationFrame":"setTimeout"],m=Io[s?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&a&&m){let d=a[Zone.__symbol__("OriginalDelegate")];d&&(a=d);let y=m[Zone.__symbol__("OriginalDelegate")];y&&(m=y)}return{nativeRequestAnimationFrame:a,nativeCancelAnimationFrame:m}}var _r=class s{constructor({enableLongStackTrace:a=!1,shouldCoalesceEventChangeDetection:m=!1,shouldCoalesceRunChangeDetection:d=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Oi(!1),this.onMicrotaskEmpty=new Oi(!1),this.onStable=new Oi(!1),this.onError=new Oi(!1),typeof Zone>"u")throw new Xt(908,!1);Zone.assertZonePatched();let y=this;y._nesting=0,y._outer=y._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(y._inner=y._inner.fork(new Zone.TaskTrackingZoneSpec)),a&&Zone.longStackTraceZoneSpec&&(y._inner=y._inner.fork(Zone.longStackTraceZoneSpec)),y.shouldCoalesceEventChangeDetection=!d&&m,y.shouldCoalesceRunChangeDetection=d,y.lastRequestAnimationFrameId=-1,y.nativeRequestAnimationFrame=aB().nativeRequestAnimationFrame,uB(y)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!s.isInAngularZone())throw new Xt(909,!1)}static assertNotInAngularZone(){if(s.isInAngularZone())throw new Xt(909,!1)}run(a,m,d){return this._inner.run(a,m,d)}runTask(a,m,d,y){let i=this._inner,M=i.scheduleEventTask("NgZoneEvent: "+y,a,lB,cS,cS);try{return i.runTask(M,m,d)}finally{i.cancelTask(M)}}runGuarded(a,m,d){return this._inner.runGuarded(a,m,d)}runOutsideAngular(a){return this._outer.run(a)}},lB={};function mw(s){if(s._nesting==0&&!s.hasPendingMicrotasks&&!s.isStable)try{s._nesting++,s.onMicrotaskEmpty.emit(null)}finally{if(s._nesting--,!s.hasPendingMicrotasks)try{s.runOutsideAngular(()=>s.onStable.emit(null))}finally{s.isStable=!0}}}function cB(s){s.isCheckStableRunning||s.lastRequestAnimationFrameId!==-1||(s.lastRequestAnimationFrameId=s.nativeRequestAnimationFrame.call(Io,()=>{s.fakeTopEventTask||(s.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{s.lastRequestAnimationFrameId=-1,sb(s),s.isCheckStableRunning=!0,mw(s),s.isCheckStableRunning=!1},void 0,()=>{},()=>{})),s.fakeTopEventTask.invoke()}),sb(s))}function uB(s){let a=()=>{cB(s)};s._inner=s._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(m,d,y,i,M,L)=>{if(hB(L))return m.invokeTask(y,i,M,L);try{return uS(s),m.invokeTask(y,i,M,L)}finally{(s.shouldCoalesceEventChangeDetection&&i.type==="eventTask"||s.shouldCoalesceRunChangeDetection)&&a(),hS(s)}},onInvoke:(m,d,y,i,M,L,B)=>{try{return uS(s),m.invoke(y,i,M,L,B)}finally{s.shouldCoalesceRunChangeDetection&&a(),hS(s)}},onHasTask:(m,d,y,i)=>{m.hasTask(y,i),d===y&&(i.change=="microTask"?(s._hasPendingMicrotasks=i.microTask,sb(s),mw(s)):i.change=="macroTask"&&(s.hasPendingMacrotasks=i.macroTask))},onHandleError:(m,d,y,i)=>(m.handleError(y,i),s.runOutsideAngular(()=>s.onError.emit(i)),!1)})}function sb(s){s._hasPendingMicrotasks||(s.shouldCoalesceEventChangeDetection||s.shouldCoalesceRunChangeDetection)&&s.lastRequestAnimationFrameId!==-1?s.hasPendingMicrotasks=!0:s.hasPendingMicrotasks=!1}function uS(s){s._nesting++,s.isStable&&(s.isStable=!1,s.onUnstable.emit(null))}function hS(s){s._nesting--,mw(s)}var ab=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Oi,this.onMicrotaskEmpty=new Oi,this.onStable=new Oi,this.onError=new Oi}run(a,m,d){return a.apply(m,d)}runGuarded(a,m,d){return a.apply(m,d)}runOutsideAngular(a){return a()}runTask(a,m,d,y){return a.apply(m,d)}};function hB(s){return!Array.isArray(s)||s.length!==1?!1:s[0].data?.__ignore_ng_zone__===!0}function dB(s="zone.js",a){return s==="noop"?new ab:s==="zone.js"?new _r(a):s}var ld=function(s){return s[s.EarlyRead=0]="EarlyRead",s[s.Write=1]="Write",s[s.MixedReadWrite=2]="MixedReadWrite",s[s.Read=3]="Read",s}(ld||{}),fB={destroy(){}};function d0(s,a){!a&&cN(d0);let m=a?.injector??Xe(xs);if(!Tp(m))return fB;$l("NgAfterNextRender");let d=m.get(gw),y=d.handler??=new cb,i=a?.phase??ld.MixedReadWrite,M=()=>{y.unregister(B),L()},L=m.get(Yb).onDestroy(M),B=_s(m,()=>new lb(i,()=>{M(),s()}));return y.register(B),{destroy:M}}var lb=class{constructor(a,m){this.phase=a,this.callbackFn=m,this.zone=Xe(_r),this.errorHandler=Xe(Us,{optional:!0}),Xe(Ly,{optional:!0})?.notify(1)}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(a){this.errorHandler?.handleError(a)}}},cb=class{constructor(){this.executingCallbacks=!1,this.buckets={[ld.EarlyRead]:new Set,[ld.Write]:new Set,[ld.MixedReadWrite]:new Set,[ld.Read]:new Set},this.deferredCallbacks=new Set}register(a){(this.executingCallbacks?this.deferredCallbacks:this.buckets[a.phase]).add(a)}unregister(a){this.buckets[a.phase].delete(a),this.deferredCallbacks.delete(a)}execute(){this.executingCallbacks=!0;for(let a of Object.values(this.buckets))for(let m of a)m.invoke();this.executingCallbacks=!1;for(let a of this.deferredCallbacks)this.buckets[a.phase].add(a);this.deferredCallbacks.clear()}destroy(){for(let a of Object.values(this.buckets))a.clear();this.deferredCallbacks.clear()}},gw=(()=>{let a=class a{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let d=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let y of d)y()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};a.\u0275prov=kt({token:a,providedIn:"root",factory:()=>new a});let s=a;return s})();function ub(s,a,m){let d=m?s.styles:null,y=m?s.classes:null,i=0;if(a!==null)for(let M=0;M<a.length;M++){let L=a[M];if(typeof L=="number")i=L;else if(i==1)y=jM(y,L);else if(i==2){let B=L,q=a[++M];d=jM(d,B+": "+q+";")}}m?s.styles=d:s.stylesWithoutHost=d,m?s.classes=y:s.classesWithoutHost=y}var Fy=class extends u0{constructor(a){super(),this.ngModule=a}resolveComponentFactory(a){let m=Bl(a);return new md(m,this.ngModule)}};function dS(s){let a=[];for(let m in s){if(!s.hasOwnProperty(m))continue;let d=s[m];d!==void 0&&a.push({propName:Array.isArray(d)?d[0]:d,templateName:m})}return a}function pB(s){let a=s.toLowerCase();return a==="svg"?mN:a==="math"?gN:null}var hb=class{constructor(a,m){this.injector=a,this.parentInjector=m}get(a,m,d){d=Hy(d);let y=this.injector.get(a,C1,d);return y!==C1||m===C1?y:this.parentInjector.get(a,m,d)}},md=class extends ky{get inputs(){let a=this.componentDef,m=a.inputTransforms,d=dS(a.inputs);if(m!==null)for(let y of d)m.hasOwnProperty(y.propName)&&(y.transform=m[y.propName]);return d}get outputs(){return dS(this.componentDef.outputs)}constructor(a,m){super(),this.componentDef=a,this.ngModule=m,this.componentType=a.type,this.selector=WF(a.selectors),this.ngContentSelectors=a.ngContentSelectors?a.ngContentSelectors:[],this.isBoundToModule=!!m}create(a,m,d,y){let i=qn(null);try{y=y||this.ngModule;let M=y instanceof ki?y:y?.injector;M&&this.componentDef.getStandaloneInjector!==null&&(M=this.componentDef.getStandaloneInjector(M)||M);let L=M?new hb(a,M):a,B=L.get(Bp,null);if(B===null)throw new Xt(407,!1);let q=L.get(sB,null),se=L.get(gw,null),ge=L.get(Ly,null),Pe={rendererFactory:B,sanitizer:q,inlineEffectRunner:null,afterRenderEventManager:se,changeDetectionScheduler:ge},Ke=B.createRenderer(null,this.componentDef),Nt=this.componentDef.selectors[0][0]||"div",sn=d?sz(Ke,d,this.componentDef.encapsulation,L):e0(Ke,Nt,pB(Nt)),Rt=512;this.componentDef.signals?Rt|=4096:this.componentDef.onPush||(Rt|=16);let bt=null;sn!==null&&(bt=ew(sn,L,!0));let an=uw(0,null,null,1,0,null,null,null,null,null,null),or=r0(null,an,null,Rt,null,null,Pe,Ke,L,null,bt);Gb(or);let kn,fi;try{let jr=this.componentDef,wn,Ao=null;jr.findHostDirectiveDefs?(wn=[],Ao=new Map,jr.findHostDirectiveDefs(jr,wn,Ao),wn.push(jr)):wn=[jr];let pi=mB(or,sn),Na=gB(pi,sn,jr,wn,or,Pe,Ke);fi=jb(an,Ti),sn&&vB(Ke,jr,sn,d),m!==void 0&&xB(fi,this.ngContentSelectors,m),kn=yB(Na,jr,wn,Ao,or,[bB]),dw(an,or,null)}finally{Hb()}return new db(this.componentType,kn,vd(fi,or),or,fi)}finally{qn(i)}}},db=class extends ib{constructor(a,m,d,y,i){super(),this.location=d,this._rootLView=y,this._tNode=i,this.previousInputValues=null,this.instance=m,this.hostView=this.changeDetectorRef=new du(y,void 0,!1),this.componentType=a}setInput(a,m){let d=this._tNode.inputs,y;if(d!==null&&(y=d[a])){if(this.previousInputValues??=new Map,this.previousInputValues.has(a)&&Object.is(this.previousInputValues.get(a),m))return;let i=this._rootLView;hw(i[bn],i,y,a,m),this.previousInputValues.set(a,m);let M=Vl(this._tNode.index,i);fw(M)}}get injector(){return new au(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(a){this.hostView.onDestroy(a)}};function mB(s,a){let m=s[bn],d=Ti;return s[d]=a,i0(m,d,2,"#host",null)}function gB(s,a,m,d,y,i,M){let L=y[bn];_B(d,s,a,M);let B=null;a!==null&&(B=ew(a,y[dd]));let q=i.rendererFactory.createRenderer(a,m),se=16;m.signals?se=4096:m.onPush&&(se=64);let ge=r0(y,lA(m),null,se,y[s.index],s,i,q,null,null,B);return L.firstCreatePass&&tb(L,s,d.length-1),o0(y,ge),y[s.index]=ge}function _B(s,a,m,d){for(let y of s)a.mergedAttrs=Lb(a.mergedAttrs,y.hostAttrs);a.mergedAttrs!==null&&(ub(a,a.mergedAttrs,!0),m!==null&&JC(d,m,a))}function yB(s,a,m,d,y,i){let M=vs(),L=y[bn],B=qo(M,y);hA(L,y,M,m,null,d);for(let se=0;se<m.length;se++){let ge=M.directiveStart+se,Pe=pd(y,L,ge,M);hu(Pe,y)}dA(L,y,M),B&&hu(B,y);let q=pd(y,L,M.directiveStart+M.componentOffset,M);if(s[Li]=y[Li]=q,i!==null)for(let se of i)se(q,a);return oA(L,M,y),q}function vB(s,a,m,d){if(d)N1(s,m,["ng-version","17.3.10"]);else{let{attrs:y,classes:i}=ZF(a.selectors[0]);y&&N1(s,m,y),i&&i.length>0&&KC(s,m,i.join(" "))}}function xB(s,a,m){let d=s.projection=[];for(let y=0;y<a.length;y++){let i=m[y];d.push(i!=null?Array.from(i):null)}}function bB(){let s=vs();Wb(Tr()[bn],s)}var wd=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=wB;let s=a;return s})();function wB(){let s=vs();return AA(s,Tr())}var TB=wd,CA=class extends TB{constructor(a,m,d){super(),this._lContainer=a,this._hostTNode=m,this._hostLView=d}get element(){return vd(this._hostTNode,this._hostLView)}get injector(){return new au(this._hostTNode,this._hostLView)}get parentInjector(){let a=Zb(this._hostTNode,this._hostLView);if(vC(a)){let m=Sy(a,this._hostLView),d=My(a),y=m[bn].data[d+8];return new au(y,m)}else return new au(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(a){let m=fS(this._lContainer);return m!==null&&m[a]||null}get length(){return this._lContainer.length-wi}createEmbeddedView(a,m,d){let y,i;typeof d=="number"?y=d:d!=null&&(y=d.index,i=d.injector);let M=zp(this._lContainer,a.ssrId),L=a.createEmbeddedViewImpl(m||{},i,M);return this.insertImpl(L,y,Fp(this._hostTNode,M)),L}createComponent(a,m,d,y,i){let M=a&&!hN(a),L;if(M)L=m;else{let Nt=m||{};L=Nt.index,d=Nt.injector,y=Nt.projectableNodes,i=Nt.environmentInjector||Nt.ngModuleRef}let B=M?a:new md(Bl(a)),q=d||this.parentInjector;if(!i&&B.ngModule==null){let sn=(M?q:this.parentInjector).get(ki,null);sn&&(i=sn)}let se=Bl(B.componentType??{}),ge=zp(this._lContainer,se?.id??null),Pe=ge?.firstChild??null,Ke=B.create(q,y,Pe,i);return this.insertImpl(Ke.hostView,L,Fp(this._hostTNode,ge)),Ke}insert(a,m){return this.insertImpl(a,m,!0)}insertImpl(a,m,d){let y=a._lView;if(bN(y)){let L=this.indexOf(a);if(L!==-1)this.detach(L);else{let B=y[ui],q=new CA(B,B[ys],B[ui]);q.detach(q.indexOf(a))}}let i=this._adjustIndex(m),M=this._lContainer;return a0(M,y,i,d),a.attachToViewContainerRef(),kS(A1(M),i,a),a}move(a,m){return this.insert(a,m)}indexOf(a){let m=fS(this._lContainer);return m!==null?m.indexOf(a):-1}remove(a){let m=this._adjustIndex(a,-1),d=kp(this._lContainer,m);d&&(Ty(A1(this._lContainer),m),t0(d[bn],d))}detach(a){let m=this._adjustIndex(a,-1),d=kp(this._lContainer,m);return d&&Ty(A1(this._lContainer),m)!=null?new du(d):null}_adjustIndex(a,m=0){return a??this.length+m}};function fS(s){return s[Iy]}function A1(s){return s[Iy]||(s[Iy]=[])}function AA(s,a){let m,d=a[s.index];return $s(d)?m=d:(m=fA(d,a,null,s),a[s.index]=m,o0(a,m)),PA(m,a,s,d),new CA(m,s,a)}function EB(s,a){let m=s[Nr],d=m.createComment(""),y=qo(a,s),i=sw(m,y);return Py(m,i,d,Q3(m,y),!1),d}var PA=RA,_w=()=>!1;function IB(s,a,m){return _w(s,a,m)}function RA(s,a,m,d){if(s[Aa])return;let y;m.type&8?y=gs(d):y=EB(a,m),s[Aa]=y}function DB(s,a,m){if(s[Aa]&&s[Pp])return!0;let d=m[Ho],y=a.index-Ti;if(!d||u3(a)||Jy(d,y))return!1;let M=K1(d,y),L=d.data[Jb]?.[y],[B,q]=eB(M,L);return s[Aa]=B,s[Pp]=q,!0}function MB(s,a,m,d){_w(s,m,a)||RA(s,a,m,d)}function SB(){PA=MB,_w=DB}var fb=class s{constructor(a){this.queryList=a,this.matches=null}clone(){return new s(this.queryList)}setDirty(){this.queryList.setDirty()}},pb=class s{constructor(a=[]){this.queries=a}createEmbeddedView(a){let m=a.queries;if(m!==null){let d=a.contentQueries!==null?a.contentQueries[0]:m.length,y=[];for(let i=0;i<d;i++){let M=m.getByIndex(i),L=this.queries[M.indexInDeclarationView];y.push(L.clone())}return new s(y)}return null}insertView(a){this.dirtyQueriesWithMatches(a)}detachView(a){this.dirtyQueriesWithMatches(a)}finishViewCreation(a){this.dirtyQueriesWithMatches(a)}dirtyQueriesWithMatches(a){for(let m=0;m<this.queries.length;m++)yw(a,m).matches!==null&&this.queries[m].setDirty()}},mb=class{constructor(a,m,d=null){this.flags=m,this.read=d,typeof a=="string"?this.predicate=FB(a):this.predicate=a}},gb=class s{constructor(a=[]){this.queries=a}elementStart(a,m){for(let d=0;d<this.queries.length;d++)this.queries[d].elementStart(a,m)}elementEnd(a){for(let m=0;m<this.queries.length;m++)this.queries[m].elementEnd(a)}embeddedTView(a){let m=null;for(let d=0;d<this.length;d++){let y=m!==null?m.length:0,i=this.getByIndex(d).embeddedTView(a,y);i&&(i.indexInDeclarationView=d,m!==null?m.push(i):m=[i])}return m!==null?new s(m):null}template(a,m){for(let d=0;d<this.queries.length;d++)this.queries[d].template(a,m)}getByIndex(a){return this.queries[a]}get length(){return this.queries.length}track(a){this.queries.push(a)}},_b=class s{constructor(a,m=-1){this.metadata=a,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=m}elementStart(a,m){this.isApplyingToNode(m)&&this.matchTNode(a,m)}elementEnd(a){this._declarationNodeIndex===a.index&&(this._appliesToNextNode=!1)}template(a,m){this.elementStart(a,m)}embeddedTView(a,m){return this.isApplyingToNode(a)?(this.crossesNgTemplate=!0,this.addMatch(-a.index,m),new s(this.metadata)):null}isApplyingToNode(a){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let m=this._declarationNodeIndex,d=a.parent;for(;d!==null&&d.type&8&&d.index!==m;)d=d.parent;return m===(d!==null?d.index:-1)}return this._appliesToNextNode}matchTNode(a,m){let d=this.metadata.predicate;if(Array.isArray(d))for(let y=0;y<d.length;y++){let i=d[y];this.matchTNodeWithReadOption(a,m,CB(m,i)),this.matchTNodeWithReadOption(a,m,yy(m,a,i,!1,!1))}else d===Np?m.type&4&&this.matchTNodeWithReadOption(a,m,-1):this.matchTNodeWithReadOption(a,m,yy(m,a,d,!1,!1))}matchTNodeWithReadOption(a,m,d){if(d!==null){let y=this.metadata.read;if(y!==null)if(y===Ul||y===wd||y===Np&&m.type&4)this.addMatch(m.index,-2);else{let i=yy(m,a,y,!1,!1);i!==null&&this.addMatch(m.index,i)}else this.addMatch(m.index,d)}}addMatch(a,m){this.matches===null?this.matches=[a,m]:this.matches.push(a,m)}};function CB(s,a){let m=s.localNames;if(m!==null){for(let d=0;d<m.length;d+=2)if(m[d]===a)return m[d+1]}return null}function AB(s,a){return s.type&11?vd(s,a):s.type&4?pw(s,a):null}function PB(s,a,m,d){return m===-1?AB(a,s):m===-2?RB(s,a,d):pd(s,s[bn],m,a)}function RB(s,a,m){if(m===Ul)return vd(a,s);if(m===Np)return pw(a,s);if(m===wd)return AA(a,s)}function OA(s,a,m,d){let y=a[Ca].queries[d];if(y.matches===null){let i=s.data,M=m.matches,L=[];for(let B=0;M!==null&&B<M.length;B+=2){let q=M[B];if(q<0)L.push(null);else{let se=i[q];L.push(PB(a,se,M[B+1],m.metadata.read))}}y.matches=L}return y.matches}function yb(s,a,m,d){let y=s.queries.getByIndex(m),i=y.matches;if(i!==null){let M=OA(s,a,y,m);for(let L=0;L<i.length;L+=2){let B=i[L];if(B>0)d.push(M[L/2]);else{let q=i[L+1],se=a[-B];for(let ge=wi;ge<se.length;ge++){let Pe=se[ge];Pe[Gp]===Pe[ui]&&yb(Pe[bn],Pe,q,d)}if(se[fd]!==null){let ge=se[fd];for(let Pe=0;Pe<ge.length;Pe++){let Ke=ge[Pe];yb(Ke[bn],Ke,q,d)}}}}}return d}function OB(s,a){return s[Ca].queries[a].queryList}function LB(s,a,m){let d=new Q1((m&4)===4);return uz(s,a,d,d.destroy),(a[Ca]??=new pb).queries.push(new fb(d))-1}function kB(s,a,m){let d=Gs();return d.firstCreatePass&&(NB(d,new mb(s,a,m),-1),(a&2)===2&&(d.staticViewQueries=!0)),LB(d,Tr(),a)}function FB(s){return s.split(",").map(a=>a.trim())}function NB(s,a,m){s.queries===null&&(s.queries=new gb),s.queries.track(new _b(a,m))}function yw(s,a){return s.queries.getByIndex(a)}function zB(s,a){let m=s[bn],d=yw(m,a);return d.crossesNgTemplate?yb(m,s,a,[]):OA(m,s,d,a)}function BB(s){let a=[],m=new Map;function d(y){let i=m.get(y);if(!i){let M=s(y);m.set(y,i=M.then($B))}return i}return Ny.forEach((y,i)=>{let M=[];y.templateUrl&&M.push(d(y.templateUrl).then(q=>{y.template=q}));let L=typeof y.styles=="string"?[y.styles]:y.styles||[];if(y.styles=L,y.styleUrl&&y.styleUrls?.length)throw new Error("@Component cannot define both `styleUrl` and `styleUrls`. Use `styleUrl` if the component has one stylesheet, or `styleUrls` if it has multiple");if(y.styleUrls?.length){let q=y.styles.length,se=y.styleUrls;y.styleUrls.forEach((ge,Pe)=>{L.push(""),M.push(d(ge).then(Ke=>{L[q+Pe]=Ke,se.splice(se.indexOf(ge),1),se.length==0&&(y.styleUrls=void 0)}))})}else y.styleUrl&&M.push(d(y.styleUrl).then(q=>{L.push(q),y.styleUrl=void 0}));let B=Promise.all(M).then(()=>GB(i));a.push(B)}),VB(),Promise.all(a).then(()=>{})}var Ny=new Map,jB=new Set;function VB(){let s=Ny;return Ny=new Map,s}function UB(){return Ny.size===0}function $B(s){return typeof s=="string"?s:s.text()}function GB(s){jB.delete(s)}var jl=class{},jp=class{};var zy=class extends jl{constructor(a,m,d){super(),this._parent=m,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Fy(this);let y=$S(a);this._bootstrapComponents=qC(y.bootstrap),this._r3Injector=CC(a,m,[{provide:jl,useValue:this},{provide:u0,useValue:this.componentFactoryResolver},...d],ao(a),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(a)}get injector(){return this._r3Injector}destroy(){let a=this._r3Injector;!a.destroyed&&a.destroy(),this.destroyCbs.forEach(m=>m()),this.destroyCbs=null}onDestroy(a){this.destroyCbs.push(a)}},By=class extends jp{constructor(a){super(),this.moduleType=a}create(a){return new zy(this.moduleType,a,[])}};function HB(s,a,m){return new zy(s,a,m)}var vb=class extends jl{constructor(a){super(),this.componentFactoryResolver=new Fy(this),this.instance=null;let m=new Sp([...a.providers,{provide:jl,useValue:this},{provide:u0,useValue:this.componentFactoryResolver}],a.parent||Nb(),a.debugName,new Set(["environment"]));this.injector=m,a.runEnvironmentInitializers&&m.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(a){this.injector.onDestroy(a)}};function f0(s,a,m=null){return new vb({providers:s,parent:a,debugName:m,runEnvironmentInitializers:!0}).injector}var _u=(()=>{let a=class a{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new bi(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let d=this.taskId++;return this.pendingTasks.add(d),d}remove(d){this.pendingTasks.delete(d),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function Jp(s,a,m){let d=s[a];return Object.is(d,m)?!1:(s[a]=m,!0)}function em(s){return(s.flags&32)===32}function qB(s,a,m,d,y,i,M,L,B){let q=a.consts,se=i0(a,s,4,M||null,Dy(q,L));uA(a,m,se,Dy(q,B)),Wb(a,se);let ge=se.tView=uw(2,se,d,y,i,a.directiveRegistry,a.pipeRegistry,null,a.schemas,q,null);return a.queries!==null&&(a.queries.template(a,se),ge.queries=a.queries.embeddedTView(se)),se}function fu(s,a,m,d,y,i,M,L){let B=Tr(),q=Gs(),se=s+Ti,ge=q.firstCreatePass?qB(se,q,B,a,m,d,y,i,M):q.data[se];Yp(ge,!1);let Pe=LA(q,B,ge,s);qb()&&aw(q,B,Pe,ge),hu(Pe,B);let Ke=fA(Pe,B,Pe,ge);return B[se]=Ke,o0(B,Ke),IB(Ke,ge,B),Bb(ge)&&sA(q,B,ge),M!=null&&aA(B,ge,L),fu}var LA=kA;function kA(s,a,m,d){return Hs(!0),a[Nr].createComment("")}function WB(s,a,m,d){let y=a[Ho],i=!y||Wp()||em(m)||Jy(y,d);if(Hs(i),i)return kA(s,a,m,d);let M=y.data[v3]?.[d]??null;M!==null&&m.tView!==null&&m.tView.ssrId===null&&(m.tView.ssrId=M);let L=l0(y,s,a,m);Ky(y,d,L);let B=tw(y,d);return c0(B,L)}function ZB(){LA=WB}function QB(s,a,m,d){return Jp(s,Yy(),m)?a+AS(m)+d:xd}function dy(s,a){return s<<17|a<<2}function pu(s){return s>>17&32767}function YB(s){return(s&2)==2}function XB(s,a){return s&131071|a<<17}function xb(s){return s|2}function gd(s){return(s&131068)>>2}function P1(s,a){return s&-131069|a<<2}function KB(s){return(s&1)===1}function bb(s){return s|1}function JB(s,a,m,d,y,i){let M=i?a.classBindings:a.styleBindings,L=pu(M),B=gd(M);s[d]=m;let q=!1,se;if(Array.isArray(m)){let ge=m;se=ge[1],(se===null||$p(ge,se)>0)&&(q=!0)}else se=m;if(y)if(B!==0){let Pe=pu(s[L+1]);s[d+1]=dy(Pe,L),Pe!==0&&(s[Pe+1]=P1(s[Pe+1],d)),s[L+1]=XB(s[L+1],d)}else s[d+1]=dy(L,0),L!==0&&(s[L+1]=P1(s[L+1],d)),L=d;else s[d+1]=dy(B,0),L===0?L=d:s[B+1]=P1(s[B+1],d),B=d;q&&(s[d+1]=xb(s[d+1])),pS(s,se,d,!0),pS(s,se,d,!1),e4(a,se,s,d,i),M=dy(L,B),i?a.classBindings=M:a.styleBindings=M}function e4(s,a,m,d,y){let i=y?s.residualClasses:s.residualStyles;i!=null&&typeof a=="string"&&$p(i,a)>=0&&(m[d+1]=bb(m[d+1]))}function pS(s,a,m,d){let y=s[m+1],i=a===null,M=d?pu(y):gd(y),L=!1;for(;M!==0&&(L===!1||i);){let B=s[M],q=s[M+1];t4(B,a)&&(L=!0,s[M+1]=d?bb(q):xb(q)),M=d?pu(q):gd(q)}L&&(s[m+1]=d?xb(y):bb(y))}function t4(s,a){return s===null||a==null||(Array.isArray(s)?s[1]:s)===a?!0:Array.isArray(s)&&typeof a=="string"?$p(s,a)>=0:!1}function vw(s,a,m){let d=Tr(),y=Yy();if(Jp(d,y,a)){let i=Gs(),M=UN();pz(i,M,d,s,a,d[Nr],m,!1)}return vw}function mS(s,a,m,d,y){let i=a.inputs,M=y?"class":"style";hw(s,m,i[M],M,d)}function xw(s,a){return n4(s,a,null,!0),xw}function n4(s,a,m,d){let y=Tr(),i=Gs(),M=kN(2);if(i.firstUpdatePass&&i4(i,s,M,d),a!==xd&&Jp(y,M,a)){let L=i.data[mu()];c4(i,L,y,y[Nr],s,y[M+1]=u4(a,m),d,M)}}function r4(s,a){return a>=s.expandoStartIndex}function i4(s,a,m,d){let y=s.data;if(y[m+1]===null){let i=y[mu()],M=r4(s,m);h4(i,d)&&a===null&&!M&&(a=!1),a=o4(y,i,a,d),JB(y,i,a,m,M,d)}}function o4(s,a,m,d){let y=BN(s),i=d?a.residualClasses:a.residualStyles;if(y===null)(d?a.classBindings:a.styleBindings)===0&&(m=R1(null,s,a,m,d),m=Vp(m,a.attrs,d),i=null);else{let M=a.directiveStylingLast;if(M===-1||s[M]!==y)if(m=R1(y,s,a,m,d),i===null){let B=s4(s,a,d);B!==void 0&&Array.isArray(B)&&(B=R1(null,s,a,B[1],d),B=Vp(B,a.attrs,d),a4(s,a,d,B))}else i=l4(s,a,d)}return i!==void 0&&(d?a.residualClasses=i:a.residualStyles=i),m}function s4(s,a,m){let d=m?a.classBindings:a.styleBindings;if(gd(d)!==0)return s[pu(d)]}function a4(s,a,m,d){let y=m?a.classBindings:a.styleBindings;s[pu(y)]=d}function l4(s,a,m){let d,y=a.directiveEnd;for(let i=1+a.directiveStylingLast;i<y;i++){let M=s[i].hostAttrs;d=Vp(d,M,m)}return Vp(d,a.attrs,m)}function R1(s,a,m,d,y){let i=null,M=m.directiveEnd,L=m.directiveStylingLast;for(L===-1?L=m.directiveStart:L++;L<M&&(i=a[L],d=Vp(d,i.hostAttrs,y),i!==s);)L++;return s!==null&&(m.directiveStylingLast=L),d}function Vp(s,a,m){let d=m?1:2,y=-1;if(a!==null)for(let i=0;i<a.length;i++){let M=a[i];typeof M=="number"?y=M:y===d&&(Array.isArray(s)||(s=s===void 0?[]:["",s]),LF(s,M,m?!0:a[++i]))}return s===void 0?null:s}function c4(s,a,m,d,y,i,M,L){if(!(a.type&3))return;let B=s.data,q=B[L+1],se=KB(q)?gS(B,a,m,y,gd(q),M):void 0;if(!jy(se)){jy(i)||YB(q)&&(i=gS(B,null,m,y,L,M));let ge=iC(mu(),m);tz(d,M,ge,y,i)}}function gS(s,a,m,d,y,i){let M=a===null,L;for(;y>0;){let B=s[y],q=Array.isArray(B),se=q?B[1]:B,ge=se===null,Pe=m[y+1];Pe===xd&&(Pe=ge?Go:void 0);let Ke=ge?v1(Pe,d):se===d?Pe:void 0;if(q&&!jy(Ke)&&(Ke=v1(B,d)),jy(Ke)&&(L=Ke,M))return L;let Nt=s[y+1];y=M?pu(Nt):gd(Nt)}if(a!==null){let B=i?a.residualClasses:a.residualStyles;B!=null&&(L=v1(B,d))}return L}function jy(s){return s!==void 0}function u4(s,a){return s==null||s===""||(typeof a=="string"?s=s+a:typeof s=="object"&&(s=ao(nw(s)))),s}function h4(s,a){return(s.flags&(a?8:16))!==0}var wb=class{destroy(a){}updateValue(a,m){}swap(a,m){let d=Math.min(a,m),y=Math.max(a,m),i=this.detach(y);if(y-d>1){let M=this.detach(d);this.attach(d,i),this.attach(y,M)}else this.attach(d,i)}move(a,m){this.attach(m,this.detach(a))}};function O1(s,a,m,d,y){return s===m&&Object.is(a,d)?1:Object.is(y(s,a),y(m,d))?-1:0}function d4(s,a,m){let d,y,i=0,M=s.length-1;if(Array.isArray(a)){let L=a.length-1;for(;i<=M&&i<=L;){let B=s.at(i),q=a[i],se=O1(i,B,i,q,m);if(se!==0){se<0&&s.updateValue(i,q),i++;continue}let ge=s.at(M),Pe=a[L],Ke=O1(M,ge,L,Pe,m);if(Ke!==0){Ke<0&&s.updateValue(M,Pe),M--,L--;continue}let Nt=m(i,B),sn=m(M,ge),Rt=m(i,q);if(Object.is(Rt,sn)){let bt=m(L,Pe);Object.is(bt,Nt)?(s.swap(i,M),s.updateValue(M,Pe),L--,M--):s.move(M,i),s.updateValue(i,q),i++;continue}if(d??=new Vy,y??=yS(s,i,M,m),Tb(s,d,i,Rt))s.updateValue(i,q),i++,M++;else if(y.has(Rt))d.set(Nt,s.detach(i)),M--;else{let bt=s.create(i,a[i]);s.attach(i,bt),i++,M++}}for(;i<=L;)_S(s,d,m,i,a[i]),i++}else if(a!=null){let L=a[Symbol.iterator](),B=L.next();for(;!B.done&&i<=M;){let q=s.at(i),se=B.value,ge=O1(i,q,i,se,m);if(ge!==0)ge<0&&s.updateValue(i,se),i++,B=L.next();else{d??=new Vy,y??=yS(s,i,M,m);let Pe=m(i,se);if(Tb(s,d,i,Pe))s.updateValue(i,se),i++,M++,B=L.next();else if(!y.has(Pe))s.attach(i,s.create(i,se)),i++,M++,B=L.next();else{let Ke=m(i,q);d.set(Ke,s.detach(i)),M--}}}for(;!B.done;)_S(s,d,m,s.length,B.value),B=L.next()}for(;i<=M;)s.destroy(s.detach(M--));d?.forEach(L=>{s.destroy(L)})}function Tb(s,a,m,d){return a!==void 0&&a.has(d)?(s.attach(m,a.get(d)),a.delete(d),!0):!1}function _S(s,a,m,d,y){if(Tb(s,a,d,m(d,y)))s.updateValue(d,y);else{let i=s.create(d,y);s.attach(d,i)}}function yS(s,a,m,d){let y=new Set;for(let i=a;i<=m;i++)y.add(d(i,s.at(i)));return y}var Vy=class{constructor(){this.kvMap=new Map,this._vMap=void 0}has(a){return this.kvMap.has(a)}delete(a){if(!this.has(a))return!1;let m=this.kvMap.get(a);return this._vMap!==void 0&&this._vMap.has(m)?(this.kvMap.set(a,this._vMap.get(m)),this._vMap.delete(m)):this.kvMap.delete(a),!0}get(a){return this.kvMap.get(a)}set(a,m){if(this.kvMap.has(a)){let d=this.kvMap.get(a);this._vMap===void 0&&(this._vMap=new Map);let y=this._vMap;for(;y.has(d);)d=y.get(d);y.set(d,m)}else this.kvMap.set(a,m)}forEach(a){for(let[m,d]of this.kvMap)if(a(d,m),this._vMap!==void 0){let y=this._vMap;for(;y.has(d);)d=y.get(d),a(d,m)}}};function tm(s,a,m){$l("NgControlFlow");let d=Tr(),y=Yy(),i=Mb(d,Ti+s),M=0;if(Jp(d,y,a)){let L=qn(null);try{if(vA(i,M),a!==-1){let B=Sb(d[bn],Ti+a),q=zp(i,B.tView.ssrId),se=s0(d,B,m,{dehydratedView:q});a0(i,se,M,Fp(B,q))}}finally{qn(L)}}else{let L=yA(i,M);L!==void 0&&(L[Li]=m)}}var Eb=class{constructor(a,m,d){this.lContainer=a,this.$implicit=m,this.$index=d}get $count(){return this.lContainer.length-wi}};function FA(s){return s}var Ib=class{constructor(a,m,d){this.hasEmptyBlock=a,this.trackByFn=m,this.liveCollection=d}};function NA(s,a,m,d,y,i,M,L,B,q,se,ge,Pe){$l("NgControlFlow");let Ke=B!==void 0,Nt=Tr(),sn=L?M.bind(Nt[Mo][Li]):M,Rt=new Ib(Ke,sn);Nt[Ti+s]=Rt,fu(s+1,a,m,d,y,i),Ke&&fu(s+2,B,q,se,ge,Pe)}var Db=class extends wb{constructor(a,m,d){super(),this.lContainer=a,this.hostLView=m,this.templateTNode=d,this.needsIndexUpdate=!1}get length(){return this.lContainer.length-wi}at(a){return this.getLView(a)[Li].$implicit}attach(a,m){let d=m[Ho];this.needsIndexUpdate||=a!==this.length,a0(this.lContainer,m,a,Fp(this.templateTNode,d))}detach(a){return this.needsIndexUpdate||=a!==this.length-1,f4(this.lContainer,a)}create(a,m){let d=zp(this.lContainer,this.templateTNode.tView.ssrId);return s0(this.hostLView,this.templateTNode,new Eb(this.lContainer,m,a),{dehydratedView:d})}destroy(a){t0(a[bn],a)}updateValue(a,m){this.getLView(a)[Li].$implicit=m}reset(){this.needsIndexUpdate=!1}updateIndexes(){if(this.needsIndexUpdate)for(let a=0;a<this.length;a++)this.getLView(a)[Li].$index=a}getLView(a){return p4(this.lContainer,a)}};function zA(s){let a=qn(null),m=mu();try{let d=Tr(),y=d[bn],i=d[m];if(i.liveCollection===void 0){let L=m+1,B=Mb(d,L),q=Sb(y,L);i.liveCollection=new Db(B,d,q)}else i.liveCollection.reset();let M=i.liveCollection;if(d4(M,s,i.trackByFn),M.updateIndexes(),i.hasEmptyBlock){let L=Yy(),B=M.length===0;if(Jp(d,L,B)){let q=m+2,se=Mb(d,q);if(B){let ge=Sb(y,q),Pe=zp(se,ge.tView.ssrId),Ke=s0(d,ge,void 0,{dehydratedView:Pe});a0(se,Ke,0,Fp(ge,Pe))}else vA(se,0)}}}finally{qn(a)}}function Mb(s,a){return s[a]}function f4(s,a){return kp(s,a)}function p4(s,a){return yA(s,a)}function Sb(s,a){return jb(s,a)}function m4(s,a,m,d,y,i){let M=a.consts,L=Dy(M,y),B=i0(a,s,2,d,L);return uA(a,m,B,Dy(M,i)),B.attrs!==null&&ub(B,B.attrs,!1),B.mergedAttrs!==null&&ub(B,B.mergedAttrs,!0),a.queries!==null&&a.queries.elementStart(a,B),B}function Ei(s,a,m,d){let y=Tr(),i=Gs(),M=Ti+s,L=y[Nr],B=i.firstCreatePass?m4(M,i,y,a,m,d):i.data[M],q=BA(i,y,B,L,a,s);y[M]=q;let se=Bb(B);return Yp(B,!0),JC(L,q,B),!em(B)&&qb()&&aw(i,y,q,B),IN()===0&&hu(q,y),DN(),se&&(sA(i,y,B),oA(i,B,y)),d!==null&&aA(y,B),Ei}function Ii(){let s=vs();cC()?RN():(s=s.parent,Yp(s,!1));let a=s;SN(a)&&AN(),MN();let m=Gs();return m.firstCreatePass&&(Wb(m,s),KS(s)&&m.queries.elementEnd(s)),a.classesWithoutHost!=null&&qN(a)&&mS(m,a,Tr(),a.classesWithoutHost,!0),a.stylesWithoutHost!=null&&WN(a)&&mS(m,a,Tr(),a.stylesWithoutHost,!1),Ii}function Wi(s,a,m,d){return Ei(s,a,m,d),Ii(),Wi}var BA=(s,a,m,d,y,i)=>(Hs(!0),e0(d,y,gC()));function g4(s,a,m,d,y,i){let M=a[Ho],L=!M||Wp()||em(m)||Jy(M,i);if(Hs(L),L)return e0(d,y,gC());let B=l0(M,s,a,m);return $C(M,i)&&Ky(M,i,B.nextSibling),M&&(PC(m)||RC(B))&&Hp(m)&&(CN(m),XC(B)),B}function _4(){BA=g4}var y4=(s,a,m,d)=>(Hs(!0),ow(a[Nr],""));function v4(s,a,m,d){let y,i=a[Ho],M=!i||Wp()||em(m);if(Hs(M),M)return ow(a[Nr],"");let L=l0(i,s,a,m),B=A3(i,d);return Ky(i,d,L),y=c0(B,L),y}function x4(){y4=v4}function p0(){return Tr()}var Uy="en-US";var b4=Uy;function w4(s){typeof s=="string"&&(b4=s.toLowerCase().replace(/_/g,"-"))}function jA(s,a,m){let d=s[Nr];switch(m){case Node.COMMENT_NODE:return ow(d,a);case Node.TEXT_NODE:return iw(d,a);case Node.ELEMENT_NODE:return e0(d,a,null)}}var T4=(s,a,m,d)=>(Hs(!0),jA(s,m,d));function E4(s,a,m,d){return Hs(!0),jA(s,m,d)}function I4(){T4=E4}function Ra(s,a,m,d){let y=Tr(),i=Gs(),M=vs();return M4(i,y,y[Nr],M,s,a,d),Ra}function D4(s,a,m,d){let y=s.cleanup;if(y!=null)for(let i=0;i<y.length-1;i+=2){let M=y[i];if(M===m&&y[i+1]===d){let L=a[Cp],B=y[i+2];return L.length>B?L[B]:null}typeof M=="string"&&(i+=2)}return null}function M4(s,a,m,d,y,i,M){let L=Bb(d),q=s.firstCreatePass&&gA(s),se=a[Li],ge=mA(a),Pe=!0;if(d.type&3||M){let sn=qo(d,a),Rt=M?M(sn):sn,bt=ge.length,an=M?kn=>M(gs(kn[d.index])):d.index,or=null;if(!M&&L&&(or=D4(s,a,y,d.index)),or!==null){let kn=or.__ngLastListenerFn__||or;kn.__ngNextListenerFn__=i,or.__ngLastListenerFn__=i,Pe=!1}else{i=xS(d,a,se,i,!1);let kn=m.listen(Rt,y,i);ge.push(i,kn),q&&q.push(y,an,bt,bt+1)}}else i=xS(d,a,se,i,!1);let Ke=d.outputs,Nt;if(Pe&&Ke!==null&&(Nt=Ke[y])){let sn=Nt.length;if(sn)for(let Rt=0;Rt<sn;Rt+=2){let bt=Nt[Rt],an=Nt[Rt+1],fi=a[bt][an].subscribe(i),jr=ge.length;ge.push(i,fi),q&&q.push(y,d.index,jr,-(jr+1))}}}function vS(s,a,m,d){let y=qn(null);try{return zs(6,a,m),m(d)!==!1}catch(i){return _A(s,i),!1}finally{zs(7,a,m),qn(y)}}function xS(s,a,m,d,y){return function i(M){if(M===Function)return d;let L=s.componentOffset>-1?Vl(s.index,a):a;fw(L);let B=vS(a,m,d,M),q=i.__ngNextListenerFn__;for(;q;)B=vS(a,m,q,M)&&B,q=q.__ngNextListenerFn__;return y&&B===!1&&M.preventDefault(),B}}function nm(s=1){return VN(s)}function VA(s,a,m){kB(s,a,m)}function bw(s){let a=Tr(),m=Gs(),d=uC();$b(d+1);let y=yw(m,d);if(s.dirty&&xN(a)===((y.metadata.flags&2)===2)){if(y.matches===null)s.reset([]);else{let i=zB(a,d);s.reset(i,s3),s.notifyOnChanges()}return!0}return!1}function ww(){return OB(Tr(),uC())}function UA(s){let a=ON();return vN(a,Ti+s)}function bs(s,a=""){let m=Tr(),d=Gs(),y=s+Ti,i=d.firstCreatePass?i0(d,y,1,a,null):d.data[y],M=$A(d,m,i,a,s);m[y]=M,qb()&&aw(d,m,M,i),Yp(i,!1)}var $A=(s,a,m,d,y)=>(Hs(!0),iw(a[Nr],d));function S4(s,a,m,d,y){let i=a[Ho],M=!i||Wp()||em(m)||Jy(i,y);return Hs(M),M?iw(a[Nr],d):l0(i,s,a,m)}function C4(){$A=S4}function m0(s){return GA("",s,""),m0}function GA(s,a,m){let d=Tr(),y=QB(d,s,a,m);return y!==xd&&Sz(d,mu(),y),GA}var A4=(()=>{let a=class a{constructor(d){this._injector=d,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(d){if(!d.standalone)return null;if(!this.cachedInjectors.has(d)){let y=qS(!1,d.type),i=y.length>0?f0([y],this._injector,`Standalone[${d.type.name}]`):null;this.cachedInjectors.set(d,i)}return this.cachedInjectors.get(d)}ngOnDestroy(){try{for(let d of this.cachedInjectors.values())d!==null&&d.destroy()}finally{this.cachedInjectors.clear()}}};a.\u0275prov=kt({token:a,providedIn:"environment",factory:()=>new a(jt(ki))});let s=a;return s})();function HA(s){$l("NgStandalone"),s.getStandaloneInjector=a=>a.get(A4).getOrCreateStandaloneInjector(s)}var fy=null;function P4(s){fy!==null&&(s.defaultEncapsulation!==fy.defaultEncapsulation||s.preserveWhitespaces!==fy.preserveWhitespaces)||(fy=s)}var g0=(()=>{let a=class a{log(d){console.log(d)}warn(d){console.warn(d)}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"platform"});let s=a;return s})();var Tw=new Wt(""),rm=new Wt(""),_0=(()=>{let a=class a{constructor(d,y,i){this._ngZone=d,this.registry=y,this._pendingCount=0,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,Ew||(R4(i),i.addToWindow(y)),this._watchAngularEvents(),d.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{_r.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&this._pendingCount===0&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;this._callbacks.length!==0;){let d=this._callbacks.pop();clearTimeout(d.timeoutId),d.doneCb()}});else{let d=this.getPendingTasks();this._callbacks=this._callbacks.filter(y=>y.updateCb&&y.updateCb(d)?(clearTimeout(y.timeoutId),!1):!0)}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(d=>({source:d.source,creationLocation:d.creationLocation,data:d.data})):[]}addCallback(d,y,i){let M=-1;y&&y>0&&(M=setTimeout(()=>{this._callbacks=this._callbacks.filter(L=>L.timeoutId!==M),d()},y)),this._callbacks.push({doneCb:d,timeoutId:M,updateCb:i})}whenStable(d,y,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(d,y,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(d){this.registry.registerApplication(d,this)}unregisterApplication(d){this.registry.unregisterApplication(d)}findProviders(d,y,i){return[]}};a.\u0275fac=function(y){return new(y||a)(jt(_r),jt(y0),jt(rm))},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})(),y0=(()=>{let a=class a{constructor(){this._applications=new Map}registerApplication(d,y){this._applications.set(d,y)}unregisterApplication(d){this._applications.delete(d)}unregisterAllApplications(){this._applications.clear()}getTestability(d){return this._applications.get(d)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(d,y=!0){return Ew?.findTestabilityInTree(this,d,y)??null}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"platform"});let s=a;return s})();function R4(s){Ew=s}var Ew;function im(s){return!!s&&typeof s.then=="function"}function qA(s){return!!s&&typeof s.subscribe=="function"}var v0=new Wt(""),WA=(()=>{let a=class a{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((d,y)=>{this.resolve=d,this.reject=y}),this.appInits=Xe(v0,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let d=[];for(let i of this.appInits){let M=i();if(im(M))d.push(M);else if(qA(M)){let L=new Promise((B,q)=>{M.subscribe({complete:B,error:q})});d.push(L)}}let y=()=>{this.done=!0,this.resolve()};Promise.all(d).then(()=>{y()}).catch(i=>{this.reject(i)}),d.length===0&&y(),this.initialized=!0}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),Td=new Wt("");function O4(){hM(()=>{throw new Xt(600,!1)})}function L4(s){return s.isBoundToModule}function k4(s,a,m){try{let d=m();return im(d)?d.catch(y=>{throw a.runOutsideAngular(()=>s.handleError(y)),y}):d}catch(d){throw a.runOutsideAngular(()=>s.handleError(d)),d}}function ZA(s,a){return Array.isArray(a)?a.reduce(ZA,s):Ct(Ct({},s),a)}var Oa=(()=>{let a=class a{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Xe(AC),this.afterRenderEffectManager=Xe(gw),this.externalTestViews=new Set,this.beforeRender=new Gi,this.afterTick=new Gi,this.componentTypes=[],this.components=[],this.isStable=Xe(_u).hasPendingTasks.pipe(On(d=>!d)),this._injector=Xe(ki)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(d,y){let i=d instanceof ky;if(!this._injector.get(WA).done){let Ke=!i&&US(d),Nt=!1;throw new Xt(405,Nt)}let L;i?L=d:L=this._injector.get(u0).resolveComponentFactory(d),this.componentTypes.push(L.componentType);let B=L4(L)?void 0:this._injector.get(jl),q=y||L.selector,se=L.create(xs.NULL,[],q,B),ge=se.location.nativeElement,Pe=se.injector.get(Tw,null);return Pe?.registerApplication(ge),se.onDestroy(()=>{this.detachView(se.hostView),xy(this.components,se),Pe?.unregisterApplication(ge)}),this._loadComponent(se),se}tick(){this._tick(!0)}_tick(d){if(this._runningTick)throw new Xt(101,!1);let y=qn(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(d)}catch(i){this.internalErrorHandler(i)}finally{this.afterTick.next(),this._runningTick=!1,qn(y)}}detectChangesInAttachedViews(d){let y=0,i=this.afterRenderEffectManager;for(;;){if(y===bA)throw new Xt(103,!1);if(d){let M=y===0;this.beforeRender.next(M);for(let{_lView:L,notifyErrorHandler:B}of this._views)F4(L,M,B)}if(y++,i.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:M})=>Cb(M))&&(i.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:M})=>Cb(M))))break}}attachView(d){let y=d;this._views.push(y),y.attachToAppRef(this)}detachView(d){let y=d;xy(this._views,y),y.detachFromAppRef()}_loadComponent(d){this.attachView(d.hostView),this.tick(),this.components.push(d);let y=this._injector.get(Td,[]);[...this._bootstrapListeners,...y].forEach(i=>i(d))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(d=>d()),this._views.slice().forEach(d=>d.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(d){return this._destroyListeners.push(d),()=>xy(this._destroyListeners,d)}destroy(){if(this._destroyed)throw new Xt(406,!1);let d=this._injector;d.destroy&&!d.destroyed&&d.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function xy(s,a){let m=s.indexOf(a);m>-1&&s.splice(m,1)}var py;function Iw(s){py??=new WeakMap;let a=py.get(s);if(a)return a;let m=s.isStable.pipe(fs(d=>d)).toPromise().then(()=>{});return py.set(s,m),s.onDestroy(()=>py?.delete(s)),m}function F4(s,a,m){!a&&!Cb(s)||N4(s,m,a)}function Cb(s){return Ub(s)}function N4(s,a,m){let d;m?(d=0,s[fn]|=1024):s[fn]&64?d=0:d=1,wA(s,a,d)}var Ab=class{constructor(a,m){this.ngModuleFactory=a,this.componentFactories=m}},x0=(()=>{let a=class a{compileModuleSync(d){return new By(d)}compileModuleAsync(d){return Promise.resolve(this.compileModuleSync(d))}compileModuleAndAllComponentsSync(d){let y=this.compileModuleSync(d),i=$S(d),M=qC(i.declarations).reduce((L,B)=>{let q=Bl(B);return q&&L.push(new md(q)),L},[]);return new Ab(y,M)}compileModuleAndAllComponentsAsync(d){return Promise.resolve(this.compileModuleAndAllComponentsSync(d))}clearCache(){}clearCacheFor(d){}getModuleId(d){}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),z4=new Wt("");function B4(s,a,m){let d=new By(m);return Promise.resolve(d)}function bS(s){for(let a=s.length-1;a>=0;a--)if(s[a]!==void 0)return s[a]}var j4=(()=>{let a=class a{constructor(){this.zone=Xe(_r),this.applicationRef=Xe(Oa)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function V4(s){return[{provide:_r,useFactory:s},{provide:lu,multi:!0,useFactory:()=>{let a=Xe(j4,{optional:!0});return()=>a.initialize()}},{provide:lu,multi:!0,useFactory:()=>{let a=Xe(G4);return()=>{a.initialize()}}},{provide:AC,useFactory:U4}]}function U4(){let s=Xe(_r),a=Xe(Us);return m=>s.runOutsideAngular(()=>a.handleError(m))}function $4(s){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:s?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:s?.runCoalescing??!1}}var G4=(()=>{let a=class a{constructor(){this.subscription=new ei,this.initialized=!1,this.zone=Xe(_r),this.pendingTasks=Xe(_u)}initialize(){if(this.initialized)return;this.initialized=!0;let d=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(d=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{_r.assertNotInAngularZone(),queueMicrotask(()=>{d!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(d),d=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{_r.assertInAngularZone(),d??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function H4(){return typeof $localize<"u"&&$localize.locale||Uy}var Dw=new Wt("",{providedIn:"root",factory:()=>Xe(Dw,zn.Optional|zn.SkipSelf)||H4()});var QA=new Wt(""),YA=(()=>{let a=class a{constructor(d){this._injector=d,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(d,y){let i=dB(y?.ngZone,$4({eventCoalescing:y?.ngZoneEventCoalescing,runCoalescing:y?.ngZoneRunCoalescing}));return i.run(()=>{let M=HB(d.moduleType,this.injector,V4(()=>i)),L=M.injector.get(Us,null);return i.runOutsideAngular(()=>{let B=i.onError.subscribe({next:q=>{L.handleError(q)}});M.onDestroy(()=>{xy(this._modules,M),B.unsubscribe()})}),k4(L,i,()=>{let B=M.injector.get(WA);return B.runInitializers(),B.donePromise.then(()=>{let q=M.injector.get(Dw,Uy);return w4(q||Uy),this._moduleDoBootstrap(M),M})})})}bootstrapModule(d,y=[]){let i=ZA({},y);return B4(this.injector,i,d).then(M=>this.bootstrapModuleFactory(M,i))}_moduleDoBootstrap(d){let y=d.injector.get(Oa);if(d._bootstrapComponents.length>0)d._bootstrapComponents.forEach(i=>y.bootstrap(i));else if(d.instance.ngDoBootstrap)d.instance.ngDoBootstrap(y);else throw new Xt(-403,!1);this._modules.push(d)}onDestroy(d){this._destroyListeners.push(d)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Xt(404,!1);this._modules.slice().forEach(y=>y.destroy()),this._destroyListeners.forEach(y=>y());let d=this._injector.get(QA,null);d&&(d.forEach(y=>y()),d.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}};a.\u0275fac=function(y){return new(y||a)(jt(xs))},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"platform"});let s=a;return s})(),Ip=null,XA=new Wt("");function q4(s){if(Ip&&!Ip.get(XA,!1))throw new Xt(400,!1);O4(),Ip=s;let a=s.get(YA);return Q4(s),a}function Mw(s,a,m=[]){let d=`Platform: ${a}`,y=new Wt(d);return(i=[])=>{let M=KA();if(!M||M.injector.get(XA,!1)){let L=[...m,...i,{provide:y,useValue:!0}];s?s(L):q4(W4(L,d))}return Z4(y)}}function W4(s=[],a){return xs.create({name:a,providers:[{provide:Wy,useValue:"platform"},{provide:QA,useValue:new Set([()=>Ip=null])},...s]})}function Z4(s){let a=KA();if(!a)throw new Xt(401,!1);return a}function KA(){return Ip?.get(YA)??null}function Q4(s){s.get(Xb,null)?.forEach(m=>m())}var om=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=Y4;let s=a;return s})();function Y4(s){return X4(vs(),Tr(),(s&16)===16)}function X4(s,a,m){if(Hp(s)&&!m){let d=Vl(s.index,a);return new du(d,d)}else if(s.type&47){let d=a[Mo];return new du(d,a)}return null}var JA=Mw(null,"core",[]),e2=(()=>{let a=class a{constructor(d){}};a.\u0275fac=function(y){return new(y||a)(jt(Oa))},a.\u0275mod=qi({type:a}),a.\u0275inj=Hi({});let s=a;return s})();var wS=!1,K4=!1;function J4(){wS||(wS=!0,D3(),_4(),C4(),x4(),ZB(),SB(),nB(),cz(),I4())}function ej(s,a){return Iw(s)}function t2(){return _d([{provide:hy,useFactory:()=>{let s=!0;return Tp()&&(s=!!Xe(gu,{optional:!0})?.get(VC,null)),s&&$l("NgHydration"),s}},{provide:lu,useValue:()=>{K4=!!Xe(P3,{optional:!0}),Tp()&&Xe(hy)&&(tj(),J4())},multi:!0},{provide:HC,useFactory:()=>Tp()&&Xe(hy)},{provide:Td,useFactory:()=>{if(Tp()&&Xe(hy)){let s=Xe(Oa),a=Xe(xs);return()=>{ej(s,a).then(()=>{Wz(s)})}}return()=>{}},multi:!0}])}function tj(){let s=Xy(),a;for(let m of s.body.childNodes)if(m.nodeType===Node.COMMENT_NODE&&m.textContent?.trim()===E3){a=m;break}if(!a)throw new Xt(-507,!1)}function n2(s){let a=Bl(s);if(!a)return null;let m=new md(a);return{get selector(){return m.selector},get type(){return m.componentType},get inputs(){return m.inputs},get outputs(){return m.outputs},get ngContentSelectors(){return m.ngContentSelectors},get isStandalone(){return a.standalone},get isSignal(){return a.signals}}}var a2=null;function yu(){return a2}function l2(s){a2??=s}var b0=class{};var Fi=new Wt(""),Pw=(()=>{let a=class a{historyGo(d){throw new Error("")}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:()=>Xe(oj),providedIn:"platform"});let s=a;return s})(),c2=new Wt(""),oj=(()=>{let a=class a extends Pw{constructor(){super(),this._doc=Xe(Fi),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return yu().getBaseHref(this._doc)}onPopState(d){let y=yu().getGlobalEventTarget(this._doc,"window");return y.addEventListener("popstate",d,!1),()=>y.removeEventListener("popstate",d)}onHashChange(d){let y=yu().getGlobalEventTarget(this._doc,"window");return y.addEventListener("hashchange",d,!1),()=>y.removeEventListener("hashchange",d)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(d){this._location.pathname=d}pushState(d,y,i){this._history.pushState(d,y,i)}replaceState(d,y,i){this._history.replaceState(d,y,i)}forward(){this._history.forward()}back(){this._history.back()}historyGo(d=0){this._history.go(d)}getState(){return this._history.state}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:()=>new a,providedIn:"platform"});let s=a;return s})();function Rw(s,a){if(s.length==0)return a;if(a.length==0)return s;let m=0;return s.endsWith("/")&&m++,a.startsWith("/")&&m++,m==2?s+a.substring(1):m==1?s+a:s+"/"+a}function r2(s){let a=s.match(/#|\?|$/),m=a&&a.index||s.length,d=m-(s[m-1]==="/"?1:0);return s.slice(0,d)+s.slice(m)}function La(s){return s&&s[0]!=="?"?"?"+s:s}var vu=(()=>{let a=class a{historyGo(d){throw new Error("")}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:()=>Xe(Ow),providedIn:"root"});let s=a;return s})(),u2=new Wt(""),Ow=(()=>{let a=class a extends vu{constructor(d,y){super(),this._platformLocation=d,this._removeListenerFns=[],this._baseHref=y??this._platformLocation.getBaseHrefFromDOM()??Xe(Fi).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(d){this._removeListenerFns.push(this._platformLocation.onPopState(d),this._platformLocation.onHashChange(d))}getBaseHref(){return this._baseHref}prepareExternalUrl(d){return Rw(this._baseHref,d)}path(d=!1){let y=this._platformLocation.pathname+La(this._platformLocation.search),i=this._platformLocation.hash;return i&&d?`${y}${i}`:y}pushState(d,y,i,M){let L=this.prepareExternalUrl(i+La(M));this._platformLocation.pushState(d,y,L)}replaceState(d,y,i,M){let L=this.prepareExternalUrl(i+La(M));this._platformLocation.replaceState(d,y,L)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(d=0){this._platformLocation.historyGo?.(d)}};a.\u0275fac=function(y){return new(y||a)(jt(Pw),jt(u2,8))},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),h2=(()=>{let a=class a extends vu{constructor(d,y){super(),this._platformLocation=d,this._baseHref="",this._removeListenerFns=[],y!=null&&(this._baseHref=y)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(d){this._removeListenerFns.push(this._platformLocation.onPopState(d),this._platformLocation.onHashChange(d))}getBaseHref(){return this._baseHref}path(d=!1){let y=this._platformLocation.hash??"#";return y.length>0?y.substring(1):y}prepareExternalUrl(d){let y=Rw(this._baseHref,d);return y.length>0?"#"+y:y}pushState(d,y,i,M){let L=this.prepareExternalUrl(i+La(M));L.length==0&&(L=this._platformLocation.pathname),this._platformLocation.pushState(d,y,L)}replaceState(d,y,i,M){let L=this.prepareExternalUrl(i+La(M));L.length==0&&(L=this._platformLocation.pathname),this._platformLocation.replaceState(d,y,L)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(d=0){this._platformLocation.historyGo?.(d)}};a.\u0275fac=function(y){return new(y||a)(jt(Pw),jt(u2,8))},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})(),Id=(()=>{let a=class a{constructor(d){this._subject=new Oi,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=d;let y=this._locationStrategy.getBaseHref();this._basePath=lj(r2(i2(y))),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(d=!1){return this.normalize(this._locationStrategy.path(d))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(d,y=""){return this.path()==this.normalize(d+La(y))}normalize(d){return a.stripTrailingSlash(aj(this._basePath,i2(d)))}prepareExternalUrl(d){return d&&d[0]!=="/"&&(d="/"+d),this._locationStrategy.prepareExternalUrl(d)}go(d,y="",i=null){this._locationStrategy.pushState(i,"",d,y),this._notifyUrlChangeListeners(this.prepareExternalUrl(d+La(y)),i)}replaceState(d,y="",i=null){this._locationStrategy.replaceState(i,"",d,y),this._notifyUrlChangeListeners(this.prepareExternalUrl(d+La(y)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(d=0){this._locationStrategy.historyGo?.(d)}onUrlChange(d){return this._urlChangeListeners.push(d),this._urlChangeSubscription??=this.subscribe(y=>{this._notifyUrlChangeListeners(y.url,y.state)}),()=>{let y=this._urlChangeListeners.indexOf(d);this._urlChangeListeners.splice(y,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(d="",y){this._urlChangeListeners.forEach(i=>i(d,y))}subscribe(d,y,i){return this._subject.subscribe({next:d,error:y,complete:i})}};a.normalizeQueryParams=La,a.joinWithSlash=Rw,a.stripTrailingSlash=r2,a.\u0275fac=function(y){return new(y||a)(jt(vu))},a.\u0275prov=kt({token:a,factory:()=>sj(),providedIn:"root"});let s=a;return s})();function sj(){return new Id(jt(vu))}function aj(s,a){if(!s||!a.startsWith(s))return a;let m=a.substring(s.length);return m===""||["/",";","?","#"].includes(m[0])?m:a}function i2(s){return s.replace(/\/index.html$/,"")}function lj(s){if(new RegExp("^(https?:)?//").test(s)){let[,m]=s.split(/\/\/[^\/]+/);return m}return s}function w0(s,a){a=encodeURIComponent(a);for(let m of s.split(";")){let d=m.indexOf("="),[y,i]=d==-1?[m,""]:[m.slice(0,d),m.slice(d+1)];if(y.trim()===a)return decodeURIComponent(i)}return null}var Sw=/\s+/,o2=[],d2=(()=>{let a=class a{constructor(d,y){this._ngEl=d,this._renderer=y,this.initialClasses=o2,this.stateMap=new Map}set klass(d){this.initialClasses=d!=null?d.trim().split(Sw):o2}set ngClass(d){this.rawClass=typeof d=="string"?d.trim().split(Sw):d}ngDoCheck(){for(let y of this.initialClasses)this._updateState(y,!0);let d=this.rawClass;if(Array.isArray(d)||d instanceof Set)for(let y of d)this._updateState(y,!0);else if(d!=null)for(let y of Object.keys(d))this._updateState(y,!!d[y]);this._applyStateDiff()}_updateState(d,y){let i=this.stateMap.get(d);i!==void 0?(i.enabled!==y&&(i.changed=!0,i.enabled=y),i.touched=!0):this.stateMap.set(d,{enabled:y,changed:!0,touched:!0})}_applyStateDiff(){for(let d of this.stateMap){let y=d[0],i=d[1];i.changed?(this._toggleClass(y,i.enabled),i.changed=!1):i.touched||(i.enabled&&this._toggleClass(y,!1),this.stateMap.delete(y)),i.touched=!1}}_toggleClass(d,y){d=d.trim(),d.length>0&&d.split(Sw).forEach(i=>{y?this._renderer.addClass(this._ngEl.nativeElement,i):this._renderer.removeClass(this._ngEl.nativeElement,i)})}};a.\u0275fac=function(y){return new(y||a)(Kp(Ul),Kp(h0))},a.\u0275dir=qy({type:a,selectors:[["","ngClass",""]],inputs:{klass:[Sa.None,"class","klass"],ngClass:"ngClass"},standalone:!0});let s=a;return s})();var T0=(()=>{let a=class a{};a.\u0275fac=function(y){return new(y||a)},a.\u0275mod=qi({type:a}),a.\u0275inj=Hi({});let s=a;return s})(),Lw="browser",cj="server";function uj(s){return s===Lw}function sm(s){return s===cj}var f2=(()=>{let a=class a{};a.\u0275prov=kt({token:a,providedIn:"root",factory:()=>uj(Xe(Wo))?new Cw(Xe(Fi),window):new Aw});let s=a;return s})(),Cw=class{constructor(a,m){this.document=a,this.window=m,this.offset=()=>[0,0]}setOffset(a){Array.isArray(a)?this.offset=()=>a:this.offset=a}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(a){this.window.scrollTo(a[0],a[1])}scrollToAnchor(a){let m=hj(this.document,a);m&&(this.scrollToElement(m),m.focus())}setHistoryScrollRestoration(a){this.window.history.scrollRestoration=a}scrollToElement(a){let m=a.getBoundingClientRect(),d=m.left+this.window.pageXOffset,y=m.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(d-i[0],y-i[1])}};function hj(s,a){let m=s.getElementById(a)||s.getElementsByName(a)[0];if(m)return m;if(typeof s.createTreeWalker=="function"&&s.body&&typeof s.body.attachShadow=="function"){let d=s.createTreeWalker(s.body,NodeFilter.SHOW_ELEMENT),y=d.currentNode;for(;y;){let i=y.shadowRoot;if(i){let M=i.getElementById(a)||i.querySelector(`[name="${a}"]`);if(M)return M}y=d.nextNode()}}return null}var Aw=class{setOffset(a){}getScrollPosition(){return[0,0]}scrollToPosition(a){}scrollToAnchor(a){}setHistoryScrollRestoration(a){}},Ed=class{};var ka=class{},D0=class{},Hl=class s{constructor(a){this.normalizedNames=new Map,this.lazyUpdate=null,a?typeof a=="string"?this.lazyInit=()=>{this.headers=new Map,a.split(`
`).forEach(m=>{let d=m.indexOf(":");if(d>0){let y=m.slice(0,d),i=y.toLowerCase(),M=m.slice(d+1).trim();this.maybeSetNormalizedName(y,i),this.headers.has(i)?this.headers.get(i).push(M):this.headers.set(i,[M])}})}:typeof Headers<"u"&&a instanceof Headers?(this.headers=new Map,a.forEach((m,d)=>{this.setHeaderEntries(d,m)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(a).forEach(([m,d])=>{this.setHeaderEntries(m,d)})}:this.headers=new Map}has(a){return this.init(),this.headers.has(a.toLowerCase())}get(a){this.init();let m=this.headers.get(a.toLowerCase());return m&&m.length>0?m[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(a){return this.init(),this.headers.get(a.toLowerCase())||null}append(a,m){return this.clone({name:a,value:m,op:"a"})}set(a,m){return this.clone({name:a,value:m,op:"s"})}delete(a,m){return this.clone({name:a,value:m,op:"d"})}maybeSetNormalizedName(a,m){this.normalizedNames.has(m)||this.normalizedNames.set(m,a)}init(){this.lazyInit&&(this.lazyInit instanceof s?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(a=>this.applyUpdate(a)),this.lazyUpdate=null))}copyFrom(a){a.init(),Array.from(a.headers.keys()).forEach(m=>{this.headers.set(m,a.headers.get(m)),this.normalizedNames.set(m,a.normalizedNames.get(m))})}clone(a){let m=new s;return m.lazyInit=this.lazyInit&&this.lazyInit instanceof s?this.lazyInit:this,m.lazyUpdate=(this.lazyUpdate||[]).concat([a]),m}applyUpdate(a){let m=a.name.toLowerCase();switch(a.op){case"a":case"s":let d=a.value;if(typeof d=="string"&&(d=[d]),d.length===0)return;this.maybeSetNormalizedName(a.name,m);let y=(a.op==="a"?this.headers.get(m):void 0)||[];y.push(...d),this.headers.set(m,y);break;case"d":let i=a.value;if(!i)this.headers.delete(m),this.normalizedNames.delete(m);else{let M=this.headers.get(m);if(!M)return;M=M.filter(L=>i.indexOf(L)===-1),M.length===0?(this.headers.delete(m),this.normalizedNames.delete(m)):this.headers.set(m,M)}break}}setHeaderEntries(a,m){let d=(Array.isArray(m)?m:[m]).map(i=>i.toString()),y=a.toLowerCase();this.headers.set(y,d),this.maybeSetNormalizedName(a,y)}forEach(a){this.init(),Array.from(this.normalizedNames.keys()).forEach(m=>a(this.normalizedNames.get(m),this.headers.get(m)))}};var Fw=class{encodeKey(a){return m2(a)}encodeValue(a){return m2(a)}decodeKey(a){return decodeURIComponent(a)}decodeValue(a){return decodeURIComponent(a)}};function fj(s,a){let m=new Map;return s.length>0&&s.replace(/^\?/,"").split("&").forEach(y=>{let i=y.indexOf("="),[M,L]=i==-1?[a.decodeKey(y),""]:[a.decodeKey(y.slice(0,i)),a.decodeValue(y.slice(i+1))],B=m.get(M)||[];B.push(L),m.set(M,B)}),m}var pj=/%(\d[a-f0-9])/gi,mj={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function m2(s){return encodeURIComponent(s).replace(pj,(a,m)=>mj[m]??a)}function E0(s){return`${s}`}var Gl=class s{constructor(a={}){if(this.updates=null,this.cloneFrom=null,this.encoder=a.encoder||new Fw,a.fromString){if(a.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=fj(a.fromString,this.encoder)}else a.fromObject?(this.map=new Map,Object.keys(a.fromObject).forEach(m=>{let d=a.fromObject[m],y=Array.isArray(d)?d.map(E0):[E0(d)];this.map.set(m,y)})):this.map=null}has(a){return this.init(),this.map.has(a)}get(a){this.init();let m=this.map.get(a);return m?m[0]:null}getAll(a){return this.init(),this.map.get(a)||null}keys(){return this.init(),Array.from(this.map.keys())}append(a,m){return this.clone({param:a,value:m,op:"a"})}appendAll(a){let m=[];return Object.keys(a).forEach(d=>{let y=a[d];Array.isArray(y)?y.forEach(i=>{m.push({param:d,value:i,op:"a"})}):m.push({param:d,value:y,op:"a"})}),this.clone(m)}set(a,m){return this.clone({param:a,value:m,op:"s"})}delete(a,m){return this.clone({param:a,value:m,op:"d"})}toString(){return this.init(),this.keys().map(a=>{let m=this.encoder.encodeKey(a);return this.map.get(a).map(d=>m+"="+this.encoder.encodeValue(d)).join("&")}).filter(a=>a!=="").join("&")}clone(a){let m=new s({encoder:this.encoder});return m.cloneFrom=this.cloneFrom||this,m.updates=(this.updates||[]).concat(a),m}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(a=>this.map.set(a,this.cloneFrom.map.get(a))),this.updates.forEach(a=>{switch(a.op){case"a":case"s":let m=(a.op==="a"?this.map.get(a.param):void 0)||[];m.push(E0(a.value)),this.map.set(a.param,m);break;case"d":if(a.value!==void 0){let d=this.map.get(a.param)||[],y=d.indexOf(E0(a.value));y!==-1&&d.splice(y,1),d.length>0?this.map.set(a.param,d):this.map.delete(a.param)}else{this.map.delete(a.param);break}}}),this.cloneFrom=this.updates=null)}};var Nw=class{constructor(){this.map=new Map}set(a,m){return this.map.set(a,m),this}get(a){return this.map.has(a)||this.map.set(a,a.defaultValue()),this.map.get(a)}delete(a){return this.map.delete(a),this}has(a){return this.map.has(a)}keys(){return this.map.keys()}};function gj(s){switch(s){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function g2(s){return typeof ArrayBuffer<"u"&&s instanceof ArrayBuffer}function _2(s){return typeof Blob<"u"&&s instanceof Blob}function y2(s){return typeof FormData<"u"&&s instanceof FormData}function _j(s){return typeof URLSearchParams<"u"&&s instanceof URLSearchParams}var am=class s{constructor(a,m,d,y){this.url=m,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=a.toUpperCase();let i;if(gj(this.method)||y?(this.body=d!==void 0?d:null,i=y):i=d,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),this.transferCache=i.transferCache),this.headers??=new Hl,this.context??=new Nw,!this.params)this.params=new Gl,this.urlWithParams=m;else{let M=this.params.toString();if(M.length===0)this.urlWithParams=m;else{let L=m.indexOf("?"),B=L===-1?"?":L<m.length-1?"&":"";this.urlWithParams=m+B+M}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||g2(this.body)||_2(this.body)||y2(this.body)||_j(this.body)?this.body:this.body instanceof Gl?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||y2(this.body)?null:_2(this.body)?this.body.type||null:g2(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Gl?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(a={}){let m=a.method||this.method,d=a.url||this.url,y=a.responseType||this.responseType,i=a.transferCache??this.transferCache,M=a.body!==void 0?a.body:this.body,L=a.withCredentials??this.withCredentials,B=a.reportProgress??this.reportProgress,q=a.headers||this.headers,se=a.params||this.params,ge=a.context??this.context;return a.setHeaders!==void 0&&(q=Object.keys(a.setHeaders).reduce((Pe,Ke)=>Pe.set(Ke,a.setHeaders[Ke]),q)),a.setParams&&(se=Object.keys(a.setParams).reduce((Pe,Ke)=>Pe.set(Ke,a.setParams[Ke]),se)),new s(m,d,M,{params:se,headers:q,context:ge,reportProgress:B,responseType:y,withCredentials:L,transferCache:i})}},Dd=function(s){return s[s.Sent=0]="Sent",s[s.UploadProgress=1]="UploadProgress",s[s.ResponseHeader=2]="ResponseHeader",s[s.DownloadProgress=3]="DownloadProgress",s[s.Response=4]="Response",s[s.User=5]="User",s}(Dd||{}),lm=class{constructor(a,m=S0.Ok,d="OK"){this.headers=a.headers||new Hl,this.status=a.status!==void 0?a.status:m,this.statusText=a.statusText||d,this.url=a.url||null,this.ok=this.status>=200&&this.status<300}},zw=class s extends lm{constructor(a={}){super(a),this.type=Dd.ResponseHeader}clone(a={}){return new s({headers:a.headers||this.headers,status:a.status!==void 0?a.status:this.status,statusText:a.statusText||this.statusText,url:a.url||this.url||void 0})}},Md=class s extends lm{constructor(a={}){super(a),this.type=Dd.Response,this.body=a.body!==void 0?a.body:null}clone(a={}){return new s({body:a.body!==void 0?a.body:this.body,headers:a.headers||this.headers,status:a.status!==void 0?a.status:this.status,statusText:a.statusText||this.statusText,url:a.url||this.url||void 0})}},M0=class extends lm{constructor(a){super(a,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${a.url||"(unknown url)"}`:this.message=`Http failure response for ${a.url||"(unknown url)"}: ${a.status} ${a.statusText}`,this.error=a.error||null}},S0=function(s){return s[s.Continue=100]="Continue",s[s.SwitchingProtocols=101]="SwitchingProtocols",s[s.Processing=102]="Processing",s[s.EarlyHints=103]="EarlyHints",s[s.Ok=200]="Ok",s[s.Created=201]="Created",s[s.Accepted=202]="Accepted",s[s.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",s[s.NoContent=204]="NoContent",s[s.ResetContent=205]="ResetContent",s[s.PartialContent=206]="PartialContent",s[s.MultiStatus=207]="MultiStatus",s[s.AlreadyReported=208]="AlreadyReported",s[s.ImUsed=226]="ImUsed",s[s.MultipleChoices=300]="MultipleChoices",s[s.MovedPermanently=301]="MovedPermanently",s[s.Found=302]="Found",s[s.SeeOther=303]="SeeOther",s[s.NotModified=304]="NotModified",s[s.UseProxy=305]="UseProxy",s[s.Unused=306]="Unused",s[s.TemporaryRedirect=307]="TemporaryRedirect",s[s.PermanentRedirect=308]="PermanentRedirect",s[s.BadRequest=400]="BadRequest",s[s.Unauthorized=401]="Unauthorized",s[s.PaymentRequired=402]="PaymentRequired",s[s.Forbidden=403]="Forbidden",s[s.NotFound=404]="NotFound",s[s.MethodNotAllowed=405]="MethodNotAllowed",s[s.NotAcceptable=406]="NotAcceptable",s[s.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",s[s.RequestTimeout=408]="RequestTimeout",s[s.Conflict=409]="Conflict",s[s.Gone=410]="Gone",s[s.LengthRequired=411]="LengthRequired",s[s.PreconditionFailed=412]="PreconditionFailed",s[s.PayloadTooLarge=413]="PayloadTooLarge",s[s.UriTooLong=414]="UriTooLong",s[s.UnsupportedMediaType=415]="UnsupportedMediaType",s[s.RangeNotSatisfiable=416]="RangeNotSatisfiable",s[s.ExpectationFailed=417]="ExpectationFailed",s[s.ImATeapot=418]="ImATeapot",s[s.MisdirectedRequest=421]="MisdirectedRequest",s[s.UnprocessableEntity=422]="UnprocessableEntity",s[s.Locked=423]="Locked",s[s.FailedDependency=424]="FailedDependency",s[s.TooEarly=425]="TooEarly",s[s.UpgradeRequired=426]="UpgradeRequired",s[s.PreconditionRequired=428]="PreconditionRequired",s[s.TooManyRequests=429]="TooManyRequests",s[s.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",s[s.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",s[s.InternalServerError=500]="InternalServerError",s[s.NotImplemented=501]="NotImplemented",s[s.BadGateway=502]="BadGateway",s[s.ServiceUnavailable=503]="ServiceUnavailable",s[s.GatewayTimeout=504]="GatewayTimeout",s[s.HttpVersionNotSupported=505]="HttpVersionNotSupported",s[s.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",s[s.InsufficientStorage=507]="InsufficientStorage",s[s.LoopDetected=508]="LoopDetected",s[s.NotExtended=510]="NotExtended",s[s.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",s}(S0||{});function kw(s,a){return{body:a,headers:s.headers,context:s.context,observe:s.observe,params:s.params,reportProgress:s.reportProgress,responseType:s.responseType,withCredentials:s.withCredentials,transferCache:s.transferCache}}var cm=(()=>{let a=class a{constructor(d){this.handler=d}request(d,y,i={}){let M;if(d instanceof am)M=d;else{let q;i.headers instanceof Hl?q=i.headers:q=new Hl(i.headers);let se;i.params&&(i.params instanceof Gl?se=i.params:se=new Gl({fromObject:i.params})),M=new am(d,y,i.body!==void 0?i.body:null,{headers:q,context:i.context,params:se,reportProgress:i.reportProgress,responseType:i.responseType||"json",withCredentials:i.withCredentials,transferCache:i.transferCache})}let L=on(M).pipe(Ia(q=>this.handler.handle(q)));if(d instanceof am||i.observe==="events")return L;let B=L.pipe(oo(q=>q instanceof Md));switch(i.observe||"body"){case"body":switch(M.responseType){case"arraybuffer":return B.pipe(On(q=>{if(q.body!==null&&!(q.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return q.body}));case"blob":return B.pipe(On(q=>{if(q.body!==null&&!(q.body instanceof Blob))throw new Error("Response is not a Blob.");return q.body}));case"text":return B.pipe(On(q=>{if(q.body!==null&&typeof q.body!="string")throw new Error("Response is not a string.");return q.body}));case"json":default:return B.pipe(On(q=>q.body))}case"response":return B;default:throw new Error(`Unreachable: unhandled observe type ${i.observe}}`)}}delete(d,y={}){return this.request("DELETE",d,y)}get(d,y={}){return this.request("GET",d,y)}head(d,y={}){return this.request("HEAD",d,y)}jsonp(d,y){return this.request("JSONP",d,{params:new Gl().append(y,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(d,y={}){return this.request("OPTIONS",d,y)}patch(d,y,i={}){return this.request("PATCH",d,kw(i,y))}post(d,y,i={}){return this.request("POST",d,kw(i,y))}put(d,y,i={}){return this.request("PUT",d,kw(i,y))}};a.\u0275fac=function(y){return new(y||a)(jt(ka))},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})();function C2(s,a){return a(s)}function yj(s,a){return(m,d)=>a.intercept(m,{handle:y=>s(y,d)})}function vj(s,a,m){return(d,y)=>_s(m,()=>a(d,i=>s(i,y)))}var xj=new Wt(""),Bw=new Wt(""),A2=new Wt(""),bj=new Wt("");function wj(){let s=null;return(a,m)=>{s===null&&(s=(Xe(xj,{optional:!0})??[]).reduceRight(yj,C2));let d=Xe(_u),y=d.add();return s(a,m).pipe(Fl(()=>d.remove(y)))}}var v2=(()=>{let a=class a extends ka{constructor(d,y){super(),this.backend=d,this.injector=y,this.chain=null,this.pendingTasks=Xe(_u);let i=Xe(bj,{optional:!0});this.backend=i??d}handle(d){if(this.chain===null){let i=Array.from(new Set([...this.injector.get(Bw),...this.injector.get(A2,[])]));this.chain=i.reduceRight((M,L)=>vj(M,L,this.injector),C2)}let y=this.pendingTasks.add();return this.chain(d,i=>this.backend.handle(i)).pipe(Fl(()=>this.pendingTasks.remove(y)))}};a.\u0275fac=function(y){return new(y||a)(jt(D0),jt(ki))},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})();var Tj=/^\)\]\}',?\n/;function Ej(s){return"responseURL"in s&&s.responseURL?s.responseURL:/^X-Request-URL:/m.test(s.getAllResponseHeaders())?s.getResponseHeader("X-Request-URL"):null}var x2=(()=>{let a=class a{constructor(d){this.xhrFactory=d}handle(d){if(d.method==="JSONP")throw new Xt(-2800,!1);let y=this.xhrFactory;return(y.\u0275loadImpl?Pr(y.\u0275loadImpl()):on(null)).pipe(so(()=>new ir(M=>{let L=y.build();if(L.open(d.method,d.urlWithParams),d.withCredentials&&(L.withCredentials=!0),d.headers.forEach((Rt,bt)=>L.setRequestHeader(Rt,bt.join(","))),d.headers.has("Accept")||L.setRequestHeader("Accept","application/json, text/plain, */*"),!d.headers.has("Content-Type")){let Rt=d.detectContentTypeHeader();Rt!==null&&L.setRequestHeader("Content-Type",Rt)}if(d.responseType){let Rt=d.responseType.toLowerCase();L.responseType=Rt!=="json"?Rt:"text"}let B=d.serializeBody(),q=null,se=()=>{if(q!==null)return q;let Rt=L.statusText||"OK",bt=new Hl(L.getAllResponseHeaders()),an=Ej(L)||d.url;return q=new zw({headers:bt,status:L.status,statusText:Rt,url:an}),q},ge=()=>{let{headers:Rt,status:bt,statusText:an,url:or}=se(),kn=null;bt!==S0.NoContent&&(kn=typeof L.response>"u"?L.responseText:L.response),bt===0&&(bt=kn?S0.Ok:0);let fi=bt>=200&&bt<300;if(d.responseType==="json"&&typeof kn=="string"){let jr=kn;kn=kn.replace(Tj,"");try{kn=kn!==""?JSON.parse(kn):null}catch(wn){kn=jr,fi&&(fi=!1,kn={error:wn,text:kn})}}fi?(M.next(new Md({body:kn,headers:Rt,status:bt,statusText:an,url:or||void 0})),M.complete()):M.error(new M0({error:kn,headers:Rt,status:bt,statusText:an,url:or||void 0}))},Pe=Rt=>{let{url:bt}=se(),an=new M0({error:Rt,status:L.status||0,statusText:L.statusText||"Unknown Error",url:bt||void 0});M.error(an)},Ke=!1,Nt=Rt=>{Ke||(M.next(se()),Ke=!0);let bt={type:Dd.DownloadProgress,loaded:Rt.loaded};Rt.lengthComputable&&(bt.total=Rt.total),d.responseType==="text"&&L.responseText&&(bt.partialText=L.responseText),M.next(bt)},sn=Rt=>{let bt={type:Dd.UploadProgress,loaded:Rt.loaded};Rt.lengthComputable&&(bt.total=Rt.total),M.next(bt)};return L.addEventListener("load",ge),L.addEventListener("error",Pe),L.addEventListener("timeout",Pe),L.addEventListener("abort",Pe),d.reportProgress&&(L.addEventListener("progress",Nt),B!==null&&L.upload&&L.upload.addEventListener("progress",sn)),L.send(B),M.next({type:Dd.Sent}),()=>{L.removeEventListener("error",Pe),L.removeEventListener("abort",Pe),L.removeEventListener("load",ge),L.removeEventListener("timeout",Pe),d.reportProgress&&(L.removeEventListener("progress",Nt),B!==null&&L.upload&&L.upload.removeEventListener("progress",sn)),L.readyState!==L.DONE&&L.abort()}})))}};a.\u0275fac=function(y){return new(y||a)(jt(Ed))},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})(),P2=new Wt(""),Ij="XSRF-TOKEN",Dj=new Wt("",{providedIn:"root",factory:()=>Ij}),Mj="X-XSRF-TOKEN",Sj=new Wt("",{providedIn:"root",factory:()=>Mj}),C0=class{},Cj=(()=>{let a=class a{constructor(d,y,i){this.doc=d,this.platform=y,this.cookieName=i,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let d=this.doc.cookie||"";return d!==this.lastCookieString&&(this.parseCount++,this.lastToken=w0(d,this.cookieName),this.lastCookieString=d),this.lastToken}};a.\u0275fac=function(y){return new(y||a)(jt(Fi),jt(Wo),jt(Dj))},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})();function Aj(s,a){let m=s.url.toLowerCase();if(!Xe(P2)||s.method==="GET"||s.method==="HEAD"||m.startsWith("http://")||m.startsWith("https://"))return a(s);let d=Xe(C0).getToken(),y=Xe(Sj);return d!=null&&!s.headers.has(y)&&(s=s.clone({headers:s.headers.set(y,d)})),a(s)}var R2=function(s){return s[s.Interceptors=0]="Interceptors",s[s.LegacyInterceptors=1]="LegacyInterceptors",s[s.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",s[s.NoXsrfProtection=3]="NoXsrfProtection",s[s.JsonpSupport=4]="JsonpSupport",s[s.RequestsMadeViaParent=5]="RequestsMadeViaParent",s[s.Fetch=6]="Fetch",s}(R2||{});function Pj(s,a){return{\u0275kind:s,\u0275providers:a}}function Rj(...s){let a=[cm,x2,v2,{provide:ka,useExisting:v2},{provide:D0,useExisting:x2},{provide:Bw,useValue:Aj,multi:!0},{provide:P2,useValue:!0},{provide:C0,useClass:Cj}];for(let m of s)a.push(...m.\u0275providers);return _d(a)}var b2=new Wt("");function Oj(){return Pj(R2.LegacyInterceptors,[{provide:b2,useFactory:wj},{provide:Bw,useExisting:b2,multi:!0}])}var O2=(()=>{let a=class a{};a.\u0275fac=function(y){return new(y||a)},a.\u0275mod=qi({type:a}),a.\u0275inj=Hi({providers:[Rj(Oj())]});let s=a;return s})();var w2="b",T2="h",E2="s",I2="st",D2="u",M2="rt",I0=new Wt(""),Lj=["GET","HEAD"];function kj(s,a){let ge=Xe(I0),{isCacheActive:m}=ge,d=$_(ge,["isCacheActive"]),{transferCache:y,method:i}=s;if(!m||i==="POST"&&!d.includePostRequests&&!y||i!=="POST"&&!Lj.includes(i)||y===!1||d.filter?.(s)===!1)return a(s);let M=Xe(gu),L=Nj(s),B=M.get(L,null),q=d.includeHeaders;if(typeof y=="object"&&y.includeHeaders&&(q=y.includeHeaders),B){let{[w2]:Pe,[M2]:Ke,[T2]:Nt,[E2]:sn,[I2]:Rt,[D2]:bt}=B,an=Pe;switch(Ke){case"arraybuffer":an=new TextEncoder().encode(Pe).buffer;break;case"blob":an=new Blob([Pe]);break}let or=new Hl(Nt);return on(new Md({body:an,headers:or,status:sn,statusText:Rt,url:bt}))}let se=sm(Xe(Wo));return a(s).pipe(ti(Pe=>{Pe instanceof Md&&se&&M.set(L,{[w2]:Pe.body,[T2]:Fj(Pe.headers,q),[E2]:Pe.status,[I2]:Pe.statusText,[D2]:Pe.url||"",[M2]:s.responseType})}))}function Fj(s,a){if(!a)return{};let m={};for(let d of a){let y=s.getAll(d);y!==null&&(m[d]=y)}return m}function S2(s){return[...s.keys()].sort().map(a=>`${a}=${s.getAll(a)}`).join("&")}function Nj(s){let{params:a,method:m,responseType:d,url:y}=s,i=S2(a),M=s.serializeBody();M instanceof URLSearchParams?M=S2(M):typeof M!="string"&&(M="");let L=[m,d,y,M,i].join("|"),B=zj(L);return B}function zj(s){let a=0;for(let m of s)a=Math.imul(31,a)+m.charCodeAt(0)<<0;return a+=2147483648,a.toString()}function L2(s){return[{provide:I0,useFactory:()=>($l("NgHttpTransferCache"),Ct({isCacheActive:!0},s))},{provide:A2,useValue:kj,multi:!0,deps:[gu,I0]},{provide:Td,multi:!0,useFactory:()=>{let a=Xe(Oa),m=Xe(I0);return()=>{Iw(a).then(()=>{m.isCacheActive=!1})}}}]}var Uw=class extends b0{constructor(){super(...arguments),this.supportsDOMEvents=!0}},$w=class s extends Uw{static makeCurrent(){l2(new s)}onAndCancel(a,m,d){return a.addEventListener(m,d),()=>{a.removeEventListener(m,d)}}dispatchEvent(a,m){a.dispatchEvent(m)}remove(a){a.parentNode&&a.parentNode.removeChild(a)}createElement(a,m){return m=m||this.getDefaultDocument(),m.createElement(a)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(a){return a.nodeType===Node.ELEMENT_NODE}isShadowRoot(a){return a instanceof DocumentFragment}getGlobalEventTarget(a,m){return m==="window"?window:m==="document"?a:m==="body"?a.body:null}getBaseHref(a){let m=Bj();return m==null?null:jj(m)}resetBaseElement(){um=null}getUserAgent(){return window.navigator.userAgent}getCookie(a){return w0(document.cookie,a)}},um=null;function Bj(){return um=um||document.querySelector("base"),um?um.getAttribute("href"):null}function jj(s){return new URL(s,document.baseURI).pathname}var Gw=class{addToWindow(a){Io.getAngularTestability=(d,y=!0)=>{let i=a.findTestabilityInTree(d,y);if(i==null)throw new Xt(5103,!1);return i},Io.getAllAngularTestabilities=()=>a.getAllTestabilities(),Io.getAllAngularRootElements=()=>a.getAllRootElements();let m=d=>{let y=Io.getAllAngularTestabilities(),i=y.length,M=function(){i--,i==0&&d()};y.forEach(L=>{L.whenStable(M)})};Io.frameworkStabilizers||(Io.frameworkStabilizers=[]),Io.frameworkStabilizers.push(m)}findTestabilityInTree(a,m,d){if(m==null)return null;let y=a.getTestability(m);return y??(d?yu().isShadowRoot(m)?this.findTestabilityInTree(a,m.host,!0):this.findTestabilityInTree(a,m.parentElement,!0):null)}},Vj=(()=>{let a=class a{build(){return new XMLHttpRequest}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})(),Hw=new Wt(""),B2=(()=>{let a=class a{constructor(d,y){this._zone=y,this._eventNameToPlugin=new Map,d.forEach(i=>{i.manager=this}),this._plugins=d.slice().reverse()}addEventListener(d,y,i){return this._findPluginFor(y).addEventListener(d,y,i)}getZone(){return this._zone}_findPluginFor(d){let y=this._eventNameToPlugin.get(d);if(y)return y;if(y=this._plugins.find(M=>M.supports(d)),!y)throw new Xt(5101,!1);return this._eventNameToPlugin.set(d,y),y}};a.\u0275fac=function(y){return new(y||a)(jt(Hw),jt(_r))},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})(),A0=class{constructor(a){this._doc=a}},jw="ng-app-id",j2=(()=>{let a=class a{constructor(d,y,i,M={}){this.doc=d,this.appId=y,this.nonce=i,this.platformId=M,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=sm(M),this.resetHostNodes()}addStyles(d){for(let y of d)this.changeUsageCount(y,1)===1&&this.onStyleAdded(y)}removeStyles(d){for(let y of d)this.changeUsageCount(y,-1)<=0&&this.onStyleRemoved(y)}ngOnDestroy(){let d=this.styleNodesInDOM;d&&(d.forEach(y=>y.remove()),d.clear());for(let y of this.getAllStyles())this.onStyleRemoved(y);this.resetHostNodes()}addHost(d){this.hostNodes.add(d);for(let y of this.getAllStyles())this.addStyleToHost(d,y)}removeHost(d){this.hostNodes.delete(d)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(d){for(let y of this.hostNodes)this.addStyleToHost(y,d)}onStyleRemoved(d){let y=this.styleRef;y.get(d)?.elements?.forEach(i=>i.remove()),y.delete(d)}collectServerRenderedStyles(){let d=this.doc.head?.querySelectorAll(`style[${jw}="${this.appId}"]`);if(d?.length){let y=new Map;return d.forEach(i=>{i.textContent!=null&&y.set(i.textContent,i)}),y}return null}changeUsageCount(d,y){let i=this.styleRef;if(i.has(d)){let M=i.get(d);return M.usage+=y,M.usage}return i.set(d,{usage:y,elements:[]}),y}getStyleElement(d,y){let i=this.styleNodesInDOM,M=i?.get(y);if(M?.parentNode===d)return i.delete(y),M.removeAttribute(jw),M;{let L=this.doc.createElement("style");return this.nonce&&L.setAttribute("nonce",this.nonce),L.textContent=y,this.platformIsServer&&L.setAttribute(jw,this.appId),d.appendChild(L),L}}addStyleToHost(d,y){let i=this.getStyleElement(d,y),M=this.styleRef,L=M.get(y)?.elements;L?L.push(i):M.set(y,{elements:[i],usage:1})}resetHostNodes(){let d=this.hostNodes;d.clear(),d.add(this.doc.head)}};a.\u0275fac=function(y){return new(y||a)(jt(Fi),jt(Xp),jt(Kb,8),jt(Wo))},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})(),Vw={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Zw=/%COMP%/g,V2="%COMP%",Uj=`_nghost-${V2}`,$j=`_ngcontent-${V2}`,Gj=!0,Hj=new Wt("",{providedIn:"root",factory:()=>Gj});function qj(s){return $j.replace(Zw,s)}function Wj(s){return Uj.replace(Zw,s)}function U2(s,a){return a.map(m=>m.replace(Zw,s))}var F2=(()=>{let a=class a{constructor(d,y,i,M,L,B,q,se=null){this.eventManager=d,this.sharedStylesHost=y,this.appId=i,this.removeStylesOnCompDestroy=M,this.doc=L,this.platformId=B,this.ngZone=q,this.nonce=se,this.rendererByCompId=new Map,this.platformIsServer=sm(B),this.defaultRenderer=new hm(d,L,q,this.platformIsServer)}createRenderer(d,y){if(!d||!y)return this.defaultRenderer;this.platformIsServer&&y.encapsulation===js.ShadowDom&&(y=Fr(Ct({},y),{encapsulation:js.Emulated}));let i=this.getOrCreateRenderer(d,y);return i instanceof P0?i.applyToHost(d):i instanceof dm&&i.applyStyles(),i}getOrCreateRenderer(d,y){let i=this.rendererByCompId,M=i.get(y.id);if(!M){let L=this.doc,B=this.ngZone,q=this.eventManager,se=this.sharedStylesHost,ge=this.removeStylesOnCompDestroy,Pe=this.platformIsServer;switch(y.encapsulation){case js.Emulated:M=new P0(q,se,y,this.appId,ge,L,B,Pe);break;case js.ShadowDom:return new qw(q,se,d,y,L,B,this.nonce,Pe);default:M=new dm(q,se,y,ge,L,B,Pe);break}i.set(y.id,M)}return M}ngOnDestroy(){this.rendererByCompId.clear()}};a.\u0275fac=function(y){return new(y||a)(jt(B2),jt(j2),jt(Xp),jt(Hj),jt(Fi),jt(Wo),jt(_r),jt(Kb))},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})(),hm=class{constructor(a,m,d,y){this.eventManager=a,this.doc=m,this.ngZone=d,this.platformIsServer=y,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(a,m){return m?this.doc.createElementNS(Vw[m]||m,a):this.doc.createElement(a)}createComment(a){return this.doc.createComment(a)}createText(a){return this.doc.createTextNode(a)}appendChild(a,m){(N2(a)?a.content:a).appendChild(m)}insertBefore(a,m,d){a&&(N2(a)?a.content:a).insertBefore(m,d)}removeChild(a,m){a&&a.removeChild(m)}selectRootElement(a,m){let d=typeof a=="string"?this.doc.querySelector(a):a;if(!d)throw new Xt(-5104,!1);return m||(d.textContent=""),d}parentNode(a){return a.parentNode}nextSibling(a){return a.nextSibling}setAttribute(a,m,d,y){if(y){m=y+":"+m;let i=Vw[y];i?a.setAttributeNS(i,m,d):a.setAttribute(m,d)}else a.setAttribute(m,d)}removeAttribute(a,m,d){if(d){let y=Vw[d];y?a.removeAttributeNS(y,m):a.removeAttribute(`${d}:${m}`)}else a.removeAttribute(m)}addClass(a,m){a.classList.add(m)}removeClass(a,m){a.classList.remove(m)}setStyle(a,m,d,y){y&(Pa.DashCase|Pa.Important)?a.style.setProperty(m,d,y&Pa.Important?"important":""):a.style[m]=d}removeStyle(a,m,d){d&Pa.DashCase?a.style.removeProperty(m):a.style[m]=""}setProperty(a,m,d){a!=null&&(a[m]=d)}setValue(a,m){a.nodeValue=m}listen(a,m,d){if(typeof a=="string"&&(a=yu().getGlobalEventTarget(this.doc,a),!a))throw new Error(`Unsupported event target ${a} for event ${m}`);return this.eventManager.addEventListener(a,m,this.decoratePreventDefault(d))}decoratePreventDefault(a){return m=>{if(m==="__ngUnwrap__")return a;(this.platformIsServer?this.ngZone.runGuarded(()=>a(m)):a(m))===!1&&m.preventDefault()}}};function N2(s){return s.tagName==="TEMPLATE"&&s.content!==void 0}var qw=class extends hm{constructor(a,m,d,y,i,M,L,B){super(a,i,M,B),this.sharedStylesHost=m,this.hostEl=d,this.shadowRoot=d.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let q=U2(y.id,y.styles);for(let se of q){let ge=document.createElement("style");L&&ge.setAttribute("nonce",L),ge.textContent=se,this.shadowRoot.appendChild(ge)}}nodeOrShadowRoot(a){return a===this.hostEl?this.shadowRoot:a}appendChild(a,m){return super.appendChild(this.nodeOrShadowRoot(a),m)}insertBefore(a,m,d){return super.insertBefore(this.nodeOrShadowRoot(a),m,d)}removeChild(a,m){return super.removeChild(this.nodeOrShadowRoot(a),m)}parentNode(a){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(a)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},dm=class extends hm{constructor(a,m,d,y,i,M,L,B){super(a,i,M,L),this.sharedStylesHost=m,this.removeStylesOnCompDestroy=y,this.styles=B?U2(B,d.styles):d.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},P0=class extends dm{constructor(a,m,d,y,i,M,L,B){let q=y+"-"+d.id;super(a,m,d,i,M,L,B,q),this.contentAttr=qj(q),this.hostAttr=Wj(q)}applyToHost(a){this.applyStyles(),this.setAttribute(a,this.hostAttr,"")}createElement(a,m){let d=super.createElement(a,m);return super.setAttribute(d,this.contentAttr,""),d}},Zj=(()=>{let a=class a extends A0{constructor(d){super(d)}supports(d){return!0}addEventListener(d,y,i){return d.addEventListener(y,i,!1),()=>this.removeEventListener(d,y,i)}removeEventListener(d,y,i){return d.removeEventListener(y,i)}};a.\u0275fac=function(y){return new(y||a)(jt(Fi))},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})(),z2=["alt","control","meta","shift"],Qj={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Yj={alt:s=>s.altKey,control:s=>s.ctrlKey,meta:s=>s.metaKey,shift:s=>s.shiftKey},Xj=(()=>{let a=class a extends A0{constructor(d){super(d)}supports(d){return a.parseEventName(d)!=null}addEventListener(d,y,i){let M=a.parseEventName(y),L=a.eventCallback(M.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>yu().onAndCancel(d,M.domEventName,L))}static parseEventName(d){let y=d.toLowerCase().split("."),i=y.shift();if(y.length===0||!(i==="keydown"||i==="keyup"))return null;let M=a._normalizeKey(y.pop()),L="",B=y.indexOf("code");if(B>-1&&(y.splice(B,1),L="code."),z2.forEach(se=>{let ge=y.indexOf(se);ge>-1&&(y.splice(ge,1),L+=se+".")}),L+=M,y.length!=0||M.length===0)return null;let q={};return q.domEventName=i,q.fullKey=L,q}static matchEventFullKeyCode(d,y){let i=Qj[d.key]||d.key,M="";return y.indexOf("code.")>-1&&(i=d.code,M="code."),i==null||!i?!1:(i=i.toLowerCase(),i===" "?i="space":i==="."&&(i="dot"),z2.forEach(L=>{if(L!==i){let B=Yj[L];B(d)&&(M+=L+".")}}),M+=i,M===y)}static eventCallback(d,y,i){return M=>{a.matchEventFullKeyCode(M,d)&&i.runGuarded(()=>y(M))}}static _normalizeKey(d){return d==="esc"?"escape":d}};a.\u0275fac=function(y){return new(y||a)(jt(Fi))},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})();function Kj(){$w.makeCurrent()}function Jj(){return new Us}function e5(){return NC(document),document}var t5=[{provide:Wo,useValue:Lw},{provide:Xb,useValue:Kj,multi:!0},{provide:Fi,useFactory:e5,deps:[]}],$2=Mw(JA,"browser",t5),n5=new Wt(""),r5=[{provide:rm,useClass:Gw,deps:[]},{provide:Tw,useClass:_0,deps:[_r,y0,rm]},{provide:_0,useClass:_0,deps:[_r,y0,rm]}],i5=[{provide:Wy,useValue:"root"},{provide:Us,useFactory:Jj,deps:[]},{provide:Hw,useClass:Zj,multi:!0,deps:[Fi,_r,Wo]},{provide:Hw,useClass:Xj,multi:!0,deps:[Fi]},F2,j2,B2,{provide:Bp,useExisting:F2},{provide:Ed,useClass:Vj,deps:[]},[]],G2=(()=>{let a=class a{constructor(d){}static withServerTransition(d){return{ngModule:a,providers:[{provide:Xp,useValue:d.appId}]}}};a.\u0275fac=function(y){return new(y||a)(jt(n5,12))},a.\u0275mod=qi({type:a}),a.\u0275inj=Hi({providers:[...i5,...r5],imports:[T0,e2]});let s=a;return s})();var H2=(()=>{let a=class a{constructor(d){this._doc=d}getTitle(){return this._doc.title}setTitle(d){this._doc.title=d||""}};a.\u0275fac=function(y){return new(y||a)(jt(Fi))},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var Ww=function(s){return s[s.NoHttpTransferCache=0]="NoHttpTransferCache",s[s.HttpTransferCacheOptions=1]="HttpTransferCacheOptions",s}(Ww||{});function q2(...s){let a=[],m=new Set,d=m.has(Ww.HttpTransferCacheOptions);for(let{\u0275providers:y,\u0275kind:i}of s)m.add(i),y.length&&a.push(y);return _d([[],t2(),m.has(Ww.NoHttpTransferCache)||d?[]:L2({}),a])}var An="primary",Mm=Symbol("RouteTitle"),Jw=class{constructor(a){this.params=a||{}}has(a){return Object.prototype.hasOwnProperty.call(this.params,a)}get(a){if(this.has(a)){let m=this.params[a];return Array.isArray(m)?m[0]:m}return null}getAll(a){if(this.has(a)){let m=this.params[a];return Array.isArray(m)?m:[m]}return[]}get keys(){return Object.keys(this.params)}};function Rd(s){return new Jw(s)}function o5(s,a,m){let d=m.path.split("/");if(d.length>s.length||m.pathMatch==="full"&&(a.hasChildren()||d.length<s.length))return null;let y={};for(let i=0;i<d.length;i++){let M=d[i],L=s[i];if(M.startsWith(":"))y[M.substring(1)]=L;else if(M!==L.path)return null}return{consumed:s.slice(0,d.length),posParams:y}}function s5(s,a){if(s.length!==a.length)return!1;for(let m=0;m<s.length;++m)if(!qs(s[m],a[m]))return!1;return!0}function qs(s,a){let m=s?eT(s):void 0,d=a?eT(a):void 0;if(!m||!d||m.length!=d.length)return!1;let y;for(let i=0;i<m.length;i++)if(y=m[i],!nP(s[y],a[y]))return!1;return!0}function eT(s){return[...Object.keys(s),...Object.getOwnPropertySymbols(s)]}function nP(s,a){if(Array.isArray(s)&&Array.isArray(a)){if(s.length!==a.length)return!1;let m=[...s].sort(),d=[...a].sort();return m.every((y,i)=>d[i]===y)}else return s===a}function rP(s){return s.length>0?s[s.length-1]:null}function Ql(s){return f1(s)?s:im(s)?Pr(Promise.resolve(s)):on(s)}var a5={exact:oP,subset:sP},iP={exact:l5,subset:c5,ignored:()=>!0};function Z2(s,a,m){return a5[m.paths](s.root,a.root,m.matrixParams)&&iP[m.queryParams](s.queryParams,a.queryParams)&&!(m.fragment==="exact"&&s.fragment!==a.fragment)}function l5(s,a){return qs(s,a)}function oP(s,a,m){if(!bu(s.segments,a.segments)||!L0(s.segments,a.segments,m)||s.numberOfChildren!==a.numberOfChildren)return!1;for(let d in a.children)if(!s.children[d]||!oP(s.children[d],a.children[d],m))return!1;return!0}function c5(s,a){return Object.keys(a).length<=Object.keys(s).length&&Object.keys(a).every(m=>nP(s[m],a[m]))}function sP(s,a,m){return aP(s,a,a.segments,m)}function aP(s,a,m,d){if(s.segments.length>m.length){let y=s.segments.slice(0,m.length);return!(!bu(y,m)||a.hasChildren()||!L0(y,m,d))}else if(s.segments.length===m.length){if(!bu(s.segments,m)||!L0(s.segments,m,d))return!1;for(let y in a.children)if(!s.children[y]||!sP(s.children[y],a.children[y],d))return!1;return!0}else{let y=m.slice(0,s.segments.length),i=m.slice(s.segments.length);return!bu(s.segments,y)||!L0(s.segments,y,d)||!s.children[An]?!1:aP(s.children[An],a,i,d)}}function L0(s,a,m){return a.every((d,y)=>iP[m](s[y].parameters,d.parameters))}var ql=class{constructor(a=new lr([],{}),m={},d=null){this.root=a,this.queryParams=m,this.fragment=d}get queryParamMap(){return this._queryParamMap??=Rd(this.queryParams),this._queryParamMap}toString(){return d5.serialize(this)}},lr=class{constructor(a,m){this.segments=a,this.children=m,this.parent=null,Object.values(m).forEach(d=>d.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return k0(this)}},xu=class{constructor(a,m){this.path=a,this.parameters=m}get parameterMap(){return this._parameterMap??=Rd(this.parameters),this._parameterMap}toString(){return cP(this)}};function u5(s,a){return bu(s,a)&&s.every((m,d)=>qs(m.parameters,a[d].parameters))}function bu(s,a){return s.length!==a.length?!1:s.every((m,d)=>m.path===a[d].path)}function h5(s,a){let m=[];return Object.entries(s.children).forEach(([d,y])=>{d===An&&(m=m.concat(a(y,d)))}),Object.entries(s.children).forEach(([d,y])=>{d!==An&&(m=m.concat(a(y,d)))}),m}var Sm=(()=>{let a=class a{};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:()=>new vm,providedIn:"root"});let s=a;return s})(),vm=class{parse(a){let m=new nT(a);return new ql(m.parseRootSegment(),m.parseQueryParams(),m.parseFragment())}serialize(a){let m=`/${fm(a.root,!0)}`,d=m5(a.queryParams),y=typeof a.fragment=="string"?`#${f5(a.fragment)}`:"";return`${m}${d}${y}`}},d5=new vm;function k0(s){return s.segments.map(a=>cP(a)).join("/")}function fm(s,a){if(!s.hasChildren())return k0(s);if(a){let m=s.children[An]?fm(s.children[An],!1):"",d=[];return Object.entries(s.children).forEach(([y,i])=>{y!==An&&d.push(`${y}:${fm(i,!1)}`)}),d.length>0?`${m}(${d.join("//")})`:m}else{let m=h5(s,(d,y)=>y===An?[fm(s.children[An],!1)]:[`${y}:${fm(d,!1)}`]);return Object.keys(s.children).length===1&&s.children[An]!=null?`${k0(s)}/${m[0]}`:`${k0(s)}/(${m.join("//")})`}}function lP(s){return encodeURIComponent(s).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function R0(s){return lP(s).replace(/%3B/gi,";")}function f5(s){return encodeURI(s)}function tT(s){return lP(s).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function F0(s){return decodeURIComponent(s)}function Q2(s){return F0(s.replace(/\+/g,"%20"))}function cP(s){return`${tT(s.path)}${p5(s.parameters)}`}function p5(s){return Object.entries(s).map(([a,m])=>`;${tT(a)}=${tT(m)}`).join("")}function m5(s){let a=Object.entries(s).map(([m,d])=>Array.isArray(d)?d.map(y=>`${R0(m)}=${R0(y)}`).join("&"):`${R0(m)}=${R0(d)}`).filter(m=>m);return a.length?`?${a.join("&")}`:""}var g5=/^[^\/()?;#]+/;function Qw(s){let a=s.match(g5);return a?a[0]:""}var _5=/^[^\/()?;=#]+/;function y5(s){let a=s.match(_5);return a?a[0]:""}var v5=/^[^=?&#]+/;function x5(s){let a=s.match(v5);return a?a[0]:""}var b5=/^[^&#]+/;function w5(s){let a=s.match(b5);return a?a[0]:""}var nT=class{constructor(a){this.url=a,this.remaining=a}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new lr([],{}):new lr([],this.parseChildren())}parseQueryParams(){let a={};if(this.consumeOptional("?"))do this.parseQueryParam(a);while(this.consumeOptional("&"));return a}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let a=[];for(this.peekStartsWith("(")||a.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),a.push(this.parseSegment());let m={};this.peekStartsWith("/(")&&(this.capture("/"),m=this.parseParens(!0));let d={};return this.peekStartsWith("(")&&(d=this.parseParens(!1)),(a.length>0||Object.keys(m).length>0)&&(d[An]=new lr(a,m)),d}parseSegment(){let a=Qw(this.remaining);if(a===""&&this.peekStartsWith(";"))throw new Xt(4009,!1);return this.capture(a),new xu(F0(a),this.parseMatrixParams())}parseMatrixParams(){let a={};for(;this.consumeOptional(";");)this.parseParam(a);return a}parseParam(a){let m=y5(this.remaining);if(!m)return;this.capture(m);let d="";if(this.consumeOptional("=")){let y=Qw(this.remaining);y&&(d=y,this.capture(d))}a[F0(m)]=F0(d)}parseQueryParam(a){let m=x5(this.remaining);if(!m)return;this.capture(m);let d="";if(this.consumeOptional("=")){let M=w5(this.remaining);M&&(d=M,this.capture(d))}let y=Q2(m),i=Q2(d);if(a.hasOwnProperty(y)){let M=a[y];Array.isArray(M)||(M=[M],a[y]=M),M.push(i)}else a[y]=i}parseParens(a){let m={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let d=Qw(this.remaining),y=this.remaining[d.length];if(y!=="/"&&y!==")"&&y!==";")throw new Xt(4010,!1);let i;d.indexOf(":")>-1?(i=d.slice(0,d.indexOf(":")),this.capture(i),this.capture(":")):a&&(i=An);let M=this.parseChildren();m[i]=Object.keys(M).length===1?M[An]:new lr([],M),this.consumeOptional("//")}return m}peekStartsWith(a){return this.remaining.startsWith(a)}consumeOptional(a){return this.peekStartsWith(a)?(this.remaining=this.remaining.substring(a.length),!0):!1}capture(a){if(!this.consumeOptional(a))throw new Xt(4011,!1)}};function uP(s){return s.segments.length>0?new lr([],{[An]:s}):s}function hP(s){let a={};for(let[d,y]of Object.entries(s.children)){let i=hP(y);if(d===An&&i.segments.length===0&&i.hasChildren())for(let[M,L]of Object.entries(i.children))a[M]=L;else(i.segments.length>0||i.hasChildren())&&(a[d]=i)}let m=new lr(s.segments,a);return T5(m)}function T5(s){if(s.numberOfChildren===1&&s.children[An]){let a=s.children[An];return new lr(s.segments.concat(a.segments),a.children)}return s}function Od(s){return s instanceof ql}function E5(s,a,m=null,d=null){let y=dP(s);return fP(y,a,m,d)}function dP(s){let a;function m(i){let M={};for(let B of i.children){let q=m(B);M[B.outlet]=q}let L=new lr(i.url,M);return i===s&&(a=L),L}let d=m(s.root),y=uP(d);return a??y}function fP(s,a,m,d){let y=s;for(;y.parent;)y=y.parent;if(a.length===0)return Yw(y,y,y,m,d);let i=I5(a);if(i.toRoot())return Yw(y,y,new lr([],{}),m,d);let M=D5(i,y,s),L=M.processChildren?gm(M.segmentGroup,M.index,i.commands):mP(M.segmentGroup,M.index,i.commands);return Yw(y,M.segmentGroup,L,m,d)}function N0(s){return typeof s=="object"&&s!=null&&!s.outlets&&!s.segmentPath}function xm(s){return typeof s=="object"&&s!=null&&s.outlets}function Yw(s,a,m,d,y){let i={};d&&Object.entries(d).forEach(([B,q])=>{i[B]=Array.isArray(q)?q.map(se=>`${se}`):`${q}`});let M;s===a?M=m:M=pP(s,a,m);let L=uP(hP(M));return new ql(L,i,y)}function pP(s,a,m){let d={};return Object.entries(s.children).forEach(([y,i])=>{i===a?d[y]=m:d[y]=pP(i,a,m)}),new lr(s.segments,d)}var z0=class{constructor(a,m,d){if(this.isAbsolute=a,this.numberOfDoubleDots=m,this.commands=d,a&&d.length>0&&N0(d[0]))throw new Xt(4003,!1);let y=d.find(xm);if(y&&y!==rP(d))throw new Xt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function I5(s){if(typeof s[0]=="string"&&s.length===1&&s[0]==="/")return new z0(!0,0,s);let a=0,m=!1,d=s.reduce((y,i,M)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let L={};return Object.entries(i.outlets).forEach(([B,q])=>{L[B]=typeof q=="string"?q.split("/"):q}),[...y,{outlets:L}]}if(i.segmentPath)return[...y,i.segmentPath]}return typeof i!="string"?[...y,i]:M===0?(i.split("/").forEach((L,B)=>{B==0&&L==="."||(B==0&&L===""?m=!0:L===".."?a++:L!=""&&y.push(L))}),y):[...y,i]},[]);return new z0(m,a,d)}var Ad=class{constructor(a,m,d){this.segmentGroup=a,this.processChildren=m,this.index=d}};function D5(s,a,m){if(s.isAbsolute)return new Ad(a,!0,0);if(!m)return new Ad(a,!1,NaN);if(m.parent===null)return new Ad(m,!0,0);let d=N0(s.commands[0])?0:1,y=m.segments.length-1+d;return M5(m,y,s.numberOfDoubleDots)}function M5(s,a,m){let d=s,y=a,i=m;for(;i>y;){if(i-=y,d=d.parent,!d)throw new Xt(4005,!1);y=d.segments.length}return new Ad(d,!1,y-i)}function S5(s){return xm(s[0])?s[0].outlets:{[An]:s}}function mP(s,a,m){if(s??=new lr([],{}),s.segments.length===0&&s.hasChildren())return gm(s,a,m);let d=C5(s,a,m),y=m.slice(d.commandIndex);if(d.match&&d.pathIndex<s.segments.length){let i=new lr(s.segments.slice(0,d.pathIndex),{});return i.children[An]=new lr(s.segments.slice(d.pathIndex),s.children),gm(i,0,y)}else return d.match&&y.length===0?new lr(s.segments,{}):d.match&&!s.hasChildren()?rT(s,a,m):d.match?gm(s,0,y):rT(s,a,m)}function gm(s,a,m){if(m.length===0)return new lr(s.segments,{});{let d=S5(m),y={};if(Object.keys(d).some(i=>i!==An)&&s.children[An]&&s.numberOfChildren===1&&s.children[An].segments.length===0){let i=gm(s.children[An],a,m);return new lr(s.segments,i.children)}return Object.entries(d).forEach(([i,M])=>{typeof M=="string"&&(M=[M]),M!==null&&(y[i]=mP(s.children[i],a,M))}),Object.entries(s.children).forEach(([i,M])=>{d[i]===void 0&&(y[i]=M)}),new lr(s.segments,y)}}function C5(s,a,m){let d=0,y=a,i={match:!1,pathIndex:0,commandIndex:0};for(;y<s.segments.length;){if(d>=m.length)return i;let M=s.segments[y],L=m[d];if(xm(L))break;let B=`${L}`,q=d<m.length-1?m[d+1]:null;if(y>0&&B===void 0)break;if(B&&q&&typeof q=="object"&&q.outlets===void 0){if(!X2(B,q,M))return i;d+=2}else{if(!X2(B,{},M))return i;d++}y++}return{match:!0,pathIndex:y,commandIndex:d}}function rT(s,a,m){let d=s.segments.slice(0,a),y=0;for(;y<m.length;){let i=m[y];if(xm(i)){let B=A5(i.outlets);return new lr(d,B)}if(y===0&&N0(m[0])){let B=s.segments[a];d.push(new xu(B.path,Y2(m[0]))),y++;continue}let M=xm(i)?i.outlets[An]:`${i}`,L=y<m.length-1?m[y+1]:null;M&&L&&N0(L)?(d.push(new xu(M,Y2(L))),y+=2):(d.push(new xu(M,{})),y++)}return new lr(d,{})}function A5(s){let a={};return Object.entries(s).forEach(([m,d])=>{typeof d=="string"&&(d=[d]),d!==null&&(a[m]=rT(new lr([],{}),0,d))}),a}function Y2(s){let a={};return Object.entries(s).forEach(([m,d])=>a[m]=`${d}`),a}function X2(s,a,m){return s==m.path&&qs(a,m.parameters)}var _m="imperative",di=function(s){return s[s.NavigationStart=0]="NavigationStart",s[s.NavigationEnd=1]="NavigationEnd",s[s.NavigationCancel=2]="NavigationCancel",s[s.NavigationError=3]="NavigationError",s[s.RoutesRecognized=4]="RoutesRecognized",s[s.ResolveStart=5]="ResolveStart",s[s.ResolveEnd=6]="ResolveEnd",s[s.GuardsCheckStart=7]="GuardsCheckStart",s[s.GuardsCheckEnd=8]="GuardsCheckEnd",s[s.RouteConfigLoadStart=9]="RouteConfigLoadStart",s[s.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",s[s.ChildActivationStart=11]="ChildActivationStart",s[s.ChildActivationEnd=12]="ChildActivationEnd",s[s.ActivationStart=13]="ActivationStart",s[s.ActivationEnd=14]="ActivationEnd",s[s.Scroll=15]="Scroll",s[s.NavigationSkipped=16]="NavigationSkipped",s}(di||{}),Zo=class{constructor(a,m){this.id=a,this.url=m}},Ld=class extends Zo{constructor(a,m,d="imperative",y=null){super(a,m),this.type=di.NavigationStart,this.navigationTrigger=d,this.restoredState=y}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Fa=class extends Zo{constructor(a,m,d){super(a,m),this.urlAfterRedirects=d,this.type=di.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Co=function(s){return s[s.Redirect=0]="Redirect",s[s.SupersededByNewNavigation=1]="SupersededByNewNavigation",s[s.NoDataFromResolver=2]="NoDataFromResolver",s[s.GuardRejected=3]="GuardRejected",s}(Co||{}),B0=function(s){return s[s.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",s[s.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",s}(B0||{}),Wl=class extends Zo{constructor(a,m,d,y){super(a,m),this.reason=d,this.code=y,this.type=di.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Zl=class extends Zo{constructor(a,m,d,y){super(a,m),this.reason=d,this.code=y,this.type=di.NavigationSkipped}},bm=class extends Zo{constructor(a,m,d,y){super(a,m),this.error=d,this.target=y,this.type=di.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},j0=class extends Zo{constructor(a,m,d,y){super(a,m),this.urlAfterRedirects=d,this.state=y,this.type=di.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},iT=class extends Zo{constructor(a,m,d,y){super(a,m),this.urlAfterRedirects=d,this.state=y,this.type=di.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},oT=class extends Zo{constructor(a,m,d,y,i){super(a,m),this.urlAfterRedirects=d,this.state=y,this.shouldActivate=i,this.type=di.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},sT=class extends Zo{constructor(a,m,d,y){super(a,m),this.urlAfterRedirects=d,this.state=y,this.type=di.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},aT=class extends Zo{constructor(a,m,d,y){super(a,m),this.urlAfterRedirects=d,this.state=y,this.type=di.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},lT=class{constructor(a){this.route=a,this.type=di.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},cT=class{constructor(a){this.route=a,this.type=di.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},uT=class{constructor(a){this.snapshot=a,this.type=di.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},hT=class{constructor(a){this.snapshot=a,this.type=di.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},dT=class{constructor(a){this.snapshot=a,this.type=di.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},fT=class{constructor(a){this.snapshot=a,this.type=di.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},V0=class{constructor(a,m,d){this.routerEvent=a,this.position=m,this.anchor=d,this.type=di.Scroll}toString(){let a=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${a}')`}},wm=class{},Tm=class{constructor(a){this.url=a}};var pT=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Cm,this.attachRef=null}},Cm=(()=>{let a=class a{constructor(){this.contexts=new Map}onChildOutletCreated(d,y){let i=this.getOrCreateContext(d);i.outlet=y,this.contexts.set(d,i)}onChildOutletDestroyed(d){let y=this.getContext(d);y&&(y.outlet=null,y.attachRef=null)}onOutletDeactivated(){let d=this.contexts;return this.contexts=new Map,d}onOutletReAttached(d){this.contexts=d}getOrCreateContext(d){let y=this.getContext(d);return y||(y=new pT,this.contexts.set(d,y)),y}getContext(d){return this.contexts.get(d)||null}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),U0=class{constructor(a){this._root=a}get root(){return this._root.value}parent(a){let m=this.pathFromRoot(a);return m.length>1?m[m.length-2]:null}children(a){let m=mT(a,this._root);return m?m.children.map(d=>d.value):[]}firstChild(a){let m=mT(a,this._root);return m&&m.children.length>0?m.children[0].value:null}siblings(a){let m=gT(a,this._root);return m.length<2?[]:m[m.length-2].children.map(y=>y.value).filter(y=>y!==a)}pathFromRoot(a){return gT(a,this._root).map(m=>m.value)}};function mT(s,a){if(s===a.value)return a;for(let m of a.children){let d=mT(s,m);if(d)return d}return null}function gT(s,a){if(s===a.value)return[a];for(let m of a.children){let d=gT(s,m);if(d.length)return d.unshift(a),d}return[]}var So=class{constructor(a,m){this.value=a,this.children=m}toString(){return`TreeNode(${this.value})`}};function Cd(s){let a={};return s&&s.children.forEach(m=>a[m.value.outlet]=m),a}var $0=class extends U0{constructor(a,m){super(a),this.snapshot=m,DT(this,a)}toString(){return this.snapshot.toString()}};function gP(s){let a=P5(s),m=new bi([new xu("",{})]),d=new bi({}),y=new bi({}),i=new bi({}),M=new bi(""),L=new kd(m,d,i,M,y,An,s,a.root);return L.snapshot=a.root,new $0(new So(L,[]),a)}function P5(s){let a={},m={},d={},y="",i=new Em([],a,d,y,m,An,s,null,{});return new G0("",new So(i,[]))}var kd=class{constructor(a,m,d,y,i,M,L,B){this.urlSubject=a,this.paramsSubject=m,this.queryParamsSubject=d,this.fragmentSubject=y,this.dataSubject=i,this.outlet=M,this.component=L,this._futureSnapshot=B,this.title=this.dataSubject?.pipe(On(q=>q[Mm]))??on(void 0),this.url=a,this.params=m,this.queryParams=d,this.fragment=y,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(On(a=>Rd(a))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(On(a=>Rd(a))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function IT(s,a,m="emptyOnly"){let d,{routeConfig:y}=s;return a!==null&&(m==="always"||y?.path===""||!a.component&&!a.routeConfig?.loadComponent)?d={params:Ct(Ct({},a.params),s.params),data:Ct(Ct({},a.data),s.data),resolve:Ct(Ct(Ct(Ct({},s.data),a.data),y?.data),s._resolvedData)}:d={params:Ct({},s.params),data:Ct({},s.data),resolve:Ct(Ct({},s.data),s._resolvedData??{})},y&&yP(y)&&(d.resolve[Mm]=y.title),d}var Em=class{get title(){return this.data?.[Mm]}constructor(a,m,d,y,i,M,L,B,q){this.url=a,this.params=m,this.queryParams=d,this.fragment=y,this.data=i,this.outlet=M,this.component=L,this.routeConfig=B,this._resolve=q}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Rd(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Rd(this.queryParams),this._queryParamMap}toString(){let a=this.url.map(d=>d.toString()).join("/"),m=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${a}', path:'${m}')`}},G0=class extends U0{constructor(a,m){super(m),this.url=a,DT(this,m)}toString(){return _P(this._root)}};function DT(s,a){a.value._routerState=s,a.children.forEach(m=>DT(s,m))}function _P(s){let a=s.children.length>0?` { ${s.children.map(_P).join(", ")} } `:"";return`${s.value}${a}`}function Xw(s){if(s.snapshot){let a=s.snapshot,m=s._futureSnapshot;s.snapshot=m,qs(a.queryParams,m.queryParams)||s.queryParamsSubject.next(m.queryParams),a.fragment!==m.fragment&&s.fragmentSubject.next(m.fragment),qs(a.params,m.params)||s.paramsSubject.next(m.params),s5(a.url,m.url)||s.urlSubject.next(m.url),qs(a.data,m.data)||s.dataSubject.next(m.data)}else s.snapshot=s._futureSnapshot,s.dataSubject.next(s._futureSnapshot.data)}function _T(s,a){let m=qs(s.params,a.params)&&u5(s.url,a.url),d=!s.parent!=!a.parent;return m&&!d&&(!s.parent||_T(s.parent,a.parent))}function yP(s){return typeof s.title=="string"||s.title===null}var R5=(()=>{let a=class a{constructor(){this.activated=null,this._activatedRoute=null,this.name=An,this.activateEvents=new Oi,this.deactivateEvents=new Oi,this.attachEvents=new Oi,this.detachEvents=new Oi,this.parentContexts=Xe(Cm),this.location=Xe(wd),this.changeDetector=Xe(om),this.environmentInjector=Xe(ki),this.inputBinder=Xe(Q0,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(d){if(d.name){let{firstChange:y,previousValue:i}=d.name;if(y)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(d){return this.parentContexts.getContext(d)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let d=this.parentContexts.getContext(this.name);d?.route&&(d.attachRef?this.attach(d.attachRef,d.route):this.activateWith(d.route,d.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Xt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Xt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Xt(4012,!1);this.location.detach();let d=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(d.instance),d}attach(d,y){this.activated=d,this._activatedRoute=y,this.location.insert(d.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(d.instance)}deactivate(){if(this.activated){let d=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(d)}}activateWith(d,y){if(this.isActivated)throw new Xt(4013,!1);this._activatedRoute=d;let i=this.location,L=d.snapshot.component,B=this.parentContexts.getOrCreateContext(this.name).children,q=new yT(d,B,i.injector);this.activated=i.createComponent(L,{index:i.length,injector:q,environmentInjector:y??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};a.\u0275fac=function(y){return new(y||a)},a.\u0275dir=qy({type:a,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Qy]});let s=a;return s})(),yT=class s{__ngOutletInjector(a){return new s(this.route,this.childContexts,a)}constructor(a,m,d){this.route=a,this.childContexts=m,this.parent=d}get(a,m){return a===kd?this.route:a===Cm?this.childContexts:this.parent.get(a,m)}},Q0=new Wt(""),K2=(()=>{let a=class a{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(d){this.unsubscribeFromRouteData(d),this.subscribeToRouteData(d)}unsubscribeFromRouteData(d){this.outletDataSubscriptions.get(d)?.unsubscribe(),this.outletDataSubscriptions.delete(d)}subscribeToRouteData(d){let{activatedRoute:y}=d,i=wp([y.queryParams,y.params,y.data]).pipe(so(([M,L,B],q)=>(B=Ct(Ct(Ct({},M),L),B),q===0?on(B):Promise.resolve(B)))).subscribe(M=>{if(!d.isActivated||!d.activatedComponentRef||d.activatedRoute!==y||y.component===null){this.unsubscribeFromRouteData(d);return}let L=n2(y.component);if(!L){this.unsubscribeFromRouteData(d);return}for(let{templateName:B}of L.inputs)d.activatedComponentRef.setInput(B,M[B])});this.outletDataSubscriptions.set(d,i)}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})();function O5(s,a,m){let d=Im(s,a._root,m?m._root:void 0);return new $0(d,a)}function Im(s,a,m){if(m&&s.shouldReuseRoute(a.value,m.value.snapshot)){let d=m.value;d._futureSnapshot=a.value;let y=L5(s,a,m);return new So(d,y)}else{if(s.shouldAttach(a.value)){let i=s.retrieve(a.value);if(i!==null){let M=i.route;return M.value._futureSnapshot=a.value,M.children=a.children.map(L=>Im(s,L)),M}}let d=k5(a.value),y=a.children.map(i=>Im(s,i));return new So(d,y)}}function L5(s,a,m){return a.children.map(d=>{for(let y of m.children)if(s.shouldReuseRoute(d.value,y.value.snapshot))return Im(s,d,y);return Im(s,d)})}function k5(s){return new kd(new bi(s.url),new bi(s.params),new bi(s.queryParams),new bi(s.fragment),new bi(s.data),s.outlet,s.component,s)}var vP="ngNavigationCancelingError";function xP(s,a){let{redirectTo:m,navigationBehaviorOptions:d}=Od(a)?{redirectTo:a,navigationBehaviorOptions:void 0}:a,y=bP(!1,Co.Redirect);return y.url=m,y.navigationBehaviorOptions=d,y}function bP(s,a){let m=new Error(`NavigationCancelingError: ${s||""}`);return m[vP]=!0,m.cancellationCode=a,m}function F5(s){return wP(s)&&Od(s.url)}function wP(s){return!!s&&s[vP]}var N5=(()=>{let a=class a{};a.\u0275fac=function(y){return new(y||a)},a.\u0275cmp=hi({type:a,selectors:[["ng-component"]],standalone:!0,features:[HA],decls:1,vars:0,template:function(y,i){y&1&&Wi(0,"router-outlet")},dependencies:[R5],encapsulation:2});let s=a;return s})();function z5(s,a){return s.providers&&!s._injector&&(s._injector=f0(s.providers,a,`Route: ${s.path}`)),s._injector??a}function MT(s){let a=s.children&&s.children.map(MT),m=a?Fr(Ct({},s),{children:a}):Ct({},s);return!m.component&&!m.loadComponent&&(a||m.loadChildren)&&m.outlet&&m.outlet!==An&&(m.component=N5),m}function Ws(s){return s.outlet||An}function B5(s,a){let m=s.filter(d=>Ws(d)===a);return m.push(...s.filter(d=>Ws(d)!==a)),m}function Am(s){if(!s)return null;if(s.routeConfig?._injector)return s.routeConfig._injector;for(let a=s.parent;a;a=a.parent){let m=a.routeConfig;if(m?._loadedInjector)return m._loadedInjector;if(m?._injector)return m._injector}return null}var j5=(s,a,m,d)=>On(y=>(new vT(a,y.targetRouterState,y.currentRouterState,m,d).activate(s),y)),vT=class{constructor(a,m,d,y,i){this.routeReuseStrategy=a,this.futureState=m,this.currState=d,this.forwardEvent=y,this.inputBindingEnabled=i}activate(a){let m=this.futureState._root,d=this.currState?this.currState._root:null;this.deactivateChildRoutes(m,d,a),Xw(this.futureState.root),this.activateChildRoutes(m,d,a)}deactivateChildRoutes(a,m,d){let y=Cd(m);a.children.forEach(i=>{let M=i.value.outlet;this.deactivateRoutes(i,y[M],d),delete y[M]}),Object.values(y).forEach(i=>{this.deactivateRouteAndItsChildren(i,d)})}deactivateRoutes(a,m,d){let y=a.value,i=m?m.value:null;if(y===i)if(y.component){let M=d.getContext(y.outlet);M&&this.deactivateChildRoutes(a,m,M.children)}else this.deactivateChildRoutes(a,m,d);else i&&this.deactivateRouteAndItsChildren(m,d)}deactivateRouteAndItsChildren(a,m){a.value.component&&this.routeReuseStrategy.shouldDetach(a.value.snapshot)?this.detachAndStoreRouteSubtree(a,m):this.deactivateRouteAndOutlet(a,m)}detachAndStoreRouteSubtree(a,m){let d=m.getContext(a.value.outlet),y=d&&a.value.component?d.children:m,i=Cd(a);for(let M of Object.values(i))this.deactivateRouteAndItsChildren(M,y);if(d&&d.outlet){let M=d.outlet.detach(),L=d.children.onOutletDeactivated();this.routeReuseStrategy.store(a.value.snapshot,{componentRef:M,route:a,contexts:L})}}deactivateRouteAndOutlet(a,m){let d=m.getContext(a.value.outlet),y=d&&a.value.component?d.children:m,i=Cd(a);for(let M of Object.values(i))this.deactivateRouteAndItsChildren(M,y);d&&(d.outlet&&(d.outlet.deactivate(),d.children.onOutletDeactivated()),d.attachRef=null,d.route=null)}activateChildRoutes(a,m,d){let y=Cd(m);a.children.forEach(i=>{this.activateRoutes(i,y[i.value.outlet],d),this.forwardEvent(new fT(i.value.snapshot))}),a.children.length&&this.forwardEvent(new hT(a.value.snapshot))}activateRoutes(a,m,d){let y=a.value,i=m?m.value:null;if(Xw(y),y===i)if(y.component){let M=d.getOrCreateContext(y.outlet);this.activateChildRoutes(a,m,M.children)}else this.activateChildRoutes(a,m,d);else if(y.component){let M=d.getOrCreateContext(y.outlet);if(this.routeReuseStrategy.shouldAttach(y.snapshot)){let L=this.routeReuseStrategy.retrieve(y.snapshot);this.routeReuseStrategy.store(y.snapshot,null),M.children.onOutletReAttached(L.contexts),M.attachRef=L.componentRef,M.route=L.route.value,M.outlet&&M.outlet.attach(L.componentRef,L.route.value),Xw(L.route.value),this.activateChildRoutes(a,null,M.children)}else{let L=Am(y.snapshot);M.attachRef=null,M.route=y,M.injector=L,M.outlet&&M.outlet.activateWith(y,M.injector),this.activateChildRoutes(a,null,M.children)}}else this.activateChildRoutes(a,null,d)}},H0=class{constructor(a){this.path=a,this.route=this.path[this.path.length-1]}},Pd=class{constructor(a,m){this.component=a,this.route=m}};function V5(s,a,m){let d=s._root,y=a?a._root:null;return pm(d,y,m,[d.value])}function U5(s){let a=s.routeConfig?s.routeConfig.canActivateChild:null;return!a||a.length===0?null:{node:s,guards:a}}function Nd(s,a){let m=Symbol(),d=a.get(s,m);return d===m?typeof s=="function"&&!DS(s)?s:a.get(s):d}function pm(s,a,m,d,y={canDeactivateChecks:[],canActivateChecks:[]}){let i=Cd(a);return s.children.forEach(M=>{$5(M,i[M.value.outlet],m,d.concat([M.value]),y),delete i[M.value.outlet]}),Object.entries(i).forEach(([M,L])=>ym(L,m.getContext(M),y)),y}function $5(s,a,m,d,y={canDeactivateChecks:[],canActivateChecks:[]}){let i=s.value,M=a?a.value:null,L=m?m.getContext(s.value.outlet):null;if(M&&i.routeConfig===M.routeConfig){let B=G5(M,i,i.routeConfig.runGuardsAndResolvers);B?y.canActivateChecks.push(new H0(d)):(i.data=M.data,i._resolvedData=M._resolvedData),i.component?pm(s,a,L?L.children:null,d,y):pm(s,a,m,d,y),B&&L&&L.outlet&&L.outlet.isActivated&&y.canDeactivateChecks.push(new Pd(L.outlet.component,M))}else M&&ym(a,L,y),y.canActivateChecks.push(new H0(d)),i.component?pm(s,null,L?L.children:null,d,y):pm(s,null,m,d,y);return y}function G5(s,a,m){if(typeof m=="function")return m(s,a);switch(m){case"pathParamsChange":return!bu(s.url,a.url);case"pathParamsOrQueryParamsChange":return!bu(s.url,a.url)||!qs(s.queryParams,a.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!_T(s,a)||!qs(s.queryParams,a.queryParams);case"paramsChange":default:return!_T(s,a)}}function ym(s,a,m){let d=Cd(s),y=s.value;Object.entries(d).forEach(([i,M])=>{y.component?a?ym(M,a.children.getContext(i),m):ym(M,null,m):ym(M,a,m)}),y.component?a&&a.outlet&&a.outlet.isActivated?m.canDeactivateChecks.push(new Pd(a.outlet.component,y)):m.canDeactivateChecks.push(new Pd(null,y)):m.canDeactivateChecks.push(new Pd(null,y))}function Pm(s){return typeof s=="function"}function H5(s){return typeof s=="boolean"}function q5(s){return s&&Pm(s.canLoad)}function W5(s){return s&&Pm(s.canActivate)}function Z5(s){return s&&Pm(s.canActivateChild)}function Q5(s){return s&&Pm(s.canDeactivate)}function Y5(s){return s&&Pm(s.canMatch)}function TP(s){return s instanceof Ea||s?.name==="EmptyError"}var O0=Symbol("INITIAL_VALUE");function Fd(){return so(s=>wp(s.map(a=>a.pipe(Da(1),_1(O0)))).pipe(On(a=>{for(let m of a)if(m!==!0){if(m===O0)return O0;if(m===!1||m instanceof ql)return m}return!0}),oo(a=>a!==O0),Da(1)))}function X5(s,a){return qr(m=>{let{targetSnapshot:d,currentSnapshot:y,guards:{canActivateChecks:i,canDeactivateChecks:M}}=m;return M.length===0&&i.length===0?on(Fr(Ct({},m),{guardsResult:!0})):K5(M,d,y,s).pipe(qr(L=>L&&H5(L)?J5(d,i,s,a):on(L)),On(L=>Fr(Ct({},m),{guardsResult:L})))})}function K5(s,a,m,d){return Pr(s).pipe(qr(y=>iV(y.component,y.route,m,a,d)),fs(y=>y!==!0,!0))}function J5(s,a,m,d){return Pr(a).pipe(Ia(y=>rd(tV(y.route.parent,d),eV(y.route,d),rV(s,y.path,m),nV(s,y.route,m))),fs(y=>y!==!0,!0))}function eV(s,a){return s!==null&&a&&a(new dT(s)),on(!0)}function tV(s,a){return s!==null&&a&&a(new uT(s)),on(!0)}function nV(s,a,m){let d=a.routeConfig?a.routeConfig.canActivate:null;if(!d||d.length===0)return on(!0);let y=d.map(i=>ly(()=>{let M=Am(a)??m,L=Nd(i,M),B=W5(L)?L.canActivate(a,s):_s(M,()=>L(a,s));return Ql(B).pipe(fs())}));return on(y).pipe(Fd())}function rV(s,a,m){let d=a[a.length-1],i=a.slice(0,a.length-1).reverse().map(M=>U5(M)).filter(M=>M!==null).map(M=>ly(()=>{let L=M.guards.map(B=>{let q=Am(M.node)??m,se=Nd(B,q),ge=Z5(se)?se.canActivateChild(d,s):_s(q,()=>se(d,s));return Ql(ge).pipe(fs())});return on(L).pipe(Fd())}));return on(i).pipe(Fd())}function iV(s,a,m,d,y){let i=a&&a.routeConfig?a.routeConfig.canDeactivate:null;if(!i||i.length===0)return on(!0);let M=i.map(L=>{let B=Am(a)??y,q=Nd(L,B),se=Q5(q)?q.canDeactivate(s,a,m,d):_s(B,()=>q(s,a,m,d));return Ql(se).pipe(fs())});return on(M).pipe(Fd())}function oV(s,a,m,d){let y=a.canLoad;if(y===void 0||y.length===0)return on(!0);let i=y.map(M=>{let L=Nd(M,s),B=q5(L)?L.canLoad(a,m):_s(s,()=>L(a,m));return Ql(B)});return on(i).pipe(Fd(),EP(d))}function EP(s){return c1(ti(a=>{if(Od(a))throw xP(s,a)}),On(a=>a===!0))}function sV(s,a,m,d){let y=a.canMatch;if(!y||y.length===0)return on(!0);let i=y.map(M=>{let L=Nd(M,s),B=Y5(L)?L.canMatch(a,m):_s(s,()=>L(a,m));return Ql(B)});return on(i).pipe(Fd(),EP(d))}var Dm=class{constructor(a){this.segmentGroup=a||null}},q0=class extends Error{constructor(a){super(),this.urlTree=a}};function Sd(s){return td(new Dm(s))}function aV(s){return td(new Xt(4e3,!1))}function lV(s){return td(bP(!1,Co.GuardRejected))}var xT=class{constructor(a,m){this.urlSerializer=a,this.urlTree=m}lineralizeSegments(a,m){let d=[],y=m.root;for(;;){if(d=d.concat(y.segments),y.numberOfChildren===0)return on(d);if(y.numberOfChildren>1||!y.children[An])return aV(a.redirectTo);y=y.children[An]}}applyRedirectCommands(a,m,d){let y=this.applyRedirectCreateUrlTree(m,this.urlSerializer.parse(m),a,d);if(m.startsWith("/"))throw new q0(y);return y}applyRedirectCreateUrlTree(a,m,d,y){let i=this.createSegmentGroup(a,m.root,d,y);return new ql(i,this.createQueryParams(m.queryParams,this.urlTree.queryParams),m.fragment)}createQueryParams(a,m){let d={};return Object.entries(a).forEach(([y,i])=>{if(typeof i=="string"&&i.startsWith(":")){let L=i.substring(1);d[y]=m[L]}else d[y]=i}),d}createSegmentGroup(a,m,d,y){let i=this.createSegments(a,m.segments,d,y),M={};return Object.entries(m.children).forEach(([L,B])=>{M[L]=this.createSegmentGroup(a,B,d,y)}),new lr(i,M)}createSegments(a,m,d,y){return m.map(i=>i.path.startsWith(":")?this.findPosParam(a,i,y):this.findOrReturn(i,d))}findPosParam(a,m,d){let y=d[m.path.substring(1)];if(!y)throw new Xt(4001,!1);return y}findOrReturn(a,m){let d=0;for(let y of m){if(y.path===a.path)return m.splice(d),y;d++}return a}},bT={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function cV(s,a,m,d,y){let i=ST(s,a,m);return i.matched?(d=z5(a,d),sV(d,a,m,y).pipe(On(M=>M===!0?i:Ct({},bT)))):on(i)}function ST(s,a,m){if(a.path==="**")return uV(m);if(a.path==="")return a.pathMatch==="full"&&(s.hasChildren()||m.length>0)?Ct({},bT):{matched:!0,consumedSegments:[],remainingSegments:m,parameters:{},positionalParamSegments:{}};let y=(a.matcher||o5)(m,s,a);if(!y)return Ct({},bT);let i={};Object.entries(y.posParams??{}).forEach(([L,B])=>{i[L]=B.path});let M=y.consumed.length>0?Ct(Ct({},i),y.consumed[y.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:y.consumed,remainingSegments:m.slice(y.consumed.length),parameters:M,positionalParamSegments:y.posParams??{}}}function uV(s){return{matched:!0,parameters:s.length>0?rP(s).parameters:{},consumedSegments:s,remainingSegments:[],positionalParamSegments:{}}}function J2(s,a,m,d){return m.length>0&&fV(s,m,d)?{segmentGroup:new lr(a,dV(d,new lr(m,s.children))),slicedSegments:[]}:m.length===0&&pV(s,m,d)?{segmentGroup:new lr(s.segments,hV(s,m,d,s.children)),slicedSegments:m}:{segmentGroup:new lr(s.segments,s.children),slicedSegments:m}}function hV(s,a,m,d){let y={};for(let i of m)if(Y0(s,a,i)&&!d[Ws(i)]){let M=new lr([],{});y[Ws(i)]=M}return Ct(Ct({},d),y)}function dV(s,a){let m={};m[An]=a;for(let d of s)if(d.path===""&&Ws(d)!==An){let y=new lr([],{});m[Ws(d)]=y}return m}function fV(s,a,m){return m.some(d=>Y0(s,a,d)&&Ws(d)!==An)}function pV(s,a,m){return m.some(d=>Y0(s,a,d))}function Y0(s,a,m){return(s.hasChildren()||a.length>0)&&m.pathMatch==="full"?!1:m.path===""}function mV(s,a,m,d){return Ws(s)!==d&&(d===An||!Y0(a,m,s))?!1:ST(a,s,m).matched}function gV(s,a,m){return a.length===0&&!s.children[m]}var wT=class{};function _V(s,a,m,d,y,i,M="emptyOnly"){return new TT(s,a,m,d,y,M,i).recognize()}var yV=31,TT=class{constructor(a,m,d,y,i,M,L){this.injector=a,this.configLoader=m,this.rootComponentType=d,this.config=y,this.urlTree=i,this.paramsInheritanceStrategy=M,this.urlSerializer=L,this.applyRedirects=new xT(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(a){return new Xt(4002,`'${a.segmentGroup}'`)}recognize(){let a=J2(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(a).pipe(On(m=>{let d=new Em([],Object.freeze({}),Object.freeze(Ct({},this.urlTree.queryParams)),this.urlTree.fragment,{},An,this.rootComponentType,null,{}),y=new So(d,m),i=new G0("",y),M=E5(d,[],this.urlTree.queryParams,this.urlTree.fragment);return M.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(M),this.inheritParamsAndData(i._root,null),{state:i,tree:M}}))}match(a){return this.processSegmentGroup(this.injector,this.config,a,An).pipe(Ll(d=>{if(d instanceof q0)return this.urlTree=d.urlTree,this.match(d.urlTree.root);throw d instanceof Dm?this.noMatchError(d):d}))}inheritParamsAndData(a,m){let d=a.value,y=IT(d,m,this.paramsInheritanceStrategy);d.params=Object.freeze(y.params),d.data=Object.freeze(y.data),a.children.forEach(i=>this.inheritParamsAndData(i,d))}processSegmentGroup(a,m,d,y){return d.segments.length===0&&d.hasChildren()?this.processChildren(a,m,d):this.processSegment(a,m,d,d.segments,y,!0).pipe(On(i=>i instanceof So?[i]:[]))}processChildren(a,m,d){let y=[];for(let i of Object.keys(d.children))i==="primary"?y.unshift(i):y.push(i);return Pr(y).pipe(Ia(i=>{let M=d.children[i],L=B5(m,i);return this.processSegmentGroup(a,L,M,i)}),g1((i,M)=>(i.push(...M),i)),kl(null),m1(),qr(i=>{if(i===null)return Sd(d);let M=IP(i);return vV(M),on(M)}))}processSegment(a,m,d,y,i,M){return Pr(m).pipe(Ia(L=>this.processSegmentAgainstRoute(L._injector??a,m,L,d,y,i,M).pipe(Ll(B=>{if(B instanceof Dm)return on(null);throw B}))),fs(L=>!!L),Ll(L=>{if(TP(L))return gV(d,y,i)?on(new wT):Sd(d);throw L}))}processSegmentAgainstRoute(a,m,d,y,i,M,L){return mV(d,y,i,M)?d.redirectTo===void 0?this.matchSegmentAgainstRoute(a,y,d,i,M):this.allowRedirects&&L?this.expandSegmentAgainstRouteUsingRedirect(a,y,m,d,i,M):Sd(y):Sd(y)}expandSegmentAgainstRouteUsingRedirect(a,m,d,y,i,M){let{matched:L,consumedSegments:B,positionalParamSegments:q,remainingSegments:se}=ST(m,y,i);if(!L)return Sd(m);y.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>yV&&(this.allowRedirects=!1));let ge=this.applyRedirects.applyRedirectCommands(B,y.redirectTo,q);return this.applyRedirects.lineralizeSegments(y,ge).pipe(qr(Pe=>this.processSegment(a,d,m,Pe.concat(se),M,!1)))}matchSegmentAgainstRoute(a,m,d,y,i){let M=cV(m,d,y,a,this.urlSerializer);return d.path==="**"&&(m.children={}),M.pipe(so(L=>L.matched?(a=d._injector??a,this.getChildConfig(a,d,y).pipe(so(({routes:B})=>{let q=d._loadedInjector??a,{consumedSegments:se,remainingSegments:ge,parameters:Pe}=L,Ke=new Em(se,Pe,Object.freeze(Ct({},this.urlTree.queryParams)),this.urlTree.fragment,bV(d),Ws(d),d.component??d._loadedComponent??null,d,wV(d)),{segmentGroup:Nt,slicedSegments:sn}=J2(m,se,ge,B);if(sn.length===0&&Nt.hasChildren())return this.processChildren(q,B,Nt).pipe(On(bt=>bt===null?null:new So(Ke,bt)));if(B.length===0&&sn.length===0)return on(new So(Ke,[]));let Rt=Ws(d)===i;return this.processSegment(q,B,Nt,sn,Rt?An:i,!0).pipe(On(bt=>new So(Ke,bt instanceof So?[bt]:[])))}))):Sd(m)))}getChildConfig(a,m,d){return m.children?on({routes:m.children,injector:a}):m.loadChildren?m._loadedRoutes!==void 0?on({routes:m._loadedRoutes,injector:m._loadedInjector}):oV(a,m,d,this.urlSerializer).pipe(qr(y=>y?this.configLoader.loadChildren(a,m).pipe(ti(i=>{m._loadedRoutes=i.routes,m._loadedInjector=i.injector})):lV(m))):on({routes:[],injector:a})}};function vV(s){s.sort((a,m)=>a.value.outlet===An?-1:m.value.outlet===An?1:a.value.outlet.localeCompare(m.value.outlet))}function xV(s){let a=s.value.routeConfig;return a&&a.path===""}function IP(s){let a=[],m=new Set;for(let d of s){if(!xV(d)){a.push(d);continue}let y=a.find(i=>d.value.routeConfig===i.value.routeConfig);y!==void 0?(y.children.push(...d.children),m.add(y)):a.push(d)}for(let d of m){let y=IP(d.children);a.push(new So(d.value,y))}return a.filter(d=>!m.has(d))}function bV(s){return s.data||{}}function wV(s){return s.resolve||{}}function TV(s,a,m,d,y,i){return qr(M=>_V(s,a,m,d,M.extractedUrl,y,i).pipe(On(({state:L,tree:B})=>Fr(Ct({},M),{targetSnapshot:L,urlAfterRedirects:B}))))}function EV(s,a){return qr(m=>{let{targetSnapshot:d,guards:{canActivateChecks:y}}=m;if(!y.length)return on(m);let i=new Set(y.map(B=>B.route)),M=new Set;for(let B of i)if(!M.has(B))for(let q of DP(B))M.add(q);let L=0;return Pr(M).pipe(Ia(B=>i.has(B)?IV(B,d,s,a):(B.data=IT(B,B.parent,s).resolve,on(void 0))),ti(()=>L++),id(1),qr(B=>L===M.size?on(m):Eo))})}function DP(s){let a=s.children.map(m=>DP(m)).flat();return[s,...a]}function IV(s,a,m,d){let y=s.routeConfig,i=s._resolve;return y?.title!==void 0&&!yP(y)&&(i[Mm]=y.title),DV(i,s,a,d).pipe(On(M=>(s._resolvedData=M,s.data=IT(s,s.parent,m).resolve,null)))}function DV(s,a,m,d){let y=eT(s);if(y.length===0)return on({});let i={};return Pr(y).pipe(qr(M=>MV(s[M],a,m,d).pipe(fs(),ti(L=>{i[M]=L}))),id(1),p1(i),Ll(M=>TP(M)?Eo:td(M)))}function MV(s,a,m,d){let y=Am(a)??d,i=Nd(s,y),M=i.resolve?i.resolve(a,m):_s(y,()=>i(a,m));return Ql(M)}function Kw(s){return so(a=>{let m=s(a);return m?Pr(m).pipe(On(()=>a)):on(a)})}var MP=(()=>{let a=class a{buildTitle(d){let y,i=d.root;for(;i!==void 0;)y=this.getResolvedTitleForRoute(i)??y,i=i.children.find(M=>M.outlet===An);return y}getResolvedTitleForRoute(d){return d.data[Mm]}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:()=>Xe(SV),providedIn:"root"});let s=a;return s})(),SV=(()=>{let a=class a extends MP{constructor(d){super(),this.title=d}updateTitle(d){let y=this.buildTitle(d);y!==void 0&&this.title.setTitle(y)}};a.\u0275fac=function(y){return new(y||a)(jt(H2))},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),Rm=new Wt("",{providedIn:"root",factory:()=>({})}),W0=new Wt(""),CT=(()=>{let a=class a{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Xe(x0)}loadComponent(d){if(this.componentLoaders.get(d))return this.componentLoaders.get(d);if(d._loadedComponent)return on(d._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(d);let y=Ql(d.loadComponent()).pipe(On(SP),ti(M=>{this.onLoadEndListener&&this.onLoadEndListener(d),d._loadedComponent=M}),Fl(()=>{this.componentLoaders.delete(d)})),i=new ed(y,()=>new Gi).pipe(Jh());return this.componentLoaders.set(d,i),i}loadChildren(d,y){if(this.childrenLoaders.get(y))return this.childrenLoaders.get(y);if(y._loadedRoutes)return on({routes:y._loadedRoutes,injector:y._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(y);let M=CV(y,this.compiler,d,this.onLoadEndListener).pipe(Fl(()=>{this.childrenLoaders.delete(y)})),L=new ed(M,()=>new Gi).pipe(Jh());return this.childrenLoaders.set(y,L),L}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function CV(s,a,m,d){return Ql(s.loadChildren()).pipe(On(SP),qr(y=>y instanceof jp||Array.isArray(y)?on(y):Pr(a.compileModuleAsync(y))),On(y=>{d&&d(s);let i,M,L=!1;return Array.isArray(y)?(M=y,L=!0):(i=y.create(m).injector,M=i.get(W0,[],{optional:!0,self:!0}).flat()),{routes:M.map(MT),injector:i}}))}function AV(s){return s&&typeof s=="object"&&"default"in s}function SP(s){return AV(s)?s.default:s}var AT=(()=>{let a=class a{};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:()=>Xe(PV),providedIn:"root"});let s=a;return s})(),PV=(()=>{let a=class a{shouldProcessUrl(d){return!0}extract(d){return d}merge(d,y){return d}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),CP=new Wt(""),AP=new Wt("");function RV(s,a,m){let d=s.get(AP),y=s.get(Fi);return s.get(_r).runOutsideAngular(()=>{if(!y.startViewTransition||d.skipNextTransition)return d.skipNextTransition=!1,new Promise(q=>setTimeout(q));let i,M=new Promise(q=>{i=q}),L=y.startViewTransition(()=>(i(),OV(s))),{onViewTransitionCreated:B}=d;return B&&_s(s,()=>B({transition:L,from:a,to:m})),M})}function OV(s){return new Promise(a=>{d0(a,{injector:s})})}var PT=(()=>{let a=class a{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Gi,this.transitionAbortSubject=new Gi,this.configLoader=Xe(CT),this.environmentInjector=Xe(ki),this.urlSerializer=Xe(Sm),this.rootContexts=Xe(Cm),this.location=Xe(Id),this.inputBindingEnabled=Xe(Q0,{optional:!0})!==null,this.titleStrategy=Xe(MP),this.options=Xe(Rm,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Xe(AT),this.createViewTransition=Xe(CP,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>on(void 0),this.rootComponentType=null;let d=i=>this.events.next(new lT(i)),y=i=>this.events.next(new cT(i));this.configLoader.onLoadEndListener=y,this.configLoader.onLoadStartListener=d}complete(){this.transitions?.complete()}handleNavigationRequest(d){let y=++this.navigationId;this.transitions?.next(Fr(Ct(Ct({},this.transitions.value),d),{id:y}))}setupNavigations(d,y,i){return this.transitions=new bi({id:0,currentUrlTree:y,currentRawUrl:y,extractedUrl:this.urlHandlingStrategy.extract(y),urlAfterRedirects:this.urlHandlingStrategy.extract(y),rawUrl:y,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:_m,restoredState:null,currentSnapshot:i.snapshot,targetSnapshot:null,currentRouterState:i,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(oo(M=>M.id!==0),On(M=>Fr(Ct({},M),{extractedUrl:this.urlHandlingStrategy.extract(M.rawUrl)})),so(M=>{let L=!1,B=!1;return on(M).pipe(so(q=>{if(this.navigationId>M.id)return this.cancelNavigationTransition(M,"",Co.SupersededByNewNavigation),Eo;this.currentTransition=M,this.currentNavigation={id:q.id,initialUrl:q.rawUrl,extractedUrl:q.extractedUrl,trigger:q.source,extras:q.extras,previousNavigation:this.lastSuccessfulNavigation?Fr(Ct({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let se=!d.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),ge=q.extras.onSameUrlNavigation??d.onSameUrlNavigation;if(!se&&ge!=="reload"){let Pe="";return this.events.next(new Zl(q.id,this.urlSerializer.serialize(q.rawUrl),Pe,B0.IgnoredSameUrlNavigation)),q.resolve(null),Eo}if(this.urlHandlingStrategy.shouldProcessUrl(q.rawUrl))return on(q).pipe(so(Pe=>{let Ke=this.transitions?.getValue();return this.events.next(new Ld(Pe.id,this.urlSerializer.serialize(Pe.extractedUrl),Pe.source,Pe.restoredState)),Ke!==this.transitions?.getValue()?Eo:Promise.resolve(Pe)}),TV(this.environmentInjector,this.configLoader,this.rootComponentType,d.config,this.urlSerializer,this.paramsInheritanceStrategy),ti(Pe=>{M.targetSnapshot=Pe.targetSnapshot,M.urlAfterRedirects=Pe.urlAfterRedirects,this.currentNavigation=Fr(Ct({},this.currentNavigation),{finalUrl:Pe.urlAfterRedirects});let Ke=new j0(Pe.id,this.urlSerializer.serialize(Pe.extractedUrl),this.urlSerializer.serialize(Pe.urlAfterRedirects),Pe.targetSnapshot);this.events.next(Ke)}));if(se&&this.urlHandlingStrategy.shouldProcessUrl(q.currentRawUrl)){let{id:Pe,extractedUrl:Ke,source:Nt,restoredState:sn,extras:Rt}=q,bt=new Ld(Pe,this.urlSerializer.serialize(Ke),Nt,sn);this.events.next(bt);let an=gP(this.rootComponentType).snapshot;return this.currentTransition=M=Fr(Ct({},q),{targetSnapshot:an,urlAfterRedirects:Ke,extras:Fr(Ct({},Rt),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=Ke,on(M)}else{let Pe="";return this.events.next(new Zl(q.id,this.urlSerializer.serialize(q.extractedUrl),Pe,B0.IgnoredByUrlHandlingStrategy)),q.resolve(null),Eo}}),ti(q=>{let se=new iT(q.id,this.urlSerializer.serialize(q.extractedUrl),this.urlSerializer.serialize(q.urlAfterRedirects),q.targetSnapshot);this.events.next(se)}),On(q=>(this.currentTransition=M=Fr(Ct({},q),{guards:V5(q.targetSnapshot,q.currentSnapshot,this.rootContexts)}),M)),X5(this.environmentInjector,q=>this.events.next(q)),ti(q=>{if(M.guardsResult=q.guardsResult,Od(q.guardsResult))throw xP(this.urlSerializer,q.guardsResult);let se=new oT(q.id,this.urlSerializer.serialize(q.extractedUrl),this.urlSerializer.serialize(q.urlAfterRedirects),q.targetSnapshot,!!q.guardsResult);this.events.next(se)}),oo(q=>q.guardsResult?!0:(this.cancelNavigationTransition(q,"",Co.GuardRejected),!1)),Kw(q=>{if(q.guards.canActivateChecks.length)return on(q).pipe(ti(se=>{let ge=new sT(se.id,this.urlSerializer.serialize(se.extractedUrl),this.urlSerializer.serialize(se.urlAfterRedirects),se.targetSnapshot);this.events.next(ge)}),so(se=>{let ge=!1;return on(se).pipe(EV(this.paramsInheritanceStrategy,this.environmentInjector),ti({next:()=>ge=!0,complete:()=>{ge||this.cancelNavigationTransition(se,"",Co.NoDataFromResolver)}}))}),ti(se=>{let ge=new aT(se.id,this.urlSerializer.serialize(se.extractedUrl),this.urlSerializer.serialize(se.urlAfterRedirects),se.targetSnapshot);this.events.next(ge)}))}),Kw(q=>{let se=ge=>{let Pe=[];ge.routeConfig?.loadComponent&&!ge.routeConfig._loadedComponent&&Pe.push(this.configLoader.loadComponent(ge.routeConfig).pipe(ti(Ke=>{ge.component=Ke}),On(()=>{})));for(let Ke of ge.children)Pe.push(...se(Ke));return Pe};return wp(se(q.targetSnapshot.root)).pipe(kl(null),Da(1))}),Kw(()=>this.afterPreactivation()),so(()=>{let{currentSnapshot:q,targetSnapshot:se}=M,ge=this.createViewTransition?.(this.environmentInjector,q.root,se.root);return ge?Pr(ge).pipe(On(()=>M)):on(M)}),On(q=>{let se=O5(d.routeReuseStrategy,q.targetSnapshot,q.currentRouterState);return this.currentTransition=M=Fr(Ct({},q),{targetRouterState:se}),this.currentNavigation.targetRouterState=se,M}),ti(()=>{this.events.next(new wm)}),j5(this.rootContexts,d.routeReuseStrategy,q=>this.events.next(q),this.inputBindingEnabled),Da(1),ti({next:q=>{L=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Fa(q.id,this.urlSerializer.serialize(q.extractedUrl),this.urlSerializer.serialize(q.urlAfterRedirects))),this.titleStrategy?.updateTitle(q.targetRouterState.snapshot),q.resolve(!0)},complete:()=>{L=!0}}),y1(this.transitionAbortSubject.pipe(ti(q=>{throw q}))),Fl(()=>{!L&&!B&&this.cancelNavigationTransition(M,"",Co.SupersededByNewNavigation),this.currentTransition?.id===M.id&&(this.currentNavigation=null,this.currentTransition=null)}),Ll(q=>{if(B=!0,wP(q))this.events.next(new Wl(M.id,this.urlSerializer.serialize(M.extractedUrl),q.message,q.cancellationCode)),F5(q)?this.events.next(new Tm(q.url)):M.resolve(!1);else{this.events.next(new bm(M.id,this.urlSerializer.serialize(M.extractedUrl),q,M.targetSnapshot??void 0));try{M.resolve(d.errorHandler(q))}catch(se){this.options.resolveNavigationPromiseOnError?M.resolve(!1):M.reject(se)}}return Eo}))}))}cancelNavigationTransition(d,y,i){let M=new Wl(d.id,this.urlSerializer.serialize(d.extractedUrl),y,i);this.events.next(M),d.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function LV(s){return s!==_m}var kV=(()=>{let a=class a{};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:()=>Xe(FV),providedIn:"root"});let s=a;return s})(),ET=class{shouldDetach(a){return!1}store(a,m){}shouldAttach(a){return!1}retrieve(a){return null}shouldReuseRoute(a,m){return a.routeConfig===m.routeConfig}},FV=(()=>{let a=class a extends ET{};a.\u0275fac=(()=>{let d;return function(i){return(d||(d=Qb(a)))(i||a)}})(),a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),PP=(()=>{let a=class a{};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:()=>Xe(NV),providedIn:"root"});let s=a;return s})(),NV=(()=>{let a=class a extends PP{constructor(){super(...arguments),this.location=Xe(Id),this.urlSerializer=Xe(Sm),this.options=Xe(Rm,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Xe(AT),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new ql,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=gP(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(d){return this.location.subscribe(y=>{y.type==="popstate"&&d(y.url,y.state)})}handleRouterEvent(d,y){if(d instanceof Ld)this.stateMemento=this.createStateMemento();else if(d instanceof Zl)this.rawUrlTree=y.initialUrl;else if(d instanceof j0){if(this.urlUpdateStrategy==="eager"&&!y.extras.skipLocationChange){let i=this.urlHandlingStrategy.merge(y.finalUrl,y.initialUrl);this.setBrowserUrl(i,y)}}else d instanceof wm?(this.currentUrlTree=y.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(y.finalUrl,y.initialUrl),this.routerState=y.targetRouterState,this.urlUpdateStrategy==="deferred"&&(y.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,y))):d instanceof Wl&&(d.code===Co.GuardRejected||d.code===Co.NoDataFromResolver)?this.restoreHistory(y):d instanceof bm?this.restoreHistory(y,!0):d instanceof Fa&&(this.lastSuccessfulId=d.id,this.currentPageId=this.browserPageId)}setBrowserUrl(d,y){let i=this.urlSerializer.serialize(d);if(this.location.isCurrentPathEqualTo(i)||y.extras.replaceUrl){let M=this.browserPageId,L=Ct(Ct({},y.extras.state),this.generateNgRouterState(y.id,M));this.location.replaceState(i,"",L)}else{let M=Ct(Ct({},y.extras.state),this.generateNgRouterState(y.id,this.browserPageId+1));this.location.go(i,"",M)}}restoreHistory(d,y=!1){if(this.canceledNavigationResolution==="computed"){let i=this.browserPageId,M=this.currentPageId-i;M!==0?this.location.historyGo(M):this.currentUrlTree===d.finalUrl&&M===0&&(this.resetState(d),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(y&&this.resetState(d),this.resetUrlToCurrentUrlTree())}resetState(d){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,d.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(d,y){return this.canceledNavigationResolution==="computed"?{navigationId:d,\u0275routerPageId:y}:{navigationId:d}}};a.\u0275fac=(()=>{let d;return function(i){return(d||(d=Qb(a)))(i||a)}})(),a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),mm=function(s){return s[s.COMPLETE=0]="COMPLETE",s[s.FAILED=1]="FAILED",s[s.REDIRECTING=2]="REDIRECTING",s}(mm||{});function RP(s,a){s.events.pipe(oo(m=>m instanceof Fa||m instanceof Wl||m instanceof bm||m instanceof Zl),On(m=>m instanceof Fa||m instanceof Zl?mm.COMPLETE:(m instanceof Wl?m.code===Co.Redirect||m.code===Co.SupersededByNewNavigation:!1)?mm.REDIRECTING:mm.FAILED),oo(m=>m!==mm.REDIRECTING),Da(1)).subscribe(()=>{a()})}function zV(s){throw s}var BV={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},jV={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},wu=(()=>{let a=class a{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Xe(g0),this.stateManager=Xe(PP),this.options=Xe(Rm,{optional:!0})||{},this.pendingTasks=Xe(_u),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Xe(PT),this.urlSerializer=Xe(Sm),this.location=Xe(Id),this.urlHandlingStrategy=Xe(AT),this._events=new Gi,this.errorHandler=this.options.errorHandler||zV,this.navigated=!1,this.routeReuseStrategy=Xe(kV),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Xe(W0,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Xe(Q0,{optional:!0}),this.eventsSubscription=new ei,this.isNgZoneEnabled=Xe(_r)instanceof _r&&_r.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:d=>{this.console.warn(d)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let d=this.navigationTransitions.events.subscribe(y=>{try{let i=this.navigationTransitions.currentTransition,M=this.navigationTransitions.currentNavigation;if(i!==null&&M!==null){if(this.stateManager.handleRouterEvent(y,M),y instanceof Wl&&y.code!==Co.Redirect&&y.code!==Co.SupersededByNewNavigation)this.navigated=!0;else if(y instanceof Fa)this.navigated=!0;else if(y instanceof Tm){let L=this.urlHandlingStrategy.merge(y.url,i.currentRawUrl),B={info:i.extras.info,skipLocationChange:i.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||LV(i.source)};this.scheduleNavigation(L,_m,null,B,{resolve:i.resolve,reject:i.reject,promise:i.promise})}}UV(y)&&this._events.next(y)}catch(i){this.navigationTransitions.transitionAbortSubject.next(i)}});this.eventsSubscription.add(d)}resetRootComponentType(d){this.routerState.root.component=d,this.navigationTransitions.rootComponentType=d}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),_m,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((d,y)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(d,"popstate",y)},0)})}navigateToSyncWithBrowser(d,y,i){let M={replaceUrl:!0},L=i?.navigationId?i:null;if(i){let q=Ct({},i);delete q.navigationId,delete q.\u0275routerPageId,Object.keys(q).length!==0&&(M.state=q)}let B=this.parseUrl(d);this.scheduleNavigation(B,y,L,M)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(d){this.config=d.map(MT),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(d,y={}){let{relativeTo:i,queryParams:M,fragment:L,queryParamsHandling:B,preserveFragment:q}=y,se=q?this.currentUrlTree.fragment:L,ge=null;switch(B){case"merge":ge=Ct(Ct({},this.currentUrlTree.queryParams),M);break;case"preserve":ge=this.currentUrlTree.queryParams;break;default:ge=M||null}ge!==null&&(ge=this.removeEmptyProps(ge));let Pe;try{let Ke=i?i.snapshot:this.routerState.snapshot.root;Pe=dP(Ke)}catch{(typeof d[0]!="string"||!d[0].startsWith("/"))&&(d=[]),Pe=this.currentUrlTree.root}return fP(Pe,d,ge,se??null)}navigateByUrl(d,y={skipLocationChange:!1}){let i=Od(d)?d:this.parseUrl(d),M=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(M,_m,null,y)}navigate(d,y={skipLocationChange:!1}){return VV(d),this.navigateByUrl(this.createUrlTree(d,y),y)}serializeUrl(d){return this.urlSerializer.serialize(d)}parseUrl(d){try{return this.urlSerializer.parse(d)}catch{return this.urlSerializer.parse("/")}}isActive(d,y){let i;if(y===!0?i=Ct({},BV):y===!1?i=Ct({},jV):i=y,Od(d))return Z2(this.currentUrlTree,d,i);let M=this.parseUrl(d);return Z2(this.currentUrlTree,M,i)}removeEmptyProps(d){return Object.entries(d).reduce((y,[i,M])=>(M!=null&&(y[i]=M),y),{})}scheduleNavigation(d,y,i,M,L){if(this.disposed)return Promise.resolve(!1);let B,q,se;L?(B=L.resolve,q=L.reject,se=L.promise):se=new Promise((Pe,Ke)=>{B=Pe,q=Ke});let ge=this.pendingTasks.add();return RP(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(ge))}),this.navigationTransitions.handleNavigationRequest({source:y,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:d,extras:M,resolve:B,reject:q,promise:se,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),se.catch(Pe=>Promise.reject(Pe))}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function VV(s){for(let a=0;a<s.length;a++)if(s[a]==null)throw new Xt(4008,!1)}function UV(s){return!(s instanceof wm)&&!(s instanceof Tm)}var Z0=class{};var $V=(()=>{let a=class a{constructor(d,y,i,M,L){this.router=d,this.injector=i,this.preloadingStrategy=M,this.loader=L}setUpPreloading(){this.subscription=this.router.events.pipe(oo(d=>d instanceof Fa),Ia(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(d,y){let i=[];for(let M of y){M.providers&&!M._injector&&(M._injector=f0(M.providers,d,`Route: ${M.path}`));let L=M._injector??d,B=M._loadedInjector??L;(M.loadChildren&&!M._loadedRoutes&&M.canLoad===void 0||M.loadComponent&&!M._loadedComponent)&&i.push(this.preloadConfig(L,M)),(M.children||M._loadedRoutes)&&i.push(this.processRoutes(B,M.children??M._loadedRoutes))}return Pr(i).pipe(nd())}preloadConfig(d,y){return this.preloadingStrategy.preload(y,()=>{let i;y.loadChildren&&y.canLoad===void 0?i=this.loader.loadChildren(d,y):i=on(null);let M=i.pipe(qr(L=>L===null?on(void 0):(y._loadedRoutes=L.routes,y._loadedInjector=L.injector,this.processRoutes(L.injector??d,L.routes))));if(y.loadComponent&&!y._loadedComponent){let L=this.loader.loadComponent(y);return Pr([M,L]).pipe(nd())}else return M})}};a.\u0275fac=function(y){return new(y||a)(jt(wu),jt(x0),jt(ki),jt(Z0),jt(CT))},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),OP=new Wt(""),GV=(()=>{let a=class a{constructor(d,y,i,M,L={}){this.urlSerializer=d,this.transitions=y,this.viewportScroller=i,this.zone=M,this.options=L,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},this.environmentInjector=Xe(ki),L.scrollPositionRestoration||="disabled",L.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(d=>{d instanceof Ld?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=d.navigationTrigger,this.restoredId=d.restoredState?d.restoredState.navigationId:0):d instanceof Fa?(this.lastId=d.id,this.scheduleScrollEvent(d,this.urlSerializer.parse(d.urlAfterRedirects).fragment)):d instanceof Zl&&d.code===B0.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(d,this.urlSerializer.parse(d.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(d=>{d instanceof V0&&(d.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(d.position):d.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(d.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(d,y){this.zone.runOutsideAngular(()=>Wh(this,null,function*(){yield new Promise(i=>{setTimeout(()=>{i()}),d0(()=>{i()},{injector:this.environmentInjector})}),this.zone.run(()=>{this.transitions.events.next(new V0(d,this.lastSource==="popstate"?this.store[this.restoredId]:null,y))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};a.\u0275fac=function(y){tA()},a.\u0275prov=kt({token:a,factory:a.\u0275fac});let s=a;return s})();function HV(s){return s.routerState.root}function Om(s,a){return{\u0275kind:s,\u0275providers:a}}function qV(){let s=Xe(xs);return a=>{let m=s.get(Oa);if(a!==m.components[0])return;let d=s.get(wu),y=s.get(LP);s.get(RT)===1&&d.initialNavigation(),s.get(kP,null,zn.Optional)?.setUpPreloading(),s.get(OP,null,zn.Optional)?.init(),d.resetRootComponentType(m.componentTypes[0]),y.closed||(y.next(),y.complete(),y.unsubscribe())}}var LP=new Wt("",{factory:()=>new Gi}),RT=new Wt("",{providedIn:"root",factory:()=>1});function WV(){return Om(2,[{provide:RT,useValue:0},{provide:v0,multi:!0,deps:[xs],useFactory:a=>{let m=a.get(c2,Promise.resolve());return()=>m.then(()=>new Promise(d=>{let y=a.get(wu),i=a.get(LP);RP(y,()=>{d(!0)}),a.get(PT).afterPreactivation=()=>(d(!0),i.closed?on(void 0):i),y.initialNavigation()}))}}])}function ZV(){return Om(3,[{provide:v0,multi:!0,useFactory:()=>{let a=Xe(wu);return()=>{a.setUpLocationChangeListener()}}},{provide:RT,useValue:2}])}var kP=new Wt("");function QV(s){return Om(0,[{provide:kP,useExisting:$V},{provide:Z0,useExisting:s}])}function YV(){return Om(8,[K2,{provide:Q0,useExisting:K2}])}function XV(s){let a=[{provide:CP,useValue:RV},{provide:AP,useValue:Ct({skipNextTransition:!!s?.skipInitialTransition},s)}];return Om(9,a)}var eP=new Wt("ROUTER_FORROOT_GUARD"),KV=[Id,{provide:Sm,useClass:vm},wu,Cm,{provide:kd,useFactory:HV,deps:[wu]},CT,[]],OT=(()=>{let a=class a{constructor(d){}static forRoot(d,y){return{ngModule:a,providers:[KV,[],{provide:W0,multi:!0,useValue:d},{provide:eP,useFactory:nU,deps:[[wu,new Rb,new LS]]},{provide:Rm,useValue:y||{}},y?.useHash?eU():tU(),JV(),y?.preloadingStrategy?QV(y.preloadingStrategy).\u0275providers:[],y?.initialNavigation?rU(y):[],y?.bindToComponentInputs?YV().\u0275providers:[],y?.enableViewTransitions?XV().\u0275providers:[],iU()]}}static forChild(d){return{ngModule:a,providers:[{provide:W0,multi:!0,useValue:d}]}}};a.\u0275fac=function(y){return new(y||a)(jt(eP,8))},a.\u0275mod=qi({type:a}),a.\u0275inj=Hi({});let s=a;return s})();function JV(){return{provide:OP,useFactory:()=>{let s=Xe(f2),a=Xe(_r),m=Xe(Rm),d=Xe(PT),y=Xe(Sm);return m.scrollOffset&&s.setOffset(m.scrollOffset),new GV(y,d,s,a,m)}}}function eU(){return{provide:vu,useClass:h2}}function tU(){return{provide:vu,useClass:Ow}}function nU(s){return"guarded"}function rU(s){return[s.initialNavigation==="disabled"?ZV().\u0275providers:[],s.initialNavigation==="enabledBlocking"?WV().\u0275providers:[]]}var tP=new Wt("");function iU(){return[{provide:tP,useFactory:qV},{provide:Td,multi:!0,useExisting:tP}]}var oU=[],FP=(()=>{let a=class a{};a.\u0275fac=function(y){return new(y||a)},a.\u0275mod=qi({type:a}),a.\u0275inj=Hi({imports:[OT.forRoot(oU),OT]});let s=a;return s})();var X0={apiKey:"pk.eyJ1Ijoic295aXZhbm4iLCJhIjoiY2x3cTllbHR4MDAyNDJtc2RmamFvamgxOSJ9.IiYxo2s5Vh0CW-TrROAn4A"};var NP=(()=>{let a=class a extends cm{constructor(d){super(d),this.baseUrl="https://api.mapbox.com/search/geocode/v6/forward?q="}get(d,y){return d=this.baseUrl+d,super.get(d,{params:Ct({limit:5,language:"es",access_token:X0.apiKey},y.params)})}};a.\u0275fac=function(y){return new(y||a)(jt(ka))},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var Tu=Jx(K0());var BP=(()=>{let a=class a extends cm{constructor(d){super(d),this.baseUrl="https://api.mapbox.com/directions/v5/mapbox/driving"}get(d){return d=this.baseUrl+d,super.get(d,{params:{alternatives:!1,geometries:"geojson",language:"es",overview:"simplified",steps:!1,access_token:X0.apiKey}})}};a.\u0275fac=function(y){return new(y||a)(jt(ka))},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var Yl=(()=>{let a=class a{constructor(){this.markers=[],this.directionsApi=Xe(BP)}get isMapReady(){return!!this.map}setMap(d){this.map=d}flyTo(d){if(!this.isMapReady)throw Error("El mapa no est\xE1 inicializado");this.map?.flyTo({zoom:14,center:d})}createMarkersFromPlaces(d,y){if(!this.map)throw Error("Mapa no inicializado");this.markers.forEach(L=>L.remove());let i=[];for(let L of d){let[B,q]=[L.properties.coordinates.longitude,L.properties.coordinates.latitude],se=new Tu.Popup().setHTML(`
          <h6>${L.properties.name}</h6>
          <span>${L.properties.full_address}</span>
        `),ge=new Tu.Marker().setLngLat([B,q]).setPopup(se).addTo(this.map);i.push(ge)}if(this.markers=i,d.length===0)return;let M=new Tu.LngLatBounds;i.forEach(L=>M.extend(L.getLngLat())),M.extend(y),this.map.fitBounds(M,{padding:200})}getRouteBetweenPoints(d,y){this.directionsApi.get(`/${d.join(",")};${y.join(",")}`).subscribe(i=>this.drawPolyline(i.routes[0]))}drawPolyline(d){if(console.log({kms:d.distance/1e3,duration:d.duration/60}),!this.map)throw Error("Mapa no inicializado");let y=d.geometry.coordinates,i=new Tu.LngLatBounds;y.forEach(([L,B])=>{i.extend([L,B])}),this.map?.fitBounds(i,{padding:200});let M={type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:y}}]}};this.map.getLayer("RouteString")&&(this.map.removeLayer("RouteString"),this.map.removeSource("RouteString")),this.map.addSource("RouteString",M),this.map.addLayer({id:"RouteString",type:"line",source:"RouteString",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"black","line-width":3}})}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var Zs=(()=>{let a=class a{get isUserLocationReady(){return!!this.userLocation}constructor(){this.isLoadingPlaces=!1,this.places=[],this.mapService=Xe(Yl),this.placesApi=Xe(NP),this.getUserLocation()}getUserLocation(){return Wh(this,null,function*(){return new Promise((d,y)=>{navigator.geolocation.getCurrentPosition(({coords:i})=>{this.userLocation=[i.longitude,i.latitude],d(this.userLocation)},i=>{alert("No se pudo obtener la geolocalizacion"),console.log(i),y()})})})}getPlacesByQuery(d=""){if(d.length===0){this.isLoadingPlaces=!1,this.places=[];return}if(!this.userLocation)throw Error("No hay userLocation");this.isLoadingPlaces=!0,this.placesApi.get(`${d}`,{params:{proximity:this.userLocation.join(",")}}).subscribe(y=>{this.isLoadingPlaces=!1,this.places=y.features,this.mapService.createMarkersFromPlaces(this.places,this.userLocation)})}deletePlaces(){this.places=[]}};a.\u0275fac=function(y){return new(y||a)},a.\u0275prov=kt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var zd=Jx(K0());var sU=["map"],jP=(()=>{let a=class a{constructor(){this.placesService=Xe(Zs),this.mapService=Xe(Yl)}ngAfterViewInit(){if(!this.placesService.userLocation)throw Error("No hay placesService.userLocation");let d=new zd.Map({container:this.mapDivElement.nativeElement,style:"mapbox://styles/mapbox/streets-v12",center:this.placesService.userLocation,zoom:14}),y=new zd.Popup().setHTML(`
        <h6>Aqu\xED estoy</h6>
        <span>Estoy en este lugar del mundo</span>
      `);new zd.Marker({color:"red"}).setLngLat(this.placesService.userLocation).setPopup(y).addTo(d),this.mapService.setMap(d)}};a.\u0275fac=function(y){return new(y||a)},a.\u0275cmp=hi({type:a,selectors:[["app-map-view"]],viewQuery:function(y,i){if(y&1&&VA(sU,5),y&2){let M;bw(M=ww())&&(i.mapDivElement=M.first)}},decls:2,vars:0,consts:[["map",""],[1,"map-container"]],template:function(y,i){y&1&&Wi(0,"div",1,0)},styles:[".map-container[_ngcontent-%COMP%]{height:100vh;position:fixed;right:0;top:0;width:100vw}"]});let s=a;return s})();var VP=(()=>{let a=class a{};a.\u0275fac=function(y){return new(y||a)},a.\u0275cmp=hi({type:a,selectors:[["app-loading"]],decls:6,vars:0,consts:[[1,"loading-map","d-flex","justify-content-center","align-items-center"],[1,"text-center"]],template:function(y,i){y&1&&(Ei(0,"div",0)(1,"div",1)(2,"h3"),bs(3,"Espere por favor"),Ii(),Ei(4,"span"),bs(5,"Localizando..."),Ii()()())},styles:[".loading-map[_ngcontent-%COMP%]{background-color:#000c;color:#fff;height:100vh;position:fixed;right:0;top:0;width:100vw}"]});let s=a;return s})();var UP=(()=>{let a=class a{constructor(){this.mapService=Xe(Yl),this.placesService=Xe(Zs)}goToMyLocation(){if(!this.placesService.isUserLocationReady)throw Error("No hay ubicaci\xF3n de usuario");if(!this.mapService.isMapReady)throw Error("No hay mapa disponible");this.mapService.flyTo(this.placesService.userLocation)}};a.\u0275fac=function(y){return new(y||a)},a.\u0275cmp=hi({type:a,selectors:[["app-btn-my-location"]],decls:2,vars:0,consts:[[1,"btn","btn-primary",3,"click"]],template:function(y,i){y&1&&(Ei(0,"button",0),Ra("click",function(){return i.goToMyLocation()}),bs(1,"Mi ubicaci\xF3n"),Ii())},styles:["button[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px}"]});let s=a;return s})();var $P=(()=>{let a=class a{};a.\u0275fac=function(y){return new(y||a)},a.\u0275cmp=hi({type:a,selectors:[["app-angular-logo"]],decls:1,vars:0,consts:[["width","100","alt","Angular Logo","src","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTAgMjUwIj4KICAgIDxwYXRoIGZpbGw9IiNERDAwMzEiIGQ9Ik0xMjUgMzBMMzEuOSA2My4ybDE0LjIgMTIzLjFMMTI1IDIzMGw3OC45LTQzLjcgMTQuMi0xMjMuMXoiIC8+CiAgICA8cGF0aCBmaWxsPSIjQzMwMDJGIiBkPSJNMTI1IDMwdjIyLjItLjFWMjMwbDc4LjktNDMuNyAxNC4yLTEyMy4xTDEyNSAzMHoiIC8+CiAgICA8cGF0aCAgZmlsbD0iI0ZGRkZGRiIgZD0iTTEyNSA1Mi4xTDY2LjggMTgyLjZoMjEuN2wxMS43LTI5LjJoNDkuNGwxMS43IDI5LjJIMTgzTDEyNSA1Mi4xem0xNyA4My4zaC0zNGwxNy00MC45IDE3IDQwLjl6IiAvPgogIDwvc3ZnPg=="]],template:function(y,i){y&1&&Wi(0,"img",0)},styles:["img[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px}"]});let s=a;return s})();function hU(s,a){s&1&&(Ei(0,"div",0)(1,"h6"),bs(2,"Cargando"),Ii(),Ei(3,"span"),bs(4,"Espere por favor..."),Ii()())}function dU(s,a){if(s&1){let m=p0();Ei(0,"li",3),Ra("click",function(){let y=Zp(m).$implicit,i=nm(2);return Qp(i.flyTo(y))}),Ei(1,"h6"),bs(2),Ii(),Ei(3,"p"),bs(4),Ii(),Ei(5,"button",4),Ra("click",function(){let y=Zp(m).$implicit,i=nm(2);return Qp(i.getDirections(y))}),bs(6," Direcciones "),Ii()()}if(s&2){let m=a.$implicit,d=nm(2);xw("active",m.id===d.selectedId),bd(2),m0(m.properties.name),bd(2),m0(m.properties.full_address),bd(),vw("ngClass",m.id===d.selectedId?"btn-outline-light":"btn-outline-primary")}}function fU(s,a){if(s&1&&(Ei(0,"ul",1),NA(1,dU,7,5,"li",2,FA),Ii()),s&2){let m=nm();bd(),zA(m.places)}}var GP=(()=>{let a=class a{constructor(){this.selectedId="",this.placesService=Xe(Zs),this.mapService=Xe(Yl)}get isLoadingPlaces(){return this.placesService.isLoadingPlaces}get places(){return this.placesService.places}flyTo(d){this.selectedId=d.id;let[y,i]=[d.properties.coordinates.longitude,d.properties.coordinates.latitude];this.mapService.flyTo([y,i])}getDirections(d){if(!this.placesService.userLocation)throw Error("No hay userLocation");this.placesService.deletePlaces();let y=this.placesService.userLocation,i=[d.properties.coordinates.longitude,d.properties.coordinates.latitude];this.mapService.getRouteBetweenPoints(y,i)}};a.\u0275fac=function(y){return new(y||a)},a.\u0275cmp=hi({type:a,selectors:[["app-search-results"]],decls:2,vars:2,consts:[[1,"alert","alert-primary","mt-2","text-center"],[1,"list-group","mt-2"],[1,"list-group-item","list-group-item-action","pointer",3,"active"],[1,"list-group-item","list-group-item-action","pointer",3,"click"],[1,"btn","btn-sm",3,"click","ngClass"]],template:function(y,i){y&1&&fu(0,hU,5,0,"div",0)(1,fU,3,0,"ul",1),y&2&&(tm(0,i.isLoadingPlaces?0:-1),bd(),tm(1,i.places.length>0?1:-1))},dependencies:[d2],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}p[_ngcontent-%COMP%]{font-size:12px}"]});let s=a;return s})();var HP=(()=>{let a=class a{constructor(){this.placesService=Xe(Zs)}onQueryChanged(d=""){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.placesService.getPlacesByQuery(d)},500)}};a.\u0275fac=function(y){return new(y||a)},a.\u0275cmp=hi({type:a,selectors:[["app-search-bar"]],decls:4,vars:0,consts:[["txtQuery",""],[1,"search-container"],["type","text","placeholder","Buscar lugar...",1,"form-control",3,"keyup"]],template:function(y,i){if(y&1){let M=p0();Ei(0,"div",1)(1,"input",2,0),Ra("keyup",function(){Zp(M);let B=UA(2);return Qp(i.onQueryChanged(B.value))}),Ii(),Wi(3,"app-search-results"),Ii()}},dependencies:[GP],styles:[".search-container[_ngcontent-%COMP%]{background-color:#fff;border-radius:5px;border:1px solid rgba(0,0,0,.1);box-shadow:0 10px 10px #0000001a;left:20px;padding:5px;position:fixed;top:20px;width:270px}"]});let s=a;return s})();function gU(s,a){s&1&&Wi(0,"app-loading")}function _U(s,a){s&1&&Wi(0,"app-map-view")(1,"app-btn-my-location")(2,"app-search-bar")}var qP=(()=>{let a=class a{constructor(){this.placesService=Xe(Zs)}get isUserLocationReady(){return this.placesService.isUserLocationReady}};a.\u0275fac=function(y){return new(y||a)},a.\u0275cmp=hi({type:a,selectors:[["app-map-screen"]],decls:3,vars:1,template:function(y,i){y&1&&(fu(0,gU,1,0,"app-loading")(1,_U,3,0),Wi(2,"app-angular-logo")),y&2&&tm(0,i.isUserLocationReady?1:0)},dependencies:[jP,VP,UP,$P,HP]});let s=a;return s})();var WP=(()=>{let a=class a{constructor(){this.title="maps-app"}};a.\u0275fac=function(y){return new(y||a)},a.\u0275cmp=hi({type:a,selectors:[["app-root"]],decls:1,vars:0,template:function(y,i){y&1&&Wi(0,"app-map-screen")},dependencies:[qP]});let s=a;return s})();var ZP=(()=>{let a=class a{};a.\u0275fac=function(y){return new(y||a)},a.\u0275mod=qi({type:a}),a.\u0275inj=Hi({imports:[T0]});let s=a;return s})();var QP=(()=>{let a=class a{};a.\u0275fac=function(y){return new(y||a)},a.\u0275mod=qi({type:a,bootstrap:[WP]}),a.\u0275inj=Hi({providers:[q2()],imports:[G2,FP,ZP,O2]});let s=a;return s})();var YP=Jx(K0());YP.default.accessToken="pk.eyJ1Ijoic295aXZhbm4iLCJhIjoiY2x3cTllbHR4MDAyNDJtc2RmamFvamgxOSJ9.IiYxo2s5Vh0CW-TrROAn4A";if(!navigator.geolocation)throw alert("Navigator does not support Geolocation"),new Error("Navigator does not support Geolocation");$2().bootstrapModule(QP).catch(s=>console.error(s));
